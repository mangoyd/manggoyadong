(self["webpackChunknew_web"]=self["webpackChunknew_web"]||[]).push([[231],{3707:function(e){var t=9;if("undefined"!==typeof Element&&!Element.prototype.matches){var i=Element.prototype;i.matches=i.matchesSelector||i.mozMatchesSelector||i.msMatchesSelector||i.oMatchesSelector||i.webkitMatchesSelector}function n(e,i){while(e&&e.nodeType!==t){if("function"===typeof e.matches&&e.matches(i))return e;e=e.parentNode}}e.exports=n},2357:function(e,t,i){var n=i(3707);function s(e,t,i,n,s){var r=o.apply(this,arguments);return e.addEventListener(i,r,s),{destroy:function(){e.removeEventListener(i,r,s)}}}function r(e,t,i,n,r){return"function"===typeof e.addEventListener?s.apply(null,arguments):"function"===typeof i?s.bind(null,document).apply(null,arguments):("string"===typeof e&&(e=document.querySelectorAll(e)),Array.prototype.map.call(e,(function(e){return s(e,t,i,n,r)})))}function o(e,t,i,s){return function(i){i.delegateTarget=n(i.target,t),i.delegateTarget&&s.call(e,i)}}e.exports=r},5753:function(e,t,i){var n,s,r;i(6573),i(8100),i(7936),i(7467),i(4732),i(9577),i(4979),i(4603),i(7566),i(8721),function(i,o){s=[],n=o,r="function"===typeof n?n.apply(t,s):n,void 0===r||(e.exports=r)}(0,(function(){return function e(t,i,n){var s,r,o=window,a="application/octet-stream",l=n||a,c=t,u=!i&&!n&&c,h=document.createElement("a"),d=function(e){return String(e)},p=o.Blob||o.MozBlob||o.WebKitBlob||d,f=i||"download";if(p=p.call?p.bind(o):Blob,"true"===String(this)&&(c=[c,l],l=c[0],c=c[1]),u&&u.length<2048&&(f=u.split("/").pop().split("?")[0],h.href=u,-1!==h.href.indexOf(u))){var g=new XMLHttpRequest;return g.open("GET",u,!0),g.responseType="blob",g.onload=function(t){e(t.target.response,f,a)},setTimeout((function(){g.send()}),0),g}if(/^data:([\w+-]+\/[\w+.-]+)?[,;]/.test(c)){if(!(c.length>2096103.424&&p!==d))return navigator.msSaveBlob?navigator.msSaveBlob(_(c),f):b(c);c=_(c),l=c.type||a}else if(/([\x80-\xff])/.test(c)){var m=0,v=new Uint8Array(c.length),y=v.length;for(m;m<y;++m)v[m]=c.charCodeAt(m);c=new p([v],{type:l})}function _(e){var t=e.split(/[:;,]/),i=t[1],n="base64"==t[2]?atob:decodeURIComponent,s=n(t.pop()),r=s.length,o=0,a=new Uint8Array(r);for(o;o<r;++o)a[o]=s.charCodeAt(o);return new p([a],{type:i})}function b(e,t){if("download"in h)return h.href=e,h.setAttribute("download",f),h.className="download-js-link",h.innerHTML="downloading...",h.style.display="none",document.body.appendChild(h),setTimeout((function(){h.click(),document.body.removeChild(h),!0===t&&setTimeout((function(){o.URL.revokeObjectURL(h.href)}),250)}),66),!0;if(/(Version)\/(\d+)\.(\d+)(?:\.(\d+))?.*Safari\//.test(navigator.userAgent))return/^data:/.test(e)&&(e="data:"+e.replace(/^data:([\w\/\-\+]+)/,a)),window.open(e)||confirm("Displaying New Document\n\nUse Save As... to download, then click back to return to this page.")&&(location.href=e),!0;var i=document.createElement("iframe");document.body.appendChild(i),!t&&/^data:/.test(e)&&(e="data:"+e.replace(/^data:([\w\/\-\+]+)/,a)),i.src=e,setTimeout((function(){document.body.removeChild(i)}),333)}if(s=c instanceof p?c:new p([c],{type:l}),navigator.msSaveBlob)return navigator.msSaveBlob(s,f);if(o.URL)b(o.URL.createObjectURL(s),!0);else{if("string"===typeof s||s.constructor===d)try{return b("data:"+l+";base64,"+o.btoa(s))}catch(S){return b("data:"+l+","+encodeURIComponent(s))}r=new FileReader,r.onload=function(e){b(this.result)},r.readAsDataURL(s)}return!0}}))},3529:function(e,t,i){"use strict";i(4114);var n=Object.prototype.hasOwnProperty,s="~";function r(){}function o(e,t,i){this.fn=e,this.context=t,this.once=i||!1}function a(e,t,i,n,r){if("function"!==typeof i)throw new TypeError("The listener must be a function");var a=new o(i,n||e,r),l=s?s+t:t;return e._events[l]?e._events[l].fn?e._events[l]=[e._events[l],a]:e._events[l].push(a):(e._events[l]=a,e._eventsCount++),e}function l(e,t){0===--e._eventsCount?e._events=new r:delete e._events[t]}function c(){this._events=new r,this._eventsCount=0}Object.create&&(r.prototype=Object.create(null),(new r).__proto__||(s=!1)),c.prototype.eventNames=function(){var e,t,i=[];if(0===this._eventsCount)return i;for(t in e=this._events)n.call(e,t)&&i.push(s?t.slice(1):t);return Object.getOwnPropertySymbols?i.concat(Object.getOwnPropertySymbols(e)):i},c.prototype.listeners=function(e){var t=s?s+e:e,i=this._events[t];if(!i)return[];if(i.fn)return[i.fn];for(var n=0,r=i.length,o=new Array(r);n<r;n++)o[n]=i[n].fn;return o},c.prototype.listenerCount=function(e){var t=s?s+e:e,i=this._events[t];return i?i.fn?1:i.length:0},c.prototype.emit=function(e,t,i,n,r,o){var a=s?s+e:e;if(!this._events[a])return!1;var l,c,u=this._events[a],h=arguments.length;if(u.fn){switch(u.once&&this.removeListener(e,u.fn,void 0,!0),h){case 1:return u.fn.call(u.context),!0;case 2:return u.fn.call(u.context,t),!0;case 3:return u.fn.call(u.context,t,i),!0;case 4:return u.fn.call(u.context,t,i,n),!0;case 5:return u.fn.call(u.context,t,i,n,r),!0;case 6:return u.fn.call(u.context,t,i,n,r,o),!0}for(c=1,l=new Array(h-1);c<h;c++)l[c-1]=arguments[c];u.fn.apply(u.context,l)}else{var d,p=u.length;for(c=0;c<p;c++)switch(u[c].once&&this.removeListener(e,u[c].fn,void 0,!0),h){case 1:u[c].fn.call(u[c].context);break;case 2:u[c].fn.call(u[c].context,t);break;case 3:u[c].fn.call(u[c].context,t,i);break;case 4:u[c].fn.call(u[c].context,t,i,n);break;default:if(!l)for(d=1,l=new Array(h-1);d<h;d++)l[d-1]=arguments[d];u[c].fn.apply(u[c].context,l)}}return!0},c.prototype.on=function(e,t,i){return a(this,e,t,i,!1)},c.prototype.once=function(e,t,i){return a(this,e,t,i,!0)},c.prototype.removeListener=function(e,t,i,n){var r=s?s+e:e;if(!this._events[r])return this;if(!t)return l(this,r),this;var o=this._events[r];if(o.fn)o.fn!==t||n&&!o.once||i&&o.context!==i||l(this,r);else{for(var a=0,c=[],u=o.length;a<u;a++)(o[a].fn!==t||n&&!o[a].once||i&&o[a].context!==i)&&c.push(o[a]);c.length?this._events[r]=1===c.length?c[0]:c:l(this,r)}return this},c.prototype.removeAllListeners=function(e){var t;return e?(t=s?s+e:e,this._events[t]&&l(this,t)):(this._events=new r,this._eventsCount=0),this},c.prototype.off=c.prototype.removeListener,c.prototype.addListener=c.prototype.on,c.prefixed=s,c.EventEmitter=c,e.exports=c},2392:function(e,t,i){"use strict";i.d(t,{A:function(){return p}});var n=i(6768),s=i(4232);const r={class:"pagination"},o=["disabled"],a=["onClick"],l=["disabled"];function c(e,t,i,c,u,h){const d=(0,n.g2)("van-icon");return(0,n.uX)(),(0,n.CE)("div",r,[(0,n.Lk)("button",{class:"pagination-button",disabled:i.currentPage<=1,onClick:t[0]||(t[0]=(...e)=>h.goToPreviousTenPages&&h.goToPreviousTenPages(...e))},[(0,n.bF)(d,{name:"arrow-left"})],8,o),((0,n.uX)(),(0,n.CE)("div",{class:"page-numbers",key:u.componentKey},[((0,n.uX)(!0),(0,n.CE)(n.FK,null,(0,n.pI)(h.visiblePages,(t=>((0,n.uX)(),(0,n.CE)("span",{key:t,class:(0,s.C4)({active:e.activePages[t]}),onClick:e=>h.goToPage(t)},(0,s.v_)(t),11,a)))),128))])),(0,n.Lk)("button",{class:"pagination-button",disabled:i.currentPage>=i.totalPages,onClick:t[1]||(t[1]=(...e)=>h.goToNextTenPages&&h.goToNextTenPages(...e))},[(0,n.bF)(d,{name:"arrow"})],8,l)])}i(8992),i(3949);var u={name:"Pagination",props:{totalPages:{type:Number,required:!0},currentPage:{type:Number,required:!0}},data(){return{componentKey:0}},emits:["page-change"],watch:{visiblePages:{handler(e){this.updateActivePages(this.currentPage)},immediate:!0}},computed:{visiblePages(){const e=10*Math.floor((this.currentPage-1)/10)+1,t=Math.min(e+9,this.totalPages);return Array.from({length:t-e+1},((t,i)=>e+i))}},methods:{updateActivePages(e){this.activePages={},this.visiblePages.forEach((t=>{this.activePages[t]=t===e,this.componentKey+=1}))},goToPage(e){e>=1&&e<=this.totalPages&&this.$emit("page-change",e)},goToPreviousTenPages(){const e=Math.max(1,10*Math.floor((this.currentPage-1)/10)-9);this.$emit("page-change",e)},goToNextTenPages(){const e=10*Math.floor((this.currentPage-1)/10)+1,t=Math.min(this.totalPages,e+10);this.$emit("page-change",t)}}},h=i(1241);const d=(0,h.A)(u,[["render",c],["__scopeId","data-v-914a4944"]]);var p=d},1689:function(e,t,i){"use strict";i.r(t),i.d(t,{default:function(){return Lu}});var n={};i.r(n),i.d(n,{ABORT:function(){return Ie},AFTER_DEFINITION_CHANGE:function(){return Qe},AUTOPLAY_PREVENTED:function(){return Ue},AUTOPLAY_STARTED:function(){return Ne},BEFORE_DEFINITION_CHANGE:function(){return qe},BUFFER_CHANGE:function(){return De},CANPLAY:function(){return ye},CANPLAY_THROUGH:function(){return _e},COMPLETE:function(){return Fe},CSS_FULLSCREEN_CHANGE:function(){return Ye},DEFINITION_CHANGE:function(){return Xe},DESTROY:function(){return He},DOWNLOAD_SPEED_CHANGE:function(){return Ve},DURATION_CHANGE:function(){return be},EMPTIED:function(){return Ce},ENDED:function(){return he},ENTER_PLAYER:function(){return ze},ERROR:function(){return pe},FPS_STUCK:function(){return ft},FULLSCREEN_CHANGE:function(){return We},LEAVE_PLAYER:function(){return Ge},LOADED_DATA:function(){return Ee},LOADED_METADATA:function(){return Te},LOADING:function(){return Ke},LOAD_START:function(){return xe},MINI_STATE_CHANGE:function(){return $e},PAUSE:function(){return de},PIP_CHANGE:function(){return tt},PLAY:function(){return ce},PLAYER_BLUR:function(){return Oe},PLAYER_FOCUS:function(){return Le},PLAYING:function(){return ue},PLAYNEXT:function(){return st},PROGRESS:function(){return we},RATE_CHANGE:function(){return ke},READY:function(){return Re},REPLAY:function(){return Be},RESET:function(){return lt},RETRY:function(){return Je},ROTATE:function(){return it},SCREEN_SHOT:function(){return nt},SEEKED:function(){return ge},SEEKING:function(){return fe},SEI_PARSED:function(){return Ze},SHORTCUT:function(){return rt},SOURCE_ERROR:function(){return ct},SOURCE_SUCCESS:function(){return ut},STALLED:function(){return Ae},STATS_EVENTS:function(){return pt},SUSPEND:function(){return Pe},SWITCH_SUBTITLE:function(){return ht},TIME_UPDATE:function(){return me},URL_CHANGE:function(){return je},URL_NULL:function(){return Me},USER_ACTION:function(){return at},VIDEO_EVENTS:function(){return dt},VIDEO_RESIZE:function(){return et},VOLUME_CHANGE:function(){return Se},WAITING:function(){return ve},XGLOG:function(){return ot}});var s=i(6768),r=i(4232),o="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACwAAAAeCAYAAABXNvynAAANqklEQVRYha1Y228bZ3bnDIeX4dw4Q1IkRYqkKUqiItnaTdJ417UiOcUunCC7adoiabHdh+3DouiDESCI4Ivkm2ALyB/Qt33ZLnYRpEk3QLdO4tpR6rUTx4nj2oklUaIkUxRvEm9z4dxnisNYqRrHuy7aDyBIDM/3zZkz5/zO73cQ27Ydj7KmpqYwkiT9Xq83i+P4UwzD7KcoKoXjOINhmNvn8xEsy5KhUMjr9XoRURQtnud1SZI0WJIkdWRZ5nmeL7Tb7c/b7fb7qqrmMAyTSZKUjhw5YjyKH9gjeetwOPx+f8zlcg0RBAGOjnEcN8gwTIggCNzj8bgIgnAFg0H47tqTJOnkOM4piqJHlmVTFEVSEATK7XbjKIpitm2biqLENU0riqK47HA4yo/ixx+N8NmzZ2lwlKKoQ4FAYDIej38nFAr5SZJ0+Xw+p8fjQTAMc3g8nj94jmEYDlVVbVEUbYj89vY232w2a41GI9doNC61Wq03T548Wfs/OXzu3LkRhmGepWn6CY7jhlOpVP/o6Ci520YQBHAAImhIkqTKsqxYlmVhGIY5nU4UFvwkSdJD07TL7/ejbre7u7fdbturq6tCoVBYrlQqlwRBuKYoyhfT09P5/7XDc3NzoxzH/W06nf6reDzeS1GUKxAIYDiOf21Tq9WsQqHA1+v1arvd3hQEIS/L8pJpmrLL5Qo4nU4KRVGX0+mkKYpKBwKBVDQaDff19XlJkkTgjE6n49je3tbL5TJfKpVy5XL5QrvdfufYsWO3H9nhubm5feBsKpV64YknnsgEg0F0J5rValXjeV4RBEFotVqVZrO5oChK0bIs2bIszbIssXswgngRBHFalqValiXAb5fLFWMY5jssyw4Eg8EIy7I+lmXdgUAARRDEsbq6qn355ZcLpVLpPZ7nP1BVdcnj8Wy89tprXxfkA0V3P7I/GRwcfDmbzcZ2nIXcW1paaq2srHzabDava5q2oet61bbtjsvlSlIUtZ/juL0Mw0QwDHOZpmnouq4qiiK2Wq2lRqNxkef5d3ie//dqtdqH43iWYZjHe3t7xzKZTDQej2OpVMpt23bW5/PRlUplqF6vf9But3/rcDjuPeDwuXPnvCiKDnMc9zd79uz583379sXhyaFYyuWykc/ny4VC4aOtra03Xn311bdhz/nz56MEQfyY47gfxGKxJzOZTG8ikXDtnGlZlqPZbFpra2upXC5HVKtVU5blaysrK9c4jnOLonhQluW/VBTlUKfTScZiMe+ePXs8JEkmSZKk4UVpmrb0+uuvl6empjQ403n69GnHK6+8gpIkORIIBLqRHRkZSfb09DjBYH19XVtYWFhZXV19s16v/0qW5asTExPa6dOn/X6//2eZTObnw8PDTyaTSQ5yHBDj63xDEIfP50NIkvQ6nc4oiqL9pmkClgsnT55cv3LlShGwWdM0hyzLPtu2ab/f7/b7/QiAuSRJHumrVb1+/XrjwIEDZvd0hmFokiTHY7HYD4aHh2ORSATw0y4Wi8ry8vLy5ubm77a2tn4xMzOTv/82YuFw+O/T6fRLOzkuy7JjY2NDrdVqLV3XdZ/PhxME4cVxHJDBNTg4SHMcN0ZRVCifzxPnz59vHT9+fPHUqVOfOBwO6C01TdOes2378XQ6TQKaxOPxaKfTOWwYBhQ2QF7JaRgGVOy+SCTy02w2+2Q6nfZAGuRyOWlxcfHzjY2NX/M8/9aJEyeWdyJ348aNHw4MDPzD2NjYQDgcdkLhLi0tgf2tfD7/ZqlU+l2lUvmiVquV6/W6qOs6wXGcLxQKOQmCoFqtlqvdbt85cOBA7tChQ/rVq1e3VFW9J8sy2AZRFA36/X6AQYwgCA6aDs/zS/Pz8zXn4cOHR0mSPJhKpX6UzWZ7oK0Wi0X97t27X2xsbPyq2Wy+MT093U362dlZ95UrV3oDgcBf792798/g4SCy9x/uM7Bvt9u/mJqa+v3+/fv/Y//+/UuSJBV1XfcTBNEXDofdJEmi9XrdWa/X1959993bExMT6sGDB43x8fHW+++/XzJN0+twOGI+ny8AwWBZ1tlqtbyNRmMTIo36/f4fBQKBZ2KxWBRyBxwDTKxWq5d5nv/tqVOnaruKiMZx/Pssy36XYZgu+lerVX11dXW5VCq9DSgwPT3dhOsQ9WPHji3Ksnyh0Wh8UC6Xq5Bm8B/HcZCCox6PZ+jIkSPozvknT56siKL44dbW1ifFYnGb5/mufU9PD8Nx3J/SNP0smkqlXk6n098Lh8NeAPF8Pq9tbGzcFQTh8szMTGk35LlcLr/P5wPoAl6BQqcqlUrNarX6sSiKF+GG34TJEydOtCVJ+qRSqdxeW1sDAgQ8w8UwzIDH4xkLBoPcbnvTNNd4nr9SKpXAXgSfWJZ1pVKpx2Ox2PPoY489Njg0NBSA6AqCYK2vr5fq9frHANrfvDmKojiGYX4cx30ulwuRZdkSBKGpKEresqzqAx3ov9/MhiAIt2u12hawOJ/PhzIMA+nXj2HY/3B4enq6LsvyzWaz+Vm1Wq1A22cYBslkMlwikciglmXZ8Nm9ybbhkvUA3YOuZZqmoGkadC8bwzAgPh5owZZlPZT9GIZh2l+11O59EASBfW6n00miKPrAPtM0W7ANTB8I2sLCQi6Xy9UB4CmKghTpDQaD3/d6vcPfcuOGoigrPM/XJEmyCIJAI5FIiKbpMY/Hk3qYw263Owk2PT09ISg6XddtRVEkwzBa0NK/xT5BUdS+cDgcpmnaCam3srLSKBQKK2ixWLxQKBRub29va0Bs+vv73clkcpRl2Rfm5uYeA/DfWbIstzRNWxFFsSTLsgH2fX19vmg0OkaS5DNnz56NfPPm58+fh7Z9CGwSiQQBe3Rdt1qtVrHT6dzRdb212352djZKkuQPe3t7v5tKpUifzwfdUl9fX7+5ubn5r6goijdardatSqWy3Ww2u6+sr6+PSSQSh1mW/ens7OzQzmFzc3OGaZoVRVE22+12B67RNI309fVFo9HoczRNv3Du3Dl2l/2f0DT9ciQSeRaaANg6vqKVaqvV+k9Zlj9CUZTfsT9z5kwPTdMvwllwJuSu4ytW2G40Gld5nr/gnJyc9EC+IggS83g8kVAo5IbUgLxUFIUFMH/vvffWJyYmuizs0qVLktPpjINUomk6AK+YZVnMsixO1/WIZVk9165dG7p58+ZzwWDwhWg0+syePXuyAwMDBLTtUqlk5nK5fLFY/OXRo0c/npiYMO8/HJChF2Ox2EuZTGbf4OCgD0VRR6FQMHK5HBTsb3Rdv+kER2zbrhuG4UIQpM/v93fzjCAIJ4IgtCzLjK7r5oULF/KTk5Py5OSk8eGHH0IBBgHg/X4/ieM48AU3juMhiqJGQ6HQwWQyeTCdTo8mEokIkBqwqVar1u3bt/Pr6+tvtdvtf5mYmBDup0F/IBD4WSKReCmbzY6mUikfNDCwv3PnznKhUPhnSZIunDhxouG8fPmy9vTTT7fGx8cVwzBI27YTXq+XZBgG5TgOaGLANM1eBEGi8/Pz5Pz8vGbb9pqqqludTgcTRREii3u9Xiwej7sSiQSZSqXoWCzmA41H0zQK5GZzc1NfWFi4t7Ky8k+1Wu0fAbPPnj1LXr9+/SnonKlU6sWRkZHBTCbjcbvdSLlcNhcWFjZXV1ffbjQab6Eouj4+Pm532Rp8Ll682DAMoybLMqqqao/f72cJguhGjqbpMEVRIy6Xa1jXdQ/ksGVZS4C/7Xa7zPO8G1KCpmkQpF9XKXCSRqMB2C7mcrm79+7de6fZbP5mZmamAP9/+umnz4fD4b/r7+9/bmhoKAkPDGlQr9etW7durebz+beAIXY6nbunTp3qps4DigMIPMuyPwFplMlkErFYzL0jMEERLC4uQhu+Iorix4qiLNu2zeM4/r1QKPR8MBgcxnGcvO8skDZVVVVREIRiu92+CQ1B1/VtDMOCXq93tKenB/jI49lsFkQtYppml3vncrnS8vLyG41G45fHjh37Yrd/D5NIWZIkD0ej0b8YHR19MpvNdoUcEHI4sFqtStVqFTriIs/zN03ThEJkQG8ahtEETed0OnHbtlHbtlXwH0EQaDDARRI0TWcjkUh/JBLx3ydE3bcCtGBxcTFXLBbfbTabvz569Ojn3/TtoSL0zJkzXoCkZDL581QqNRIKhQgg6ICLjvuSqVAoyOVyuQaNRFGU7U6nsynLcs40TZBNARRFoZOBlmNJkkxTFBVlWTYYjUYBNrtcXJKkrgitVCpdEVoqlf5NEAQQoXe+zbc/KPNnZ2d7KIp6nmGYp4PBIAB//969e0EJd/+HYmq1WpYkSQY0EkVRNFmW1d0y/34bBl4LkXQBAlEUBZdhr722tsbfu3cvV6lULoui+JEsy7dnZmbWHubTHx2kgBTyer1DJElOBAKBQ/F4fCwQCDA4joPkh3kDzBmQnVnDwxakk6qq3WEKz/MGUNh6vV75fx2kfG2EICCLkhiGDVMU9RSO4wMgFBmGAQ4NzQNUi4vjOGxnVLV7SZIE4wFdEARVkiR5e3u7WKlU5iVJ+gxGVaZpLh8/fvyRRlWPNFuDh5qamtqkaRrmER1N08q6ro9ompZRVbWP53kahoGiKBIwDISIAzlSVdUCltbpdPRGo8F3Oh0B+AjMMnien+90Ojd2hoGP4ofD4XD8FzY2qtFFnEuLAAAAAElFTkSuQmCC",a="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAB4AAAAiCAYAAABIiGl0AAADfElEQVRYhe1XPW/TQBg+2+f4ajuuXRJVaRqklBYQ6lSJBfExsfBfUHezV5U6VcrCxM7GgpAYkJCAAanKUKm0BFXqh5IiG8e1j9iOP9CFGDkuuG4CLPBIHu78vn5e3z3vPTZ1cHDQLxaLDAAA0DQNGIYBFEVRIANRFJErCsMQkGtvb+9Ls9l8omnauqqqelZuDFgulyFCKE9sGj+KkySJZxhGDIIgyJtMFwqFcUhHgBCCHMeVWZat567aNM1QkqRB9d1uN2q32w7G2MlK4jiOlWUZKYrC8DxPHR8f+9vb2x/b7fbbXq/3MYoiPys/DEOXsm07FARhQLyzs9Pb2tp6aRjG63PecLFard5bWFio12o1RPZc1/W+aZqe53l9sv/pnOSU67ouTArJsqyepmnPV1dXH2cRr6+v34AQ8oqilOv1OiLbJQgCCwBgs/JiOI4D6FRVRKmZy0zged4Bxni32+3qp6enYR6yJEihMDnBMAwNIbx0XiLDMJzjOHudTud9s9ksTE9Py2T+V10oCAKqVCpIluVBgG3bEUwHndfD4LsITUVR3p2cnHw2DOMVy7JKVryiKHdXVlbuy7I8NSwcnCHOg42NDaLa4+GVKUSCzc1N27Ks2wCAqfjl6DxEk4LoJq30v0JMdEP0k0n8sx6cFD/TzQhxEASh7/u5DvlJMUI82HSaHssxLgo4XNrBUhSLxalSqfSg0WiIF3lOv983PM9rBUHwyTCMk6HqMwGTTkaanPQbxvhOHsJYDqZpdo+Ojt7ouv5MluVXAAA9FXdGNyPE5GQZNvnURd5Y07Rp3/c9jPEOxvhF+j7RDdFPcu63tJMkSbQsy5cEQbhWKBQup+8T3aSVDcnxFSOvH5OHDD2Zm5mZGZx+iqKIs7OzN33ff9hoNFrJ+FKpdJfoJx6TpR8hJqR5/JiiKMjz/NVKpXJreXl5cW5uDlarVY7n+aX5+fma67r9ZHxsEvGYbO9YfkywtrZ2nabpR0tLSwvkI1EURUoURVir1c7tCBI7lh8TqKr6wbbtXYyxlyc+Cc/zxvPjGK7r7u7v739wXfdKPPcrVz3z6ZMOyOPHMRzHedtqtTYODw9reXPA8GNvLD+Ooaoq8eOn4+T+FVv8T/yPEvM8/2OAECpQFDX5X1we4uSAWFcURbl/NScB7HQ6AUJoUIBlWTgMw69/nBUA8A2zXKN/e8PjvQAAAABJRU5ErkJggg==";const l={class:"info-container"},c={class:"info-wrapper"},u={class:"ads pc-hide",style:{"padding-top":"0","margin-top":"0px"}},h={class:"ads-item"},d={class:"video-location h5-hide"},p={class:"video-info"},f={class:"h5-video-location pc-hide"},g={class:"video-name"},m={key:0},v={key:1},y={key:2},_={class:"info"},b={class:"viewed"},S={class:"time"},E={key:0,class:"video-desc"},T={key:0,class:"ads"},k={class:"ads-item"},w={key:1,class:"list"},x={key:2,class:"ads"},C={class:"ads-item"},A={key:3,class:"list"},P={key:4,class:"ads"},I={class:"ads-item"},D={key:5,class:"list"},L={key:6,class:"ads"},O={class:"ads-item"};function R(e,t,i,n,R,M){const N=(0,s.g2)("van-loading"),U=(0,s.g2)("van-image"),F=(0,s.g2)("Card"),B=(0,s.g2)("Pagination");return(0,s.uX)(),(0,s.CE)("div",l,[(0,s.Lk)("div",c,[(0,s.Lk)("div",u,[((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(R._ads.slice(0,8),(e=>((0,s.uX)(),(0,s.CE)("div",h,[(0,s.bF)(U,{onClick:t=>M.goAd(e.link),fit:"cover",position:"center","lazy-load":!0,src:e.picUrl},{loading:(0,s.k6)((()=>[(0,s.bF)(N,{type:"spinner",size:"20"})])),_:2},1032,["onClick","src"])])))),256))]),(0,s.Lk)("div",d,[t[3]||(t[3]=(0,s.Lk)("div",{class:"line"},null,-1)),(0,s.Lk)("span",{class:"link",onClick:t[0]||(t[0]=(...e)=>M.goHome&&M.goHome(...e))},"HOME"),t[4]||(t[4]=(0,s.Lk)("span",{class:"arrow"},"▷",-1)),(0,s.Lk)("span",{class:"link",onClick:t[1]||(t[1]=(...e)=>M.goCategory&&M.goCategory(...e))},(0,r.v_)(R.classifyName),1),t[5]||(t[5]=(0,s.Lk)("span",{class:"arrow"},"▷",-1)),(0,s.eW)(" "+(0,r.v_)(R.data.title),1)]),(0,s.Lk)("div",p,[(0,s.Lk)("div",f,[t[6]||(t[6]=(0,s.Lk)("div",{class:"line"},null,-1)),(0,s.Lk)("span",{class:"link",onClick:t[2]||(t[2]=(...e)=>M.goCategory&&M.goCategory(...e))},(0,r.v_)(R.classifyName),1),t[7]||(t[7]=(0,s.Lk)("span",{class:"arrow"},"▷",-1)),(0,s.eW)(" "+(0,r.v_)(R.data.title),1)]),t[10]||(t[10]=(0,s.Lk)("div",{id:"mse"},null,-1)),t[11]||(t[11]=(0,s.Lk)("div",{class:"video-wrapper"},[(0,s.Lk)("div",{class:"video-img",id:"video-info"})],-1)),(0,s.Lk)("div",g,["ko-KR"==e.language?((0,s.uX)(),(0,s.CE)("span",m,(0,r.v_)(R.data.title),1)):(0,s.Q3)("",!0),"en-US"==e.language?((0,s.uX)(),(0,s.CE)("span",v,(0,r.v_)(R.data.titleUs),1)):(0,s.Q3)("",!0),"zh-CN"==e.language?((0,s.uX)(),(0,s.CE)("span",y,(0,r.v_)(R.data.titleCn),1)):(0,s.Q3)("",!0)]),(0,s.Lk)("div",_,[(0,s.Lk)("div",b,[t[8]||(t[8]=(0,s.Lk)("img",{src:o,alt:""},null,-1)),(0,s.Lk)("span",null,"조회수 : "+(0,r.v_)(R.data.watchTimes),1)]),(0,s.Lk)("div",S,[t[9]||(t[9]=(0,s.Lk)("img",{src:a,alt:""},null,-1)),(0,s.Lk)("span",null,"등록일 : "+(0,r.v_)(M.formatTime(R.data.createdAt)),1)])]),R.data.titleChinese?((0,s.uX)(),(0,s.CE)("div",E,(0,r.v_)(),1)):(0,s.Q3)("",!0)]),R._ads.slice(0,16).length?((0,s.uX)(),(0,s.CE)("div",T,[((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(R._ads.slice(0,16),(e=>((0,s.uX)(),(0,s.CE)("div",k,[(0,s.bF)(U,{onClick:t=>M.goAd(e.link),fit:"cover",position:"center","lazy-load":!0,src:e.picUrl},{loading:(0,s.k6)((()=>[(0,s.bF)(N,{type:"spinner",size:"20"})])),_:2},1032,["onClick","src"])])))),256))])):(0,s.Q3)("",!0),R.videos.slice(0,8).length?((0,s.uX)(),(0,s.CE)("div",w,[((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(R.videos.slice(0,8),(e=>((0,s.uX)(),(0,s.Wv)(F,{classifyName:R.classifyName,classifyId:R.classifyId,specialId:R.specialId,class:"video-card",item:e,key:e.id},null,8,["classifyName","classifyId","specialId","item"])))),128))])):(0,s.Q3)("",!0),R._ads.slice(16,24).length?((0,s.uX)(),(0,s.CE)("div",x,[((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(R._ads.slice(16,24),(e=>((0,s.uX)(),(0,s.CE)("div",C,[(0,s.bF)(U,{onClick:t=>M.goAd(e.link),fit:"cover",position:"center","lazy-load":!0,src:e.picUrl},{loading:(0,s.k6)((()=>[(0,s.bF)(N,{type:"spinner",size:"20"})])),_:2},1032,["onClick","src"])])))),256))])):(0,s.Q3)("",!0),R.videos.slice(8,16).length?((0,s.uX)(),(0,s.CE)("div",A,[((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(R.videos.slice(8,16),(e=>((0,s.uX)(),(0,s.Wv)(F,{classifyName:R.classifyName,classifyId:R.classifyId,specialId:R.specialId,class:"video-card",item:e,key:e.id},null,8,["classifyName","classifyId","specialId","item"])))),128))])):(0,s.Q3)("",!0),R._ads.slice(24,32).length?((0,s.uX)(),(0,s.CE)("div",P,[((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(R._ads.slice(24,32),(e=>((0,s.uX)(),(0,s.CE)("div",I,[(0,s.bF)(U,{onClick:t=>M.goAd(e.link),fit:"cover",position:"center","lazy-load":!0,src:e.picUrl},{loading:(0,s.k6)((()=>[(0,s.bF)(N,{type:"spinner",size:"20"})])),_:2},1032,["onClick","src"])])))),256))])):(0,s.Q3)("",!0),R.videos.slice(16,24).length?((0,s.uX)(),(0,s.CE)("div",D,[((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(R.videos.slice(16,24),(e=>((0,s.uX)(),(0,s.Wv)(F,{classifyName:R.classifyName,classifyId:R.classifyId,specialId:R.specialId,class:"video-card",item:e,key:e.id},null,8,["classifyName","classifyId","specialId","item"])))),128))])):(0,s.Q3)("",!0),R._ads.slice(32,40).length?((0,s.uX)(),(0,s.CE)("div",L,[((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(R._ads.slice(32,40),(e=>((0,s.uX)(),(0,s.CE)("div",O,[(0,s.bF)(U,{onClick:t=>M.goAd(e.link),fit:"cover",position:"center","lazy-load":!0,src:e.picUrl},{loading:(0,s.k6)((()=>[(0,s.bF)(N,{type:"spinner",size:"20"})])),_:2},1032,["onClick","src"])])))),256))])):(0,s.Q3)("",!0),(0,s.bF)(B,{"total-pages":R.total,"current-page":R.pageNum,onPageChange:M.handlePageChange},null,8,["total-pages","current-page","onPageChange"])])])}i(4114);var M=i(3397),N=i(9148),U=i.n(N),F=i(7597),B=i(5791),H=i(782),j=(i(6849),i(8992),i(4520),i(2577),i(3949),i(1454),i(3529)),V=i.n(j);const G="undefined"!==typeof window&&window.location&&window.location.href.indexOf("xgplayerdebugger=1")>-1,z={info:"color: #525252; background-color: #90ee90;",error:"color: #525252; background-color: red;",warn:"color: #525252; background-color: yellow; "},K="%c[xgplayer]",W={config:{debug:G?3:0},logInfo:function(e,...t){this.config.debug>=3&&console.log(K,z.info,e,...t)},logWarn:function(e,...t){this.config.debug>=1&&console.warn(K,z.warn,e,...t)},logError:function(e,...t){if(this.config.debug<1)return;const i=this.config.debug>=2?"trace":"error";console[i](K,z.error,e,...t)}};function Y(e){e.logInfo=W.logInfo.bind(e),e.logWarn=W.logWarn.bind(e),e.logError=W.logError.bind(e)}class ${constructor(e){this.bufferedList=e}start(e){return this.bufferedList[e].start}end(e){return this.bufferedList[e].end}get length(){return this.bufferedList.length}}const X={};function q(e,t){for(let i=0,n=t.length;i<n;i++)if(e.indexOf(t[i])>-1)return!0;return!1}function Q(e){const t=typeof e;return null!==e&&("object"===t||"function"===t)}function Z(e,t,i){let n,s,r,o,a,l,c=0,u=!1,h=!1,d=!0;const p=!t&&0!==t&&"function"===typeof window.requestAnimationFrame;if("function"!==typeof e)throw new TypeError("Expected a function");function f(t){const i=n,r=s;return n=s=void 0,c=t,o=e.apply(r,i),o}function g(e,t){return p?(window.cancelAnimationFrame(a),window.requestAnimationFrame(e)):setTimeout(e,t)}function m(e){if(p)return window.cancelAnimationFrame(e);clearTimeout(e)}function v(e){return c=e,a=g(b,t),u?f(e):o}function y(e){const i=e-l,n=e-c,s=t-i;return h?Math.min(s,r-n):s}function _(e){const i=e-l,n=e-c;return void 0===l||i>=t||i<0||h&&n>=r}function b(){const e=Date.now();if(_(e))return S(e);a=g(b,y(e))}function S(e){return a=void 0,d&&n?f(e):(n=s=void 0,o)}function E(){void 0!==a&&m(a),c=0,n=l=s=a=void 0}function T(){return void 0===a?o:S(Date.now())}function k(){return void 0!==a}function w(...e){const i=Date.now(),r=_(i);if(n=e,s=this,l=i,r){if(void 0===a)return v(l);if(h)return a=g(b,t),f(l)}return void 0===a&&(a=g(b,t)),o}return t=+t||0,Q(i)&&(u=!!i.leading,h="maxWait"in i,r=h?Math.max(+i.maxWait||0,t):r,d="trailing"in i?!!i.trailing:d),w.cancel=E,w.flush=T,w.pending=k,w}function J(e,t,i){let n=!0,s=!0;if("function"!==typeof e)throw new TypeError("Expected a function");return Q(i)&&(n="leading"in i?!!i.leading:n,s="trailing"in i?!!i.trailing:s),Z(e,t,{leading:n,trailing:s,maxWait:t})}function ee(){let e=(document.documentElement.getAttribute("lang")||navigator.language||"zh-cn").toLocaleLowerCase();return"zh-cn"===e&&(e="zh"),e}function te(e,t,i){if(!e)return;const n=e.getAttribute(i);return!(!n||n!==t||"VIDEO"!==e.tagName&&"AUDIO"!==e.tagName)}X.createDom=function(e="div",t="",i={},n=""){const s=document.createElement(e);return s.className=n,s.innerHTML=t,Object.keys(i).forEach((t=>{const n=t,r=i[t];"video"===e||"audio"===e||"live-video"===e?r&&s.setAttribute(n,r):s.setAttribute(n,r)})),s},X.createDomFromHtml=function(e,t={},i=""){try{let n=document.createElement("div");n.innerHTML=e;let s=n.children;return n=null,s.length>0?(s=s[0],i&&X.addClass(s,i),t&&Object.keys(t).forEach((e=>{s.setAttribute(e,t[e])})),s):null}catch(n){return W.logError("util.createDomFromHtml",n),null}},X.hasClass=function(e,t){if(!e||!t)return!1;try{return Array.prototype.some.call(e.classList,(e=>e===t))}catch(i){const n=e.className&&"object"===typeof e.className?e.getAttribute("class"):e.className;return n&&!!n.match(new RegExp("(\\s|^)"+t+"(\\s|$)"))}},X.addClass=function(e,t){if(e&&t)try{t.replace(/(^\s+|\s+$)/g,"").split(/\s+/g).forEach((t=>{t&&e.classList.add(t)}))}catch(i){X.hasClass(e,t)||(e.className&&"object"===typeof e.className?e.setAttribute("class",e.getAttribute("class")+" "+t):e.className+=" "+t)}},X.removeClass=function(e,t){if(e&&t)try{t.replace(/(^\s+|\s+$)/g,"").split(/\s+/g).forEach((t=>{t&&e.classList.remove(t)}))}catch(i){X.hasClass(e,t)&&t.split(/\s+/g).forEach((t=>{const i=new RegExp("(\\s|^)"+t+"(\\s|$)");e.className&&"object"===typeof e.className?e.setAttribute("class",e.getAttribute("class").replace(i," ")):e.className=e.className.replace(i," ")}))}},X.toggleClass=function(e,t){e&&t.split(/\s+/g).forEach((t=>{X.hasClass(e,t)?X.removeClass(e,t):X.addClass(e,t)}))},X.classNames=function(){const e=[];for(let t=0;t<arguments.length;t++)"String"===X.typeOf(arguments[t])?e.push(arguments[t]):"Object"===X.typeOf(arguments[t])&&Object.keys(arguments[t]).map((i=>{arguments[t][i]&&e.push(i)}));return e.join(" ")},X.findDom=function(e=document,t){let i;try{i=e.querySelector(t)}catch(n){W.logError("util.findDom",n),0===t.indexOf("#")&&(i=e.getElementById(t.slice(1)))}return i},X.getCss=function(e,t){return e.currentStyle?e.currentStyle[t]:document.defaultView.getComputedStyle(e,!1)[t]},X.padStart=function(e,t,i){const n=String(i),s=t|0;let r=Math.ceil(s/n.length);const o=[],a=String(e);while(r--)o.push(n);return o.join("").substring(0,s-a.length)+a},X.format=function(e){if(window.isNaN(e))return"";e=Math.round(e);const t=X.padStart(Math.floor(e/3600),2,0),i=X.padStart(Math.floor((e-3600*t)/60),2,0),n=X.padStart(Math.floor(e-3600*t-60*i),2,0);return("00"===t?[i,n]:[t,i,n]).join(":")},X.event=function(e){if(e.touches){const t=e.touches[0]||e.changedTouches[0];e.clientX=t.clientX||0,e.clientY=t.clientY||0,e.offsetX=t.pageX-t.target.offsetLeft,e.offsetY=t.pageY-t.target.offsetTop}e._target=e.target||e.srcElement},X.typeOf=function(e){return Object.prototype.toString.call(e).match(/([^\s.*]+)(?=]$)/g)[0]},X.deepCopy=function(e,t){if("Object"===X.typeOf(t)&&"Object"===X.typeOf(e))return Object.keys(t).forEach((i=>{"Object"!==X.typeOf(t[i])||t[i]instanceof Node?"Array"===X.typeOf(t[i])?e[i]="Array"===X.typeOf(e[i])?e[i].concat(t[i]):t[i]:e[i]=t[i]:void 0===e[i]||void 0===e[i]?e[i]=t[i]:X.deepCopy(e[i],t[i])})),e},X.deepMerge=function(e,t){return Object.keys(t).map((i=>{"Array"===X.typeOf(t[i])&&"Array"===X.typeOf(e[i])?"Array"===X.typeOf(e[i])&&e[i].push(...t[i]):X.typeOf(e[i])!==X.typeOf(t[i])||null===e[i]||"Object"!==X.typeOf(e[i])||t[i]instanceof window.Node?null!==t[i]&&(e[i]=t[i]):X.deepMerge(e[i],t[i])})),e},X.getBgImage=function(e){const t=(e.currentStyle||window.getComputedStyle(e,null)).backgroundImage;if(!t||"none"===t)return"";const i=document.createElement("a");return i.href=t.replace(/url\("|"\)/g,""),i.href},X.copyDom=function(e){if(e&&1===e.nodeType){const t=document.createElement(e.tagName);return Array.prototype.forEach.call(e.attributes,(e=>{t.setAttribute(e.name,e.value)})),e.innerHTML&&(t.innerHTML=e.innerHTML),t}return""},X.setInterval=function(e,t,i,n){e._interval[t]||(e._interval[t]=window.setInterval(i.bind(e),n))},X.clearInterval=function(e,t){clearInterval(e._interval[t]),e._interval[t]=null},X.setTimeout=function(e,t,i){e._timers||(e._timers=[]);const n=setTimeout((()=>{t(),X.clearTimeout(e,n)}),i);return e._timers.push(n),n},X.clearTimeout=function(e,t){const{_timers:i}=e;if("Array"===X.typeOf(i)){for(let n=0;n<i.length;n++)if(i[n]===t){i.splice(n,1),clearTimeout(t);break}}else clearTimeout(t)},X.clearAllTimers=function(e){const{_timers:t}=e;"Array"===X.typeOf(t)&&(t.map((e=>{clearTimeout(e)})),e._timerIds=[])},X.createImgBtn=function(e,t,i,n){const s=X.createDom(`xg-${e}`,"",{},`xgplayer-${e}-img`);if(s.style.backgroundImage=`url("${t}")`,i&&n){let t,r,o;["px","rem","em","pt","dp","vw","vh","vm","%"].every((e=>!(i.indexOf(e)>-1&&n.indexOf(e)>-1)||(t=parseFloat(i.slice(0,i.indexOf(e)).trim()),r=parseFloat(n.slice(0,n.indexOf(e)).trim()),o=e,!1))),s.style.width=`${t}${o}`,s.style.height=`${r}${o}`,s.style.backgroundSize=`${t}${o} ${r}${o}`,s.style.margin="start"===e?`-${r/2}${o} auto auto -${t/2}${o}`:"auto 5px auto 5px"}return s},X.Hex2RGBA=function(e,t){const i=[];if(/^\#[0-9A-F]{3}$/i.test(e)){let t="#";e.replace(/[0-9A-F]/gi,(function(e){t+=e+e})),e=t}return/^#[0-9A-F]{6}$/i.test(e)?(e.replace(/[0-9A-F]{2}/gi,(function(e){i.push(parseInt(e,16))})),`rgba(${i.join(",")}, ${t})`):"rgba(255, 255, 255, 0.1)"},X.getFullScreenEl=function(){return document.fullscreenElement||document.webkitFullscreenElement||document.mozFullScreenElement||document.msFullscreenElement},X.checkIsFunction=function(e){return e&&"function"===typeof e},X.checkIsObject=function(e){return null!==e&&"object"===typeof e},X.hide=function(e){e.style.display="none"},X.show=function(e,t){e.style.display=t||"block"},X.isUndefined=function(e){if("undefined"===typeof e||null===e)return!0},X.isNotNull=function(e){return!(void 0===e||null===e)},X.setStyleFromCsstext=function(e,t){if(t)if("String"===X.typeOf(t)){const i=t.replace(/\s+/g,"").split(";");i.map((t=>{if(t){const i=t.split(":");i.length>1&&(e.style[i[0]]=i[1])}}))}else Object.keys(t).map((i=>{e.style[i]=t[i]}))},X.filterStyleFromText=function(e,t=["width","height","top","left","bottom","right","position","z-index","padding","margin","transform"]){const i=e.style.cssText;if(!i)return{};const n=i.replace(/\s+/g,"").split(";"),s={},r={};return n.map((e=>{if(e){const i=e.split(":");i.length>1&&(q(i[0],t)?s[i[0]]=i[1]:r[i[0]]=i[1])}})),e.setAttribute("style",""),Object.keys(r).map((t=>{e.style[t]=r[t]})),s},X.getStyleFromCsstext=function(e){const t=e.style.cssText;if(!t)return{};const i=t.replace(/\s+/g,"").split(";"),n={};return i.map((e=>{if(e){const t=e.split(":");t.length>1&&(n[t[0]]=t[1])}})),n},X.preloadImg=(e,t=()=>{},i=()=>{})=>{if(!e)return;let n=new window.Image;n.onload=e=>{n=null,t&&t(e)},n.onerror=e=>{n=null,i&&i(e)},n.src=e},X.stopPropagation=e=>{e&&e.stopPropagation()},X.scrollTop=function(){return window.pageYOffset||document.documentElement.scrollTop||document.body.scrollTop||0},X.scrollLeft=function(){return window.pageXOffset||document.documentElement.scrollLeft||document.body.scrollLeft||0},X.checkTouchSupport=function(){return"ontouchstart"in window},X.getBuffered2=(e,t=.5)=>{const i=[];for(let s=0;s<e.length;s++)i.push({start:e.start(s)<.5?0:e.start(s),end:e.end(s)});i.sort((function(e,t){const i=e.start-t.start;return i||t.end-e.end}));let n=[];if(t)for(let s=0;s<i.length;s++){const e=n.length;if(e){const r=n[e-1].end;i[s].start-r<t?i[s].end>r&&(n[e-1].end=i[s].end):n.push(i[s])}else n.push(i[s])}else n=i;return new $(n)},X.getEventPos=function(e,t=1){return e.touches&&e.touches.length>0&&(e=e.touches[0]),{x:e.x/t,y:e.y/t,clientX:e.clientX/t,clientY:e.clientY/t,offsetX:e.offsetX/t,offsetY:e.offsetY/t,pageX:e.pageX/t,pageY:e.pageY/t}},X.requestAnimationFrame=function(e){const t=window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame;if(t)return t(e)},X.getHostFromUrl=function(e){if("String"!==X.typeOf(e))return"";const t=e.split("/");let i="";return t.length>3&&t[2]&&(i=t[2]),i},X.cancelAnimationFrame=function(e){const t=window.cancelAnimationFrame||window.mozCancelAnimationFrame||window.cancelRequestAnimationFrame;t&&t(e)},X.isMSE=function(e){return e.media&&(e=e.media),!!(e&&e instanceof HTMLMediaElement)&&(/^blob/.test(e.currentSrc)||/^blob/.test(e.src))},X.isBlob=function(e){return"string"===typeof e&&/^blob/.test(e)},X.generateSessionId=function(e=0){let t=(new Date).getTime();try{e=parseInt(e)}catch(n){e=0}t+=e,window.performance&&"function"===typeof window.performance.now&&(t+=parseInt(window.performance.now()));const i="xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,(function(e){const i=(t+16*Math.random())%16|0;return t=Math.floor(t/16),("x"===e?i:3&i|8).toString(16)}));return i},X.createEvent=function(e){let t;return"function"===typeof window.Event?t=new Event(e):(t=document.createEvent("Event"),t.initEvent(e,!0,!0)),t},X.adjustTimeByDuration=function(e,t,i){return t&&e&&(e>t||i&&e<t)?t:e},X.createPositionBar=function(e,t){const i=X.createDom("xg-bar","",{"data-index":-1},e);return t.appendChild(i),i},X.getTransformStyle=function(e={x:0,y:0,scale:1,rotate:0},t=""){const i={scale:`${e.scale||1}`,translate:`${e.x||0}%, ${e.y||0}%`,rotate:`${e.rotate||0}deg`},n=Object.keys(i);return n.forEach((e=>{const n=new RegExp(`${e}\\([^\\(]+\\)`,"g"),s=`${e}(${i[e]})`;n.test(t)?(n.lastIndex=-1,t=t.replace(n,s)):t+=`${s} `})),t},X.convertDeg=function(e){return Math.abs(e)<=1?360*e:e%360},X.getIndexByTime=function(e,t){const i=t.length;let n=-1;if(i<1)return n;if(e<=t[0].end||i<2)n=0;else if(e>t[i-1].end)n=i-1;else for(let s=1;s<i;s++)if(e>t[s-1].end&&e<=t[s].end){n=s;break}return n},X.getOffsetCurrentTime=function(e,t,i=-1){let n=-1;if(n=i>=0&&i<t.length?i:X.getIndexByTime(e,t),n<0)return-1;const s=t.length,{start:r,end:o,cTime:a,offset:l}=t[n];return e<r?a:e>=r&&e<=o?e-l:e>o&&n>=s-1?o:-1},X.getCurrentTimeByOffset=function(e,t){let i=-1;if(!t||t.length<0)return e;for(let n=0;n<t.length;n++)if(e<=t[n].duration){i=n;break}if(-1!==i){const{start:n}=t[i];return i-1<0?n+e:n+(e-t[i-1].duration)}return e};const ie={android:/(Android)\s([\d.]+)/,ios:/(Version)\/([\d.]+)/},ne=["avc1.42E01E, mp4a.40.2","avc1.58A01E, mp4a.40.2","avc1.4D401E, mp4a.40.2","avc1.64001E, mp4a.40.2","avc1.42E01E","mp4v.20.8","avc1.42E01E, mp4a.40.2","avc1.58A01E, mp4a.40.2","avc1.4D401E, mp4a.40.2","avc1.64001E, mp4a.40.2","mp4v.20.8, mp4a.40.2","mp4v.20.240, mp4a.40.2"],se={get device(){const e=se.os;return e.isPc?"pc":"mobile"},get browser(){if("undefined"===typeof navigator)return"";const e=navigator.userAgent.toLowerCase(),t={ie:/rv:([\d.]+)\) like gecko/,firefox:/firefox\/([\d.]+)/,chrome:/chrome\/([\d.]+)/,opera:/opera.([\d.]+)/,safari:/version\/([\d.]+).*safari/};return[].concat(Object.keys(t).filter((i=>t[i].test(e))))[0]},get os(){if("undefined"===typeof navigator)return{};const e=navigator.userAgent,t=/(?:Windows Phone)/.test(e),i=/(?:SymbianOS)/.test(e)||t,n=/(?:Android)/.test(e),s=/(?:Firefox)/.test(e),r=/(?:iPad|PlayBook)/.test(e)||"MacIntel"===navigator.platform&&navigator.maxTouchPoints>1,o=r||n&&!/(?:Mobile)/.test(e)||s&&/(?:Tablet)/.test(e),a=/(?:iPhone)/.test(e)&&!o,l=!a&&!n&&!i&&!o;return{isTablet:o,isPhone:a,isIpad:r,isIos:a||r,isAndroid:n,isPc:l,isSymbian:i,isWindowsPhone:t,isFireFox:s}},get osVersion(){if("undefined"===typeof navigator)return 0;const e=navigator.userAgent;let t="";t=/(?:iPhone)|(?:iPad|PlayBook)/.test(e)?ie.ios:ie.android;const i=t?t.exec(e):[];if(i&&i.length>=3){const e=i[2].split(".");return e.length>0?parseInt(e[0]):0}return 0},get isWeixin(){if("undefined"===typeof navigator)return!1;const e=/(micromessenger)\/([\d.]+)/,t=e.exec(navigator.userAgent.toLocaleLowerCase());return!!t},isSupportMP4(){const e={isSupport:!1,mime:""};if("undefined"===typeof document)return e;if(this.supportResult)return this.supportResult;let t=document.createElement("video");return"function"===typeof t.canPlayType&&ne.map((i=>{"probably"===t.canPlayType(`video/mp4; codecs="${i}"`)&&(e.isSupport=!0,e.mime+=`||${i}`)})),this.supportResult=e,t=null,e},isMSESupport(e='video/mp4; codecs="avc1.42E01E,mp4a.40.2"'){if("undefined"===typeof MediaSource||!MediaSource)return!1;try{return MediaSource.isTypeSupported(e)}catch(t){return this._logger.error(e,t),!1}},isHevcSupported(){return!("undefined"===typeof MediaSource||!MediaSource.isTypeSupported)&&(MediaSource.isTypeSupported('video/mp4;codecs="hev1.1.6.L120.90"')||MediaSource.isTypeSupported('video/mp4;codecs="hev1.2.4.L120.90"')||MediaSource.isTypeSupported('video/mp4;codecs="hev1.3.E.L120.90"')||MediaSource.isTypeSupported('video/mp4;codecs="hev1.4.10.L120.90"'))},probeConfigSupported(e){const t={supported:!1,smooth:!1,powerEfficient:!1};if(!e||"undefined"===typeof navigator)return Promise.resolve(t);if(navigator.mediaCapabilities&&navigator.mediaCapabilities.decodingInfo)return navigator.mediaCapabilities.decodingInfo(e);{const n=e.video||{},s=e.audio||{};try{const e=MediaSource.isTypeSupported(n.contentType),t=MediaSource.isTypeSupported(s.contentType);return Promise.resolve({supported:e&&t,smooth:!1,powerEfficient:!1})}catch(i){return Promise.resolve(t)}}}};var re="3.1.0-alpha.9";const oe={1:"media",2:"media",3:"media",4:"media",5:"media",6:"media"},ae={1:5101,2:5102,3:5103,4:5104,5:5105,6:5106};class le{constructor(e,t={errorType:"",errorCode:0,errorMessage:"",originError:"",ext:{},mediaError:null}){const i=e&&e.i18n?e.i18n.ERROR_TYPES:null;if(e.media){const i=t.mediaError?t.mediaError:e.media.error||{},{duration:n,currentTime:s,ended:r,src:o,currentSrc:a}=e,{readyState:l,networkState:c}=e.media;let u=t.errorCode||i.code;ae[u]&&(u=ae[u]);const h={playerVersion:re,currentTime:s,duration:n,ended:r,readyState:l,networkState:c,src:o||a,errorType:t.errorType,errorCode:u,message:t.errorMessage||i.message,mediaError:i,originError:t.originError?t.originError.stack:"",host:X.getHostFromUrl(o||a)};return t.ext&&Object.keys(t.ext).map((e=>{h[e]=t.ext[e]})),h}if(arguments.length>1){const e={playerVersion:re,domain:document.domain},t=["errorType","currentTime","duration","networkState","readyState","src","currentSrc","ended","errd","errorCode","mediaError"];for(let i=0;i<arguments.length;i++)e[t[i]]=arguments[i];return e.ex=i?(i[arguments[0]]||{}).msg:"",e}}}const ce="play",ue="playing",he="ended",de="pause",pe="error",fe="seeking",ge="seeked",me="timeupdate",ve="waiting",ye="canplay",_e="canplaythrough",be="durationchange",Se="volumechange",Ee="loadeddata",Te="loadedmetadata",ke="ratechange",we="progress",xe="loadstart",Ce="emptied",Ae="stalled",Pe="suspend",Ie="abort",De="bufferedChange",Le="focus",Oe="blur",Re="ready",Me="urlNull",Ne="autoplay_started",Ue="autoplay_was_prevented",Fe="complete",Be="replay",He="destroy",je="urlchange",Ve="download_speed_change",Ge="leaveplayer",ze="enterplayer",Ke="loading",We="fullscreen_change",Ye="cssFullscreen_change",$e="mini_state_change",Xe="definition_change",qe="before_definition_change",Qe="after_definition_change",Ze="SEI_PARSED",Je="retry",et="video_resize",tt="pip_change",it="rotate",nt="screenShot",st="playnext",rt="shortcut",ot="xglog",at="user_action",lt="reset",ct="source_error",ut="source_success",ht="switch_subtitle",dt=["play","playing","ended","pause","error","seeking","seeked","timeupdate","waiting","canplay","canplaythrough","durationchange","volumechange","loadeddata","loadedmetadata","ratechange","progress","loadstart","emptied","stalled","suspend","abort","lowdecode"],pt={STATS_INFO:"stats_info",STATS_DOWNLOAD:"stats_download",STATS_RESET:"stats_reset"},ft="fps_stuck";function gt(e,t){this&&this.emit&&("error"===e?this.errorHandler(e,t.error):this.emit(e,t))}function mt(e,t){return(i,n)=>{const s={player:t,eventName:e,originalEvent:i,detail:i.detail||{},timeStamp:i.timeStamp,currentTime:t.currentTime,duration:t.duration,paused:t.paused,ended:t.ended,isInternalOp:!!t._internalOp[i.type],muted:t.muted,volume:t.volume,host:X.getHostFromUrl(t.currentSrc),vtype:t.vtype};if(t.removeInnerOP(i.type),"timeupdate"===e&&(t._currentTime=t.media&&t.media.currentTime),"ratechange"===e){const e=t.media?t.media.playbackRate:0;if(e&&t._rate===e)return;t._rate=t.media&&t.media.playbackRate}if("durationchange"===e&&(t._duration=t.media.duration),"volumechange"===e&&(s.isMutedChange=t._lastMuted!==t.muted,t._lastMuted=t.muted),"error"===e&&(s.error=n||t.video.error),t.mediaEventMiddleware[e]){const i=gt.bind(t,e,s);try{t.mediaEventMiddleware[e].call(t,s,i)}catch(r){throw gt.call(t,e,s),r}}else gt.call(t,e,s)}}class vt extends(V()){constructor(e){super(e),this._hasStart=!1,this._currentTime=0,this._duration=0,this._internalOp={},this._lastMuted=!1,this.vtype="MP4",this._rate=-1,this.mediaConfig=Object.assign({},{controls:!1,autoplay:e.autoplay,playsinline:e.playsinline,"x5-playsinline":e.playsinline,"webkit-playsinline":e.playsinline,"x5-video-player-fullscreen":e["x5-video-player-fullscreen"]||e.x5VideoPlayerFullscreen,"x5-video-orientation":e["x5-video-orientation"]||e.x5VideoOrientation,airplay:e.airplay,"webkit-airplay":e.airplay,tabindex:0|e.tabindex,mediaType:e.mediaType||"video","data-index":-1},e.videoConfig,e.videoAttributes);const t=e["x5-video-player-type"]||e.x5VideoPlayerType;se.isWeixin&&se.os.isAndroid&&t&&(this.mediaConfig["x5-video-player-type"]=t,delete this.mediaConfig.playsinline,delete this.mediaConfig["webkit-playsinline"],delete this.mediaConfig["x5-playsinline"]),e.loop&&(this.mediaConfig.loop="loop"),e.autoplayMuted&&!Object.prototype.hasOwnProperty.call(this.mediaConfig,"muted")&&(this.mediaConfig.muted=!0),this.media=X.createDom(this.mediaConfig.mediaType,"",this.mediaConfig,""),e.defaultPlaybackRate&&(this.media.defaultPlaybackRate=this.media.playbackRate=e.defaultPlaybackRate),"Number"===X.typeOf(e.volume)&&(this.volume=e.volume),e.autoplayMuted&&(this.media.muted=!0,this._lastMuted=!0),e.autoplay&&(this.media.autoplay=!0),this._interval={},this.mediaEventMiddleware={},this.attachVideoEvents()}setEventsMiddleware(e){Object.keys(e).map((t=>{this.mediaEventMiddleware[t]=e[t]}))}removeEventsMiddleware(e){Object.keys(e).map((e=>{delete this.mediaEventMiddleware[e]}))}attachVideoEvents(e=this.media){this._evHandlers||(this._evHandlers=dt.map((e=>{const t=`on${e.charAt(0).toUpperCase()}${e.slice(1)}`;return"function"===typeof this[t]&&this.on(e,this[t]),{[e]:mt(e,this)}}))),this._evHandlers.forEach((t=>{const i=Object.keys(t)[0];e.addEventListener(i,t[i],!1)}))}detachVideoEvents(e=this.media){this._evHandlers.forEach((t=>{const i=Object.keys(t)[0];e.removeEventListener(i,t[i],!1)})),this._evHandlers.forEach((e=>{const t=Object.keys(e)[0],i=`on${t.charAt(0).toUpperCase()}${t.slice(1)}`;"function"===typeof this[i]&&this.off(t,this[i])})),this._evHandlers=null}_attachSourceEvents(e,t){e.removeAttribute("src"),e.load(),t.forEach(((e,t)=>{this.media.appendChild(X.createDom("source","",{src:`${e.src}`,type:`${e.type||""}`,"data-index":t+1}))}));const i=e.children;if(!i)return;this._videoSourceCount=i.length,this._videoSourceIndex=i.length,this._vLoadeddata=e=>{this.emit(ut,{src:e.target.currentSrc,host:X.getHostFromUrl(e.target.currentSrc)})};let n=null;for(let s=0;s<this._evHandlers.length;s++)if("error"===Object.keys(this._evHandlers[s])[0]){n=this._evHandlers[s];break}!this._sourceError&&(this._sourceError=e=>{const t=parseInt(e.target.getAttribute("data-index"),10);if(this._videoSourceIndex--,0===this._videoSourceIndex||t>=this._videoSourceCount){const t={code:4,message:"sources_load_error"};n?n.error(e,t):this.errorHandler("error",t)}const i=oe[4];this.emit(ct,new le(this,{errorType:i,errorCode:4,errorMessage:"sources_load_error",mediaError:{code:4,message:"sources_load_error"},src:e.target.src}))});for(let s=0;s<i.length;s++)i[s].addEventListener("error",this._sourceError);e.addEventListener("loadeddata",this._vLoadeddata)}_detachSourceEvents(e){const t=e.children;if(t&&0!==t.length&&this._sourceError){for(let e=0;e<t.length;e++)t[e].removeEventListener("error",this._sourceError);while(t.length>0)e.removeChild(t[0]);this._vLoadeddata&&e.removeEventListener("loadeddata",this._vLoadeddata)}}errorHandler(e,t=null){if(this.media&&(this.media.error||t)){let i=this.media.error||t;const n=i.code?oe[i.code]:"other";let s=i.message;this.media.currentSrc||(s="empty_src",i={code:6,message:s}),this.emit(e,new le(this,{errorType:n,errorCode:i.code,errorMessage:i.message||"",mediaError:i}))}}destroy(){this.media&&(this.media.pause&&(this.media.pause(),this.media.muted=!0),this.media.removeAttribute("src"),this.media.load()),this._currentTime=0,this._duration=0,this.mediaConfig=null;for(const e in this._interval)Object.prototype.hasOwnProperty.call(this._interval,e)&&(clearInterval(this._interval[e]),this._interval[e]=null);this.detachVideoEvents(),this.media=null,this.mediaEventMiddleware={},this.removeAllListeners()}get video(){return this.media}set video(e){this.media=e}play(){const e=this.media?this.media.play():null;return e}pause(){this.media&&this.media.pause()}load(){this.media&&this.media.load()}canPlayType(e){return!!this.media&&this.media.canPlayType(e)}getBufferedRange(e){const t=[0,0];if(!this.media)return t;e||(e=this.media.buffered);const i=this.media.currentTime;if(e)for(let n=0,s=e.length;n<s;n++)if(t[0]=e.start(n),t[1]=e.end(n),t[0]<=i&&i<=t[1])break;return t[0]-i<=0&&i-t[1]<=0?t:[0,0]}set autoplay(e){this.media&&(this.media.autoplay=e)}get autoplay(){return!!this.media&&this.media.autoplay}get buffered(){return this.media?this.media.buffered:null}get buffered2(){return this.media&&this.media.buffered?X.getBuffered2(this.media.buffered):null}get bufferedPoint(){const e={start:0,end:0};if(!this.media)return e;const t=this.media.buffered;if(!t||0===t.length)return e;for(let i=0;i<t.length;i++)if((t.start(i)<=this.currentTime||t.start(i)<.1)&&t.end(i)>=this.currentTime)return{start:t.start(i),end:t.end(i)};return e}get crossOrigin(){return this.media?this.media.crossOrigin:""}set crossOrigin(e){this.media&&(this.media.crossOrigin=e)}get currentSrc(){return this.media?this.media.currentSrc:""}set currentSrc(e){this.media&&(this.media.currentSrc=e)}get currentTime(){return this.media?void 0!==this.media.currentTime?this.media.currentTime:this._currentTime:0}set currentTime(e){this.media&&(this.media.currentTime=e)}get defaultMuted(){return!!this.media&&this.media.defaultMuted}set defaultMuted(e){this.media&&(this.media.defaultMuted=e)}get duration(){return this._duration}get ended(){return!!this.media&&this.media.ended}get error(){return this.media.error}get errorNote(){const e=this.media.error;if(!e)return"";const t=["MEDIA_ERR_ABORTED","MEDIA_ERR_NETWORK","MEDIA_ERR_DECODE","MEDIA_ERR_SRC_NOT_SUPPORTED"];return t[this.media.error.code-1]}get loop(){return!!this.media&&this.media.loop}set loop(e){this.media&&(this.media.loop=e)}get muted(){return!!this.media&&this.media.muted}set muted(e){this.media&&this.media.muted!==e&&(this._lastMuted=this.media.muted,this.media.muted=e)}get networkState(){return this.media.networkState}get paused(){return!this.media||this.media.paused}get playbackRate(){return this.media?this.media.playbackRate:0}set playbackRate(e){this.media&&e!==1/0&&(this.media.defaultPlaybackRate=e,this.media.playbackRate=e)}get played(){return this.media?this.media.played:null}get preload(){return!!this.media&&this.media.preload}set preload(e){this.media&&(this.media.preload=e)}get readyState(){return this.media.readyState}get seekable(){return!!this.media&&this.media.seekable}get seeking(){return!!this.media&&this.media.seeking}get src(){return this.media?this.media.src:""}set src(e){this.media&&(this.emit(je,e),this.emit(ve),this._currentTime=0,this._duration=0,X.isMSE(this.media)?this.onWaiting():(this._detachSourceEvents(this.media),"Array"===X.typeOf(e)?this._attachSourceEvents(this.media,e):e?this.media.src=e:this.media.removeAttribute("src"),this.load()))}get volume(){return this.media?this.media.volume:0}set volume(e){e!==1/0&&this.media&&(this.media.volume=e)}get aspectRatio(){return this.media?this.media.videoWidth/this.media.videoHeight:0}addInnerOP(e){this._internalOp[e]=!0}removeInnerOP(e){delete this._internalOp[e]}emit(e,t,...i){super.emit(e,t,...i)}on(e,t,...i){super.on(e,t,...i)}once(e,t,...i){super.once(e,t,...i)}off(e,t,...i){super.off(e,t,...i)}offAll(){super.removeAllListeners()}}class yt{constructor(e={name:"xgplayer",version:1,db:null,ojstore:{name:"xg-m4a",keypath:"vid"}}){this.indexedDB=window.indexedDB||window.webkitindexedDB,this.IDBKeyRange=window.IDBKeyRange||window.webkitIDBKeyRange,this.myDB=e}openDB(e){const t=this,i=this.myDB.version||1,n=t.indexedDB.open(t.myDB.name,i);n.onerror=function(e){},n.onsuccess=i=>{this.myDB.db=i.target.result,e.call(t)},n.onupgradeneeded=e=>{const i=e.target.result;e.target.transaction,i.objectStoreNames.contains(t.myDB.ojstore.name)||i.createObjectStore(t.myDB.ojstore.name,{keyPath:t.myDB.ojstore.keypath})}}deletedb(){const e=this;e.indexedDB.deleteDatabase(this.myDB.name)}closeDB(){this.myDB.db.close()}addData(e,t){const i=this.myDB.db.transaction(e,"readwrite").objectStore(e);let n;for(let s=0;s<t.length;s++)n=i.add(t[s]),n.onerror=function(){},n.onsuccess=function(){}}putData(e,t){const i=this.myDB.db.transaction(e,"readwrite").objectStore(e);let n;for(let s=0;s<t.length;s++)n=i.put(t[s]),n.onerror=function(){},n.onsuccess=function(){}}getDataByKey(e,t,i){const n=this,s=this.myDB.db.transaction(e,"readwrite").objectStore(e),r=s.get(t);r.onerror=function(){i.call(n,null)},r.onsuccess=function(e){const t=e.target.result;i.call(n,t)}}deleteData(e,t){const i=this.myDB.db.transaction(e,"readwrite").objectStore(e);i.delete(t)}clearData(e){const t=this.myDB.db.transaction(e,"readwrite").objectStore(e);t.clear()}}const _t=["fullscreenchange","webkitfullscreenchange","mozfullscreenchange","MSFullscreenChange"],bt=["requestFullscreen","webkitRequestFullscreen","mozRequestFullScreen","msRequestFullscreen"],St=["exitFullscreen","webkitExitFullscreen","mozCancelFullScreen","msExitFullscreen"],Et="data-xgplayerid";function Tt(e,t,i,...n){const s=t.call(e,...n);i&&"function"===typeof i&&(s&&s.then?s.then(((...t)=>{i.call(e,...t)})):i.call(e,...n))}function kt(e,t,i={pre:null,next:null}){return this.__hooks||(this.__hooks={}),!this.__hooks[e]&&(this.__hooks[e]=null),function(){if(i.pre)try{i.pre.call(this,...arguments)}catch(n){throw n.message=`[pluginName: ${this.pluginName}:${e}:pre error] >> ${n.message}`,n}if(this.__hooks&&this.__hooks[e])try{const n=this.__hooks[e].call(this,this,...arguments);n?n.then?n.then((e=>{!1!==e&&Tt(this,t,i.next,...arguments)})).catch((e=>{throw e})):Tt(this,t,i.next,...arguments):void 0===n&&Tt(this,t,i.next,...arguments)}catch(n){throw n.message=`[pluginName: ${this.pluginName}:${e}] >> ${n.message}`,n}else Tt(this,t,i.next,...arguments)}.bind(this)}function wt(e,t){const{__hooks:i}=this;if(i)return i.hasOwnProperty(e)?(i&&(i[e]=t),!0):(console.warn(`has no supported hook which name [${e}]`),!1)}function xt(e,t){const{__hooks:i}=this;i&&delete i[e]}function Ct(e,...t){if(!this.plugins||!this.plugins[e.toLowerCase()])return;const i=this.plugins[e.toLowerCase()];return i.useHooks&&i.useHooks(...t)}function At(e,...t){if(!this.plugins||!this.plugins[e.toLowerCase()])return;const i=this.plugins[e.toLowerCase()];return i?i.removeHooks&&i.removeHooks(...t):void 0}function Pt(e,t=[]){e.__hooks={},t&&t.map((t=>{e.__hooks[t]=null})),Object.defineProperty(e,"hooks",{get:()=>e.__hooks&&Object.keys(e.__hooks).map((t=>{if(e.__hooks[t])return t}))})}function It(e){e.__hooks=null}function Dt(e,t,i,...n){if(!e.__hooks||!e.__hooks[t])return i.call(e,e,...n);{const s=e.__hooks[t].call(e,e,...n);if(s&&s.then)s.then((t=>!1===t?null:i.call(e,e,...n))).catch((e=>{console.warn(`[runHooks]${t} reject`,e.message)}));else if(!1!==s)return i.call(e,e,...n)}}function Lt(e,t){W.logError(`[${e}] event or callback cant be undefined or null when call ${t}`)}class Ot{static defineGetterOrSetter(e,t){for(const i in t)Object.prototype.hasOwnProperty.call(t,i)&&Object.defineProperty(e,i,t[i])}static get defaultConfig(){return{}}static get pluginName(){return"pluginName"}constructor(e){X.checkIsFunction(this.beforeCreate)&&this.beforeCreate(e),Pt(this),this.__args=e,this.__events={},this.__onceEvents={},this.config=e.config||{},this.player=null,this.playerConfig={},this.pluginName="",this.__init(e)}beforeCreate(e){}afterCreate(){}beforePlayerInit(){}onPluginsReady(){}afterPlayerInit(){}destroy(){}__init(e){this.player=e.player,this.playerConfig=e.player&&e.player.config,this.pluginName=e.pluginName?e.pluginName.toLowerCase():this.constructor.pluginName.toLowerCase(),this.logger=e.player&&e.player.logger}updateLang(e){e||(e=this.lang)}get lang(){return this.player.lang}get i18n(){return this.player.i18n}get i18nKeys(){return this.player.i18nKeys}get domEventType(){let e=X.checkTouchSupport()?"touch":"mouse";return!this.playerConfig||"touch"!==this.playerConfig.domEventType&&"mouse"!==this.playerConfig.domEventType||(e=this.playerConfig.domEventType),e}on(e,t){e&&t&&this.player?"string"===typeof e?(this.__events[e]=t,this.player.on(e,t)):Array.isArray(e)&&e.forEach((e=>{this.__events[e]=t,this.player.on(e,t)})):Lt(this.pluginName,"plugin.on(event, callback)")}once(e,t){e&&t&&this.player?"string"===typeof e?(this.__onceEvents[e]=t,this.player.once(e,t)):Array.isArray(e)&&e.forEach((i=>{this.__onceEvents[i]=t,this.player.once(e,t)})):Lt(this.pluginName,"plugin.once(event, callback)")}off(e,t){e&&t&&this.player?"string"===typeof e?(delete this.__events[e],this.player.off(e,t)):Array.isArray(e)&&e.forEach((i=>{delete this.__events[e],this.player.off(i,t)})):Lt(this.pluginName,"plugin.off(event, callback)")}offAll(){["__events","__onceEvents"].forEach((e=>{Object.keys(this[e]).forEach((t=>{this[e][t]&&this.off(t,this[e][t]),t&&delete this[e][t]}))})),this.__events={},this.__onceEvents={}}emit(e,...t){this.player&&this.player.emit(e,...t)}emitUserAction(e,t,i={}){if(!this.player)return;const n={...i,pluginName:this.pluginName};this.player.emitUserAction(e,t,n)}hook(e,t,i={pre:null,next:null}){return kt.call(this,...arguments)}useHooks(e,t,...i){return wt.call(this,...arguments)}removeHooks(e,t,...i){return xt.call(this,...arguments)}registerPlugin(e,t={},i=""){if(this.player)return i&&(t.pluginName=i),this.player.registerPlugin({plugin:e,options:t})}getPlugin(e){return this.player?this.player.getPlugin(e):null}__destroy(){const e=this.player,t=this.pluginName;this.offAll(),X.clearAllTimers(this),X.checkIsFunction(this.destroy)&&this.destroy(),["player","playerConfig","pluginName","logger","__args","__hooks"].map((e=>{this[e]=null})),e.unRegisterPlugin(t),It(this)}}var Rt=i(2357),Mt=i.n(Rt);const Nt={CONTROLS:"controls",ROOT:"root"},Ut={ROOT:"root",ROOT_LEFT:"rootLeft",ROOT_RIGHT:"rootRight",ROOT_TOP:"rootTop",CONTROLS_LEFT:"controlsLeft",CONTROLS_RIGTH:"controlsRight",CONTROLS_RIGHT:"controlsRight",CONTROLS_CENTER:"controlsCenter",CONTROLS:"controls"},Ft={ICON_DISABLE:"xg-icon-disable",ICON_HIDE:"xg-icon-hide"};function Bt(e){return!!e&&(e.indexOf&&/^(?:http|data:|\/)/.test(e))}function Ht(e,t){return"object"===typeof e&&e.class&&"string"===typeof e.class?`${t} ${e.class}`:t}function jt(e,t){return"object"===typeof e&&e.attr&&"object"===typeof e.attr&&Object.keys(e.attr).map((i=>{t[i]=e.attr[i]})),t}function Vt(e,t,i="",n={},s=""){let r=null;if(e instanceof window.Element)return X.addClass(e,i),Object.keys(n).map((t=>{e.setAttribute(t,n[t])})),e;if(Bt(e)||Bt(e.url))return n.src=Bt(e)?e:e.url||"",r=X.createDom(e.tag||"img","",n,`xg-img ${i}`),r;if("function"===typeof e)try{return r=e(),r instanceof window.Element?(X.addClass(r,i),Object.keys(n).map((e=>{r.setAttribute(e,n[e])})),r):(W.logWarn(`warn>>icons.${t} in config of plugin named [${s}] is a function mast return an Element Object`),null)}catch(o){return W.logError(`Plugin named [${s}]:createIcon`,o),null}return"string"===typeof e?X.createDomFromHtml(e,n,i):(W.logWarn(`warn>>icons.${t} in config of plugin named [${s}] is invalid`),null)}function Gt(e,t){const i=t.config.icons||t.playerConfig.icons;Object.keys(e).map((n=>{const s=e[n];let r=s&&s.class?s.class:"",o=s&&s.attr?s.attr:{},a=null;i&&i[n]&&(r=Ht(i[n],r),o=jt(i[n],o),a=Vt(i[n],n,r,o,t.pluginName)),!a&&s&&(a=Vt(s.icon?s.icon:s,o,r,{},t.pluginName)),t.icons[n]=a}))}function zt(e,t){Object.keys(e).map((i=>{Object.defineProperty(t.langText,i,{get:()=>{const{lang:n,i18n:s}=t;return s[i]?s[i]:e[i]&&e[i][n]||""}})}))}class Kt extends Ot{static insert(e,t,i=0){const n=t.children.length,s=Number(i),r=e instanceof window.Node;if(n){let i=0,o=null,a="";for(;i<n;i++){o=t.children[i];const e=Number(o.getAttribute("data-index"));if(e>=s){a="beforebegin";break}e<s&&(a="afterend")}return r?"afterend"===a?t.appendChild(e):t.insertBefore(e,o):o.insertAdjacentHTML(a,e),"afterend"===a?t.children[t.children.length-1]:t.children[i]}return r?t.appendChild(e):t.insertAdjacentHTML("beforeend",e),t.children[t.children.length-1]}static get defaultConfig(){return{}}static delegate(e,t,i,n,s=!1){const r=[];if(e instanceof window.Node&&"function"===typeof n)if(Array.isArray(i))i.forEach((i=>{const o=Mt()(e,t,i,n,s);o.key=`${t}_${i}`,r.push(o)}));else{const o=Mt()(e,t,i,n,s);o.key=`${t}_${i}`,r.push(o)}return r}static get ROOT_TYPES(){return Nt}static get POSITIONS(){return Ut}constructor(e={}){super(e),this.__delegates=[]}__init(e){if(super.__init(e),!e.root)return;const t=e.root;let i=null;this.icons={},this.root=null,this.parent=null;const n=this.registerIcons()||{};Gt(n,this),this.langText={};const s=this.registerLanguageTexts()||{};zt(s,this);let r="";try{r=this.render()}catch(l){throw W.logError(`Plugin:${this.pluginName}:render`,l),new Error(`Plugin:${this.pluginName}:render:${l.message}`)}if(r)i=Kt.insert(r,t,e.index),i.setAttribute("data-index",e.index);else{if(!e.tag)return;i=X.createDom(e.tag,"",e.attr,e.name),i.setAttribute("data-index",e.index),t.appendChild(i)}this.root=i,this.parent=t;const o=this.config.attr||{},a=this.config.style||{};this.setAttr(o),this.setStyle(a),this.config.index&&this.root.setAttribute("data-index",this.config.index),this.__registerChildren()}__registerChildren(){if(!this.root)return;this._children=[];const e=this.children();e&&"object"===typeof e&&Object.keys(e).length>0&&Object.keys(e).map((t=>{const i=t,n=e[i],s={root:this.root};let r,o;"function"===typeof n?(r=this.config[i]||{},o=n):"object"===typeof n&&"function"===typeof n.plugin&&(r=n.options?X.deepCopy(this.config[i]||{},n.options):this.config[i]||{},o=n.plugin),s.config=r,void 0!==r.index&&(s.index=r.index),r.root&&(s.root=r.root),this.registerPlugin(o,s,i)}))}updateLang(e){function t(e,i){for(let n=0;n<e.children.length;n++)e.children[n].children.length>0?t(e.children[n],i):i(e.children[n])}e||(e=this.lang);const{root:i,i18n:n,langText:s}=this;i&&t(i,(t=>{const i=t.getAttribute&&t.getAttribute("lang-key");if(!i)return;const r=n[i.toUpperCase()]||s[i];r&&(t.innerHTML="function"===typeof r?r(e):r)}))}get lang(){return this.player.lang}changeLangTextKey(e,t=""){const i=this.i18n||{},n=this.langText;e.setAttribute&&e.setAttribute("lang-key",t);const s=i[t]||n[t]||"";s&&(e.innerHTML=s)}plugins(){return this._children}disable(){this.config.disable=!0,X.addClass(this.find(".xgplayer-icon"),Ft.ICON_DISABLE)}enable(){this.config.disable=!1,X.removeClass(this.find(".xgplayer-icon"),Ft.ICON_DISABLE)}children(){return{}}registerPlugin(e,t={},i=""){t.root=t.root||this.root;const n=super.registerPlugin(e,t,i);return this._children.push(n),n}registerIcons(){return{}}registerLanguageTexts(){return{}}find(e){if(this.root)return this.root.querySelector(e)}bind(e,t,i){if(arguments.length<3&&"function"===typeof t)Array.isArray(e)?e.forEach((e=>{this.bindEL(e,t)})):this.bindEL(e,t);else{const n=Kt.delegate.call(this,this.root,e,t,i);this.__delegates=this.__delegates.concat(n)}}unbind(e,t){if(arguments.length<3&&"function"===typeof t)Array.isArray(e)?e.forEach((e=>{this.unbindEL(e,t)})):this.unbindEL(e,t);else{const i=`${e}_${t}`;for(let e=0;e<this.__delegates.length;e++)if(this.__delegates[e].key===i){this.__delegates[e].destroy(),this.__delegates.splice(e,1);break}}}setStyle(e,t){if(this.root)return"String"===X.typeOf(e)?this.root.style[e]=t:void("Object"===X.typeOf(e)&&Object.keys(e).map((t=>{this.root.style[t]=e[t]})))}setAttr(e,t){if(this.root)return"String"===X.typeOf(e)?this.root.setAttribute(e,t):void("Object"===X.typeOf(e)&&Object.keys(e).map((t=>{this.root.setAttribute(t,e[t])})))}setHtml(e,t){this.root&&(this.root.innerHTML=e,"function"===typeof t&&t())}bindEL(e,t,i=!1){this.root&&`on${e}`in this.root&&"function"===typeof t&&this.root.addEventListener(e,t,i)}unbindEL(e,t,i=!1){this.root&&`on${e}`in this.root&&"function"===typeof t&&this.root.removeEventListener(e,t,i)}show(e){if(!this.root)return;this.root.style.display=void 0!==e?e:"block";const t=window.getComputedStyle(this.root,null),i=t.getPropertyValue("display");return"none"===i?this.root.style.display="block":void 0}hide(){this.root&&(this.root.style.display="none")}appendChild(e,t){if(!this.root)return null;if(arguments.length<2&&arguments[0]instanceof window.Element)return this.root.appendChild(arguments[0]);if(!t||!(t instanceof window.Element))return null;try{return"string"===typeof e?this.find(e).appendChild(t):e.appendChild(t)}catch(i){return W.logError("Plugin:appendChild",i),null}}render(){return""}destroy(){}__destroy(){const{player:e}=this;this.__delegates.map((e=>{e.destroy()})),this.__delegates=[],this._children instanceof Array&&(this._children.map((t=>{e.unRegisterPlugin(t.pluginName)})),this._children=null),this.root&&(this.root.hasOwnProperty("remove")?this.root.remove():this.root.parentNode&&this.root.parentNode.removeChild(this.root)),super.__destroy(),this.icons={},["root","parent"].map((e=>{this[e]=null}))}}var Wt=Object.defineProperty,Yt=(e,t,i)=>t in e?Wt(e,t,{enumerable:!0,configurable:!0,writable:!0,value:i}):e[t]=i,$t=(e,t,i)=>(Yt(e,"symbol"!==typeof t?t+"":t,i),i);class Xt{constructor(){if($t(this,"__trigger",(e=>{const t=(new Date).getTime();this.timeStamp=t;for(let i=0;i<e.length;i++)this.__runHandler(e[i].target)})),this.__handlers=[],this.timeStamp=0,this.observer=null,window.ResizeObserver)try{this.observer=new window.ResizeObserver(J(this.__trigger,100,{trailing:!0})),this.timeStamp=(new Date).getTime()}catch(e){console.error(e)}}addObserver(e,t){if(!this.observer)return;this.observer&&this.observer.observe(e);const i=e.getAttribute(Et),{__handlers:n}=this;let s=-1;for(let r=0;r<n.length;r++)n[r]&&e===n[r].target&&(s=r);s>-1?this.__handlers[s].handler=t:this.__handlers.push({target:e,handler:t,playerId:i})}unObserver(e){let t=-1;this.__handlers.map(((i,n)=>{e===i.target&&(t=n)}));try{this.observer&&this.observer.unobserve(e)}catch(i){}this.observer&&this.observer.unobserve(e),t>-1&&this.__handlers.splice(t,1)}destroyObserver(){this.observer&&this.observer.disconnect(),this.observer=null,this.__handlers=null}__runHandler(e){const{__handlers:t}=this;for(let n=0;n<t.length;n++)if(t[n]&&e===t[n].target){try{t[n].handler(e)}catch(i){console.error(i)}return!0}return!1}}let qt=null;function Qt(e,t){return qt||(qt=new Xt),qt.addObserver(e,t),qt}function Zt(e,t){qt.unObserver(e,t)}const Jt={pluginGroup:{},init(e){let t=e._pluginInfoId;t||(t=X.generateSessionId(),e._pluginInfoId=t),!e.config.closeResizeObserver&&e.root&&Qt(e.root,(()=>{e.resize()})),this.pluginGroup[t]={_originalOptions:e.config||{},_plugins:{}}},formatPluginInfo(e,t){let i=null,n=null;return e.plugin&&"function"===typeof e.plugin?(i=e.plugin,n=e.options):(i=e,n={}),t&&(n.config=t||{}),{PLUFGIN:i,options:n}},checkPluginIfExits(e,t){for(let i=0;i<t.length;i++)if(e.toLowerCase()===t[i].pluginName.toLowerCase())return!0;return!1},getRootByConfig(e,t){const i=Object.keys(t);let n=null;for(let s=0;s<i.length;s++)if(e.toLowerCase()===i[s].toLowerCase()){n=t[i[s]];break}return"Object"===X.typeOf(n)?{root:n.root,position:n.position}:{}},lazyRegister(e,t){const i=t.timeout||1500;return Promise.race([t.loader().then((t=>{let i;i=t&&t.__esModule?t.default:t,this.register(e,i,t.options)})),new Promise(((e,t)=>{setTimeout((()=>{t(new Error("timeout"))}),i)}))])},register(e,t,i={}){if(!e||!t||"function"!==typeof t||void 0===t.prototype)return;const n=e._pluginInfoId;if(!n||!this.pluginGroup[n])return;this.pluginGroup[n]._plugins||(this.pluginGroup[n]._plugins={});const s=this.pluginGroup[n]._plugins,r=this.pluginGroup[n]._originalOptions;i.player=e;const o=i.pluginName||t.pluginName;if(!o)throw new Error("The property pluginName is necessary");if(t.isSupported&&!t.isSupported(e.config.mediaType,e.config.codecType))return void console.warn(`not supported plugin [${o}]`);i.config||(i.config={});const a=Object.keys(r);for(let c=0;c<a.length;c++)if(o.toLowerCase()===a[c].toLowerCase()){const e=r[a[c]];"Object"===X.typeOf(e)?i.config=Object.assign({},i.config,r[a[c]]):"Boolean"===X.typeOf(e)&&(i.config.disable=!e);break}t.defaultConfig&&Object.keys(t.defaultConfig).forEach((e=>{"undefined"===typeof i.config[e]&&(i.config[e]=t.defaultConfig[e])})),i.root?"string"===typeof i.root&&(i.root=e[i.root]):i.root=e.root,i.index=i.config.index||0;try{s[o.toLowerCase()]&&(this.unRegister(n,o.toLowerCase()),console.warn(`the is one plugin with same pluginName [${o}] exist, destroy the old instance`));const e=new t(i);return s[o.toLowerCase()]=e,s[o.toLowerCase()].func=t,e&&"function"===typeof e.afterCreate&&e.afterCreate(),e}catch(l){throw console.error(l),l}},unRegister(e,t){e._pluginInfoId&&(e=e._pluginInfoId),t=t.toLowerCase();try{const i=this.pluginGroup[e]._plugins[t];i&&(i.pluginName&&i.__destroy(),delete this.pluginGroup[e]._plugins[t])}catch(i){console.error(`[unRegister:${t}] cgid:[${e}] error`,i)}},deletePlugin(e,t){const i=e._pluginInfoId;i&&this.pluginGroup[i]&&this.pluginGroup[i]._plugins&&delete this.pluginGroup[i]._plugins[t]},getPlugins(e){const t=e._pluginInfoId;return t&&this.pluginGroup[t]?this.pluginGroup[t]._plugins:{}},findPlugin(e,t){const i=e._pluginInfoId;if(!i||!this.pluginGroup[i])return null;const n=t.toLowerCase();return this.pluginGroup[i]._plugins[n]},beforeInit(e){function t(e){return e&&e.then?e:new Promise((e=>{e()}))}return new Promise((i=>{if(!this.pluginGroup)return;let n;return n=e._loadingPlugins&&e._loadingPlugins.length?Promise.all(e._loadingPlugins):Promise.resolve(),n.then((()=>{const n=e._pluginInfoId;if(!this.pluginGroup[n])return void i();const s=this.pluginGroup[n]._plugins,r=[];Object.keys(s).forEach((e=>{if(s[e]&&s[e].beforePlayerInit)try{const i=s[e].beforePlayerInit();r.push(t(i))}catch(i){throw r.push(t(null)),i}})),Promise.all([...r]).then((()=>{i()})).catch((e=>{console.error(e),i()}))}))}))},afterInit(e){const t=e._pluginInfoId;if(!t||!this.pluginGroup[t])return;const i=this.pluginGroup[t]._plugins;Object.keys(i).forEach((e=>{i[e]&&i[e].afterPlayerInit&&i[e].afterPlayerInit()}))},setLang(e,t){const i=t._pluginInfoId;if(!i||!this.pluginGroup[i])return;const n=this.pluginGroup[i]._plugins;Object.keys(n).forEach((t=>{if(n[t].updateLang)n[t].updateLang(e);else try{n[t].lang=e}catch(i){console.warn(`${t} setLang`)}}))},reRender(e){const t=e._pluginInfoId;if(!t||!this.pluginGroup[t])return;const i=[],n=this.pluginGroup[t]._plugins;Object.keys(n).forEach((e=>{"controls"!==e&&n[e]&&(i.push({plugin:n[e].func,options:n[e].__args}),this.unRegister(t,e))})),i.forEach((t=>{this.register(e,t.plugin,t.options)}))},onPluginsReady(e){const t=e._pluginInfoId;if(!t||!this.pluginGroup[t])return;const i=this.pluginGroup[t]._plugins||{};Object.keys(i).forEach((e=>{i[e].onPluginsReady&&"function"===typeof i[e].onPluginsReady&&i[e].onPluginsReady()}))},destroy(e){const t=e._pluginInfoId;if(!this.pluginGroup[t])return;e.root&&Zt(e.root);const i=this.pluginGroup[t]._plugins;for(const n of Object.keys(i))this.unRegister(t,n);delete this.pluginGroup[t],delete e._pluginInfoId}};var ei={DEFAULT:"xgplayer",DEFAULT_SKIN:"xgplayer-skin-default",ENTER:"xgplayer-is-enter",PAUSED:"xgplayer-pause",PLAYING:"xgplayer-playing",ENDED:"xgplayer-ended",CANPLAY:"xgplayer-canplay",LOADING:"xgplayer-isloading",ERROR:"xgplayer-is-error",REPLAY:"xgplayer-replay",NO_START:"xgplayer-nostart",ACTIVE:"xgplayer-active",INACTIVE:"xgplayer-inactive",FULLSCREEN:"xgplayer-is-fullscreen",CSS_FULLSCREEN:"xgplayer-is-cssfullscreen",ROTATE_FULLSCREEN:"xgplayer-rotate-fullscreen",PARENT_ROTATE_FULLSCREEN:"xgplayer-rotate-parent",PARENT_FULLSCREEN:"xgplayer-fullscreen-parent",INNER_FULLSCREEN:"xgplayer-fullscreen-inner",NO_CONTROLS:"no-controls",FLEX_CONTROLS:"flex-controls",CONTROLS_FOLLOW:"controls-follow",CONTROLS_AUTOHIDE:"controls-autohide",TOP_BAR_AUTOHIDE:"top-bar-autohide",NOT_ALLOW_AUTOPLAY:"not-allow-autoplay",SEEKING:"seeking",PC:"xgplayer-pc",BUILTIN_CLASS:"xgplayer-built-in",MOBILE:"xgplayer-mobile",MINI:"xgplayer-mini"};function ti(){return{id:"",el:null,isNoRoot:!1,isCustomRoot:!0,url:"",domEventType:"default",nullUrlStart:!1,width:600,height:337.5,fluid:!1,fitVideoSize:"fixed",videoFillMode:"auto",volume:.6,autoplay:!1,autoplayMuted:!1,loop:!1,isLive:!1,zoom:1,videoInit:!0,poster:"",isMobileSimulateMode:!1,defaultPlaybackRate:1,execBeforePluginsCall:null,allowSeekAfterEnded:!0,enableContextmenu:!0,closeVideoClick:!1,closeVideoDblclick:!1,closePlayerBlur:!1,closeDelayBlur:!1,leavePlayerTime:3e3,closePlayVideoFocus:!1,closePauseVideoFocus:!1,closeFocusVideoFocus:!0,closeControlsBlur:!0,topBarAutoHide:!0,videoAttributes:{},startTime:0,seekedStatus:"play",miniprogress:!1,disableSwipeHandler:()=>{},enableSwipeHandler:()=>{},preProcessUrl:null,ignores:[],whitelist:[],inactive:3e3,lang:ee(),controls:!0,marginControls:!1,fullscreenTarget:null,screenShot:!1,rotate:!1,pip:!1,download:!1,mini:!1,cssFullscreen:!0,keyShortcut:!0,presets:[],plugins:[],playbackRate:1,definition:{list:[]},playsinline:!0,customDuration:0,timeOffset:0,icons:{},i18n:[],tabindex:0,thumbnail:null,videoConfig:{},isHideTips:!1,minWaitDelay:200,commonStyle:{progressColor:"",playedColor:"",cachedColor:"",sliderBtnStyle:{},volumeColor:""}}}const ii=(e,t)=>{let i;i=t.preset&&t.options?new t.preset(t.options,e.config):new t({},e.config);const{plugins:n=[],ignores:s=[],icons:r={},i18n:o=[]}=i;e.config.plugins||(e.config.plugins=[]),e.config.ignores||(e.config.ignores=[]),e.config.plugins.push(...n),e.config.ignores.push(...s),Object.keys(r).map((t=>{e.config.icons[t]||(e.config.icons[t]=r[t])}));const a=e.config.i18n||[];o.push(...a),e.config.i18n=o};var ni={LANG:"en",TEXT:{ERROR_TYPES:{network:{code:1,msg:"video download error"},mse:{code:2,msg:"stream append error"},parse:{code:3,msg:"parsing error"},format:{code:4,msg:"wrong format"},decoder:{code:5,msg:"decoding error"},runtime:{code:6,msg:"grammatical errors"},timeout:{code:7,msg:"play timeout"},other:{code:8,msg:"other errors"}},HAVE_NOTHING:"There is no information on whether audio/video is ready",HAVE_METADATA:"Audio/video metadata is ready ",HAVE_CURRENT_DATA:"Data about the current play location is available, but there is not enough data to play the next frame/millisecond",HAVE_FUTURE_DATA:"Current and at least one frame of data is available",HAVE_ENOUGH_DATA:"The available data is sufficient to start playing",NETWORK_EMPTY:"Audio/video has not been initialized",NETWORK_IDLE:"Audio/video is active and has been selected for resources, but no network is used",NETWORK_LOADING:"The browser is downloading the data",NETWORK_NO_SOURCE:"No audio/video source was found",MEDIA_ERR_ABORTED:"The fetch process is aborted by the user",MEDIA_ERR_NETWORK:"An error occurred while downloading",MEDIA_ERR_DECODE:"An error occurred while decoding",MEDIA_ERR_SRC_NOT_SUPPORTED:"Audio/video is not supported",REPLAY:"Replay",ERROR:"Network is offline",PLAY_TIPS:"Play",PAUSE_TIPS:"Pause",PLAYNEXT_TIPS:"Play next",DOWNLOAD_TIPS:"Download",ROTATE_TIPS:"Rotate",RELOAD_TIPS:"Reload",FULLSCREEN_TIPS:"Fullscreen",EXITFULLSCREEN_TIPS:"Exit fullscreen",CSSFULLSCREEN_TIPS:"Cssfullscreen",EXITCSSFULLSCREEN_TIPS:"Exit cssfullscreen",TEXTTRACK:"Caption",PIP:"PIP",SCREENSHOT:"Screenshot",LIVE:"LIVE",OFF:"Off",OPEN:"Open",MINI_DRAG:"Click and hold to drag",MINISCREEN:"Miniscreen",REFRESH_TIPS:"Please Try",REFRESH:"Refresh",FORWARD:"forward",LIVE_TIP:"Live"}};const si={lang:{},langKeys:[],textKeys:[]};function ri(e,t){return Object.keys(t).forEach((i=>{const n=X.typeOf(t[i]),s=X.typeOf(e[i]);"Array"===n?("Array"!==s&&(e[i]=[]),e[i].push(...t[i])):"Object"===n?("Object"!==s&&(e[i]={}),ri(e[i],t[i])):e[i]=t[i]})),e}function oi(){Object.keys(si.lang.en).map((e=>{si.textKeys[e]=e}))}function ai(e,t){let i=[];if(t||(t=si),!t.lang)return;i="Array"!==X.typeOf(e)?Object.keys(e).map((t=>{const i="zh"===t?"zh-cn":t;return{LANG:i,TEXT:e[t]}})):e;const{lang:n}=t;i.map((e=>{"zh"===e.LANG&&(e.LANG="zh-cn"),n[e.LANG]?ri(n[e.LANG]||{},e.TEXT||{}):li(e,t)})),oi()}function li(e,t){let i=e.LANG;if(t||(t=si),!t.lang)return;const n=e.TEXT||{};"zh"===i&&(i="zh-cn"),t.lang[i]?ri(t.lang[i],n):(t.langKeys.push(i),t.lang[i]=n),oi()}function ci(e){const t={lang:{},langKeys:[],textKeys:{},pId:e};return ri(t.lang,si.lang),t.langKeys.push(...si.langKeys),ri(t.textKeys,si.textKeys),t}li(ni);const ui={get textKeys(){return si.textKeys},get langKeys(){return si.langKeys},get lang(){const e={};return si.langKeys.map((t=>{e[t]=si.lang[t]})),si.lang["zh-cn"]&&(e.zh=si.lang["zh-cn"]||{}),e},extend:ai,use:li,init:ci},hi={INITIAL:1,READY:2,ATTACHING:3,ATTACHED:4,NOTALLOW:5,RUNNING:6,ENDED:7,DESTROYED:8},di=["ERROR","INITIAL","READY","ATTACHING","ATTACHED","NOTALLOW","RUNNING","ENDED","DESTROYED"],pi={};let fi=null;class gi extends j.EventEmitter{static getInstance(){return fi||(fi=new gi),fi}add(e){e&&(pi[e.playerId]=e,1===Object.keys(pi).length&&this.setActive(e.playerId,!0))}remove(e){e&&(e.isUserActive,delete pi[e.playerId])}_iterate(e,t=!1){for(const i in pi)if(Object.prototype.hasOwnProperty.call(pi,i)){const n=pi[i];if(t){if(e(n))break}else e(n)}}forEach(e){this._iterate(e)}find(e){let t=null;return this._iterate((i=>{const n=e(i);return n&&(t=i),n}),!0),t}findAll(e){const t=[];return this._iterate((i=>{e(i)&&t.push(i)})),t}setActive(e,t=!0){if(pi[e])return t?this.forEach((t=>{e===t.playerId?(t.isUserActive=!0,t.isInstNext=!1):t.isUserActive=!1})):pi[e].isUserActive=t,e}getActiveId(){const e=Object.keys(pi);for(let t=0;t<e.length;t++){const i=pi[e[t]];if(i&&i.isUserActive)return e[t]}return null}setNext(e,t=!0){if(pi[e])return t?this.forEach((t=>{e===t.playerId?(t.isUserActive=!1,t.isInstNext=!0):t.isInstNext=!1})):pi[e].isInstNext=t,e}}function mi(e){const t=Object.keys(pi);for(let i=0;i<t.length;i++){const n=pi[t[i]];if(n.root===e)return n}return null}var vi=Object.defineProperty,yi=(e,t,i)=>t in e?vi(e,t,{enumerable:!0,configurable:!0,writable:!0,value:i}):e[t]=i,_i=(e,t,i)=>(yi(e,"symbol"!==typeof t?t+"":t,i),i);const bi=["play","pause","replay","retry"];let Si=0,Ei=0,Ti=null;const ki=class extends vt{constructor(e){const t=X.deepMerge(ti(),e);super(t),_i(this,"canPlayFunc",(()=>{if(!this.config)return;const{autoplay:e,defaultPlaybackRate:t}=this.config;W.logInfo("player","canPlayFunc, startTime",this.__startTime),this.__startTime>0&&this.duration>0&&(this.currentTime=this.__startTime>this.duration?this.duration:this.__startTime,this.__startTime=-1),this.playbackRate=t,(e||this._useAutoplay)&&this.mediaPlay(),this.off(ye,this.canPlayFunc),this.removeClass(ei.ENTER)})),_i(this,"onFullscreenChange",((e,t)=>{const i=()=>{X.setTimeout(this,(()=>{this.resize()}),100)},n=X.getFullScreenEl();this._fullActionFrom?this._fullActionFrom="":this.emit(at,{eventType:"system",action:"switch_fullscreen",pluginName:"player",currentTime:this.currentTime,duration:this.duration,props:[{prop:"fullscreen",from:!0,to:!1}]});const s=te(n,this.playerId,Et);if(t||n&&(n===this._fullscreenEl||s))i(),!this.config.closeFocusVideoFocus&&this.media.focus(),this.fullscreen=!0,this.changeFullStyle(this.root,n,ei.FULLSCREEN),this.emit(We,!0,this._fullScreenOffset),this.cssfullscreen&&this.exitCssFullscreen();else if(this.fullscreen){i();const{_fullScreenOffset:e,config:t}=this;t.needFullscreenScroll?(window.scrollTo(e.left,e.top),X.setTimeout(this,(()=>{this.fullscreen=!1,this._fullScreenOffset=null}),100)):(!this.config.closeFocusVideoFocus&&this.media.focus(),this.fullscreen=!1,this._fullScreenOffset=null),this.cssfullscreen?this.removeClass(ei.FULLSCREEN):this.recoverFullStyle(this.root,this._fullscreenEl,ei.FULLSCREEN),this._fullscreenEl=null,this.emit(We,!1)}})),_i(this,"_onWebkitbeginfullscreen",(e=>{this._fullscreenEl=this.media,this.onFullscreenChange(e,!0)})),_i(this,"_onWebkitendfullscreen",(e=>{this.onFullscreenChange(e,!1)})),Pt(this,bi),this.config=t,this._pluginInfoId=X.generateSessionId(),Y(this);const i=this.constructor.defaultPreset,{presets:n}=this.config;if(n.length){const e=n.indexOf("default");e>=0&&i&&(n[e]=i)}else i&&n.push(i);this.userTimer=null,this.waitTimer=null,this.handleSource=!0,this._state=hi.INITIAL,this.isError=!1,this._hasStart=!1,this.isSeeking=!1,this.isCanplay=!1,this._useAutoplay=!1,this.__startTime=-1,this.rotateDeg=0,this.isActive=!1,this.fullscreen=!1,this.cssfullscreen=!1,this.isRotateFullscreen=!1,this._fullscreenEl=null,this.timeSegments=[],this._cssfullscreenEl=null,this.curDefinition=null,this._orgCss="",this._fullScreenOffset=null,this._videoHeight=0,this._videoWidth=0,this.videoPos={pi:1,scale:0,rotate:-1,x:0,y:0,h:-1,w:-1,vy:0,vx:0},this.sizeInfo={width:0,height:0,left:0,top:0},this._accPlayed={t:0,acc:0,loopAcc:0},this._offsetInfo={currentTime:-1,duration:0},this.innerContainer=null,this.topBar=null,this.root=null,this.__i18n=ui.init(this._pluginInfoId),se.os.isAndroid&&se.osVersion>0&&se.osVersion<6&&(this.config.autoplay=!1),this.database=new yt,this.isUserActive=!1,this._onceSeekCanplay=null,this._isPauseBeforeSeek=0,this.innerStates={isActiveLocked:!1},this.instManager=Ti,this._initMedia();const{isNoRoot:s}=this.config,r=!s&&this._initDOM();if(!s&&!r)return void console.error(new Error(`can't find the dom which id is ${this.config.id} or this.config.el does not exist`));Jt.init(this);const{definition:o={},url:a}=this.config;if(!a&&o.list&&o.list.length>0){let e=o.list.find((e=>e.definition&&e.definition===o.defaultDefinition));e||(o.defaultDefinition=o.list[0].definition,e=o.list[0]),this.config.url=e.url,this.curDefinition=e}this._bindEvents(),this._registerPresets(),this._registerPlugins(),Jt.onPluginsReady(this),this.getInitDefinition(),this.setState(hi.READY),X.setTimeout(this,(()=>{this.emit(Re)}),0),this.onReady&&this.onReady(),(this.config.videoInit||this.config.autoplay)&&(!this.hasStart||this.state<hi.ATTACHED)&&this.start()}static set debugger(e){W.config.debug=e}static get version(){return re}static get debugger(){return W.config.debug}static set instManager(e){Ti=e}static get instManager(){return Ti}static getCurrentUserActivePlayerId(){return null==Ti?void 0:Ti.getActiveId()}static setCurrentUserActive(e,t){null==Ti||Ti.setActive(e,t)}_initMedia(){const e=this.constructor.XgVideoProxy;if(e&&this.mediaConfig.mediaType===e.mediaType){const t=this.innerContainer||this.root;this.detachVideoEvents(this.media);const i=new e(t,this.config,this.mediaConfig);this.attachVideoEvents(i),this.media=i}this.media.setAttribute(Et,this.playerId)}_initDOM(){const{id:e,el:t,isCustomRoot:i,controls:n,autoplay:s,isMobileSimulateMode:r}=this.config;if(this.root=e?document.getElementById(e):null,!this.root)if(t&&1===t.nodeType)this.root=t;else{if(i)return this.emit(pe,new le("use",this.config.vid,{line:32,handle:"Constructor",msg:"container id can't be empty"})),console.error("this.confg.id or this.config.el can't be empty"),!1;this.root=X.createDom("div","",{id:e,class:ei.BUILTIN_CLASS})}const o=mi(this.root);o&&(W.logWarn("The is an Player instance already exists in this.root, destroy it and reinitialize"),o.destroy()),this.root.setAttribute(Et,this.playerId),null==Ti||Ti.add(this),this._initBaseDoms();const a="mobile"===r?"mobile":se.device;if(this.addClass(`${ei.DEFAULT} ${ei.INACTIVE} xgplayer-${a} ${n?"":ei.NO_CONTROLS}`),s?this.addClass(ei.ENTER):this.addClass(ei.NO_START),this.config.fluid){let{width:e,height:t}=this.config;"number"===typeof e&&"number"===typeof t||(e=600,t=337.5);const i={width:"100%",height:"0","max-width":"100%","padding-top":100*t/e+"%"};Object.keys(i).forEach((e=>{this.root.style[e]=i[e]}))}else["width","height"].forEach((e=>{this.config[e]&&("number"!==typeof this.config[e]?this.root.style[e]=this.config[e]:this.root.style[e]=`${this.config[e]}px`)}));const{width:l,height:c,left:u,top:h}=this.root.getBoundingClientRect();return this.sizeInfo.width=l,this.sizeInfo.height=c,this.sizeInfo.left=u,this.sizeInfo.top=h,!0}_initBaseDoms(){this.topBar=null,this.leftBar=null,this.rightBar=null,this.config.marginControls&&(this.innerContainer=X.createDom("xg-video-container","",{"data-index":-1},"xg-video-container"),this.root.appendChild(this.innerContainer))}_bindEvents(){["focus","blur"].forEach((e=>{this.on(e,this["on"+e.charAt(0).toUpperCase()+e.slice(1)])})),_t.forEach((e=>{document&&document.addEventListener(e,this.onFullscreenChange)})),se.os.isIos&&(this.media.addEventListener("webkitbeginfullscreen",this._onWebkitbeginfullscreen),this.media.addEventListener("webkitendfullscreen",this._onWebkitendfullscreen)),this.once(Ee,this.resize),this.playFunc=()=>{this.config.closeFocusVideoFocus||this.media.focus()},this.once(ce,this.playFunc)}_unbindEvents(){this.root&&this.root.removeEventListener("mousemove",this.mousemoveFunc),_t.forEach((e=>{document.removeEventListener(e,this.onFullscreenChange)})),this.playFunc&&this.off(ce,this.playFunc),this.off(ye,this.canPlayFunc),this.media.removeEventListener("webkitbeginfullscreen",this._onWebkitbeginfullscreen),this.media.removeEventListener("webkitendfullscreen",this._onWebkitendfullscreen)}_clearUserTimer(){this.userTimer&&(X.clearTimeout(this,this.userTimer),this.userTimer=null)}_startInit(e){if(!this.media)return;if((!e||""===e||"Array"===X.typeOf(e)&&0===e.length)&&(e="",this.emit(Me),W.logWarn("config.url is null, please get url and run player._startInit(url)"),this.config.nullUrlStart))return;this.handleSource&&(this._detachSourceEvents(this.media),"Array"===X.typeOf(e)&&e.length>0?this._attachSourceEvents(this.media,e):this.media.src&&this.media.src===e?e||this.media.removeAttribute("src"):this.media.src=e),"Number"===X.typeOf(this.config.volume)&&(this.volume=this.config.volume);const t=this.innerContainer?this.innerContainer:this.root;t&&this.media instanceof window.Element&&!t.contains(this.media)&&t.insertBefore(this.media,t.firstChild);const{readyState:i}=this.media;W.logInfo("_startInit readyState",i),this.config.autoplay&&(!X.isMSE(this.media)&&this.load(),(se.os.isIpad||se.os.isPhone)&&this.mediaPlay());const{startTime:n}=this.config;this.__startTime=n>0?n:-1,this.config.startTime=0,i>=2&&this.duration>0?this.canPlayFunc():this.on(ye,this.canPlayFunc),(!this.hasStart||this.state<hi.ATTACHED)&&Jt.afterInit(this),this.hasStart=!0,this.setState(hi.ATTACHED),X.setTimeout(this,(()=>{this.emit(Fe)}),0)}_registerPlugins(e=!0){this._loadingPlugins=[];const t=this.config.ignores||[],i=this.config.plugins||[],n=this.config.i18n||[];e&&ui.extend(n,this.__i18n);const s=t.join("||").toLowerCase().split("||"),r=this.plugins;i.forEach((t=>{try{const i=t.plugin?t.plugin.pluginName:t.pluginName;if(i&&s.indexOf(i.toLowerCase())>-1)return null;if(!e&&r[i.toLowerCase()])return;if(t.lazy&&t.loader){const e=Jt.lazyRegister(this,t);return void(t.forceBeforeInit&&(e.then((()=>{this._loadingPlugins.splice(this._loadingPlugins.indexOf(e),1)})).catch((t=>{W.logError("_registerPlugins:loadingPlugin",t),this._loadingPlugins.splice(this._loadingPlugins.indexOf(e),1)})),this._loadingPlugins.push(e)))}return this.registerPlugin(t)}catch(i){W.logError("_registerPlugins:",i)}}))}_registerPresets(){this.config.presets.forEach((e=>{ii(this,e)}))}_getRootByPosition(e){let t=null;switch(e){case Ut.ROOT_RIGHT:this.rightBar||(this.rightBar=X.createPositionBar("xg-right-bar",this.root)),t=this.rightBar;break;case Ut.ROOT_LEFT:this.leftBar||(this.leftBar=X.createPositionBar("xg-left-bar",this.root)),t=this.leftBar;break;case Ut.ROOT_TOP:this.topBar||(this.topBar=X.createPositionBar("xg-top-bar",this.root),this.config.topBarAutoHide&&X.addClass(this.topBar,ei.TOP_BAR_AUTOHIDE)),t=this.topBar;break;default:t=this.innerContainer||this.root;break}return t}registerPlugin(e,t){const i=Jt.formatPluginInfo(e,t),{PLUFGIN:n,options:s}=i,{plugins:r}=this.config,o=Jt.checkPluginIfExits(n.pluginName,r);!o&&r.push(n);const a=Jt.getRootByConfig(n.pluginName,this.config);a.root&&(s.root=a.root),a.position&&(s.position=a.position);const l=s.position?s.position:s.config&&s.config.position||n.defaultConfig&&n.defaultConfig.position;return!s.root&&"string"===typeof l&&l.indexOf("controls")>-1?this.controls&&this.controls.registerPlugin(n,s,n.pluginName):(s.root||(s.root="controls"===n.pluginName?this.root:this._getRootByPosition(l)),Jt.register(this,n,s))}deregister(e){"string"===typeof e?Jt.unRegister(this,e):e instanceof Ot&&Jt.unRegister(this,e.pluginName)}unRegisterPlugin(e,t=!1){this.deregister(e),t&&this.removePluginFromConfig(e)}removePluginFromConfig(e){let t;if("string"===typeof e?t=e:e instanceof Ot&&(t=e.pluginName),t)for(let i=this.config.plugins.length-1;i>-1;i--){const e=this.config.plugins[i];if(e.pluginName.toLowerCase()===t.toLowerCase()){this.config.plugins.splice(i,1);break}}}get plugins(){return Jt.getPlugins(this)}getPlugin(e){const t=Jt.findPlugin(this,e);return t&&t.pluginName?t:null}addClass(e){this.root&&(X.hasClass(this.root,e)||X.addClass(this.root,e))}removeClass(e){this.root&&X.removeClass(this.root,e)}hasClass(e){if(this.root)return X.hasClass(this.root,e)}setAttribute(e,t){this.root&&this.root.setAttribute(e,t)}removeAttribute(e,t){this.root&&this.root.removeAttribute(e,t)}start(e){if(!(this.state>hi.ATTACHING))return e||this.config.url||this.getInitDefinition(),this.hasStart=!0,this.setState(hi.ATTACHING),this._registerPlugins(!1),Jt.beforeInit(this).then((()=>{if(!this.config)return;e||(e=this.url||this.config.url);const t=this._preProcessUrl(e),i=this._startInit(t.url);return i})).catch((e=>{throw e.fileName="player",e.lineNumber="236",W.logError("start:beforeInit:",e),e}))}switchURL(e,t){let i=e;"Object"===X.typeOf(e)&&(i=e.url),i=this._preProcessUrl(i).url;const n=this.currentTime;this.__startTime=n;const s=this.paused&&!this.isError;return this.src=i,new Promise(((e,t)=>{const n=e=>{this.off("timeupdate",r),this.off("canplay",r),t(e)},r=()=>{this.duration>0&&this.__startTime>0&&(this.currentTime=this.__startTime,this.__startTime=-1),s&&this.pause(),this.off("error",n),e(!0)};this.once("error",n),i?(se.os.isAndroid?this.once("timeupdate",r):this.once("canplay",r),this.play()):this.errorHandler("error",{code:6,message:"empty_src"})}))}videoPlay(){this.mediaPlay()}mediaPlay(){if(!this.hasStart&&this.state<hi.ATTACHED)return this.removeClass(ei.NO_START),this.addClass(ei.ENTER),this.start(),void(this._useAutoplay=!0);this.state<hi.RUNNING&&(this.removeClass(ei.NO_START),!this.isCanplay&&this.addClass(ei.ENTER));const e=super.play();return void 0!==e&&e&&e.then?e.then((()=>{this.removeClass(ei.NOT_ALLOW_AUTOPLAY),this.addClass(ei.PLAYING),this.state<hi.RUNNING&&(W.logInfo(">>>>playPromise.then"),this.setState(hi.RUNNING),this.emit(Ne))})).catch((e=>{if(W.logWarn(">>>>playPromise.catch",e.name),this.media&&this.media.error)return this.onError(),void this.removeClass(ei.ENTER);"NotAllowedError"===e.name&&(this._errorTimer=X.setTimeout(this,(()=>{this._errorTimer=null,this.emit(Ue),this.addClass(ei.NOT_ALLOW_AUTOPLAY),this.removeClass(ei.ENTER),this.pause(),this.setState(hi.NOTALLOW)}),0))})):(W.logWarn("video.play not return promise"),this.state<hi.RUNNING&&(this.setState(hi.RUNNING),this.removeClass(ei.NOT_ALLOW_AUTOPLAY),this.removeClass(ei.NO_START),this.removeClass(ei.ENTER),this.addClass(ei.PLAYING),this.emit(Ne))),e}mediaPause(){super.pause()}videoPause(){super.pause()}play(){return this.removeClass(ei.PAUSED),Dt(this,"play",(()=>this.mediaPlay()))}pause(){Dt(this,"pause",(()=>{super.pause()}))}seek(e,t){if(!this.media||Number.isNaN(Number(e))||!this.hasStart)return;const{isSeekedPlay:i,seekedStatus:n}=this.config,s=t||(i?"play":n);e=e<0?0:e>this.duration?parseInt(this.duration,10):e,!this._isPauseBeforeSeek&&(this._isPauseBeforeSeek=this.paused?2:1),this._onceSeekCanplay&&this.off(ge,this._onceSeekCanplay),this._onceSeekCanplay=()=>{switch(this.removeClass(ei.ENTER),this.isSeeking=!1,s){case"play":this.play();break;case"pause":this.pause();break;default:this._isPauseBeforeSeek>1||this.paused?this.pause():this.play()}this._isPauseBeforeSeek=0,this._onceSeekCanplay=null},this.once(ge,this._onceSeekCanplay),this.state<hi.RUNNING?(this.removeClass(ei.NO_START),this.currentTime=e,this.play()):this.currentTime=e}getInitDefinition(){const{definition:e,url:t}=this.config;!t&&e&&e.list&&e.list.length>0&&e.defaultDefinition&&e.list.map((t=>{t.definition===e.defaultDefinition&&(this.config.url=t.url,this.curDefinition=t)}))}changeDefinition(e,t){const{definition:i}=this.config;if(Array.isArray(null==i?void 0:i.list)&&i.list.forEach((t=>{(null==e?void 0:e.definition)===t.definition&&(this.curDefinition=t)})),(null==e?void 0:e.bitrate)&&"number"!==typeof e.bitrate&&(e.bitrate=parseInt(e.bitrate,10)||0),this.emit(Xe,{from:t,to:e}),!this.hasStart)return void(this.config.url=e.url);const n=this.switchURL(e.url,{seamless:!1!==i.seamless&&"undefined"!==typeof MediaSource&&"function"===typeof MediaSource.isTypeSupported,...e});n&&n.then?n.then((()=>{this.emit(Qe,{from:t,to:e})})):this.emit(Qe,{from:t,to:e})}reload(){this.load(),this.reloadFunc=function(){this.play()},this.once(Ee,this.reloadFunc)}resetState(){const{NOT_ALLOW_AUTOPLAY:e,PLAYING:t,NO_START:i,PAUSED:n,REPLAY:s,ENTER:r,ENDED:o,ERROR:a,LOADING:l}=ei,c=[e,t,i,n,s,r,o,a,l];this.hasStart=!1,this.isError=!1,this._useAutoplay=!1,this.mediaPause(),this._accPlayed.acc=0,this._accPlayed.t=0,this._accPlayed.loopAcc=0,c.forEach((e=>{this.removeClass(e)})),this.addClass(ei.NO_START),this.emit(lt)}reset(e=[],t){this.resetState();const{plugins:i}=this;if(i&&(e.map((e=>{this.deregister(e)})),t)){const e=ti();Object.keys(this.config).keys((t=>{"undefined"===this.config[t]||"plugins"!==t&&"presets"!==t&&"el"!==t&&"id"!==t||(this.config[t]=e[t])}))}}destroy(){const{innerContainer:e,root:t,media:i}=this;if(!i)return;if(this.hasStart=!1,this._useAutoplay=!1,t&&t.removeAttribute(Et),this.updateAcc("destroy"),this._unbindEvents(),this._detachSourceEvents(this.media),X.clearAllTimers(this),this.emit(He),null==Ti||Ti.remove(this),Jt.destroy(this),It(this),super.destroy(),this.fullscreen&&this._fullscreenEl===t&&this.exitFullscreen(),e){const t=e.children;for(let i=0;i<t.length;i++)e.removeChild(t[i])}t&&!e&&i instanceof window.Node&&t.contains(i)&&t.removeChild(i),["topBar","leftBar","rightBar","innerContainer"].map((e=>{this[e]&&t.removeChild(this[e]),this[e]=null}));const n=t?t.className.split(" "):[],s=t&&X.hasClass(t,ei.BUILTIN_CLASS);n.length>0?t.className=n.filter((e=>e.indexOf("xgplayer")<0)).join(" "):t&&(t.className=""),this.removeAttribute("data-xgfill"),["isSeeking","isCanplay","isActive","cssfullscreen","fullscreen"].forEach((e=>{this[e]=!1})),s&&this.root.parentNode&&this.root.parentNode.removeChild(this.root)}replay(){this.removeClass(ei.ENDED),this.currentTime=0,this.isSeeking=!1,Dt(this,"replay",(()=>{this.once(ge,(()=>{const e=this.mediaPlay();e&&e.catch&&e.catch((e=>{console.log(e)}))})),this.emit(Be),this.onPlay()}))}retry(){this.removeClass(ei.ERROR),this.addClass(ei.LOADING),Dt(this,"retry",(()=>{const e=this.currentTime,{url:t}=this.config,i=X.isMSE(this.media)?{url:t}:this._preProcessUrl(t);this.src=i.url,!this.config.isLive&&(this.currentTime=e),this.once(ye,(()=>{this.mediaPlay()}))}))}changeFullStyle(e,t,i,n){e&&(n||(n=ei.PARENT_FULLSCREEN),this._orgCss||(this._orgCss=X.filterStyleFromText(e)),X.addClass(e,i),t&&t!==e&&!this._orgPCss&&(this._orgPCss=X.filterStyleFromText(t),X.addClass(t,n),t.setAttribute(Et,this.playerId)))}recoverFullStyle(e,t,i,n){n||(n=ei.PARENT_FULLSCREEN),this._orgCss&&(X.setStyleFromCsstext(e,this._orgCss),this._orgCss=""),X.removeClass(e,i),t&&t!==e&&this._orgPCss&&(X.setStyleFromCsstext(t,this._orgPCss),this._orgPCss="",X.removeClass(t,n),t.removeAttribute(Et))}getFullscreen(e=this.config.fullscreenTarget){const{root:t,media:i}=this;e||(e=t),this._fullScreenOffset={top:X.scrollTop(),left:X.scrollLeft()},this._fullscreenEl=e,this._fullActionFrom="get";const n=X.getFullScreenEl();if(n===this._fullscreenEl)return this.onFullscreenChange(),Promise.resolve();try{for(let t=0;t<bt.length;t++){const i=bt[t];if(e[i]){const t="webkitRequestFullscreen"===i?e.webkitRequestFullscreen(window.Element.ALLOW_KEYBOARD_INPUT):e[i]();return t&&t.then?t:Promise.resolve()}}return i.fullscreenEnabled||i.webkitSupportsFullscreen?(i.webkitEnterFullscreen(),Promise.resolve()):Promise.reject(new Error("call getFullscreen fail"))}catch(s){return Promise.reject(new Error("call getFullscreen fail"))}}exitFullscreen(e){if(this.isRotateFullscreen&&this.exitRotateFullscreen(),!this._fullscreenEl&&!X.getFullScreenEl())return;const{root:t,media:i}=this;this._fullActionFrom="exit";try{for(let e=0;e<St.length;e++){const t=St[e];if(document[t]){const e=document[t]();return e&&e.then?e:Promise.resolve()}}return i&&i.webkitSupportsFullscreen?(i.webkitExitFullScreen(),Promise.resolve()):Promise.reject(new Error("call exitFullscreen fail"))}catch(n){return Promise.reject(new Error("call exitFullscreen fail"))}}getCssFullscreen(e=this.config.fullscreenTarget){this.isRotateFullscreen?this.exitRotateFullscreen():this.fullscreen&&this.exitFullscreen();const t=e?`${ei.INNER_FULLSCREEN} ${ei.CSS_FULLSCREEN}`:ei.CSS_FULLSCREEN;this.changeFullStyle(this.root,e,t);const{fullscreen:i={}}=this.config,n=!0===i.useCssFullscreen||"function"===typeof i.useCssFullscreen&&i.useCssFullscreen();n&&(this.fullscreen=!0,this.emit(We,!0)),this._cssfullscreenEl=e,this.cssfullscreen=!0,this.emit(Ye,!0)}exitCssFullscreen(){const e=this._cssfullscreenEl?`${ei.INNER_FULLSCREEN} ${ei.CSS_FULLSCREEN}`:ei.CSS_FULLSCREEN;if(this.fullscreen){const{fullscreen:t={}}=this.config,i=!0===t.useCssFullscreen||"function"===typeof t.useCssFullscreen&&t.useCssFullscreen();i?(this.recoverFullStyle(this.root,this._cssfullscreenEl,e),this.fullscreen=!1,this.emit(We,!1)):this.removeClass(e)}else this.recoverFullStyle(this.root,this._cssfullscreenEl,e);this._cssfullscreenEl=null,this.cssfullscreen=!1,this.emit(Ye,!1)}getRotateFullscreen(e=this.config.fullscreenTarget){this.cssfullscreen&&this.exitCssFullscreen(e);const t=e?`${ei.INNER_FULLSCREEN} ${ei.ROTATE_FULLSCREEN}`:ei.ROTATE_FULLSCREEN;this._fullscreenEl=e||this.root,this.changeFullStyle(this.root,e,t,ei.PARENT_ROTATE_FULLSCREEN),this.isRotateFullscreen=!0,this.fullscreen=!0,this.setRotateDeg(90),this._rootStyle=this.root.getAttribute("style"),this.root.style.width=`${window.innerHeight}px`,this.emit(We,!0)}exitRotateFullscreen(e){const t=this._fullscreenEl!==this.root?`${ei.INNER_FULLSCREEN} ${ei.ROTATE_FULLSCREEN}`:ei.ROTATE_FULLSCREEN;this.recoverFullStyle(this.root,this._fullscreenEl,t,ei.PARENT_ROTATE_FULLSCREEN),this.isRotateFullscreen=!1,this.fullscreen=!1,this.setRotateDeg(0),this.emit(We,!1),this._rootStyle&&(this.root.style.style=this._rootStyle,this._rootStyle=!1)}setRotateDeg(e){90===window.orientation||-90===window.orientation?this.rotateDeg=0:this.rotateDeg=e}focus(e={autoHide:!this.config.closeDelayBlur,delay:this.config.inactive}){this.isActive?this.onFocus(e):this.emit(Le,{paused:this.paused,ended:this.ended,...e})}blur(e={ignorePaused:!1}){this.isActive?(this._clearUserTimer(),this.emit(Oe,{paused:this.paused,ended:this.ended,...e})):this.onBlur(e)}onFocus(e={autoHide:!0,delay:3e3}){const{innerStates:t}=this;if(this.isActive=!0,this.removeClass(ei.INACTIVE),this._clearUserTimer(),void 0!==e.isLock&&(t.isActiveLocked=e.isLock),!1===e.autoHide||!0===e.isLock||t.isActiveLocked)return void this._clearUserTimer();const i=e&&e.delay?e.delay:this.config.inactive;this.userTimer=X.setTimeout(this,(()=>{this.userTimer=null,this.blur()}),i)}onBlur({ignorePaused:e=!1}={}){if(this.innerStates.isActiveLocked)return;const{closePauseVideoFocus:t}=this.config;this.isActive=!1,(e||t||!this.paused&&!this.ended)&&this.addClass(ei.INACTIVE)}onEmptied(){this.updateAcc("emptied")}onCanplay(){this.removeClass(ei.ENTER),this.removeClass(ei.ERROR),this.removeClass(ei.LOADING),this.isCanplay=!0,this.waitTimer&&X.clearTimeout(this,this.waitTimer)}onDurationchange(){this.__startTime>0&&this.duration>0&&(this.currentTime=this.__startTime,this.__startTime=-1)}onLoadeddata(){this.isError=!1,this.isSeeking=!1}onLoadstart(){this.removeClass(ei.ERROR),this.isCanplay=!1}onPlay(){this.state===hi.ENDED&&this.setState(hi.RUNNING),this.removeClass(ei.PAUSED),this.ended&&this.removeClass(ei.ENDED),!this.config.closePlayVideoFocus&&this.focus()}onPause(){this.addClass(ei.PAUSED),this.updateAcc("pause"),this.config.closePauseVideoFocus||(this._clearUserTimer(),this.focus())}onEnded(){this.updateAcc("ended"),this.addClass(ei.ENDED),this.setState(hi.ENDED)}onError(){this.isError=!0,this.updateAcc("error"),this.removeClass(ei.NOT_ALLOW_AUTOPLAY),this.removeClass(ei.NO_START),this.removeClass(ei.ENTER),this.removeClass(ei.LOADING),this.addClass(ei.ERROR)}onSeeking(){this.isSeeking||this.updateAcc("seeking"),this.isSeeking=!0,this.addClass(ei.SEEKING)}onSeeked(){this.isSeeking=!1,this.waitTimer&&X.clearTimeout(this,this.waitTimer),this.removeClass(ei.LOADING),this.removeClass(ei.SEEKING)}onWaiting(){this.waitTimer&&X.clearTimeout(this,this.waitTimer),this.updateAcc("waiting"),this.waitTimer=X.setTimeout(this,(()=>{this.addClass(ei.LOADING),this.emit(Ke),X.clearTimeout(this,this.waitTimer),this.waitTimer=null}),this.config.minWaitDelay)}onPlaying(){this.isError=!1;const{NO_START:e,PAUSED:t,ENDED:i,ERROR:n,REPLAY:s,LOADING:r}=ei,o=[e,t,i,n,s,r];o.forEach((e=>{this.removeClass(e)})),this._accPlayed.t||this.paused||this.ended||(this._accPlayed.t=(new Date).getTime())}onTimeupdate(){!this._videoHeight&&this.media.videoHeight&&this.resize(),(this.waitTimer||this.hasClass(ei.LOADING))&&this.media.readyState>2&&(this.removeClass(ei.LOADING),X.clearTimeout(this,this.waitTimer),this.waitTimer=null),!this.paused&&this.state<hi.RUNNING&&this.duration&&(this.setState(hi.RUNNING),this.emit(Ne)),this._accPlayed.t||this.paused||this.ended||(this._accPlayed.t=(new Date).getTime())}onVolumechange(){"Number"===X.typeOf(this.config.volume)&&(this.config.volume=this.volume)}onRatechange(){this.config.defaultPlaybackRate=this.playbackRate}emitUserAction(e,t,i){if(!this.media||!t||!e)return;const n="String"===X.typeOf(e)?e:e.type||"";i.props&&"Array"!==X.typeOf(i.props)&&(i.props=[i.props]),this.emit(at,{eventType:n,action:t,currentTime:this.currentTime,duration:this.duration,ended:this.ended,event:e,...i})}updateAcc(e){if(this._accPlayed.t){const t=(new Date).getTime()-this._accPlayed.t;this._accPlayed.acc+=t,this._accPlayed.t=0,("ended"===e||this.ended)&&(this._accPlayed.loopAcc=this._accPlayed.acc)}}checkBuffer(e){const t=this.media.buffered;if(!t||0===t.length||!this.duration)return!0;const i=e||this.media.currentTime||.2,n=t.length;for(let s=0;s<n;s++)if(t.start(s)<=i&&t.end(s)>i)return!0;return!1}resizePosition(){const{vy:e,vx:t,h:i,w:n}=this.videoPos;let s=this.videoPos.rotate;if(s<0&&i<0&&n<0)return;let r=this.videoPos._pi;if(!r&&this.media.videoHeight&&(r=this.media.videoWidth/this.media.videoHeight*100),!r)return;this.videoPos.pi=r,s=s<0?0:s;const o={rotate:s};let a=0,l=0,c=1;const u=Math.abs(s/90),{root:h,innerContainer:d}=this,p=h.offsetWidth,f=d?d.offsetHeight:h.offsetHeight;let g=f,m=p;if(u%2===0)c=i>0?100/i:n>0?100/n:1,o.scale=c,a=e>0?(100-i)/2-e:0,o.y=2===u?0-a:a,l=t>0?(100-n)/2-t:0,o.x=2===u?0-l:l,this.media.style.width=`${m}px`,this.media.style.height=`${g}px`;else if(u%2===1){m=f,g=p;const i=f-p;l=-i/2/m*100,o.x=3===u?l+e/2:l-e/2,a=i/2/g*100,o.y=3===u?a+t/2:a-t/2,o.scale=c,this.media.style.width=`${m}px`,this.media.style.height=`${g}px`}const v=X.getTransformStyle(o,this.media.style.transform||this.media.style.webkitTransform);this.media.style.transform=v,this.media.style.webkitTransform=v}position(e={h:0,y:0,x:0,w:0}){if(!this.media||!e||!e.h)return;const{videoPos:t}=this;t.h=100*e.h||0,t.w=100*e.w||0,t.vx=100*e.x||0,t.vy=100*e.y||0,this.resizePosition()}setConfig(e){e&&Object.keys(e).map((t=>{if("plugins"!==t){this.config[t]=e[t];const i=this.plugins[t.toLowerCase()];i&&"Function"===X.typeOf(i.setConfig)&&i.setConfig(e[t])}}))}playNext(e){this.resetState(),this.setConfig(e),this._currentTime=0,this._duration=0,Dt(this,"playnext",(()=>{this.start(),this.emit(st,e)}))}resize(){if(!this.media||!this.root)return;const e=this.root.getBoundingClientRect();this.sizeInfo.width=e.width,this.sizeInfo.height=e.height,this.sizeInfo.left=e.left,this.sizeInfo.top=e.top;const{videoWidth:t,videoHeight:i}=this.media,{fitVideoSize:n,videoFillMode:s}=this.config;if("fill"!==s&&"cover"!==s&&"contain"!==s||this.setAttribute("data-xgfill",s),!i||!t)return;this._videoHeight=i,this._videoWidth=t;const r=this.controls&&this.innerContainer?this.controls.root.getBoundingClientRect().height:0,o=e.width,a=e.height-r,l=parseInt(t/i*1e3,10),c=parseInt(o/a*1e3,10);let u=o,h=a;const d={};"auto"===n&&c>l||"fixWidth"===n?(h=o/l*1e3,this.config.fluid?d.paddingTop=100*h/u+"%":d.height=`${h+r}px`):("auto"===n&&c<l||"fixHeight"===n)&&(u=l*a/1e3,d.width=`${u}px`),this.fullscreen||this.cssfullscreen||Object.keys(d).forEach((e=>{this.root.style[e]=d[e]})),("fillHeight"===s&&c<l||"fillWidth"===s&&c>l)&&this.setAttribute("data-xgfill","cover");const p={videoScale:l,vWidth:u,vHeight:h,cWidth:u,cHeight:h+r};this.resizePosition(),this.emit(et,p)}updateObjectPosition(e=0,t=0){this.media.updateObjectPosition?this.media.updateObjectPosition(e,t):this.media.style.objectPosition=`${100*e}% ${100*t}%`}setState(e){W.logInfo("setState",`state from:${di[this.state]} to:${di[e]}`),this._state=e}_preProcessUrl(e,t){const{preProcessUrl:i}=this.config;return X.isBlob(e)||"function"!==typeof i?{url:e}:i(e,t)}get state(){return this._state}get isFullscreen(){return this.fullscreen}get isCssfullScreen(){return this.cssfullscreen}get hasStart(){return this._hasStart}set hasStart(e){"boolean"===typeof e&&(this._hasStart=e,!1===e&&this.setState(hi.READY),this.emit("hasstart"))}get isPlaying(){return this._state===hi.RUNNING||this._state===hi.ENDED}set isPlaying(e){e?this.setState(hi.RUNNING):this._state>=hi.RUNNING&&this.setState(hi.ATTACHED)}set definitionList(e){const{definition:t}=this.config;let i=null,n=null;t.list=e,this.emit("resourceReady",e),e.forEach((e=>{var s;(null==(s=this.curDefinition)?void 0:s.definition)===e.definition&&(i=e),t.defaultDefinition===e.definition&&(n=e)})),!n&&e.length>0&&(n=e[0]),i?this.changeDefinition(i):n&&this.changeDefinition(n)}get definitionList(){return this.config&&this.config.definition&&this.config.definition.list||[]}get videoFrameInfo(){const e={total:0,dropped:0,corrupted:0,droppedRate:0,droppedDuration:0};if(!this.media||!this.media.getVideoPlaybackQuality)return e;const t=this.media.getVideoPlaybackQuality();return e.dropped=t.droppedVideoFrames||0,e.total=t.totalVideoFrames||0,e.corrupted=t.corruptedVideoFrames||0,e.total>0&&(e.droppedRate=e.dropped/e.total*100,e.droppedDuration=parseInt(this.cumulateTime/e.total*e.dropped,0)),e}get controls(){return this.plugins.controls}set lang(e){const t=ui.langKeys.filter((t=>t===e));0!==t.length||"zh"===e?(this.config.lang=e,Jt.setLang(e,this)):console.error(`Sorry, set lang fail, because the language [${e}] is not supported now, list of all supported languages is [${ui.langKeys.join()}] `)}get lang(){return this.config.lang}get i18n(){let e=this.config.lang;return"zh"===e&&(e="zh-cn"),this.__i18n.lang[e]||this.__i18n.lang.en}get i18nKeys(){return this.__i18n.textKeys||{}}get version(){return re}get playerId(){return this._pluginInfoId}set url(e){this.__url=e}get url(){return this.__url||this.config.url}set poster(e){this.plugins.poster&&this.plugins.poster.update(e)}get poster(){return this.plugins.poster?this.plugins.poster.config.poster:this.config.poster}get readyState(){return super.readyState}get error(){const e=super.error;return this.i18n[e]||e}get networkState(){return super.networkState}get fullscreenChanging(){return!(null===this._fullScreenOffset)}get cumulateTime(){const{acc:e,t:t}=this._accPlayed;return t?(new Date).getTime()-t+e:e}get zoom(){return this.config.zoom}set zoom(e){this.config.zoom=e}set videoRotateDeg(e){e=X.convertDeg(e),e%90===0&&e!==this.videoPos.rotate&&(this.videoPos.rotate=e,this.resizePosition())}get videoRotateDeg(){return this.videoPos.rotate}set avgSpeed(e){Ei=e}get avgSpeed(){return Ei}set realTimeSpeed(e){Si=e}get realTimeSpeed(){return Si}get offsetCurrentTime(){return this._offsetInfo.currentTime||0}set offsetCurrentTime(e){this._offsetInfo.currentTime=e}get offsetDuration(){return this._offsetInfo.duration||0}set offsetDuration(e){this._offsetInfo.duration=e||0}hook(e,t,i={pre:null,next:null}){return kt.call(this,...arguments)}useHooks(e,t){return wt.call(this,...arguments)}removeHooks(e,t){return xt.call(this,...arguments)}usePluginHooks(e,t,i,...n){return Ct.call(this,...arguments)}removePluginHooks(e,t,i,...n){return At.call(this,...arguments)}setUserActive(e,t){"boolean"===typeof t&&t!==this.muted&&(this.addInnerOP("volumechange"),X.typeOf(t)===Boolean&&(this.muted=t)),null==Ti||Ti.setActive(this.playerId,e)}static isHevcSupported(){return se.isHevcSupported()}static probeConfigSupported(e){return se.probeConfigSupported(e)}static install(e,t){ki.plugins||(ki.plugins={}),ki.plugins[e]||(ki.plugins[e]=t)}static use(e,t){ki.plugins||(ki.plugins={}),ki.plugins[e]=t}};let wi=ki;_i(wi,"defaultPreset",null),_i(wi,"XgVideoProxy",null),wi.instManager=gi.getInstance();var xi=Object.defineProperty,Ci=(e,t,i)=>t in e?xi(e,t,{enumerable:!0,configurable:!0,writable:!0,value:i}):e[t]=i,Ai=(e,t,i)=>(Ci(e,"symbol"!==typeof t?t+"":t,i),i);class Pi extends Kt{constructor(){super(...arguments),Ai(this,"onMouseEnter",(e=>{const{player:t,playerConfig:i}=this;i.closeControlsBlur&&t.focus({autoHide:!1})})),Ai(this,"onMouseLeave",(e=>{const{player:t}=this;t.focus()}))}static get pluginName(){return"controls"}static get defaultConfig(){return{disable:!1,autoHide:!0,mode:"",initShow:!1}}beforeCreate(e){e.config.mode||"mobile"!==se.device||(e.config.mode="flex"),e.player.config.marginControls&&(e.config.autoHide=!1)}afterCreate(){const{disable:e,height:t,mode:i}=this.config;if(e)return;"flex"===i&&this.player.addClass(ei.FLEX_CONTROLS);const n={height:`${t}px`};Object.keys(n).map((e=>{this.root.style[e]=n[e]})),this.left=this.find("xg-left-grid"),this.center=this.find("xg-center-grid"),this.right=this.find("xg-right-grid"),this.innerRoot=this.find("xg-inner-controls"),this.on($e,(e=>{e?X.addClass(this.root,"mini-controls"):X.removeClass(this.root,"mini-controls")}));const{isMobileSimulateMode:s}=this.playerConfig;"mobile"!==se.device&&"mobile"!==s&&(this.bind("mouseenter",this.onMouseEnter),this.bind("mouseleave",this.onMouseLeave))}focus(){this.player.focus({autoHide:!1})}focusAwhile(){this.player.focus({autoHide:!0})}blur(){this.player.blur({ignorePaused:!0})}recoverAutoHide(){this.config.autoHide&&X.addClass(this.root,ei.CONTROLS_AUTOHIDE)}pauseAutoHide(){X.removeClass(this.root,ei.CONTROLS_AUTOHIDE)}show(e){this.root.style.display="",this.player.focus()}hide(){this.root.style.display="none"}get mode(){return this.config.mode}registerPlugin(e,t={},i){if(!this.root)return;const n=e.defaultConfig||{};if(!t.root){const s=t.position?t.position:t.config&&t.config.position?t.config.position:n.position;switch(s){case Ut.CONTROLS_LEFT:t.root=this.left;break;case Ut.CONTROLS_RIGHT:t.root=this.right;break;case Ut.CONTROLS_CENTER:t.root=this.center;break;case Ut.CONTROLS:t.root=this.root;break;default:t.root=this.left}return super.registerPlugin(e,t,i)}}destroy(){"mobile"!==se.device&&(this.unbind("mouseenter",this.onMouseEnter),this.unbind("mouseleave",this.onMouseLeave))}render(){const{mode:e,autoHide:t,initShow:i,disable:n}=this.config;if(n)return;const s=X.classNames({"xgplayer-controls":!0},{"flex-controls":"flex"===e},{"bottom-controls":"bottom"===e},{[ei.CONTROLS_AUTOHIDE]:t},{"xgplayer-controls-initshow":i||!t});return`<xg-controls class="${s}" unselectable="on">\n    <xg-inner-controls class="xg-inner-controls xg-pos">\n      <xg-left-grid class="xg-left-grid">\n      </xg-left-grid>\n      <xg-center-grid class="xg-center-grid"></xg-center-grid>\n      <xg-right-grid class="xg-right-grid">\n      </xg-right-grid>\n    </xg-inner-controls>\n    </xg-controls>`}}var Ii=Object.defineProperty,Di=(e,t,i)=>t in e?Ii(e,t,{enumerable:!0,configurable:!0,writable:!0,value:i}):e[t]=i,Li=(e,t,i)=>(Di(e,"symbol"!==typeof t?t+"":t,i),i);function Oi(){return(new Date).getTime()}const Ri={LOAD_START:"loadstart",LOADED_DATA:"loadeddata",FIRST_FRAME:"firstFrame",WAIT_START:"waitingStart",WAIT_END:"waitingEnd",SEEK_START:"seekStart",SEEK_END:"seekEnd"};class Mi extends Kt{constructor(){super(...arguments),Li(this,"_onTimeupdate",(()=>{this._state.isTimeUpdate=!0,this._state.autoplayStart&&(W.logInfo(`[xgLogger]${this.player.playerId} _onTimeupdate`),this._sendFF("onTimeupdate"))})),Li(this,"_onAutoplayStart",(()=>{W.logInfo(`[xgLogger]${this.player.playerId} _onAutoplayStart`),this._state.autoplayStart=!0,this.vt&&this._sendFF("onAutoplayStart")})),Li(this,"_onReset",(()=>{this._state={autoplayStart:!1,isFFLoading:!1,isTimeUpdate:!1,isFFSend:!1,isLs:!1},this.vt=0,this.pt=0,this.fvt=0,this.newPointTime=Oi(),this.loadedCostTime=0,this.startCostTime=0,this._isSeeking=!1,this.seekingStart=0,this.waitingStart=0,this.fixedWaitingStart=0,this._isWaiting=!1,this._waitTimer&&X.clearTimeout(this,this._waitTimer),this._waittTimer&&X.clearTimeout(this,this._waittTimer),this._waitTimer=null,this._waittTimer=null,this._waitType=0})),Li(this,"_onSeeking",(()=>{this.seekingStart||(this.suspendWaitingStatus("seek"),this.seekingStart=Oi(),this.emitLog(Ri.SEEK_START,{start:Oi()}))})),Li(this,"_onSeeked",(()=>{this.suspendSeekingStatus("seeked")})),Li(this,"_onWaitingLoadStart",(()=>{this._isWaiting||this.vt||(this._isWaiting=!0,this.waitingStart=Oi(),this.fixedWaitingStart=Oi(),this._waitType=1,this.emitLog(Ri.WAIT_START,{fixedStart:this.fixedWaitingStart,start:this.waitingStart,type:1,endType:"loadstart"}))})),Li(this,"_onWaiting",(()=>{!this._isWaiting&&this.vt&&(this._isWaiting=!0,this.vt?this.seekingStart?this._waitType=2:this._waitType=0:this._waitType=1,this.fixedWaitingStart=Oi(),this._waitTimer=X.setTimeout(this,(()=>{this._isWaiting&&(this.waitingStart=Oi(),X.clearTimeout(this,this._waitTimer),this._waitTimer=null,this._startWaitTimeout(),this.emitLog(Ri.WAIT_START,{fixedStart:this.fixedWaitingStart,start:this.waitingStart,type:this._waitType,endType:2===this._waitType?"seek":"playing"}))}),200))})),Li(this,"_onError",(()=>{this.suspendSeekingStatus("error"),this.suspendWaitingStatus("error")})),Li(this,"_onPlaying",(()=>{this._isWaiting&&this.suspendWaitingStatus("playing")}))}static get pluginName(){return"xgLogger"}static get defaultConfig(){return{waitTimeout:1e4}}afterCreate(){this._onReset(),this._waitType="firstFrame",this._initOnceEvents(),this.newPointTime=Oi(),this.loadedCostTime=0,this.startCostTime=0,this.on(xe,(()=>{const{_state:e}=this,{autoplayStart:t,isFFSend:i}=e;this.startCostTime=Oi()-this.newPointTime,W.logInfo(`[xgLogger]${this.player.playerId} LOAD_START`,`autoplayStart:${t} isFFSend:${i} startCostTime:${this.startCostTime} newPointTime${this.newPointTime}`),i||(!e.isLs&&this.emitLog(Ri.LOAD_START,{}),e.isLs=!0,e.isTimeUpdate=!1,e.isFFLoading=!0,this.pt=Oi(),this.vt=0,this.fvt=0,this._initOnceEvents(),this._onWaitingLoadStart())})),this.on(Ee,(()=>{this.vt=Oi(),this.fvt=this.vt-this.pt,this.loadedCostTime=this.vt-this.newPointTime;const{isTimeUpdate:e,isFFSend:t,autoplayStart:i}=this._state;W.logInfo(`[xgLogger]${this.player.playerId} LOADED_DATA`,`fvt:${this.fvt} isTimeUpdate:${this._state.isTimeUpdate} loadedCostTime:${this.loadedCostTime}`),(e||i)&&this._sendFF("loadedData"),t||this.emitLog(Ri.LOADED_DATA,{}),this.suspendWaitingStatus("loadeddata")})),this.on(fe,this._onSeeking),this.on(ge,this._onSeeked),this.on(He,(()=>{this.endState("destroy")})),this.on(je,(()=>{this.endState("urlChange"),W.logInfo(`[xgLogger]${this.player.playerId} URL_CHANGE`),this._state.isFFSend&&this._onReset()})),this.on([ue,ye],this._onPlaying),this.on(ve,this._onWaiting),this.on(pe,this._onError),this.on(lt,(()=>{W.logInfo(`[xgLogger]${this.player.playerId} RESET`),this.endState("reset"),this._initOnceEvents(),this._onReset()}))}_initOnceEvents(){this.off(Ne,this._onAutoplayStart),this.off(me,this._onTimeupdate),this.once(Ne,this._onAutoplayStart),this.once(me,this._onTimeupdate)}_sendFF(e){this.s=Oi();const{isFFLoading:t,isFFSend:i}=this._state;W.logInfo(`[xgLogger]${this.player.playerId} _sendFF`,`${e} fvt:${this.fvt} isFFLoading:${t} !isFFSend:${!i}`),this.vt>0&&t&&!i&&(W.logInfo(`[xgLogger]${this.player.playerId} emitLog_firstFrame`,e),this._state.isFFLoading=!1,this._state.isFFSend=!0,this.emitLog(Ri.FIRST_FRAME,{fvt:this.fvt,costTime:this.fvt,vt:this.vt,startCostTime:this.startCostTime,loadedCostTime:this.loadedCostTime}))}_startWaitTimeout(){this._waittTimer&&X.clearTimeout(this,this._waittTimer),this._waittTimer=X.setTimeout(this,(()=>{this.suspendWaitingStatus("timeout"),X.clearTimeout(this,this._waittTimer),this._waittTimer=null}),this.config.waitTimeout)}endState(e){this.suspendWaitingStatus(e),this.suspendSeekingStatus(e)}suspendSeekingStatus(e){if(!this.seekingStart)return;const t=Oi(),i=t-this.seekingStart;this.seekingStart=0,this.emitLog(Ri.SEEK_END,{end:t,costTime:i,endType:e})}suspendWaitingStatus(e){if(this._waitTimer&&(X.clearTimeout(this,this._waitTimer),this._waitTimer=null),this._waittTimer&&(X.clearTimeout(this,this._waittTimer),this._waittTimer=null),this._isWaiting=!1,!this.waitingStart)return;const t=Oi(),i=t-this.waitingStart,n=t-this.fixedWaitingStart,{waitTimeout:s}=this.config;this._isWaiting=!1,this.waitingStart=0,this.fixedWaitingStart=0,this.emitLog(Ri.WAIT_END,{fixedCostTime:n>s?s:n,costTime:i>s?s:i,type:"loadeddata"===e?1:this._waitType,endType:2===this._waitType?"seek":e})}emitLog(e,t){const{player:i}=this;this.emit(ot,{t:Oi(),host:X.getHostFromUrl(i.currentSrc),vtype:i.vtype,eventType:e,currentTime:this.player.currentTime,readyState:i.video.readyState,networkState:i.video.networkState,...t})}}function Ni(){return(new DOMParser).parseFromString('<svg class="xgplayer-replay-svg" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 78 78" width="78" height="78">\n  <path fill="#fff" transform="translate(20, 20)" d="M8.22708362,13.8757234 L11.2677371,12.6472196 C11.7798067,12.4403301 12.3626381,12.6877273 12.5695276,13.1997969 L12.9441342,14.1269807 C13.1510237,14.6390502 12.9036264,15.2218816 12.3915569,15.4287712 L6.8284538,17.6764107 L5.90126995,18.0510173 C5.38920044,18.2579068 4.80636901,18.0105096 4.5994795,17.49844 L1.97723335,11.0081531 C1.77034384,10.4960836 2.0177411,9.91325213 2.52981061,9.70636262 L3.45699446,9.33175602 C3.96906396,9.12486652 4.5518954,9.37226378 4.75878491,9.88433329 L5.67885163,12.1615783 C7.99551726,6.6766934 13.3983951,3 19.5,3 C27.7842712,3 34.5,9.71572875 34.5,18 C34.5,26.2842712 27.7842712,33 19.5,33 C15.4573596,33 11.6658607,31.3912946 8.87004692,28.5831991 C8.28554571,27.9961303 8.28762719,27.0463851 8.87469603,26.4618839 C9.46176488,25.8773827 10.4115101,25.8794641 10.9960113,26.466533 C13.2344327,28.7147875 16.263503,30 19.5,30 C26.127417,30 31.5,24.627417 31.5,18 C31.5,11.372583 26.127417,6 19.5,6 C14.4183772,6 9.94214483,9.18783811 8.22708362,13.8757234 Z"></path>\n</svg>\n',"image/svg+xml").firstChild}class Ui extends Kt{static get pluginName(){return"replay"}static get defaultConfig(){return{disable:!1}}registerIcons(){return{replay:Ni}}afterCreate(){Kt.insert(this.icons.replay,this.root,0),this.__handleReplay=this.hook("replayClick",(()=>{this.player.replay()}),{pre:e=>{e.preventDefault(),e.stopPropagation()}}),this.bind(".xgplayer-replay",["click","touchend"],this.__handleReplay),this.on(he,(()=>{if(this.playerConfig.loop||X.addClass(this.player.root,"replay"),this.config.disable)return;this.show();const e=this.root.querySelector("path");if(e){const t=window.getComputedStyle(e).getPropertyValue("transform");if("string"===typeof t&&t.indexOf("none")>-1)return null;e.setAttribute("transform",t)}})),this.on(ce,(()=>{this.hide()}))}handleReplay(e){e.preventDefault(),e.stopPropagation(),this.player.replay(),X.removeClass(this.player.root,"replay")}show(e){this.config.disable||(this.root.style.display="flex")}enable(){this.config.disable=!1}disable(){this.config.disable=!0,this.hide()}destroy(){this.unbind(".xgplayer-replay",["click","touchend"],this.__handleReplay)}render(){return`<xg-replay class="xgplayer-replay">\n      <xg-replay-txt class="xgplayer-replay-txt" lang-key="${this.i18nKeys.REPLAY}">${this.i18n.REPLAY}</xg-replay-txt>\n    </xg-replay>`}}class Fi extends Kt{static get pluginName(){return"poster"}static get defaultConfig(){return{isEndedShow:!0,hideCanplay:!1,notHidden:!1,poster:"",fillMode:"fixWidth"}}set isEndedShow(e){this.config.isEndedShow=e}get isEndedShow(){return this.config.isEndedShow}hide(){X.addClass(this.root,"hide")}show(e){X.removeClass(this.root,"hide")}beforeCreate(e){"string"===typeof e.player.config.poster&&(e.config.poster=e.player.config.poster)}afterCreate(){this.on(he,(()=>{this.isEndedShow&&X.removeClass(this.root,"hide")})),this.config.hideCanplay?(this.once(me,(()=>{this.onTimeUpdate()})),this.on(je,(()=>{X.removeClass(this.root,"hide"),X.addClass(this.root,"xg-showplay"),this.once(me,(()=>{this.onTimeUpdate()}))}))):this.on(ce,(()=>{X.addClass(this.root,"hide")}))}onTimeUpdate(){this.player.currentTime?X.removeClass(this.root,"xg-showplay"):this.once(me,(()=>{this.onTimeUpdate()}))}update(e){e&&(this.config.poster=e,this.root.style.backgroundImage=`url(${e})`)}getBgSize(e){let t="";switch(e){case"cover":t="cover";break;case"contain":t="contain";break;case"fixHeight":t="auto 100%";break;default:t=""}return t?`background-size: ${t};`:""}render(){const{poster:e,hideCanplay:t,fillMode:i,notHidden:n}=this.config,s=this.getBgSize(i),r=e?`background-image:url(${e});${s}`:s,o=n?"xg-not-hidden":t?"xg-showplay":"";return`<xg-poster class="xgplayer-poster ${o}" style="${r}">\n    </xg-poster>`}}function Bi(){return(new DOMParser).parseFromString('<svg class="play" xmlns="http://www.w3.org/2000/svg" width="28" height="40" viewBox="3 -4 28 40">\n  <path fill="#fff" transform="scale(0.0320625 0.0320625)" d="M576,363L810,512L576,661zM342,214L576,363L576,661L342,810z"></path>\n</svg>\n',"image/svg+xml").firstChild}function Hi(){return(new DOMParser).parseFromString('<svg class="pause" xmlns="http://www.w3.org/2000/svg" width="28" height="40" viewBox="3 -4 28 40">\n  <path fill="#fff" transform="scale(0.0320625 0.0320625)" d="M598,214h170v596h-170v-596zM256 810v-596h170v596h-170z"></path>\n</svg>\n',"image/svg+xml").firstChild}var ji=Object.defineProperty,Vi=(e,t,i)=>t in e?ji(e,t,{enumerable:!0,configurable:!0,writable:!0,value:i}):e[t]=i,Gi=(e,t,i)=>(Vi(e,"symbol"!==typeof t?t+"":t,i),i);const zi={};function Ki(e,t,i={start:null,end:null}){return zi[e]&&window.clearTimeout(zi[e].id),zi[e]={},i.start&&i.start(),zi[e].id=window.setTimeout((()=>{i.end&&i.end(),window.clearTimeout(zi[e].id),delete zi[e]}),t),zi[e].id}function Wi(e){e?window.clearTimeout(e):Object.keys(zi).map((e=>{window.clearTimeout(zi[e].id),delete zi[e]}))}class Yi extends Kt{constructor(e){super(e),Gi(this,"onPlayerReset",(()=>{this.autoPlayStart=!1;const e="auto"===this.config.mode?"auto-hide":"hide";this.setAttr("data-state","play"),X.removeClass(this.root,e),this.show()})),Gi(this,"onAutoplayStart",(()=>{if(this.autoPlayStart)return;const e="auto"===this.config.mode?"auto-hide":"hide";X.addClass(this.root,e),this.autoPlayStart=!0,this.onPlayPause("play")})),this.autoPlayStart=!1}static get pluginName(){return"start"}static get defaultConfig(){return{isShowPause:!1,isShowEnd:!1,disableAnimate:!1,mode:"hide"}}afterCreate(){const{player:e,playerConfig:t}=this;this.initIcons(),this.once(Re,(()=>{t&&(t.lang&&"en"===t.lang?X.addClass(e.root,"lang-is-en"):"jp"===t.lang&&X.addClass(e.root,"lang-is-jp"))})),this.on(Ne,this.onAutoplayStart),t.autoplay||this.show(),this.on(Ue,(()=>{const e="auto"===this.config.mode?"auto-hide":"hide";this.setAttr("data-state","play"),X.removeClass(this.root,e),this.show()})),this.on(ce,(()=>{this.onPlayPause("play")})),this.on(de,(()=>{this.onPlayPause("pause")})),this.on(lt,(()=>{this.onPlayerReset()})),this.clickHandler=this.hook("startClick",this.switchPausePlay,{pre:e=>{e.cancelable&&e.preventDefault(),e.stopPropagation();const{paused:t}=this.player;this.emitUserAction(e,"switch_play_pause",{props:"paused",from:t,to:!t})}}),this.bind(["click","touchend"],this.clickHandler)}registerIcons(){return{startPlay:{icon:Bi,class:"xg-icon-play"},startPause:{icon:Hi,class:"xg-icon-pause"}}}initIcons(){const{icons:e}=this;this.appendChild("xg-start-inner",e.startPlay),this.appendChild("xg-start-inner",e.startPause)}hide(){X.addClass(this.root,"hide")}show(e){X.removeClass(this.root,"hide")}focusHide(){X.addClass(this.root,"focus-hide")}recover(){X.removeClass(this.root,"focus-hide")}switchStatus(e){e?this.setAttr("data-state",this.player.paused?"pause":"play"):this.setAttr("data-state",this.player.paused?"play":"pause")}animate(e){this._animateId=Ki("pauseplay",400,{start:()=>{X.addClass(this.root,"interact"),this.show(),this.switchStatus(!0)},end:()=>{X.removeClass(this.root,"interact"),!e&&this.hide(),this._animateId=null}})}endAnimate(){X.removeClass(this.root,"interact"),Wi(this._animateId),this._animateId=null}switchPausePlay(e){const{player:t}=this;if(e.cancelable&&e.preventDefault(),e.stopPropagation(),t.state<hi.READY)return;const i=this.player.paused;i||t.state!==hi.RUNNING?t.play():t.pause()}onPlayPause(e){const{config:t,player:i}=this;if(i&&!(i.state<hi.RUNNING)&&this.autoPlayStart){if("show"===t.mode)return this.switchStatus(),void this.show();if("auto"!==t.mode){if(t.isShowPause&&i.paused&&!i.ended||t.isShowEnd&&i.ended)return this.switchStatus(),this.show(),void this.endAnimate();if(t.disableAnimate)return this.switchStatus(),void this.hide();if("play"===e)this.autoPlayStart?this.animate():this.hide();else{if(!this.autoPlayStart||i.ended)return;this.animate()}}else this.switchStatus()}}destroy(){this.unbind(["click","touchend"],this.clickHandler),Wi(this._animateId)}render(){const e=this.playerConfig.autoplay?"auto"===this.config.mode?"auto-hide":"hide":"";return`\n    <xg-start class="xgplayer-start ${e}">\n    <xg-start-inner></xg-start-inner>\n    </xg-start>`}}class $i extends Kt{static get pluginName(){return"enter"}static get defaultConfig(){return{innerHtml:"",logo:""}}render(){const{innerHtml:e}=this.config,t=X.createDom("xg-enter","",{},"xgplayer-enter");if(e&&e instanceof window.HTMLElement)t.appendChild(e);else if(e&&"string"===typeof e)t.innerHTML=e;else{let e="";for(let t=1;t<=12;t++)e+=`<div class="xgplayer-enter-bar${t}"></div>`;t.innerHTML=`<div class="xgplayer-enter-spinner">${e}</div>`}return t}}function Xi(e,t,i){try{return` <div class="xg-tips ${i?"hide":" "}" lang-key="${e.i18nKeys[t]}">\n    ${e.i18n[t]}\n    </div>`}catch(n){return'<div class="xg-tips hide"></div>'}}class qi extends Kt{static get pluginName(){return"miniscreenIcon"}static get defaultConfig(){return{position:Ut.CONTROLS_RIGHT,index:10}}afterCreate(){this.getMini=this.getMini.bind(this),this.exitMini=this.exitMini.bind(this),this.bind("click",this.getMini)}getMini(){this.config.onClick&&this.config.onClick()}exitMini(){this.config.onClick&&this.config.onClick()}destroy(){this.unbind(["click","touchend"],this.getMini)}render(){const e="MINISCREEN";return`\n      <xg-icon class="xgplayer-miniicon">\n      <div class="xgplayer-icon btn-text"><span class="icon-text" lang-key="${this.i18nKeys[e]}">${this.i18n[e]}</span></div>\n      </xg-icon>`}}function Qi(e){const t=parseFloat(e),i=-1===e.indexOf("%")&&!Number.isNaN(t);return i&&t}const Zi=["paddingLeft","paddingRight","paddingTop","paddingBottom","marginLeft","marginRight","marginTop","marginBottom","borderLeftWidth","borderRightWidth","borderTopWidth","borderBottomWidth"],Ji=Zi.length;function en(){const e={width:0,height:0,innerWidth:0,innerHeight:0,outerWidth:0,outerHeight:0};for(let t=0;t<Ji;t++){const i=Zi[t];e[i]=0}return e}function tn(e){const t=window.getComputedStyle(e);return t}function nn(e){if("string"===typeof e&&(e=document.querySelector(e)),!e||"object"!==typeof e||!e.nodeType)return;const t=tn(e);if("none"===t.display)return en();const i={};i.width=e.offsetWidth,i.height=e.offsetHeight;const n=i.isBorderBox="border-box"===t.boxSizing;for(let p=0;p<Ji;p++){const e=Zi[p],n=t[e],s=parseFloat(n);i[e]=Number.isNaN(s)?0:s}const s=i.paddingLeft+i.paddingRight,r=i.paddingTop+i.paddingBottom,o=i.marginLeft+i.marginRight,a=i.marginTop+i.marginBottom,l=i.borderLeftWidth+i.borderRightWidth,c=i.borderTopWidth+i.borderBottomWidth,u=n,h=Qi(t.width);!1!==h&&(i.width=h+(u?0:s+l));const d=Qi(t.height);return!1!==d&&(i.height=d+(u?0:r+c)),i.innerWidth=i.width-(s+l),i.innerHeight=i.height-(r+c),i.outerWidth=i.width+o,i.outerHeight=i.height+a,i}function sn(e,t){for(let i=0;i<e.length;i++){const n=e[i];if(n.identifier===t)return n}}const rn={START:"dragStart",MOVE:"dragMove",ENDED:"dragEnded"},on={mousedown:["mousemove","mouseup"],touchstart:["touchmove","touchend","touchcancel"],pointerdown:["pointermove","pointerup","pointercancel"]};class an extends(V()){constructor(e,t={}){super(),this.isEnabled=!0,this.isDragging=!1,this.isDown=!1,this.position={},this.downPoint={},this.dragPoint={x:0,y:0},this.startPos={x:0,y:0},this._root=e instanceof Element?e:document.querySelector(e),this._handlerDom=t.handle instanceof Element?t.handle:document.querySelector(t.handle),this._root&&this._handlerDom&&this._bindStartEvent()}_bindStartEvent(){"ontouchstart"in window?this._startKey="touchstart":this._startKey="mousedown",this[`on${this._startKey}`]=this[`on${this._startKey}`].bind(this),this._handlerDom.addEventListener(this._startKey,this[`on${this._startKey}`]),on[this._startKey].map((e=>{this[`on${e}`]=this[`on${e}`].bind(this)}))}_unbindStartEvent(){this._handlerDom.removeEventListener(this._startKey,this[`on${this._startKey}`])}_bindPostStartEvents(e){if(!e)return;const t=on[this._startKey];t.map((e=>{window.addEventListener(e,this[`on${e}`])})),this._boundPointerEvents=t}_unbindPostStartEvents(){this._boundPointerEvents&&(this._boundPointerEvents.map((e=>{window.removeEventListener(e,this[`on${e}`])})),delete this._boundPointerEvents)}enable(){this.isEnabled=!0}disable(){this.isEnabled=!1,this.isDragging&&this.onUp()}onDocUp(e){this.onUp()}animate(){this.isDragging&&(this.positionDrag(),window.requestAnimationFrame((()=>{this.animate()})))}positionDrag(){const e=`translate3d(${this.dragPoint.x}px, ${this.dragPoint.y}px, 0)`;this._root.style.transform=e,this._root.style.webKitTransform=e}setLeftTop(){this._root.style.left=this.position.x+"px",this._root.style.top=this.position.y+"px"}onmousedown(e){this.dragStart(e,e)}onmousemove(e){this.dragMove(e,e)}onmouseup(e){this.dragEnd(e,e)}ontouchstart(e){const t=e.changedTouches[0];this.dragStart(e,t),this.touchIdentifier=void 0!==t.pointerId?t.pointerId:t.identifier,e.preventDefault()}ontouchmove(e){const t=sn(e.changedTouches,this.touchIdentifier);t&&this.dragMove(e,t)}ontouchend(e){const t=sn(e.changedTouches,this.touchIdentifier);t&&this.dragEnd(e,t),e.preventDefault()}ontouchcancel(e){const t=sn(e.changedTouches,this.touchIdentifier);t&&this.dragCancel(e,t)}dragStart(e,t){if(!this._root||this.isDown||!this.isEnabled)return;this.downPoint=t,this.dragPoint.x=0,this.dragPoint.y=0,this._getPosition();const i=nn(this._root);this.startPos.x=this.position.x,this.startPos.y=this.position.y,this.startPos.maxY=window.innerHeight-i.height,this.startPos.maxX=window.innerWidth-i.width,this.setLeftTop(),this.isDown=!0,this._bindPostStartEvents(e)}dragRealStart(e,t){this.isDragging=!0,this.animate(),this.emit(rn.START,this.startPos)}dragEnd(e,t){this._root&&(this._unbindPostStartEvents(),this.isDragging&&(this._root.style.transform="",this.setLeftTop(),this.emit(rn.ENDED)),this.presetInfo())}_dragPointerMove(e,t){const i={x:t.pageX-this.downPoint.pageX,y:t.pageY-this.downPoint.pageY};return!this.isDragging&&this.hasDragStarted(i)&&this.dragRealStart(e,t),i}dragMove(e,t){if(e=e||window.event,!this.isDown)return;const{x:i,y:n}=this.startPos,s=this._dragPointerMove(e,t);let r=s.x,o=s.y;r=this.checkContain("x",r,i),o=this.checkContain("y",o,n),this.position.x=i+r,this.position.y=n+o,this.dragPoint.x=r,this.dragPoint.y=o,this.emit(rn.MOVE,this.position)}dragCancel(e,t){this.dragEnd(e,t)}presetInfo(){this.isDragging=!1,this.startPos={x:0,y:0},this.dragPoint={x:0,y:0},this.isDown=!1}destroy(){this._unbindStartEvent(),this._unbindPostStartEvents(),this.isDragging&&this.dragEnd(),this.removeAllListeners(),this._handlerDom=null}hasDragStarted(e){return Math.abs(e.x)>3||Math.abs(e.y)>3}checkContain(e,t,i){return t+i<0?0-i:"x"===e&&t+i>this.startPos.maxX?this.startPos.maxX-i:"y"===e&&t+i>this.startPos.maxY?this.startPos.maxY-i:t}_getPosition(){const e=window.getComputedStyle(this._root),t=this._getPositionCoord(e.left,"width"),i=this._getPositionCoord(e.top,"height");this.position.x=Number.isNaN(t)?0:t,this.position.y=Number.isNaN(i)?0:i,this._addTransformPosition(e)}_addTransformPosition(e){const t=e.transform;if(0!==t.indexOf("matrix"))return;const i=t.split(","),n=0===t.indexOf("matrix3d")?12:4,s=parseInt(i[n],10),r=parseInt(i[n+1],10);this.position.x+=s,this.position.y+=r}_getPositionCoord(e,t){if(-1!==e.indexOf("%")){const i=nn(this._root.parentNode);return i?parseFloat(e)/100*i[t]:0}return parseInt(e,10)}}var ln=Object.defineProperty,cn=(e,t,i)=>t in e?ln(e,t,{enumerable:!0,configurable:!0,writable:!0,value:i}):e[t]=i,un=(e,t,i)=>(cn(e,"symbol"!==typeof t?t+"":t,i),i);class hn extends Kt{constructor(e){super(e),un(this,"onCancelClick",(e=>{this.exitMini(),this.isClose=!0})),un(this,"onCenterClick",(e=>{const{player:t}=this;t.paused?t.play():t.pause()})),un(this,"onScroll",(e=>{if(!window.scrollY&&0!==window.scrollY||Math.abs(window.scrollY-this.pos.scrollY)<50)return;let t=parseInt(X.getCss(this.player.root,"height"));t+=this.config.scrollTop,this.pos.scrollY=window.scrollY,window.scrollY>t+5?!this.isMini&&!this.isClose&&this.getMini():window.scrollY<=t&&(this.isMini&&this.exitMini(),this.isClose=!1)})),this.isMini=!1,this.isClose=!1;const{config:t}=this;this.pos={left:t.left<0?window.innerWidth-t.width-20:t.left,top:t.top<0?window.innerHeight-t.height-20:t.top,height:this.config.height,width:this.config.width,scrollY:window.scrollY||0},this.lastStyle=null}static get pluginName(){return"miniscreen"}static get defaultConfig(){return{index:10,disable:!1,width:320,height:180,left:-1,top:-1,isShowIcon:!1,isScrollSwitch:!1,scrollTop:0,disableDrag:!1}}beforeCreate(e){"boolean"===typeof e.player.config.mini&&(e.config.isShowIcon=e.player.config.mini)}afterCreate(){this.initIcons(),this.on(de,(()=>{this.setAttr("data-state","pause")})),this.on(ce,(()=>{this.setAttr("data-state","play")}))}onPluginsReady(){const{player:e,config:t}=this;if(t.disable)return;if(this.config.isShowIcon){const t={config:{onClick:()=>{this.getMini()}}};e.controls.registerPlugin(qi,t,qi.pluginName)}const i=X.checkTouchSupport()?"touchend":"click";this.bind(".mini-cancel-btn",i,this.onCancelClick),this.bind(".play-icon",i,this.onCenterClick),this.config.disableDrag||(this._draggabilly=new an(this.player.root,{handle:this.root})),this.config.isScrollSwitch&&window.addEventListener("scroll",this.onScroll)}registerIcons(){return{play:{icon:Bi,class:"xg-icon-play"},pause:{icon:Hi,class:"xg-icon-pause"}}}initIcons(){const{icons:e}=this;this.appendChild(".play-icon",e.play),this.appendChild(".play-icon",e.pause)}getMini(){if(this.isMini)return;const{player:e,playerConfig:t}=this,i=this.config.target||this.player.root;this.lastStyle={},X.addClass(e.root,"xgplayer-mini"),["width","height","top","left"].map((e=>{this.lastStyle[e]=i.style[e],i.style[e]=`${this.pos[e]}px`})),t.fluid&&(i.style["padding-top"]=""),this.emit($e,!0),e.isMini=this.isMini=!0}exitMini(){if(!this.isMini)return!1;const{player:e,playerConfig:t}=this,i=this.config.target||this.player.root;X.removeClass(e.root,"xgplayer-mini"),this.lastStyle&&Object.keys(this.lastStyle).map((e=>{i.style[e]=this.lastStyle[e]})),this.lastStyle=null,t.fluid&&(e.root.style.width="100%",e.root.style.height="0",e.root.style["padding-top"]=100*t.height/t.width+"%"),this.emit($e,!1),this.isMini=e.isMini=!1}destroy(){window.removeEventListener("scroll",this.onScroll);const e=X.checkTouchSupport()?"touchend":"click";this.unbind(".mini-cancel-btn",e,this.onCancelClick),this.unbind(".play-icon",e,this.onCenterClick),this._draggabilly&&this._draggabilly.destroy(),this._draggabilly=null,this.exitMini()}render(){if(!this.config.disable)return`\n      <xg-mini-layer class="xg-mini-layer">\n      <xg-mini-header class="xgplayer-mini-header">\n      ${Xi(this,"MINI_DRAG",this.playerConfig.isHideTips)}\n      </xg-mini-header>\n      <div class="mini-cancel-btn">\n        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 20 20">\n          <path fill="#fff" fill-rule="evenodd" d="M3.99 3.49a1 1 0 0 1 1.414 0L10 8.085l4.596-4.595a1 1 0 1 1 1.414 1.414L11.414 9.5l4.596 4.596a1 1 0 0 1 .084 1.32l-.084.094a1 1 0 0 1-1.414 0L10 10.914 5.404 15.51a1 1 0 0 1-1.414-1.414L8.585 9.5 3.99 4.904a1 1 0 0 1-.084-1.32z"></path>\n        </svg>\n      </div>\n      <div class="play-icon">\n      </div>\n      </xg-mini-layer>`}}var dn=Object.defineProperty,pn=(e,t,i)=>t in e?dn(e,t,{enumerable:!0,configurable:!0,writable:!0,value:i}):e[t]=i,fn=(e,t,i)=>(pn(e,"symbol"!==typeof t?t+"":t,i),i);const gn={mouseenter:"onMouseEnter",mouseleave:"onMouseLeave",mousemove:"onMouseMove"},mn=["videoClick","videoDbClick"];class vn extends Ot{constructor(){super(...arguments),fn(this,"onMouseMove",(e=>{const{player:t,playerConfig:i}=this;t.isActive||(t.focus({autoHide:!i.closeDelayBlur}),!i.closeFocusVideoFocus&&t.media.focus())})),fn(this,"onMouseEnter",(e=>{const{playerConfig:t,player:i}=this;!t.closeFocusVideoFocus&&i.media.focus(),t.closeDelayBlur?i.focus({autoHide:!1}):i.focus(),this.emit(ze)})),fn(this,"onMouseLeave",(e=>{const{closePlayerBlur:t,leavePlayerTime:i,closeDelayBlur:n}=this.playerConfig;t||n||(i?this.player.focus({autoHide:!0,delay:i}):this.player.blur({ignorePaused:!0})),this.emit(Ge)})),fn(this,"onVideoClick",(e=>{const{player:t,playerConfig:i}=this;e.target&&i.closeVideoClick||e.target!==t.root&&e.target!==t.media&&e.target!==t.innerContainer&&e.target!==t.media.__canvas||(e.preventDefault(),i.closeVideoStopPropagation||e.stopPropagation(),this._clickCount++,this.clickTimer&&(clearTimeout(this.clickTimer),this.clickTimer=null),this.clickTimer=setTimeout((()=>{this._clickCount&&(this._clickCount--,Dt(this,mn[0],((e,t)=>{this.switchPlayPause(t.e)}),{e:e,paused:t.paused}),clearTimeout(this.clickTimer),this.clickTimer=null)}),300))})),fn(this,"onVideoDblClick",(e=>{const{player:t,playerConfig:i}=this;i.closeVideoDblclick||!e.target||e.target!==t.media&&e.target!==t.media.__canvas||(!i.closeVideoClick&&this._clickCount<2?this._clickCount=0:(this._clickCount=0,this.clickTimer&&(clearTimeout(this.clickTimer),this.clickTimer=null),e.preventDefault(),e.stopPropagation(),Dt(this,mn[1],((e,i)=>{this.emitUserAction(i.e,"switch_fullscreen",{props:"fullscreen",from:t.fullscreen,to:!t.fullscreen}),t.fullscreen?t.exitFullscreen():t.getFullscreen()}),{e:e,fullscreen:t.fullscreen})))}))}static get pluginName(){return"pc"}static get defaultConfig(){return{}}afterCreate(){this._clickCount=0,mn.map((e=>{this.__hooks[e]=null}));const{isMobileSimulateMode:e}=this.playerConfig;"mobile"===e||"mobile"===se.device&&!se.os.isIpad||this.initEvents()}initEvents(){const{media:e,root:t}=this.player,{enableContextmenu:i}=this.playerConfig;t&&t.addEventListener("click",this.onVideoClick,!1),t&&t.addEventListener("dblclick",this.onVideoDblClick,!1),Object.keys(gn).map((e=>{t.addEventListener(e,this[gn[e]],!1)})),!i&&e&&e.addEventListener("contextmenu",this.onContextmenu,!1)}switchPlayPause(e){const{player:t}=this;this.emitUserAction(e,"switch_play_pause",{props:"paused",from:t.paused,to:!t.paused}),t.ended?t.duration!==1/0&&t.duration>0&&t.replay():t.paused?t.play():t.pause()}onContextmenu(e){e=e||window.event,e.preventDefault&&e.preventDefault(),e.stopPropagation?e.stopPropagation():(e.returnValue=!1,e.cancelBubble=!0)}destroy(){const{video:e,root:t}=this.player;this.clickTimer&&clearTimeout(this.clickTimer),t.removeEventListener("click",this.onVideoClick,!1),t.removeEventListener("dblclick",this.onVideoDblClick,!1),e.removeEventListener("contextmenu",this.onContextmenu,!1),Object.keys(gn).map((e=>{t.removeEventListener(e,this[gn[e]],!1)}))}}var yn=Object.defineProperty,_n=(e,t,i)=>t in e?yn(e,t,{enumerable:!0,configurable:!0,writable:!0,value:i}):e[t]=i,bn=(e,t,i)=>(_n(e,"symbol"!==typeof t?t+"":t,i),i);const Sn={PRESS:"press",PRESS_END:"pressend",DOUBlE_CLICK:"doubleclick",CLICK:"click",TOUCH_MOVE:"touchmove",TOUCH_START:"touchstart",TOUCH_END:"touchend"},En={start:"touchstart",end:"touchend",move:"touchmove",cancel:"touchcancel"},Tn={start:"mousedown",end:"mouseup",move:"mousemove",cancel:"mouseleave"};function kn(e){return e&&e.length>0?e[e.length-1]:null}function wn(){return{pressDelay:600,dbClickDelay:200,disablePress:!1,disableDbClick:!1,miniStep:2,needPreventDefault:!0}}class xn{constructor(e,t={eventType:"touch"}){bn(this,"onTouchStart",(e=>{const{_pos:t,root:i}=this,n=kn(e.touches);t.x=n?parseInt(n.pageX,10):e.pageX,t.y=n?parseInt(n.pageX,10):e.pageX,t.start=!0,this.__setPress(e),i.addEventListener(this.events.end,this.onTouchEnd),i.addEventListener(this.events.cancel,this.onTouchCancel),i.addEventListener(this.events.move,this.onTouchMove),this.trigger(Sn.TOUCH_START,e)})),bn(this,"onTouchCancel",(e=>{this.onTouchEnd(e)})),bn(this,"onTouchEnd",(e=>{const{_pos:t,root:i}=this;this.__clearPress(),i.removeEventListener(this.events.cancel,this.onTouchCancel),i.removeEventListener(this.events.end,this.onTouchEnd),i.removeEventListener(this.events.move,this.onTouchMove),e.moving=t.moving,e.press=t.press,t.press&&this.trigger(Sn.PRESS_END,e),this.trigger(Sn.TOUCH_END,e),!t.press&&!t.moving&&this.__setDb(e),t.press=!1,t.start=!1,t.moving=!1})),bn(this,"onTouchMove",(e=>{const{_pos:t,config:i}=this,n=kn(e.touches),s=n?parseInt(n.pageX,10):e.pageX,r=n?parseInt(n.pageY,10):e.pageX,o=s-t.x,a=r-t.y;Math.abs(a)<i.miniStep&&Math.abs(o)<i.miniStep||(this.__clearPress(),t.press&&this.trigger(Sn.PRESS_END,e),t.press=!1,t.moving=!0,this.trigger(Sn.TOUCH_MOVE,e))})),this._pos={moving:!1,start:!1,x:0,y:0},this.config=wn(),Object.keys(t).map((e=>{this.config[e]=t[e]})),this.root=e,this.events="mouse"===t.eventType?Tn:En,this.pressIntrvalId=null,this.dbIntrvalId=null,this.__handlers={},this._initEvent()}_initEvent(){this.root.addEventListener(this.events.start,this.onTouchStart)}__setPress(e){const{config:t}=this;this.pressIntrvalId&&this.__clearPress(),this.pressIntrvalId=setTimeout((()=>{this.trigger(Sn.PRESS,e),this._pos.press=!0,this.__clearPress()}),t.pressDelay)}__clearPress(){window.clearTimeout(this.pressIntrvalId),this.pressIntrvalId=null}__setDb(e){const{config:t}=this;if(this.dbIntrvalId)return this.__clearDb(),void this.trigger(Sn.DOUBlE_CLICK,e);this.dbIntrvalId=setTimeout((()=>{this.__clearDb(),this._pos.start||this._pos.press||this._pos.moving||this.trigger(Sn.CLICK,e)}),t.dbClickDelay)}__clearDb(){clearTimeout(this.dbIntrvalId),this.dbIntrvalId=null}on(e,t){this.__handlers[e]||(this.__handlers[e]=[]),this.__handlers[e].push(t)}off(e,t){if(!this.__handlers[e])return;const i=this.__handlers[e];let n=-1;for(let s=0;s<i.length;s++)if(i[s]===t){n=s;break}n>=0&&this.__handlers[e].splice(n,1)}trigger(e,t){this.__handlers[e]&&this.__handlers[e].map((i=>{try{i(t)}catch(n){console.error(`trigger>>:${e}`,n)}}))}destroy(){const e={touchend:"onTouchEnd",touchmove:"onTouchMove",touchstart:"onTouchStart"};Object.keys(e).forEach((t=>{this.root.removeEventListener(t,this[e[t]])}))}}function Cn(){return(new DOMParser).parseFromString('<svg width="20" height="9" viewBox="0 0 8 9" fill="none" xmlns="http://www.w3.org/2000/svg"\n  xmlns:xlink="http://www.w3.org/1999/xlink">\n  <path opacity="0.54"\n    d="M7.5 3.63397C8.16667 4.01887 8.16667 4.98113 7.5 5.36603L1.5 8.83013C0.833334 9.21503 0 8.7339 0 7.9641L0 1.0359C0 0.266098 0.833333 -0.215027 1.5 0.169873L7.5 3.63397Z"\n    fill="white" />\n  <path transform="translate(5 0)" d="M7.5 3.63397C8.16667 4.01887 8.16667 4.98113 7.5 5.36603L1.5 8.83013C0.833334 9.21503 0 8.7339 0 7.9641L0 1.0359C0 0.266098 0.833333 -0.215027 1.5 0.169873L7.5 3.63397Z" fill="white"/>\n</svg>',"image/svg+xml").firstChild}var An=Object.defineProperty,Pn=(e,t,i)=>t in e?An(e,t,{enumerable:!0,configurable:!0,writable:!0,value:i}):e[t]=i,In=(e,t,i)=>(Pn(e,"symbol"!==typeof t?t+"":t,i),i);const Dn={AUTO:"auto",SEEKING:"seeking",PLAYBACK:"playbackrate",LIGHT:""},Ln=["videoClick","videoDbClick"];class On extends Kt{constructor(e){super(e),In(this,"onTouchStart",(e=>{const{player:t,config:i,pos:n,playerConfig:s}=this,r=this.getTouche(e);if(r&&!i.disableGesture&&this.duration>0&&!t.ended){n.isStart=!0,this.timer&&clearTimeout(this.timer),X.checkIsFunction(s.disableSwipeHandler)&&s.disableSwipeHandler(),this.find(".xg-dur").innerHTML=X.format(this.duration);const e=this.root.getBoundingClientRect();90===t.rotateDeg?(n.top=e.left,n.left=e.top,n.width=e.height,n.height=e.width):(n.top=e.top,n.left=e.left,n.width=e.width,n.height=e.height);const o=parseInt(r.pageX-n.left,10),a=parseInt(r.pageY-n.top,10);n.x=90===t.rotateDeg?a:o,n.y=90===t.rotateDeg?o:a,n.scopeL=i.scopeL*n.width,n.scopeR=(1-i.scopeR)*n.width,n.scopeM1=n.width*(1-i.scopeM)/2,n.scopeM2=n.width-n.scopeM1}})),In(this,"onTouchMove",(e=>{const t=this.getTouche(e),{pos:i,config:n,player:s}=this;if(!t||n.disableGesture||!this.duration||!i.isStart)return;const{miniMoveStep:r,hideControlsActive:o}=n,a=parseInt(t.pageX-i.left,10),l=parseInt(t.pageY-i.top,10),c=90===s.rotateDeg?l:a,u=90===s.rotateDeg?a:l;if(Math.abs(c-i.x)>r||Math.abs(u-i.y)>r){const t=c-i.x,r=u-i.y;let a=i.scope;if(-1===a&&(a=this.checkScope(c,u,t,r,i),0===a&&(o?s.blur():s.focus({autoHide:!1}),!i.time&&(i.time=parseInt(1e3*s.currentTime,10)+1e3*this.timeOffset)),i.scope=a),-1===a||a>0&&!n.gestureY||0===a&&!n.gestureX)return;e.cancelable&&e.preventDefault(),this.executeMove(t,r,a,i.width,i.height),i.x=c,i.y=u}})),In(this,"onTouchEnd",(e=>{const{player:t,pos:i,playerConfig:n}=this;if(setTimeout((()=>{t.getPlugin("progress")&&t.getPlugin("progress").resetSeekState()}),10),!i.isStart)return;i.scope>-1&&e.cancelable&&e.preventDefault();const{disableGesture:s,gestureX:r}=this.config;!s&&r?this.endLastMove(i.scope):i.time=0,i.scope=-1,this.resetPos(),X.checkIsFunction(n.enableSwipeHandler)&&n.enableSwipeHandler(),this.changeAction(Dn.AUTO)})),In(this,"onRootTouchMove",(e=>{!this.config.disableGesture&&this.config.gestureX&&this.checkIsRootTarget(e)&&(e.stopPropagation(),this.pos.isStart?this.onTouchMove(e):this.onTouchStart(e))})),In(this,"onRootTouchEnd",(e=>{this.pos.isStart&&this.checkIsRootTarget(e)&&(e.stopPropagation(),this.onTouchEnd(e))})),this.pos={isStart:!1,x:0,y:0,time:0,volume:0,rate:1,light:0,width:0,height:0,scopeL:0,scopeR:0,scopeM1:0,scopeM2:0,scope:-1},this.timer=null}static get pluginName(){return"mobile"}static get defaultConfig(){return{index:0,disableGesture:!1,gestureX:!0,gestureY:!0,gradient:"normal",isTouchingSeek:!1,miniMoveStep:5,miniYPer:5,scopeL:.25,scopeR:.25,scopeM:.9,pressRate:2,darkness:!0,maxDarkness:.8,disableActive:!1,disableTimeProgress:!1,hideControlsActive:!1,hideControlsEnd:!1,moveDuration:36e4,closedbClick:!1,disablePress:!0,disableSeekIcon:!1,focusVideoClick:!1}}get duration(){return this.playerConfig.customDuration||this.player.duration}get timeOffset(){return this.playerConfig.timeOffset||0}registerIcons(){return{seekTipIcon:{icon:Cn,class:"xg-seek-pre"}}}afterCreate(){Ln.map((e=>{this.__hooks[e]=null}));const{playerConfig:e,config:t,player:i}=this;!0===e.closeVideoDblclick&&(t.closedbClick=!0),this.resetPos(),X.isUndefined(e.disableGesture)||(t.disableGesture=!!e.disableGesture),this.appendChild(".xg-seek-icon",this.icons.seekTipIcon),this.xgMask=X.createDom("xg-mask","",{},"xgmask"),i.root.appendChild(this.xgMask),this.initCustomStyle(),this.registerThumbnail();const n="mouse"===this.domEventType?"mouse":"touch";this.touch=new xn(this.root,{eventType:n,needPreventDefault:!this.config.disableGesture}),this.root.addEventListener("contextmenu",(e=>{e.preventDefault()})),i.root.addEventListener("touchmove",this.onRootTouchMove,!0),i.root.addEventListener("touchend",this.onRootTouchEnd,!0),this.on(be,(()=>{const{player:e,config:t}=this;1e3*e.duration<t.moveDuration&&(t.moveDuration=1e3*e.duration)})),this.on([ye,he],(()=>{const{time:e,isStart:t}=this.pos;!t&&e>0&&(this.pos.time=0)}));const s={touchstart:"onTouchStart",touchmove:"onTouchMove",touchend:"onTouchEnd",press:"onPress",pressend:"onPressEnd",click:"onClick",doubleclick:"onDbClick"};if(Object.keys(s).map((e=>{this.touch.on(e,(t=>{this[s[e]](t)}))})),!t.disableActive){const e=i.plugins.progress;e&&(e.addCallBack("dragmove",(e=>{this.activeSeekNote(e.currentTime,e.forward)})),["dragend","click"].forEach((t=>{e.addCallBack(t,(()=>{this.changeAction(Dn.AUTO)}))})))}}registerThumbnail(){const{player:e}=this,{thumbnail:t}=e.plugins;if(t&&t.usable){this.thumbnail=t.createThumbnail(null,"mobile-thumbnail");const e=this.find(".time-preview");e.insertBefore(this.thumbnail,e.children[0])}}initCustomStyle(){const{commonStyle:e}=this.playerConfig||{},{playedColor:t,progressColor:i,timePreviewStyle:n,curTimeColor:s,durationColor:r}=e;if(t&&(this.find(".xg-curbar").style.backgroundColor=t),i&&(this.find(".xg-bar").style.backgroundColor=i),n){const e=this.find(".time-preview");Object.keys(n).forEach((t=>{e.style[t]=n[t]}))}const o=s||t,a=r;o&&(this.find(".xg-cur").style.color=o),a&&(this.find(".xg-dur").style.color=a),this.config.disableTimeProgress&&X.addClass(this.find(".xg-timebar"),"hide")}resetPos(e=0){this.pos?(this.pos.isStart=!1,this.pos.scope=-1,["x","y","width","height","scopeL","scopeR","scopeM1","scopeM2"].map((e=>{this.pos[e]=0}))):this.pos={isStart:!1,x:0,y:0,volume:0,rate:1,light:0,width:0,height:0,scopeL:0,scopeR:0,scopeM1:0,scopeM2:0,scope:-1,time:0}}changeAction(e){const{player:t,root:i}=this;i.setAttribute("data-xg-action",e);const n=t.plugins.start;n&&n.recover()}getTouche(e){this.player.rotateDeg;const t=e.touches&&e.touches.length>0?e.touches[e.touches.length-1]:e;return{pageX:t.pageX,pageY:t.pageY}}checkScope(e,t,i,n,s){const{width:r}=s;let o=-1;if(e<0||e>r)return o;const a=0===n?Math.abs(i):Math.abs(i/n);return Math.abs(i)>0&&a>=1.73&&e>s.scopeM1&&e<s.scopeM2?o=0:(0===Math.abs(i)||a<=.57)&&(o=e<s.scopeL?1:e>s.scopeR?2:3),o}executeMove(e,t,i,n,s){switch(i){case 0:this.updateTime(e/n*this.config.scopeM);break;case 1:this.updateBrightness(t/s);break;case 2:se.os.isIos||this.updateVolume(t/s);break}}endLastMove(e){const{pos:t,player:i,config:n}=this,s=(t.time-this.timeOffset)/1e3;switch(e){case 0:i.seek(Number(s).toFixed(1)),n.hideControlsEnd?i.blur():i.focus(),this.timer=setTimeout((()=>{this.pos.time=0}),500);break}this.changeAction(Dn.AUTO)}checkIsRootTarget(e){const t=this.player.plugins||{};return(!t.progress||!t.progress.root.contains(e.target))&&(t.start&&t.start.root.contains(e.target)||t.controls&&t.controls.root.contains(e.target))}sendUseAction(e){const{paused:t}=this.player;this.emitUserAction(e,"switch_play_pause",{prop:"paused",from:t,to:!t})}clickHandler(e){const{player:t,config:i,playerConfig:n}=this;t.state<hi.RUNNING?n.closeVideoClick||(this.sendUseAction(X.createEvent("click")),t.play()):!i.closedbClick||n.closeVideoClick?t.isActive?t.blur():t.focus():n.closeVideoClick||((t.isActive||i.focusVideoClick)&&(this.sendUseAction(X.createEvent("click")),this.switchPlayPause()),t.focus())}dbClickHandler(e){const{config:t,player:i}=this;!t.closedbClick&&i.state>=hi.RUNNING&&(this.sendUseAction(X.createEvent("dblclick")),this.switchPlayPause())}onClick(e){const{player:t}=this;Dt(this,Ln[0],((e,t)=>{this.clickHandler(t.e)}),{e:e,paused:t.paused})}onDbClick(e){const{player:t}=this;Dt(this,Ln[1],((e,t)=>{this.dbClickHandler(t.e)}),{e:e,paused:t.paused})}onPress(e){const{pos:t,config:i,player:n}=this;i.disablePress||(t.rate=this.player.playbackRate,this.emitUserAction("press","change_rate",{prop:"playbackRate",from:n.playbackRate,to:i.pressRate}),n.playbackRate=i.pressRate,this.changeAction(Dn.PLAYBACK))}onPressEnd(e){const{pos:t,config:i,player:n}=this;i.disablePress||(this.emitUserAction("pressend","change_rate",{prop:"playbackRate",from:n.playbackRate,to:t.rate}),n.playbackRate=t.rate,t.rate=1,this.changeAction(Dn.AUTO))}updateTime(e){const{player:t,config:i}=this,{duration:n}=this.player;e=Number(e.toFixed(4));let s=parseInt(e*i.moveDuration,10)+this.timeOffset;s+=this.pos.time,s=s<0?0:s>1e3*n?1e3*n-200:s,t.getPlugin("time")&&t.getPlugin("time").updateTime(s/1e3),t.getPlugin("progress")&&t.getPlugin("progress").updatePercent(s/1e3/this.duration,!0),this.activeSeekNote(s/1e3,e>0),i.isTouchingSeek&&t.seek(Number((s-this.timeOffset)/1e3).toFixed(1)),this.pos.time=s}updateVolume(e){this.player.rotateDeg&&(e=-e);const{player:t,pos:i}=this;if(e=parseInt(100*e,10),i.volume+=e,Math.abs(i.volume)<10)return;let n=parseInt(10*t.volume,10)-parseInt(i.volume/10,10);n=n>10?10:n<1?0:n,t.volume=n/10,i.volume=0}updateBrightness(e){this.player.rotateDeg&&(e=-e);const{pos:t,config:i,xgMask:n}=this;let s=t.light+.8*e;s=s>i.maxDarkness?i.maxDarkness:s<0?0:s,n&&(n.style.backgroundColor=`rgba(0,0,0,${s})`),t.light=s}activeSeekNote(e,t=!0){const{player:i,config:n}=this,s=!(this.duration!==1/0&&this.duration>0);if(!e||"number"!==typeof e||s||n.disableActive)return;e<0?e=0:e>i.duration&&(e=i.duration-.2),this.changeAction(Dn.SEEKING);const r=i.plugins.start;r&&r.focusHide(),this.find(".xg-dur").innerHTML=X.format(this.duration),this.find(".xg-cur").innerHTML=X.format(e),this.find(".xg-curbar").style.width=e/this.duration*100+"%",t?X.removeClass(this.find(".xg-seek-show"),"xg-back"):X.addClass(this.find(".xg-seek-show"),"xg-back"),this.updateThumbnails(e)}updateThumbnails(e){const{player:t}=this,{thumbnail:i}=t.plugins;i&&i.usable&&this.thumbnail&&i.update(this.thumbnail,e,160,90)}switchPlayPause(){const{player:e}=this;if(e.state<hi.ATTACHED)return!1;e.ended||(e.paused?e.play():e.pause())}disableGesture(){this.config.disableGesture=!1}enableGesture(){this.config.disableGesture=!0}destroy(){const{player:e}=this;this.timer&&clearTimeout(this.timer),this.thumbnail=null,e.root.removeChild(this.xgMask),this.xgMask=null,this.touch&&this.touch.destroy(),this.touch=null,e.root.removeEventListener("touchmove",this.onRootTouchMove,!0),e.root.removeEventListener("touchend",this.onRootTouchEnd,!0)}render(){const e="normal"!==this.config.gradient?`gradient ${this.config.gradient}`:"gradient";return`\n     <xg-trigger class="trigger">\n     <div class="${e}"></div>\n        <div class="time-preview">\n            <div class="xg-seek-show ${this.config.disableSeekIcon?" hide-seek-icon":""}">\n              <i class="xg-seek-icon"></i>\n              <span class="xg-cur">00:00</span>\n              <span class="xg-separator">/</span>\n              <span class="xg-dur">00:00</span>\n            </div>\n              <div class="xg-bar xg-timebar">\n                <div class="xg-curbar"></div>\n              </div>\n        </div>\n        <div class="xg-playbackrate xg-top-note">\n            <span><i>${this.config.pressRate}X</i>${this.i18n.FORWARD}</span>\n        </div>\n     </xg-trigger>\n    `}}var Rn=Object.defineProperty,Mn=(e,t,i)=>t in e?Rn(e,t,{enumerable:!0,configurable:!0,writable:!0,value:i}):e[t]=i,Nn=(e,t,i)=>(Mn(e,"symbol"!==typeof t?t+"":t,i),i);function Un(e){e.preventDefault(),e.returnValue=!1}function Fn(e){const t=e.tagName;return!("INPUT"!==t&&"TEXTAREA"!==t&&!e.isContentEditable)}class Bn extends Ot{constructor(){super(...arguments),Nn(this,"onBodyKeyDown",(e=>{if(!this.player)return;const t=e||window.event,i=t.keyCode,{_keyState:n,player:s}=this,{disable:r,disableBodyTrigger:o,isIgnoreUserActive:a}=this.config;r||o||!s.isUserActive&&!a||Fn(t.target)||!this.checkIsVisible()||t.metaKey||t.altKey||t.ctrlKey?n.isBodyKeyDown=!1:(e.repeat||n.isKeyDown||((t.target===document.body||this.config.isGlobalTrigger&&!Fn(t.target))&&this.checkCode(i,!0)&&(n.isBodyKeyDown=!0),document.addEventListener("keyup",this.onBodyKeyUp)),n.isBodyKeyDown&&this.handleKeyDown(t))})),Nn(this,"onBodyKeyUp",(e=>{this.player&&(document.removeEventListener("keyup",this.onBodyKeyUp),this.handleKeyUp(e))})),Nn(this,"onKeydown",(e=>{if(!this.player)return;const t=e||window.event,{_keyState:i}=this;if(!t.repeat){if(this.config.disable||this.config.disableRootTrigger||t.metaKey||t.altKey||t.ctrlKey)return;!t||37!==t.keyCode&&!this.checkCode(t.keyCode)||t.target!==this.player.root&&t.target!==this.player.video&&t.target!==this.player.controls.el||(i.isKeyDown=!0),this.player.root.addEventListener("keyup",this.onKeyup)}i.isKeyDown&&this.handleKeyDown(t)})),Nn(this,"onKeyup",(e=>{this.player&&(this.player.root.removeEventListener("keyup",this.onKeyup),this.handleKeyUp(e))}))}static get pluginName(){return"keyboard"}static get defaultConfig(){return{seekStep:10,checkVisible:!1,disableBodyTrigger:!1,disableRootTrigger:!1,isGlobalTrigger:!0,keyCodeMap:{},disable:!1,playbackRate:2,isIgnoreUserActive:!0}}mergekeyCodeMap(){const e=this.config.keyCodeMap;e&&Object.keys(e).map((t=>{this.keyCodeMap[t]?["keyCode","action","disable","pressAction","disablePress","isBodyTarget"].map((i=>{e[t][i]&&(this.keyCodeMap[t][i]=e[t][i])})):this.keyCodeMap[t]=e[t]}))}afterCreate(){this.config.disable=!this.playerConfig.keyShortcut;const e="function"===typeof this.config.seekStep?this.config.seekStep(this.player):this.config.seekStep;e&&"number"===typeof e&&(this.seekStep=e),this.keyCodeMap={space:{keyCode:32,action:"playPause",disable:!1,disablePress:!1,noBodyTarget:!1},up:{keyCode:38,action:"upVolume",disable:!1,disablePress:!1,noBodyTarget:!0},down:{keyCode:40,action:"downVolume",disable:!1,disablePress:!1,noBodyTarget:!0},left:{keyCode:37,action:"seekBack",disablePress:!1,disable:!1},right:{keyCode:39,action:"seek",pressAction:"changePlaybackRate",disablePress:!1,disable:!1},esc:{keyCode:27,action:"exitFullscreen",disablePress:!0,disable:!1}},this.mergekeyCodeMap(),this._keyState={isKeyDown:!1,isBodyKeyDown:!1,isPress:!1,tt:0,playbackRate:0},this.player.root.addEventListener("keydown",this.onKeydown),document.addEventListener("keydown",this.onBodyKeyDown)}setConfig(e){Object.keys(e).forEach((t=>{this.config[t]=e[t]}))}checkIsVisible(){if(!this.config.checkVisible)return!0;const e=this.player.root.getBoundingClientRect(),{height:t,top:i,bottom:n}=e,s=window.innerHeight;return!(i<0&&i<0-.9*t||n>0&&n-s>.9*t)}checkCode(e,t){let i=!1;return Object.keys(this.keyCodeMap).map((n=>{this.keyCodeMap[n]&&e===this.keyCodeMap[n].keyCode&&!this.keyCodeMap[n].disable&&(i=!t||t&&!this.keyCodeMap[n].noBodyTarget)})),i}downVolume(e){const{player:t}=this;if(t.volume<=0)return;const i=parseFloat((t.volume-.1).toFixed(1)),n={volume:{from:t.volume,to:i}};this.emitUserAction(e,"change_volume",{props:n}),t.volume=i>=0?i:0}upVolume(e){const{player:t}=this;if(t.volume>=1)return;const i=parseFloat((t.volume+.1).toFixed(1)),n={volume:{from:t.volume,to:i}};this.emitUserAction(e,"change_volume",{props:n}),t.volume=i<=1?i:1}seek(e){const{currentTime:t,offsetCurrentTime:i,duration:n,offsetDuration:s,timeSegments:r}=this.player;let o=i>-1?i:t;const a=s||n,l=e.repeat&&this.seekStep>=4?parseInt(this.seekStep/2,10):this.seekStep;o+l<=a?o+=l:o=a;const c=X.getCurrentTimeByOffset(o,r),u={currentTime:{from:t,to:c}};this.emitUserAction(e,"seek",{props:u}),this.player.currentTime=c}seekBack(e){const{currentTime:t,offsetCurrentTime:i,timeSegments:n}=this.player,s=e.repeat?parseInt(this.seekStep/2,10):this.seekStep,r=i>-1?i:t;let o=r-s;o<0&&(o=0),o=X.getCurrentTimeByOffset(o,n);const a={currentTime:{from:t,to:o}};this.emitUserAction(e,"seek",{props:a}),this.player.currentTime=o}changePlaybackRate(e){const{_keyState:t,config:i,player:n}=this;0===t.playbackRate&&(t.playbackRate=n.playbackRate,n.playbackRate=i.playbackRate)}playPause(e){const{player:t}=this;t&&(this.emitUserAction(e,"switch_play_pause"),t.paused?t.play():t.pause())}exitFullscreen(e){const{player:t}=this,{fullscreen:i,cssfullscreen:n}=t;i&&(this.emitUserAction("keyup","switch_fullscreen",{prop:"fullscreen",from:i,to:!i}),t.exitFullscreen()),n&&(this.emitUserAction("keyup","switch_css_fullscreen",{prop:"cssfullscreen",from:n,to:!n}),t.exitCssFullscreen())}handleKeyDown(e){const{_keyState:t}=this;if(e.repeat){t.isPress=!0;const e=Date.now();if(e-t.tt<200)return;t.tt=e}this.handleKeyCode(e.keyCode,e,t.isPress)}handleKeyUp(e){const{_keyState:t}=this;t.playbackRate>0&&(this.player.playbackRate=t.playbackRate,t.playbackRate=0),t.isKeyDown=!1,t.isPress=!1,t.tt=0}handleKeyCode(e,t,i){const n=Object.keys(this.keyCodeMap);for(let s=0;s<n.length;s++){const{action:r,keyCode:o,disable:a,pressAction:l,disablePress:c}=this.keyCodeMap[n[s]];if(o===e){if(!a&&(!i||!c)){const e=i&&l||r;"function"===typeof e?r(t,this.player,i):"string"===typeof e&&"function"===typeof this[e]&&this[e](t,this.player,i),this.emit(rt,{key:n[s],target:t.target,isPress:i,...this.keyCodeMap[n[s]]})}Un(t),t.stopPropagation();break}}}destroy(){this.player.root.removeEventListener("keydown",this.onKeydown),document.removeEventListener("keydown",this.onBodyKeyDown),this.player.root.removeEventListener("keyup",this.onKeyup),document.removeEventListener("keyup",this.onBodyKeyUp)}disable(){this.config.disable=!0}enable(){this.config.disable=!1}}function Hn(){return(new DOMParser).parseFromString('<svg xmlns="http://www.w3.org/2000/svg" width="100" height="100" viewBox="-5 -5 110 110">\n  <path d="M100,50A50,50,0,1,1,50,0" stroke-width="5" stroke="#ddd" stroke-dasharray="236" fill="none"></path>\n</svg>\n',"image/svg+xml").firstChild}class jn extends Kt{static get pluginName(){return"loading"}static get defaultConfig(){return{position:Ut.ROOT}}registerIcons(){return{loadingIcon:Hn}}afterCreate(){this.appendChild("xg-loading-inner",this.icons.loadingIcon)}render(){return'\n    <xg-loading class="xgplayer-loading">\n      <xg-loading-inner></xg-loading-inner>\n    </xg-loading>'}}const Vn=[{tag:"xg-cache",className:"xgplayer-progress-cache",styleKey:"cachedColor"},{tag:"xg-played",className:"xgplayer-progress-played",styleKey:"playedColor"}];class Gn{constructor(e){this.fragments=e.fragments||[],0===this.fragments.length&&this.fragments.push({percent:1}),this._callBack=e.actionCallback,this.fragConfig={fragFocusClass:e.fragFocusClass||"inner-focus-point",fragAutoFocus:!!e.fragAutoFocus,fragClass:e.fragClass||""},this.style=e.style||{playedColor:"",cachedColor:"",progressColor:""},this.duration=0,this.cachedIndex=0,this.playedIndex=0,this.focusIndex=-1}updateDuration(e){this.duration=e;let t=0;const{fragments:i}=this;this.fragments=i.map((e=>(e.start=parseInt(t,10),e.end=parseInt(t+e.percent*this.duration,10),e.duration=parseInt(e.percent*this.duration,10),t+=e.percent*this.duration,e)))}updateProgress(e="played",t={newIndex:0,curIndex:0,millisecond:0}){const{progressList:i,fragments:n}=this;if(i.length<1)return;const{newIndex:s,curIndex:r,millisecond:o}=t;s!==r&&i.map(((t,i)=>{i<s?t[e].style.width="100%":i>s&&(t[e].style.width=0)}));const a=n[s],l=0===o?0:(o-a.start)/a.duration;i[s][e].style.width=l<0?0:100*l+"%"}updateFocus(e){if(!this.fragConfig.fragAutoFocus||this.fragments.length<2)return;if(!e){if(this.focusIndex>-1){this.unHightLight(this.focusIndex);const e={index:-1,preIndex:this.focusIndex,fragment:null};this._callBack&&this._callBack(e),this.focusIndex=-1}return}const t=this.findIndex(1e3*e.currentTime,this.focusIndex);if(t>=0&&t!==this.focusIndex){this.focusIndex>-1&&this.unHightLight(this.focusIndex),this.setHightLight(t);const e={index:t,preIndex:this.focusIndex,fragment:this.fragments[this.focusIndex]};this.focusIndex=t,this._callBack&&this._callBack(e)}}update(e={cached:0,played:0},t){if(!this.duration||parseInt(1e3*t,10)!==this.duration){if(!t&&0!==t)return;this.updateDuration(parseInt(1e3*t,10))}const{playedIndex:i,cachedIndex:n}=this;if("Undefined"!==X.typeOf(e.played)){const t=this.findIndex(1e3*e.played,i);if(t<0)return;this.updateProgress("played",{newIndex:t,curIndex:i,millisecond:parseInt(1e3*e.played,10)}),this.playedIndex=t}if("Undefined"!==X.typeOf(e.cached)){const t=this.findIndex(1e3*e.cached,n);if(t<0)return;this.updateProgress("cached",{newIndex:t,curIndex:n,millisecond:parseInt(1e3*e.cached,10)}),this.cachedIndex=t}}findIndex(e,t){const{fragments:i}=this;if(!i||0===i.length)return-1;if(1===i.length)return 0;if(t>-1&&t<i.length&&e>i[t].start&&e<i[t].end)return t;if(e>i[i.length-1].start)return i.length-1;for(let n=0;n<i.length;n++)if(e>i[n].start&&e<=i[n].end){t=n;break}return t}findHightLight(){const e=this.root.children;for(let t=0;t<e.length;t++)if(X.hasClass(e[t],this.fragConfig.fragFocusClass))return{dom:e[t],pos:e[t].getBoundingClientRect()}}findFragment(e){const t=this.root.children;return e<0||e>=t.length?null:{dom:t[e],pos:t[e].getBoundingClientRect()}}unHightLight(){const e=this.root.children;for(let t=0;t<e.length;t++)X.removeClass(e[t],this.fragConfig.fragFocusClass)}setHightLight(e){const t=this.root.children;if(e<t.length)return X.addClass(t[e],this.fragConfig.fragFocusClass),{dom:t[e],pos:t[e].getBoundingClientRect()}}destroy(){this.progressList=null,this.fragments=null,this.root.innerHTML=""}reset(e){if(Object.keys(this.fragConfig).forEach((t=>{void 0!==e[t]&&(this.fragConfig[t]=e[t])})),e.fragments){if(this.fragments=0===e.fragments.length?[{percent:1}]:e.fragments,this.updateDuration(this.duration),this.playedIndex=0,this.cachedIndex=0,this.root){const e=this.root.children;while(e.length>0)this.root.removeChild(e[0])}this.render()}}render(){const{progressColor:e}=this.style;if(this.root||(this.root=X.createDom("xg-inners","",{},"progress-list")),this.fragments){const{fragClass:t,fragFocusClass:i}=this.fragConfig;this.progressList=this.fragments.map((n=>{const s=X.createDom("xg-inner","",{style:e?`background:${e}; flex: ${n.percent}`:`flex: ${n.percent}`},`${n.isFocus?i:""} xgplayer-progress-inner ${t}`);return this.root.appendChild(s),Vn.forEach((e=>{s.appendChild(X.createDom(e.tag,"",{style:e.styleKey?`background: ${this.style[e.styleKey]}; width:0;`:"width:0;"},e.className))})),{cached:s.children[0],played:s.children[1]}}))}return this.root}}var zn=Object.defineProperty,Kn=(e,t,i)=>t in e?zn(e,t,{enumerable:!0,configurable:!0,writable:!0,value:i}):e[t]=i,Wn=(e,t,i)=>(Kn(e,"symbol"!==typeof t?t+"":t,i),i);const Yn={POINT:"inner-focus-point",HIGHLIGHT:"inner-focus-highlight"};class $n extends Kt{constructor(e){super(e),Wn(this,"onMoveOnly",((e,t)=>{const{pos:i,config:n,player:s}=this;let r=t;if(e){X.event(e);const t=X.getEventPos(e,s.zoom),o=90===s.rotateDeg?t.clientY:t.clientX;if(i.moving&&Math.abs(i.x-o)<n.miniMoveStep)return;i.moving=!0,i.x=o,r=this.computeTime(e,o)}this.triggerCallbacks("dragmove",r,e),this._updateInnerFocus(r)})),Wn(this,"onBodyClick",(e=>{this.pos.isLocked&&(this.pos.isLocked=!1,e.preventDefault(),e.stopPropagation())})),Wn(this,"_mouseDownHandler",((e,t)=>{this._state.time=t.currentTime,this.updateWidth(t.currentTime,t.seekTime,t.percent,0),this._updateInnerFocus(t)})),Wn(this,"_mouseUpHandler",((e,t)=>{const{pos:i}=this;i.moving&&this.updateWidth(t.currentTime,t.seekTime,t.percent,2)})),Wn(this,"_mouseMoveHandler",((e,t)=>{const{_state:i,pos:n,config:s,player:r}=this;i.time<t.currentTime?t.forward=!0:t.forward=!1,i.time=t.currentTime,n.isDown&&!n.moving&&(n.moving=!0,s.isPauseMoving&&r.pause(),this.triggerCallbacks("dragstart",t,e),this.emitUserAction("drag","dragstart",t)),this.updateWidth(t.currentTime,t.seekTime,t.percent,1),this.triggerCallbacks("dragmove",t,e),this._updateInnerFocus(t)})),Wn(this,"onMouseDown",(e=>{const{_state:t,player:i,pos:n,config:s,playerConfig:r}=this,o=X.getEventPos(e,i.zoom),a=90===i.rotateDeg?o.clientY:o.clientX;if(i.isMini||s.closeMoveSeek||!r.allowSeekAfterEnded&&i.ended)return;if(!i.duration&&!i.isPlaying)return void i.play();e.stopPropagation(),this.focus(),X.checkIsFunction(r.disableSwipeHandler)&&r.disableSwipeHandler(),X.checkIsFunction(s.onMoveStart)&&s.onMoveStart(),X.event(e),n.x=a,n.isDown=!0,n.moving=!1,t.prePlayTime=i.currentTime,i.focus({autoHide:!1}),this.isProgressMoving=!0,X.addClass(this.progressBtn,"active");const l=this.computeTime(e,a);l.prePlayTime=t.prePlayTime,this._mouseDownHandlerHook(e,l);const c=e.type;return"touchstart"===c?(this.root.addEventListener("touchmove",this.onMouseMove),this.root.addEventListener("touchend",this.onMouseUp),this.root.addEventListener("touchcancel",this.onMouseUp)):(this.unbind("mousemove",this.onMoveOnly),document.addEventListener("mousemove",this.onMouseMove,!1),document.addEventListener("mouseup",this.onMouseUp,!1)),!0})),Wn(this,"onMouseUp",(e=>{const{player:t,config:i,pos:n,playerConfig:s,_state:r}=this;e.stopPropagation(),e.preventDefault(),X.checkIsFunction(s.enableSwipeHandler)&&s.enableSwipeHandler(),X.checkIsFunction(i.onMoveEnd)&&i.onMoveEnd(),X.event(e),X.removeClass(this.progressBtn,"active");const o=this.computeTime(e,n.x);o.prePlayTime=r.prePlayTime,n.moving?(this.triggerCallbacks("dragend",o,e),this.emitUserAction("drag","dragend",o)):(this.triggerCallbacks("click",o,e),this.emitUserAction("click","click",o)),this._mouseUpHandlerHook(e,o),n.moving=!1,n.isDown=!1,n.x=0,n.y=0,n.isLocked=!0,r.prePlayTime=0,r.time=0;const a=e.type;"touchend"===a||"touchcancel"===a?(this.root.removeEventListener("touchmove",this.onMouseMove),this.root.removeEventListener("touchend",this.onMouseUp),this.root.removeEventListener("touchcancel",this.onMouseUp),this.blur()):(document.removeEventListener("mousemove",this.onMouseMove,!1),document.removeEventListener("mouseup",this.onMouseUp,!1),n.isEnter?"mobile"!==s.isMobileSimulateMode&&this.bind("mousemove",this.onMoveOnly):this.onMouseLeave(e)),X.setTimeout(this,(()=>{this.resetSeekState()}),10),t.focus()})),Wn(this,"onMouseMove",(e=>{const{_state:t,pos:i,player:n,config:s}=this;X.checkTouchSupport()&&e.preventDefault(),X.event(e);const r=X.getEventPos(e,n.zoom),o=90===n.rotateDeg?r.clientY:r.clientX,a=Math.abs(i.x-o);if(i.moving&&a<s.miniMoveStep||!i.moving&&a<s.miniStartStep)return;i.x=o;const l=this.computeTime(e,o);l.prePlayTime=t.prePlayTime,this._mouseMoveHandlerHook(e,l)})),Wn(this,"onMouseOut",(e=>{this.triggerCallbacks("mouseout",null,e)})),Wn(this,"onMouseOver",(e=>{this.triggerCallbacks("mouseover",null,e)})),Wn(this,"onMouseEnter",(e=>{const{player:t,pos:i}=this;if(i.isDown||i.isEnter||t.isMini||!t.config.allowSeekAfterEnded&&t.ended)return;i.isEnter=!0,this.bind("mousemove",this.onMoveOnly),this.bind("mouseleave",this.onMouseLeave),X.event(e);const n=X.getEventPos(e,t.zoom),s=90===t.rotateDeg?n.clientY:n.clientX,r=this.computeTime(e,s);this.triggerCallbacks("mouseenter",r,e),this.focus()})),Wn(this,"onMouseLeave",(e=>{this.triggerCallbacks("mouseleave",null,e),this.unlock(),this._updateInnerFocus(null)})),Wn(this,"onVideoResize",(()=>{const{x:e,isDown:t,isEnter:i}=this.pos;if(i&&!t){const t=this.computeTime(null,e);this.onMoveOnly(null,t)}})),this.useable=!1,this.isProgressMoving=!1,this.__dragCallBacks=[],this._state={now:-1,direc:0,time:0,prePlayTime:-1},this._disableBlur=!1}static get pluginName(){return"progress"}static get defaultConfig(){return{position:Ut.CONTROLS_CENTER,index:0,disable:!1,isDragingSeek:!0,closeMoveSeek:!1,isPauseMoving:!1,isCloseClickSeek:!1,fragments:[{percent:1}],fragFocusClass:Yn.POINT,fragClass:"",fragAutoFocus:!1,miniMoveStep:5,miniStartStep:2,onMoveStart:()=>{},onMoveEnd:()=>{},endedDiff:.2}}static get FRAGMENT_FOCUS_CLASS(){return Yn}get offsetDuration(){return this.playerConfig.customDuration||this.player.offsetDuration||this.player.duration}get duration(){return this.playerConfig.customDuration||this.player.duration}get timeOffset(){return this.playerConfig.timeOffset||0}get currentTime(){const{offsetCurrentTime:e,currentTime:t}=this.player;return e>=0?e:t+this.timeOffset}changeState(e=!0){this.useable=e}show(e){this.root&&(this.root.style.display="flex")}_initInner(e=[],t={}){e&&0!==e.length||(e=[{percent:1}]);const i={fragments:e,...t,actionCallback:e=>{this.emitUserAction("fragment_focus","fragment_focus",e)}};this.innerList?this.innerList.reset(i):(this.innerList=new Gn(i),this.outer.insertBefore(this.innerList.render(),this.outer.children[0]),["findHightLight","unHightLight","setHightLight","findFragment"].map((e=>{this[e]=this.innerList[e].bind(this.innerList)})))}_updateInnerFocus(e){this.innerList&&this.innerList.updateFocus(e)}afterCreate(){if(this.config.disable||this.playerConfig.isLive)return;this.pos={x:0,y:0,moving:!1,isDown:!1,isEnter:!1,isLocked:!1},this.outer=this.find("xg-outer");const{fragFocusClass:e,fragAutoFocus:t,fragClass:i}=this.config;this._initInner(this.config.fragments,{fragFocusClass:e,fragAutoFocus:t,fragClass:i,style:this.playerConfig.commonStyle||{}}),"mobile"===se.device&&(this.config.isDragingSeek=!1,this.isMobile=!0),this.progressBtn=this.find(".xgplayer-progress-btn"),this.on(be,(()=>{this.onMouseLeave()})),this.on(me,(()=>{this.onTimeupdate()})),this.on(ge,(()=>{this.onTimeupdate(),this.onCacheUpdate()})),this.on(we,(()=>{this.onCacheUpdate()})),this.on(he,(()=>{this.onCacheUpdate(!0),this.onTimeupdate(!0),this._state.now=0})),this.on(Ce,(()=>{this.onReset()})),this.on(et,(()=>{this.onVideoResize()})),this.bindDomEvents(),this.initCustomStyle()}setConfig(e){let t=null;Object.keys(e).forEach((i=>{this.config[i]=e[i],"fragments"===i&&(t=e[i])})),t&&this._initInner(t,e)}initCustomStyle(){const{commonStyle:e}=this.playerConfig||{},{sliderBtnStyle:t}=e,{progressBtn:i}=this;t&&("string"===typeof t?i.style.boxShadow=t:"object"===typeof t&&Object.keys(t).map((e=>{i.style[e]=t[e]})))}triggerCallbacks(e,t,i){this.__dragCallBacks.length>0&&this.__dragCallBacks.map((n=>{if(n&&n.handler&&n.type===e)try{n.handler(t,i)}catch(s){console.error(`[XGPLAYER][triggerCallbacks] ${n} error`,s)}}))}addCallBack(e,t){t&&"function"===typeof t&&this.__dragCallBacks.push({type:e,handler:t})}removeCallBack(e,t){const{__dragCallBacks:i}=this;let n=-1;i.map(((i,s)=>{i&&i.type===e&&i.handler===t&&(n=s)})),n>-1&&i.splice(n,1)}unlock(){const{player:e,pos:t}=this;t.isEnter=!1,t.isLocked=!1,e.isMini||(this.unbind("mousemove",this.onMoveOnly),t.isDown?this.unbind("mouseleave",this.onMouseLeave):this.blur())}bindDomEvents(){const{controls:e,config:t}=this.player;this._mouseDownHandlerHook=this.hook("dragstart",this._mouseDownHandler),this._mouseUpHandlerHook=this.hook("dragend",this._mouseUpHandler),this._mouseMoveHandlerHook=this.hook("drag",this._mouseMoveHandler),"touch"!==this.domEventType&&"compatible"!==this.domEventType||(this.root.addEventListener("touchstart",this.onMouseDown),e&&(e.root&&e.root.addEventListener("touchmove",X.stopPropagation),e.center&&e.center.addEventListener("touchend",X.stopPropagation))),"mouse"!==this.domEventType&&"compatible"!==this.domEventType||(this.bind("mousedown",this.onMouseDown),"mobile"!==t.isMobileSimulateMode&&this.bind("mouseenter",this.onMouseEnter),this.bind("mouseover",this.onMouseOver),this.bind("mouseout",this.onMouseOut),this.player.root.addEventListener("click",this.onBodyClick,!0))}focus(){this.player.controls.pauseAutoHide(),X.addClass(this.root,"active")}blur(){this._disableBlur||(this.player.controls.recoverAutoHide(),X.removeClass(this.root,"active"))}disableBlur(){this._disableBlur=!0}enableBlur(){this._disableBlur=!1}updateWidth(e,t,i,n){const{config:s,player:r}=this;if(s.isCloseClickSeek&&0===n)return;const o=t=t>=r.duration?r.duration-s.endedDiff:Number(t).toFixed(1);this.updatePercent(i),this.updateTime(e),(1!==n||s.isDragingSeek&&"audio"!==r.config.mediaType)&&(this._state.now=o,this._state.direc=o>r.currentTime?0:1,r.seek(o))}computeTime(e,t){const{player:i}=this,{width:n,height:s,top:r,left:o}=this.root.getBoundingClientRect();let a,l;const c=t;90===i.rotateDeg?(a=s,l=r):(a=n,l=o);let u=c-l;u=u>a?a:u<0?0:u;let h=u/a;h=h<0?0:h>1?1:h;const d=parseInt(h*this.offsetDuration*1e3,10)/1e3,p=X.getCurrentTimeByOffset(d,i.timeSegments);return{percent:h,currentTime:d,seekTime:p,offset:u,width:a,left:l,e:e}}updateTime(e){const{player:t,duration:i}=this;e>i?e=i:e<0&&(e=0);const n=t.plugins.time;n&&n.updateTime(e)}resetSeekState(){this.isProgressMoving=!1;const e=this.player.plugins.time;e&&e.resetActive()}updatePercent(e,t){if(this.isProgressMoving=!0,this.config.disable)return;e=e>1?1:e<0?0:e,this.progressBtn.style.left=100*e+"%",this.innerList.update({played:e*this.offsetDuration},this.offsetDuration);const{miniprogress:i}=this.player.plugins;i&&i.update({played:e*this.offsetDuration},this.offsetDuration)}onTimeupdate(e){const{player:t,_state:i,offsetDuration:n}=this;if(t.isSeeking&&t.media.seeking||this.isProgressMoving||!t.hasStart)return;if(i.now>-1){const e=parseInt(1e3*i.now,10)-parseInt(1e3*t.currentTime,10);if(0===i.direc&&e>300||1===i.direc&&e>-300)return void(i.now=-1);i.now=-1}let s=this.currentTime;s=X.adjustTimeByDuration(s,n,e),this.innerList.update({played:s},n),this.progressBtn.style.left=s/n*100+"%"}onCacheUpdate(e){const{player:t,duration:i}=this;if(!t)return;let n=t.bufferedPoint.end;n=X.adjustTimeByDuration(n,i,e),this.innerList.update({cached:n},i)}onReset(){this.innerList.update({played:0,cached:0},0),this.progressBtn.style.left="0%"}destroy(){const{player:e}=this,{controls:t}=e;this.thumbnailPlugin=null,this.innerList.destroy(),this.innerList=null;const{domEventType:i}=this;"touch"!==i&&"compatible"!==i||(this.root.removeEventListener("touchstart",this.onMouseDown),this.root.removeEventListener("touchmove",this.onMouseMove),this.root.removeEventListener("touchend",this.onMouseUp),this.root.removeEventListener("touchcancel",this.onMouseUp),t&&(t.root&&t.root.removeEventListener("touchmove",X.stopPropagation),t.center&&t.center.removeEventListener("touchend",X.stopPropagation))),"mouse"!==i&&"compatible"!==i||(this.unbind("mousedown",this.onMouseDown),this.unbind("mouseenter",this.onMouseEnter),this.unbind("mousemove",this.onMoveOnly),this.unbind("mouseleave",this.onMouseLeave),document.removeEventListener("mousemove",this.onMouseMove,!1),document.removeEventListener("mouseup",this.onMouseUp,!1),e.root.removeEventListener("click",this.onBodyClick,!0))}render(){if(this.config.disable||this.playerConfig.isLive)return;const e=this.player.controls?this.player.controls.config.mode:"",t="bottom"===e?"xgplayer-progress-bottom":"";return`\n    <xg-progress class="xgplayer-progress ${t}">\n      <xg-outer class="xgplayer-progress-outer">\n        <xg-progress-btn class="xgplayer-progress-btn"></xg-progress-btn>\n      </xg-outer>\n    </xg-progress>\n    `}}var Xn=Object.defineProperty,qn=(e,t,i)=>t in e?Xn(e,t,{enumerable:!0,configurable:!0,writable:!0,value:i}):e[t]=i,Qn=(e,t,i)=>(qn(e,"symbol"!==typeof t?t+"":t,i),i);class Zn extends Kt{constructor(){super(...arguments),Qn(this,"_onMouseenter",(e=>{this.emit("icon_mouseenter",{pluginName:this.pluginName})})),Qn(this,"_onMouseLeave",(e=>{this.emit("icon_mouseleave",{pluginName:this.pluginName})}))}afterCreate(){this.bind("mouseenter",this._onMouseenter),this.bind("mouseleave",this._onMouseLeave),this.config.disable&&this.disable()}destroy(){this.unbind("mouseenter",this._onMouseenter),this.unbind("mouseleave",this._onMouseLeave)}}class Jn extends Zn{static get pluginName(){return"play"}static get defaultConfig(){return{position:Ut.CONTROLS_LEFT,index:0,disable:!1}}afterCreate(){super.afterCreate();const{player:e,config:t}=this;t.disable||(this.initIcons(),this.btnClick=this.btnClick.bind(this),this.bind(["touchend","click"],this.btnClick),this.on([de,pe,Ce],(()=>{this.animate(e.paused)})),this.on(ce,(()=>{this.animate(e.paused)})),this.animate(!0))}registerIcons(){return{play:{icon:Bi,class:"xg-icon-play"},pause:{icon:Hi,class:"xg-icon-pause"}}}btnClick(e){e.preventDefault(),e.stopPropagation();const{player:t}=this;return this.emitUserAction(e,"switch_play_pause",{prop:"paused",from:t.paused,to:!t.paused}),t.ended?t.replay():t.paused?(t.play(),this.animate(!1)):(t.pause(),this.animate(!0)),!1}initIcons(){const{icons:e}=this;this.appendChild(".xgplayer-icon",e.play),this.appendChild(".xgplayer-icon",e.pause)}animate(e){if(!this.player)return;const{i18nKeys:t}=this,i=this.find(".xg-tips");e?(this.setAttr("data-state","pause"),i&&this.changeLangTextKey(i,t.PLAY_TIPS)):(this.setAttr("data-state","play"),i&&this.changeLangTextKey(i,t.PAUSE_TIPS))}destroy(){super.destroy(),this.unbind(["touchend","click"],this.btnClick)}render(){if(!this.config.disable)return`<xg-icon class="xgplayer-play">\n    <div class="xgplayer-icon">\n    </div>\n    ${Xi(this,"PLAY_TIPS",this.playerConfig.isHideTips)}\n    </xg-icon>`}}function es(){return(new DOMParser).parseFromString('<svg width="32px" height="40px" viewBox="0 0 32 32" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">\n    <g stroke="none" stroke-width="1" fill="none" fill-rule="evenodd">\n        <path d="M11.2374369,14 L17.6187184,7.61871843 C17.9604272,7.27700968 17.9604272,6.72299032 17.6187184,6.38128157 C17.2770097,6.03957281 16.7229903,6.03957281 16.3812816,6.38128157 L9.38128157,13.3812816 C9.03957281,13.7229903 9.03957281,14.2770097 9.38128157,14.6187184 L16.3812816,21.6187184 C16.7229903,21.9604272 17.2770097,21.9604272 17.6187184,21.6187184 C17.9604272,21.2770097 17.9604272,20.7229903 17.6187184,20.3812816 L11.2374369,14 L11.2374369,14 Z" fill="#FFFFFF"></path>\n    </g>\n</svg>',"image/svg+xml").firstChild}class ts extends Kt{static get pluginName(){return"topbackicon"}static get defaultConfig(){return{position:Ut.ROOT_TOP,index:0}}afterCreate(){this.initIcons(),this.onClick=e=>{e.preventDefault(),e.stopPropagation(),this.config.onClick(e)},this.bind(["click","touchend"],this.onClick)}registerIcons(){return{screenBack:{icon:es,class:"xg-fullscreen-back"}}}initIcons(){const{icons:e}=this;this.appendChild(this.root,e.screenBack)}show(){X.addClass(this.root,"show")}hide(){X.removeClass(this.root,"show")}render(){return'<xg-icon class="xgplayer-back">\n    </xg-icon>'}}function is(){return(new DOMParser).parseFromString('<svg xmlns="http://www.w3.org/2000/svg" width="28" height="40" viewBox="2 -4 28 40">\n  <path fill="#fff" transform="scale(0.0320625 0.0320625)" d="M598 214h212v212h-84v-128h-128v-84zM726 726v-128h84v212h-212v-84h128zM214 426v-212h212v84h-128v128h-84zM298 598v128h128v84h-212v-212h84z"></path>\n</svg>\n',"image/svg+xml").firstChild}function ns(){return(new DOMParser).parseFromString('<svg xmlns="http://www.w3.org/2000/svg" width="28" height="40" viewBox="2 -4 28 40">\n  <path fill="#fff" transform="scale(0.0320625 0.0320625)" d="M682 342h128v84h-212v-212h84v128zM598 810v-212h212v84h-128v128h-84zM342 342v-128h84v212h-212v-84h128zM214 682v-84h212v212h-84v-128h-128z"></path>\n</svg>\n',"image/svg+xml").firstChild}var ss=Object.defineProperty,rs=(e,t,i)=>t in e?ss(e,t,{enumerable:!0,configurable:!0,writable:!0,value:i}):e[t]=i,os=(e,t,i)=>(rs(e,"symbol"!==typeof t?t+"":t,i),i);class as extends Zn{constructor(){super(...arguments),os(this,"_onOrientationChange",(e=>{this.player.fullscreen&&this.config.rotateFullscreen&&(90===window.orientation||-90===window.orientation?this.player.setRotateDeg(0):this.player.setRotateDeg(90))}))}static get pluginName(){return"fullscreen"}static get defaultConfig(){return{position:Ut.CONTROLS_RIGHT,index:0,useCssFullscreen:!1,rotateFullscreen:!1,useScreenOrientation:!1,lockOrientationType:"landscape",switchCallback:null,target:null,disable:!1,needBackIcon:!1}}afterCreate(){super.afterCreate();const{config:e,playerConfig:t}=this;if(e.disable)return;e.target&&(this.playerConfig.fullscreenTarget=this.config.target);const i=X.getFullScreenEl();t.fullscreenTarget===i&&this.player.getFullscreen().catch((e=>{})),this.initIcons(),this.handleFullscreen=this.hook("fullscreenChange",this.toggleFullScreen,{pre:e=>{const{fullscreen:t}=this.player;this.emitUserAction(e,"switch_fullscreen",{prop:"fullscreen",from:t,to:!t})}}),this.bind(".xgplayer-fullscreen",["touchend","click"],this.handleFullscreen),this.on(We,(e=>{const t=this.find(".xg-tips");t&&this.changeLangTextKey(t,e?this.i18nKeys.EXITFULLSCREEN_TIPS:this.i18nKeys.FULLSCREEN_TIPS),this.animate(e)})),this.config.needBackIcon&&(this.topBackIcon=this.player.registerPlugin({plugin:ts,options:{config:{onClick:e=>{this.handleFullscreen(e)}}}})),"mobile"===se.device&&window.addEventListener("orientationchange",this._onOrientationChange)}registerIcons(){return{fullscreen:{icon:is,class:"xg-get-fullscreen"},exitFullscreen:{icon:ns,class:"xg-exit-fullscreen"}}}destroy(){super.destroy(),this.unbind(".xgplayer-icon","mobile"===se.device?"touchend":"click",this.handleFullscreen),"mobile"===se.device&&window.removeEventListener("orientationchange",this._onOrientationChange)}initIcons(){const{icons:e}=this;this.appendChild(".xgplayer-icon",e.fullscreen),this.appendChild(".xgplayer-icon",e.exitFullscreen)}toggleFullScreen(e){e&&(e.preventDefault(),e.stopPropagation());const{player:t,config:i}=this,n=!0===i.useCssFullscreen||"function"===typeof i.useCssFullscreen&&i.useCssFullscreen();n?(t.fullscreen?t.exitCssFullscreen():t.getCssFullscreen(),this.animate(t.fullscreen)):i.rotateFullscreen?(t.fullscreen?t.exitRotateFullscreen():t.getRotateFullscreen(),this.animate(t.fullscreen)):i.switchCallback&&"function"===typeof i.switchCallback?i.switchCallback(t.fullscreen):t.fullscreen?(t.exitFullscreen(),i.useScreenOrientation&&this.unlockScreen()):(t.getFullscreen().catch((e=>{})),i.useScreenOrientation&&t.aspectRatio>1&&this.lockScreen(i.lockOrientationType))}animate(e){e?this.setAttr("data-state","full"):this.setAttr("data-state","normal"),this.topBackIcon&&(e?(this.topBackIcon.show(),this.hide()):(this.topBackIcon.hide(),this.show()))}render(){if(this.config.disable)return;const e="FULLSCREEN_TIPS";return`<xg-icon class="xgplayer-fullscreen">\n    <div class="xgplayer-icon">\n    </div>\n    ${Xi(this,e,this.playerConfig.isHideTips)}\n    </xg-icon>`}lockScreen(e){try{screen.orientation.lock(e).catch((e=>{}))}catch(t){}}unlockScreen(){try{screen.orientation.unlock().catch((e=>{}))}catch(e){}}}class ls extends Kt{static get pluginName(){return"time"}static get defaultConfig(){return{position:Ut.CONTROLS_LEFT,index:2,disable:!1}}constructor(e){super(e),this.isActiving=!1}get duration(){const{offsetDuration:e,duration:t}=this.player;return this.playerConfig.customDuration||e||t}get currentTime(){const{offsetCurrentTime:e,currentTime:t}=this.player;return e>=0?e:t}get timeOffset(){return this.playerConfig.timeOffset||0}afterCreate(){const e=this.player.controls.config.mode;this.mode="flex"===e?"flex":"normal",this.config.disable||("flex"===this.mode&&(this.createCenterTime(),this.root.style.display="none"),this.durationDom=this.find(".time-duration"),this.timeDom=this.find(".time-current"),this.on([be,ge,me],(e=>{"durationchange"===e.eventName&&(this.isActiving=!1),this.onTimeUpdate()})),this.on(he,(()=>{this.onTimeUpdate(!0)})),this.on(Ce,(()=>{this.onReset()})))}show(e){if("flex"===this.mode)return this.centerCurDom&&(this.centerCurDom.style.display="block"),void(this.centerDurDom&&(this.centerDurDom.style.display="block"));this.root.style.display="block"}hide(){if("flex"===this.mode)return this.centerCurDom&&(this.centerCurDom.style.display="none"),void(this.centerDurDom&&(this.centerDurDom.style.display="none"));this.root.style.display="none"}onTimeUpdate(e){const{player:t,config:i,duration:n}=this;if(i.disable||this.isActiving||!t.hasStart)return;let s=this.currentTime+this.timeOffset;s=X.adjustTimeByDuration(s,n,e),"flex"===this.mode?(this.centerCurDom.innerHTML=this.minWidthTime(X.format(s)),n!==1/0&&n>0&&(this.centerDurDom.innerHTML=X.format(n))):(this.timeDom.innerHTML=this.minWidthTime(X.format(s)),n!==1/0&&n>0&&(this.durationDom.innerHTML=X.format(n)))}onReset(){"flex"===this.mode?(this.centerCurDom.innerHTML=this.minWidthTime(X.format(0)),this.centerDurDom.innerHTML=X.format(0)):(this.timeDom.innerHTML=this.minWidthTime(X.format(0)),this.durationDom.innerHTML=X.format(0))}createCenterTime(){const{player:e}=this;if(!e.controls||!e.controls.center)return;const t=e.controls.center;this.centerCurDom=X.createDom("xg-icon","00:00",{},"xgplayer-time xg-time-left"),this.centerDurDom=X.createDom("xg-icon","00:00",{},"xgplayer-time xg-time-right"),t.children.length>0?t.insertBefore(this.centerCurDom,t.children[0]):t.appendChild(this.centerCurDom),t.appendChild(this.centerDurDom)}afterPlayerInit(){const{config:e}=this;this.duration===1/0||this.playerConfig.isLive?(X.hide(this.durationDom),X.hide(this.timeDom),X.hide(this.find(".time-separator")),X.show(this.find(".time-live-tag"))):X.hide(this.find(".time-live-tag")),e.hide?this.hide():this.show()}changeLiveState(e){e?(X.hide(this.durationDom),X.hide(this.timeDom),X.hide(this.find(".time-separator")),X.show(this.find(".time-live-tag"))):(X.hide(this.find(".time-live-tag")),X.show(this.find(".time-separator")),X.show(this.durationDom),X.show(this.timeDom))}updateTime(e){this.isActiving=!0,!e&&0!==e||e>this.duration||("flex"!==this.mode?this.timeDom.innerHTML=this.minWidthTime(X.format(e)):this.centerCurDom.innerHTML=this.minWidthTime(X.format(e)))}minWidthTime(e){return e.split(":").map((e=>`<span class="time-min-width">${e}</span>`)).join(":")}resetActive(){const{player:e}=this,t=()=>{this.isActiving=!1};this.off(ge,t),e.isSeeking&&e.media.seeking?this.once(ge,t):this.isActiving=!1}destroy(){const{center:e}=this.player.controls;this.centerCurDom&&e.removeChild(this.centerCurDom),this.centerCurDom=null,this.centerDurDom&&e.removeChild(this.centerDurDom),this.centerDurDom=null}render(){if(!this.config.disable)return`<xg-icon class="xgplayer-time">\n    <span class="time-current">00:00</span>\n    <span class="time-separator">/</span>\n    <span class="time-duration">00:00</span>\n    <span class="time-live-tag">${this.i18n.LIVE_TIP}</span>\n    </xg-icon>`}}var cs=Object.defineProperty,us=(e,t,i)=>t in e?cs(e,t,{enumerable:!0,configurable:!0,writable:!0,value:i}):e[t]=i,hs=(e,t,i)=>(us(e,"symbol"!==typeof t?t+"":t,i),i);class ds extends Ot{constructor(){super(...arguments),hs(this,"_onDurationChange",(()=>{this.updateSegments();const{currentTime:e,timeSegments:t}=this.player;if(!this._checkIfEnabled(t))return;const i=X.getIndexByTime(e,t),n=X.getOffsetCurrentTime(e,t,i);this.player.offsetCurrentTime=n,this.changeIndex(i,t)})),hs(this,"_onLoadedData",(()=>{const{timeSegments:e}=this.player;if(!this._checkIfEnabled(e))return;const t=X.getOffsetCurrentTime(0,e);this.player.offsetCurrentTime=t,this.changeIndex(0,e),this.curPos.start>0&&(this.player.currentTime=this.curPos.start)})),hs(this,"_onTimeupdate",(()=>{const{currentTime:e,timeSegments:t}=this.player;if(!this._checkIfEnabled(t))return;const i=t.length;this.lastCurrentTime=e;const n=X.getIndexByTime(e,t);n!==this.curIndex&&this.changeIndex(n,t);const s=X.getOffsetCurrentTime(e,t,n);if(this.player.offsetCurrentTime=s,!this.curPos)return;const{start:r,end:o}=this.curPos;e<r?this.player.currentTime=r:e>o&&n>=i-1&&this.player.pause()})),hs(this,"_onSeeking",(()=>{const{currentTime:e,timeSegments:t}=this.player;if(this._checkIfEnabled(t))if(e<t[0].start)this.player.currentTime=t[0].start;else if(e>t[t.length-1].end)this.player.currentTime=t[t.length-1].end;else{const i=X.getIndexByTime(e,t);if(i>=0){const n=this.getSeekTime(e,this.lastCurrentTime,i,t);n>=0&&(this.player.currentTime=n)}}})),hs(this,"_onPlay",(()=>{const{currentTime:e,timeSegments:t}=this.player;this._checkIfEnabled(t)&&e>=t[t.length-1].end&&(this.player.currentTime=t[0].start)}))}static get pluginName(){return"TimeSegmentsControls"}static get defaultConfig(){return{disable:!0,segments:[]}}afterCreate(){this.curIndex=-1,this.curPos=null,this.lastCurrentTime=0,this.updateSegments(),this.on(be,this._onDurationChange),this.on(Ee,this._onLoadedData),this.on(me,this._onTimeupdate),this.on(fe,this._onSeeking),this.on(ce,this._onPlay)}setConfig(e){if(!e)return;const t=Object.keys(e);t.length<1||(t.forEach((t=>{this.config[t]=e[t]})),this.updateSegments())}updateSegments(){const{disable:e,segments:t}=this.config,{player:i}=this;if(e||!t||0===t.length)i.timeSegments=[],i.offsetDuration=0,i.offsetCurrentTime=-1;else{const e=this.formatTimeSegments(t,i.duration);i.timeSegments=e,i.offsetDuration=e.length>0?e[e.length-1].duration:0}}formatTimeSegments(e,t){const i=[];return e?(e.sort(((e,t)=>e.start-t.start)),e.forEach(((e,n)=>{const s={};if(s.start=e.start<0?0:e.start,s.end=t>0&&e.end>t?t:e.end,t>0&&s.start>t)return;i.push(s);const r=s.end-s.start;if(0===n)s.offset=e.start,s.cTime=0,s.segDuration=r,s.duration=r;else{const e=i[n-1];s.offset=e.offset+(s.start-e.end),s.cTime=e.duration+e.cTime,s.segDuration=r,s.duration=e.duration+r}})),i):[]}getSeekTime(e,t,i,n){let s=-1;const{start:r,end:o}=n[i];if(e>=r&&e<=o)return s;const a=e-t;if(a<0&&e<r){const e=t>r?t-r:0;return s=i-1>=0?n[i-1].end+a+e:0,s}return-1}_checkIfEnabled(e){return!(!e||e.length<1)}changeIndex(e,t){this.curIndex=e,e>=0&&t.length>0?this.curPos=t[e]:this.curPos=null}}function ps(){return(new DOMParser).parseFromString('<svg xmlns="http://www.w3.org/2000/svg" width="28" height="40" viewBox="0 -10 28 40">\n  <path fill="#fff" transform="scale(0.0220625 0.0220625)" d="M358.4 358.4h-204.8v307.2h204.8l256 256v-819.2l-256 256z"></path>\n  <path fill="#fff" transform="scale(0.0220625 0.0220625)" d="M940.632 837.632l-72.192-72.192c65.114-64.745 105.412-154.386 105.412-253.44s-40.299-188.695-105.396-253.424l-0.016-0.016 72.192-72.192c83.639 83.197 135.401 198.37 135.401 325.632s-51.762 242.434-135.381 325.612l-0.020 0.020zM795.648 693.248l-72.704-72.704c27.756-27.789 44.921-66.162 44.921-108.544s-17.165-80.755-44.922-108.546l0.002 0.002 72.704-72.704c46.713 46.235 75.639 110.363 75.639 181.248s-28.926 135.013-75.617 181.227l-0.021 0.021z"></path>\n</svg>\n',"image/svg+xml").firstChild}function fs(){return(new DOMParser).parseFromString('<svg xmlns="http://www.w3.org/2000/svg" width="28" height="40" viewBox="0 -10 28 40">\n  <path fill="#fff" transform="scale(0.0220625 0.0220625)" d="M358.4 358.4h-204.8v307.2h204.8l256 256v-819.2l-256 256z"></path>\n  <path fill="#fff" transform="scale(0.0220625 0.0220625)" d="M795.648 693.248l-72.704-72.704c27.756-27.789 44.921-66.162 44.921-108.544s-17.165-80.755-44.922-108.546l0.002 0.002 72.704-72.704c46.713 46.235 75.639 110.363 75.639 181.248s-28.926 135.013-75.617 181.227l-0.021 0.021zM795.648 693.248l-72.704-72.704c27.756-27.789 44.921-66.162 44.921-108.544s-17.165-80.755-44.922-108.546l0.002 0.002 72.704-72.704c46.713 46.235 75.639 110.363 75.639 181.248s-28.926 135.013-75.617 181.227l-0.021 0.021z"></path>\n</svg>\n',"image/svg+xml").firstChild}function gs(){return(new DOMParser).parseFromString('<svg xmlns="http://www.w3.org/2000/svg" width="28" height="40" viewBox="0 -10 28 40">\n  <path fill="#fff" transform="scale(0.0220625 0.0220625)" d="M358.4 358.4h-204.8v307.2h204.8l256 256v-819.2l-256 256z"></path>\n  <path fill="#fff" transform="scale(0.0220625 0.0220625)" d="M920.4 439.808l-108.544-109.056-72.704 72.704 109.568 108.544-109.056 108.544 72.704 72.704 108.032-109.568 108.544 109.056 72.704-72.704-109.568-108.032 109.056-108.544-72.704-72.704-108.032 109.568z"></path>\n</svg>\n',"image/svg+xml").firstChild}var ms=Object.defineProperty,vs=(e,t,i)=>t in e?ms(e,t,{enumerable:!0,configurable:!0,writable:!0,value:i}):e[t]=i,ys=(e,t,i)=>(vs(e,"symbol"!==typeof t?t+"":t,i),i);class _s extends Kt{constructor(){super(...arguments),ys(this,"onBarMousedown",(e=>{const{player:t}=this,i=this.find(".xgplayer-bar");X.event(e);const n=i.getBoundingClientRect(),s=X.getEventPos(e,t.zoom),r=n.height-(s.clientY-n.top);if(s.h=r,s.barH=n.height,this.pos=s,!(r<-2))return this.updateVolumePos(r,e),document.addEventListener("mouseup",this.onBarMouseUp),this._d.isStart=!0,!1})),ys(this,"onBarMouseMove",(e=>{const{_d:t}=this;if(!t.isStart)return;const{pos:i,player:n}=this;e.preventDefault(),e.stopPropagation(),X.event(e);const s=X.getEventPos(e,n.zoom);t.isMoving=!0;const r=i.h-s.clientY+i.clientY;r>i.barH||this.updateVolumePos(r,e)})),ys(this,"onBarMouseUp",(e=>{X.event(e),document.removeEventListener("mouseup",this.onBarMouseUp);const{_d:t}=this;t.isStart=!1,t.isMoving=!1})),ys(this,"onMouseenter",(e=>{this._d.isActive=!0,this.focus(),this.emit("icon_mouseenter",{pluginName:this.pluginName})})),ys(this,"onMouseleave",(e=>{this._d.isActive=!1,this.unFocus(100,!1,e),this.emit("icon_mouseleave",{pluginName:this.pluginName})})),ys(this,"onVolumeChange",(e=>{if(!this.player)return;const{muted:t,volume:i}=this.player;this._d.isMoving||(this.find(".xgplayer-drag").style.height=t||0===i?"4px":100*i+"%",this.config.showValueLabel&&this.updateVolumeValue()),this.animate(t,i)}))}static get pluginName(){return"volume"}static get defaultConfig(){return{position:Ut.CONTROLS_RIGHT,index:1,disable:!1,showValueLabel:!1,default:.6,miniVolume:.2}}registerIcons(){return{volumeSmall:{icon:fs,class:"xg-volume-small"},volumeLarge:{icon:ps,class:"xg-volume"},volumeMuted:{icon:gs,class:"xg-volume-mute"}}}afterCreate(){if(this._timerId=null,this._d={isStart:!1,isMoving:!1,isActive:!1},this.config.disable)return;this.initIcons();const{commonStyle:e,volume:t}=this.playerConfig;e.volumeColor&&(this.find(".xgplayer-drag").style.backgroundColor=e.volumeColor),this.changeMutedHandler=this.hook("mutedChange",(e=>{this.changeMuted(e)}),{pre:e=>{e.preventDefault(),e.stopPropagation()}}),this._onMouseenterHandler=this.hook("mouseenter",this.onMouseenter),this._onMouseleaveHandler=this.hook("mouseleave",this.onMouseleave),"mobile"!==se.device&&"mobile"!==this.playerConfig.isMobileSimulateMode&&(this.bind("mouseenter",this._onMouseenterHandler),this.bind(["blur","mouseleave"],this._onMouseleaveHandler),this.bind(".xgplayer-slider","mousedown",this.onBarMousedown),this.bind(".xgplayer-slider","mousemove",this.onBarMouseMove),this.bind(".xgplayer-slider","mouseup",this.onBarMouseUp)),this.bind(".xgplayer-icon",["touchend","click"],this.changeMutedHandler),this.on(Se,this.onVolumeChange),this.once(Ee,this.onVolumeChange),"Number"!==X.typeOf(t)&&(this.player.volume=this.config.default),this.onVolumeChange()}updateVolumePos(e,t){const{player:i}=this,n=this.find(".xgplayer-drag"),s=this.find(".xgplayer-bar");if(!s||!n)return;const r=parseInt(e/s.getBoundingClientRect().height*1e3,10);n.style.height=`${e}px`;const o=Math.max(Math.min(r/1e3,1),0),a={volume:{from:i.volume,to:o}};i.muted&&(a.muted={from:!0,to:!1}),this.emitUserAction(t,"change_volume",{muted:i.muted,volume:i.volume,props:a}),i.volume=Math.max(Math.min(r/1e3,1),0),i.muted&&(i.muted=!1),this.config.showValueLabel&&this.updateVolumeValue()}updateVolumeValue(){const{volume:e,muted:t}=this.player,i=this.find(".xgplayer-value-label"),n=Math.max(Math.min(e,1),0);i.innerText=t?0:Math.ceil(100*n)}focus(){const{player:e}=this;e.focus({autoHide:!1}),this._timerId&&(X.clearTimeout(this,this._timerId),this._timerId=null),X.addClass(this.root,"slide-show")}unFocus(e=100,t=!0,i){const{_d:n,player:s}=this;n.isActive||(this._timerId&&(X.clearTimeout(this,this._timerId),this._timerId=null),this._timerId=X.setTimeout(this,(()=>{n.isActive||(t?s.blur():s.focus(),X.removeClass(this.root,"slide-show"),n.isStart&&this.onBarMouseUp(i)),this._timerId=null}),e))}changeMuted(e){e&&e.stopPropagation();const{player:t,_d:i}=this;i.isStart&&this.onBarMouseUp(e),this.emitUserAction(e,"change_muted",{muted:t.muted,volume:t.volume,props:{muted:{from:t.muted,to:!t.muted}}}),t.volume>0&&(t.muted=!t.muted),t.volume<.01&&(t.volume=this.config.miniVolume)}animate(e,t){e||0===t?this.setAttr("data-state","mute"):t<.5&&this.icons.volumeSmall?this.setAttr("data-state","small"):this.setAttr("data-state","normal")}initIcons(){const{icons:e}=this;this.appendChild(".xgplayer-icon",e.volumeSmall),this.appendChild(".xgplayer-icon",e.volumeLarge),this.appendChild(".xgplayer-icon",e.volumeMuted)}destroy(){this._timerId&&(X.clearTimeout(this,this._timerId),this._timerId=null),this.unbind("mouseenter",this.onMouseenter),this.unbind(["blur","mouseleave"],this.onMouseleave),this.unbind(".xgplayer-slider","mousedown",this.onBarMousedown),this.unbind(".xgplayer-slider","mousemove",this.onBarMouseMove),this.unbind(".xgplayer-slider","mouseup",this.onBarMouseUp),document.removeEventListener("mouseup",this.onBarMouseUp),this.unbind(".xgplayer-icon","mobile"===se.device?"touchend":"click",this.changeMutedHandler)}render(){if(this.config.disable)return;const e=this.config.default||this.player.volume,t=this.config.showValueLabel;return`\n    <xg-icon class="xgplayer-volume" data-state="normal">\n      <div class="xgplayer-icon">\n      </div>\n      <xg-slider class="xgplayer-slider">\n        ${t?`<div class="xgplayer-value-label">${100*e}</div>`:""}\n        <div class="xgplayer-bar">\n          <xg-drag class="xgplayer-drag" style="height: ${100*e}%"></xg-drag>\n        </div>\n      </xg-slider>\n    </xg-icon>`}}function bs(){return(new DOMParser).parseFromString('<svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="-4 -6 40 40" fill="none">\n  <g clip-path="url(#clip0)">\n    <path transform="scale(1.5 1.5)" d="M11.6665 9.16663H4.1665C2.78579 9.16663 1.6665 10.2859 1.6665 11.6666V15.8333C1.6665 17.214 2.78579 18.3333 4.1665 18.3333H11.6665C13.0472 18.3333 14.1665 17.214 14.1665 15.8333V11.6666C14.1665 10.2859 13.0472 9.16663 11.6665 9.16663Z" fill="white"/>\n    <path transform="scale(1.5 1.5)" fill-rule="evenodd" clip-rule="evenodd" d="M3.88148 4.06298C3.75371 4.21005 3.67667 4.40231 3.67749 4.61242C3.67847 4.87253 3.79852 5.10435 3.98581 5.25646L6.99111 8.05895C7.32771 8.37283 7.85502 8.35443 8.16891 8.01782C8.48279 7.68122 8.46437 7.15391 8.12778 6.84003L6.62061 5.43457L9.8198 5.4224C9.82848 5.42239 9.8372 5.42221 9.84591 5.4219C10.9714 5.38233 12.0885 5.6285 13.0931 6.13744C14.0976 6.64635 14.957 7.40148 15.5908 8.33234C16.2246 9.2632 16.6122 10.3394 16.7177 11.4606C16.823 12.5819 16.6427 13.7115 16.1934 14.7442C16.0098 15.1661 16.203 15.6571 16.6251 15.8408C17.0471 16.0243 17.5381 15.8311 17.7216 15.4091C18.2833 14.1183 18.5087 12.7063 18.3771 11.3047C18.2453 9.90318 17.7607 8.55792 16.9684 7.39433C16.1761 6.23073 15.1021 5.28683 13.8463 4.65065C12.5946 4.01651 11.203 3.70872 9.80072 3.75583L6.43415 3.76862L7.96326 2.12885C8.27715 1.79225 8.25872 1.26494 7.92213 0.951061C7.58553 0.63718 7.05822 0.655585 6.74433 0.99219L3.90268 4.0395C3.89545 4.04724 3.88841 4.05509 3.88154 4.06303L3.88148 4.06298Z" fill="white"/>\n  </g>\n  <defs>\n    <clipPath id="clip0">\n      <rect width="40" height="40" fill="white"/>\n    </clipPath>\n  </defs>\n</svg>\n',"image/svg+xml").firstChild}class Ss extends Zn{static get pluginName(){return"rotate"}static get defaultConfig(){return{position:Ut.CONTROLS_RIGHT,index:6,innerRotate:!0,clockwise:!1,rotateDeg:0,disable:!1}}constructor(e){super(e),this.rotateDeg=this.config.rotateDeg||0}afterCreate(){if(this.config.disable)return;super.afterCreate(),this.appendChild(".xgplayer-icon",this.icons.rotate),this.onBtnClick=this.onBtnClick.bind(this),this.bind(".xgplayer-icon",["click","touchend"],this.onBtnClick),this.on(et,(()=>{this.rotateDeg&&this.config.innerRotate&&X.setTimeout(this,(()=>{this.updateRotateDeg(this.rotateDeg,this.config.innerRotate)}),100)}));const e=this.player.root;this.rootWidth=e.style.width||e.offsetWidth||e.clientWidth,this.rootHeight=e.style.height||e.offsetHeight||e.clientHeight,this.rotateDeg&&this.updateRotateDeg(this.rotateDeg,this.config.innerRotate)}destroy(){super.destroy(),this.unbind(".xgplayer-icon",["click","touchend"],this.onBtnClick)}onBtnClick(e){e.preventDefault(),e.stopPropagation(),this.emitUserAction(e,"rotate"),this.rotate(this.config.clockwise,this.config.innerRotate,1)}updateRotateDeg(e,t){if(e||(e=0),t)return void(this.player.videoRotateDeg=e);const{player:i,rootWidth:n,rootHeight:s}=this,{root:r,innerContainer:o}=i,a=i.media,l=r.offsetWidth,c=o&&t?o.offsetHeight:r.offsetHeight;let u=n,h=s,d=0,p=0;.75!==e&&.25!==e||(u=`${c}px`,h=`${l}px`,d=-(c-l)/2,p=-(l-c)/2);const f=`translate(${d}px,${p}px) rotate(${e}turn)`,g={transformOrigin:"center center",transform:f,webKitTransform:f,height:h,width:u},m=t?a:r,v=t?i.getPlugin("poster"):null;Object.keys(g).map((e=>{m.style[e]=g[e],v&&v.root&&(v.root.style[e]=g[e])}))}rotate(e=!1,t=!0,i=1){const n=this.player;this.rotateDeg||(this.rotateDeg=0);const s=e?1:-1;this.rotateDeg=(this.rotateDeg+1+.25*s*i)%1,this.updateRotateDeg(this.rotateDeg,t),n.emit(it,360*this.rotateDeg)}registerIcons(){return{rotate:bs}}render(){if(!this.config.disable)return`\n    <xg-icon class="xgplayer-rotate">\n      <div class="xgplayer-icon">\n      </div>\n      ${Xi(this,"ROTATE_TIPS",this.playerConfig.isHideTips)}\n    </xg-icon>`}}function Es(){return(new DOMParser).parseFromString('<svg width="20" height="20" viewBox="0 0 20 20" fill="none" xmlns="http://www.w3.org/2000/svg">\n  <path fill-rule="evenodd" clip-rule="evenodd"\n    d="M16.5 4.3H3.5C3.38954 4.3 3.3 4.38954 3.3 4.5V15.5C3.3 15.6105 3.38954 15.7 3.5 15.7H8.50005L8.50006 17.5H3.5C2.39543 17.5 1.5 16.6046 1.5 15.5V4.5C1.5 3.39543 2.39543 2.5 3.5 2.5H16.5C17.6046 2.5 18.5 3.39543 18.5 4.5V8.5H16.7V4.5C16.7 4.38954 16.6105 4.3 16.5 4.3ZM12 11.5C11.4477 11.5 11 11.9477 11 12.5L11 16.5C11 17.0523 11.4478 17.5 12 17.5H17.5C18.0523 17.5 18.5 17.0523 18.5 16.5L18.5 12.5C18.5 11.9477 18.0523 11.5 17.5 11.5H12Z"\n    fill="white" />\n</svg>',"image/svg+xml").firstChild}function Ts(){return(new DOMParser).parseFromString('<svg width="20" height="20" viewBox="0 0 20 20" fill="none" xmlns="http://www.w3.org/2000/svg">\n  <path fill-rule="evenodd" clip-rule="evenodd"\n    d="M16.5 4.3H3.5C3.38954 4.3 3.3 4.38954 3.3 4.5V15.5C3.3 15.6105 3.38954 15.7 3.5 15.7H8.50005L8.50006 17.5H3.5C2.39543 17.5 1.5 16.6046 1.5 15.5V4.5C1.5 3.39543 2.39543 2.5 3.5 2.5H16.5C17.6046 2.5 18.5 3.39543 18.5 4.5V8.5H16.7V4.5C16.7 4.38954 16.6105 4.3 16.5 4.3ZM12 11.5C11.4477 11.5 11 11.9477 11 12.5L11 16.5C11 17.0523 11.4478 17.5 12 17.5H17.5C18.0523 17.5 18.5 17.0523 18.5 16.5L18.5 12.5C18.5 11.9477 18.0523 11.5 17.5 11.5H12Z"\n    fill="white" />\n  <path fill-rule="evenodd" clip-rule="evenodd"\n    d="M9.4998 7.7C9.77595 7.7 9.9998 7.47614 9.9998 7.2V6.5C9.9998 6.22386 9.77595 6 9.4998 6H5.5402L5.52754 6.00016H5.5C5.22386 6.00016 5 6.22401 5 6.50016V10.4598C5 10.7359 5.22386 10.9598 5.5 10.9598H6.2C6.47614 10.9598 6.7 10.7359 6.7 10.4598V8.83005L8.76983 10.9386C8.96327 11.1357 9.27984 11.1386 9.47691 10.9451L9.97645 10.4548C10.1735 10.2613 10.1764 9.94476 9.983 9.7477L7.97289 7.7H9.4998Z"\n    fill="white" />\n</svg>',"image/svg+xml").firstChild}var ks=Object.defineProperty,ws=(e,t,i)=>t in e?ks(e,t,{enumerable:!0,configurable:!0,writable:!0,value:i}):e[t]=i,xs=(e,t,i)=>(ws(e,"symbol"!==typeof t?t+"":t,i),i);const Cs={PIP:"picture-in-picture",INLINE:"inline",FULLSCREEN:"fullscreen"};class As extends Zn{constructor(){super(...arguments),xs(this,"switchPIP",(e=>{if(!this.isPIPAvailable())return!1;e.stopPropagation&&e.stopPropagation(),this.isPip?(this.exitPIP(),this.emitUserAction(e,"change_pip",{props:"pip",from:!0,to:!1}),this.setAttr("data-state","normal")):4===this.player.media.readyState&&(this.requestPIP(),this.emitUserAction(e,"change_pip",{props:"pip",from:!1,to:!0}),this.setAttr("data-state","pip"))}))}static get pluginName(){return"pip"}static get defaultConfig(){return{position:Ut.CONTROLS_RIGHT,index:6,showIcon:!1,preferDocument:!1,width:void 0,height:void 0,docPiPNode:void 0,docPiPStyle:void 0}}static checkWebkitSetPresentationMode(e){return"function"===typeof e.webkitSetPresentationMode}beforeCreate(e){"boolean"===typeof e.player.config.pip&&(e.config.showIcon=e.player.config.pip)}afterCreate(){this.isPIPAvailable()&&(super.afterCreate(),this.pMode=Cs.INLINE,this.initPipEvents(),this.config.showIcon&&this.initIcons(),this.once(Fe,(()=>{this.config.showIcon&&(X.removeClass(this.find(".xgplayer-icon"),"xg-icon-disable"),this.bind("click",this.switchPIP))})))}registerIcons(){return{pipIcon:{icon:Es,class:"xg-get-pip"},pipIconExit:{icon:Ts,class:"xg-exit-pip"}}}initIcons(){const{icons:e}=this;this.appendChild(".xgplayer-icon",e.pipIcon),this.appendChild(".xgplayer-icon",e.pipIconExit)}initPipEvents(){const{player:e}=this;this.leavePIPCallback=()=>{const t=e.paused;X.setTimeout(this,(()=>{!t&&e.mediaPlay()}),0),!t&&e.mediaPlay(),this.setAttr("data-state","normal"),this.pipWindow=null,e.emit(tt,!1)},this.enterPIPCallback=t=>{e.emit(tt,!0),(null==t?void 0:t.pictureInPictureWindow)&&(this.pipWindow=t.pictureInPictureWindow),this.setAttr("data-state","pip")},this.onWebkitpresentationmodechanged=t=>{const i=e.media.webkitPresentationMode;this.pMode===Cs.FULLSCREEN&&i!==Cs.FULLSCREEN&&e.onFullscreenChange(null,!1),this.pMode=i,i===Cs.PIP?this.enterPIPCallback(t):i===Cs.INLINE&&this.leavePIPCallback(t)},e.media&&(e.media.addEventListener("enterpictureinpicture",this.enterPIPCallback),e.media.addEventListener("leavepictureinpicture",this.leavePIPCallback),As.checkWebkitSetPresentationMode(e.media)&&e.media.addEventListener("webkitpresentationmodechanged",this.onWebkitpresentationmodechanged))}copyStyleIntoPiPWindow(e){const t=[...document.styleSheets].map((t=>{try{return[...t.cssRules].map((e=>e.cssText)).join("")}catch(i){const n=document.createElement("link");n.rel="stylesheet",n.type=t.type,n.media=t.media,n.href=t.href,e.document.head.appendChild(n)}return""})).filter(Boolean).join("\n"),i=document.createElement("style");i.textContent=t,e.document.head.appendChild(i)}requestPIP(){const{player:e,playerConfig:t,config:i}=this;if(this.isPIPAvailable()&&!this.isPip)try{const{poster:n}=t;if(n&&(e.media.poster="String"===X.typeOf(n)?n:n.poster),i.preferDocument&&this.isDocPIPAvailable()){const t={};if(i.width&&i.height)t.width=i.width,t.height=i.height;else{const i=e.root.getBoundingClientRect();t.width=i.width,t.height=i.height}documentPictureInPicture.requestWindow(t).then((t=>{const{docPiPNode:n,docPiPStyle:s}=i;this.enterPIPCallback();const r=n||e.root,o=r.parentElement,a=r.previousSibling,l=r.nextSibling;this.copyStyleIntoPiPWindow(t);const c=document.createElement("style");if(c.append("body{padding:0; margin:0;}"),s){let e="";"string"===typeof s?e=s:"function"===typeof s&&(e=s.call(i)),e&&c.append(e)}else r===e.root&&c.append("\n              .xgplayer{width: 100%!important; height: 100%!important;}\n            ");t.document.head.append(c),t.document.body.append(r),t.addEventListener("pagehide",(e=>{o&&(l?o.insertBefore(r,l):a?o.insertBefore(r,a.nextSibling):o.appendChild(r)),this.leavePIPCallback()}),{once:!0})}))}else As.checkWebkitSetPresentationMode(e.media)?e.media.webkitSetPresentationMode("picture-in-picture"):e.media.requestPictureInPicture();return!0}catch(n){return console.error("requestPiP",n),!1}}exitPIP(){const{player:e}=this;try{return this.isPIPAvailable()&&this.isPip&&(this.isDocPIPAvailable()&&(null==documentPictureInPicture?void 0:documentPictureInPicture.window)?documentPictureInPicture.window.close():As.checkWebkitSetPresentationMode(e.media)?e.media.webkitSetPresentationMode("inline"):document.exitPictureInPicture()),!0}catch(t){return console.error("exitPIP",t),!1}}get isPip(){const{player:e}=this;return!(!this.isDocPIPAvailable()||!(null==documentPictureInPicture?void 0:documentPictureInPicture.window))||document.pictureInPictureElement&&document.pictureInPictureElement===e.media||e.media.webkitPresentationMode===Cs.PIP}isPIPAvailable(){const e=this.player.media,t="Boolean"!==X.typeOf(document.pictureInPictureEnabled)||document.pictureInPictureEnabled;return t&&("Boolean"===X.typeOf(e.disablePictureInPicture)&&!e.disablePictureInPicture||e.webkitSupportsPresentationMode&&"Function"===X.typeOf(e.webkitSetPresentationMode))||this.isDocPIPAvailable()}isDocPIPAvailable(){return"documentPictureInPicture"in window&&/^(https|file)/.test(location.protocol)}destroy(){super.destroy();const{player:e}=this;e.media.removeEventListener("enterpictureinpicture",this.enterPIPCallback),e.media.removeEventListener("leavepictureinpicture",this.leavePIPCallback),As.checkWebkitSetPresentationMode(e.media)&&e.media.removeEventListener("webkitpresentationmodechanged",this.onWebkitpresentationmodechanged),this.exitPIP(),this.unbind("click",this.btnClick)}render(){if(this.config.showIcon&&this.isPIPAvailable())return`<xg-icon class="xgplayer-pip">\n      <div class="xgplayer-icon xg-icon-disable">\n      </div>\n      ${Xi(this,"PIP",this.playerConfig.isHideTips)}\n    </xg-icon>`}}function Ps(){return(new DOMParser).parseFromString('<svg xmlns="http://www.w3.org/2000/svg" width="24" height="40" viewBox="10 0 24 40">\n  <path transform="scale(0.038 0.028)" d="M800 380v768h-128v-352l-320 320v-704l320 320v-352z"></path>\n</svg>\n',"image/svg+xml").firstChild}var Is=Object.defineProperty,Ds=(e,t,i)=>t in e?Is(e,t,{enumerable:!0,configurable:!0,writable:!0,value:i}):e[t]=i,Ls=(e,t,i)=>(Ds(e,"symbol"!==typeof t?t+"":t,i),i);class Os extends Kt{constructor(e){super(e),Ls(this,"playNext",(e=>{const{player:t}=this;e.preventDefault(),e.stopPropagation(),this.idx+1<this.config.urlList.length?(this.idx++,this.nextHandler(this.config.urlList[this.idx],this.idx),t.emit(st,this.idx+1)):(this.nextHandler(),t.emit(st))})),this.idx=-1}static get pluginName(){return"playNext"}static get defaultConfig(){return{position:Ut.CONTROLS_LEFT,index:1,url:null,urlList:[]}}afterCreate(){this.config.urlList&&0!==this.config.urlList.length&&(this.appendChild(".xgplayer-icon",this.icons.playNext),this.initEvents())}registerIcons(){return{playNext:Ps}}initEvents(){this.nextHandler=this.hook("nextClick",this.changeSrc);const e="mobile"===se.device?"touchend":"click";this.bind(e,this.playNext),this.show()}changeSrc(e){const{player:t}=this;e&&(t.pause(),t.currentTime=0,t.switchURL?t.switchURL(e):t.src=e,t.config.url=e,t.play())}destroy(){this.unbind(["touchend","click"],this.playNext)}render(){if(this.config.urlList&&0!==this.config.urlList.length)return`\n     <xg-icon class="xgplayer-playnext">\n      <div class="xgplayer-icon">\n      </div>\n      ${Xi(this,"PLAYNEXT_TIPS",this.playerConfig.isHideTips)}\n     </xg-icon>\n    `}}var Rs=i(5753),Ms=i.n(Rs);function Ns(){return(new DOMParser).parseFromString('<svg xmlns="http://www.w3.org/2000/svg" width="24px" height="24px" viewBox="0 0 24 24">\n  <g id="Page-1" stroke="none" stroke-width="1" fill="none" fill-rule="evenodd">\n    <g transform="translate(-488.000000, -340.000000)" fill="#FFFFFF">\n      <g id="Group-2">\n        <g id="volme_big-copy" transform="translate(488.000000, 340.000000)">\n          <rect id="Rectangle-18" x="11" y="4" width="2" height="12" rx="1"></rect>\n          <rect id="Rectangle-2" x="3" y="18" width="18" height="2" rx="1"></rect>\n          <rect id="Rectangle-2" transform="translate(4.000000, 17.500000) rotate(90.000000) translate(-4.000000, -17.500000) " x="1.5" y="16.5" width="5" height="2" rx="1"></rect><rect id="Rectangle-2-Copy-3" transform="translate(20.000000, 17.500000) rotate(90.000000) translate(-20.000000, -17.500000) " x="17.5" y="16.5" width="5" height="2" rx="1"></rect>\n          <path d="M9.48791171,8.26502656 L9.48791171,14.2650266 C9.48791171,14.8173113 9.04019646,15.2650266 8.48791171,15.2650266 C7.93562696,15.2650266 7.48791171,14.8173113 7.48791171,14.2650266 L7.48791171,7.26502656 C7.48791171,6.71274181 7.93562696,6.26502656 8.48791171,6.26502656 L15.4879117,6.26502656 C16.0401965,6.26502656 16.4879117,6.71274181 16.4879117,7.26502656 C16.4879117,7.81731131 16.0401965,8.26502656 15.4879117,8.26502656 L9.48791171,8.26502656 Z" id="Combined-Shape" transform="translate(11.987912, 10.765027) scale(1, -1) rotate(45.000000) translate(-11.987912, -10.765027) "></path>\n        </g>\n      </g>\n    </g>\n  </g>\n</svg>\n',"image/svg+xml").firstChild}var Us=Object.defineProperty,Fs=(e,t,i)=>t in e?Us(e,t,{enumerable:!0,configurable:!0,writable:!0,value:i}):e[t]=i,Bs=(e,t,i)=>(Fs(e,"symbol"!==typeof t?t+"":t,i),i);class Hs extends Zn{constructor(e){super(e),Bs(this,"download",(e=>{if(this.isLock)return;this.emitUserAction(e,"download");const{url:t}=this.playerConfig;let i="";"String"===X.typeOf(t)?i=t:"Array"===X.typeOf(t)&&t.length>0&&(i=t[0].src);const n=this.getAbsoluteURL(i);Ms()(n),this.isLock=!0,this.timer=window.setTimeout((()=>{this.isLock=!1,window.clearTimeout(this.timer),this.timer=null}),300)})),this.timer=null,this.isLock=!1}static get pluginName(){return"download"}static get defaultConfig(){return{position:Ut.CONTROLS_RIGHT,index:3,disable:!0}}afterCreate(){super.afterCreate(),this.config.disable||(this.appendChild(".xgplayer-icon",this.icons.download),this._handler=this.hook("click",this.download,{pre:e=>{e.preventDefault(),e.stopPropagation()}}),this.bind(["click","touchend"],this._handler))}registerIcons(){return{download:Ns}}getAbsoluteURL(e){if(!e.match(/^https?:\/\//)){const t=document.createElement("div");t.innerHTML=`<a href="${e}">x</a>`,e=t.firstChild.href}return e}destroy(){super.destroy(),this.unbind(["click","touchend"],this.download),window.clearTimeout(this.timer),this.timer=null}render(){if(!this.config.disable)return`<xg-icon class="xgplayer-download">\n   <div class="xgplayer-icon">\n   </div>\n   ${Xi(this,"DOWNLOAD_TIPS",this.playerConfig.isHideTips)}\n    </xg-icon>`}}class js extends Zn{static get pluginName(){return"screenShot"}static get defaultConfig(){return{position:Ut.CONTROLS_RIGHT,index:5,quality:.92,type:"image/png",format:".png",width:600,height:337,saveImg:!0,fitVideo:!0,disable:!1,name:"screenshot"}}beforeCreate(e){"boolean"===typeof e.player.config.screenShot&&(e.config.disable=!e.player.config.screenShot)}afterCreate(){super.afterCreate(),this.appendChild(".xgplayer-icon",this.icons.screenshotIcon);const{config:e}=this;this.initSize=t=>{e.fitVideo&&(e.width=t.vWidth,e.height=t.vHeight)},this.once(et,this.initSize)}onPluginsReady(){this.show(),this.onClickBtn=this.onClickBtn.bind(this),this.bind(["click","touchend"],this.onClickBtn)}saveScreenShot(e,t){const i=document.createElement("a");i.href=e,i.download=t;const n=document.createEvent("MouseEvents");n.initMouseEvent("click",!0,!1,window,0,0,0,0,0,!1,!1,!1,!1,0,null),i.dispatchEvent(n)}createCanvas(e,t){const i=document.createElement("canvas"),n=i.getContext("2d");this.canvasCtx=n,this.canvas=i,i.width=e||this.config.width,i.height=t||this.config.height,n.imageSmoothingEnabled=!0,n.imageSmoothingEnabled&&(n.imageSmoothingQuality="high")}onClickBtn(e){e.preventDefault(),e.stopPropagation(),this.emitUserAction(e,"shot");const{config:t}=this;this.shot(t.width,t.height).then((e=>{this.emit(nt,e),t.saveImg&&this.saveScreenShot(e,t.name+t.format)}))}shot(e,t,i={quality:.92,type:"image/png"}){const{config:n,player:s}=this,r=i.quality||n.quality,o=i.type||n.type;return new Promise(((i,a)=>{let l,c=null;if(s.media.canvas)c=s.media.canvas;else{this.canvas?(this.canvas.width=e||n.width,this.canvas.height=t||n.height):this.createCanvas(e,t),c=this.canvas,l=this.canvasCtx;const i=s.media.videoWidth/s.media.videoHeight,r=c.width/c.height,o=0,a=0,u=s.media.videoWidth,h=s.media.videoHeight;let d,p,f,g;i>r?(f=c.width,g=c.width/i,d=0,p=Math.round((c.height-g)/2)):i===r?(f=c.width,g=c.height,d=0,p=0):i<r&&(f=c.height*i,g=c.height,d=Math.round((c.width-f)/2),p=0),l.drawImage(s.media,o,a,u,h,d,p,f,g)}let u=c.toDataURL(o,r).replace(o,"image/octet-stream");u=u.replace(/^data:image\/[^;]+/,"data:application/octet-stream"),i(u)}))}registerIcons(){return{screenshotIcon:null}}destroy(){super.destroy(),this.unbind(["click","touchend"],this.onClickBtn),this.off(et,this.initSize)}render(){if(this.config.disable)return;const e=this.icons.screenshotIcon?"xgplayer-icon":"xgplayer-icon btn-text",t="SCREENSHOT";return`\n      <xg-icon class="xgplayer-shot">\n      <div class="${e}">\n      ${this.icons.screenshotIcon?"":`<span lang-key="${this.i18nKeys[t]}">${this.i18n[t]}</span>`}\n      </div>\n    </xg-icon>`}}class Vs{constructor(e){this.config=e.config,this.parent=e.root,this.root=X.createDom("ul","",{},`xg-options-list xg-list-slide-scroll ${this.config.className}`),e.root.appendChild(this.root);const{maxHeight:t}=this.config;t&&this.setStyle({maxHeight:t}),this.onItemClick=this.onItemClick.bind(this),this.renderItemList();const i="mobile"===se.device?"touchend":"click";this._delegates=Kt.delegate.call(this,this.root,"li",i,this.onItemClick)}renderItemList(e){const{config:t,root:i}=this;e?t.data=e:e=t.data,t.style&&Object.keys(t.style).map((e=>{i.style[e]=t[e]})),e.length>0&&(this.attrKeys=Object.keys(e[0])),this.root.innerHTML="",e.map(((e,t)=>{const i=e.selected?"option-item selected":"option-item";e["data-index"]=t,this.root.appendChild(X.createDom("li",`<span>${e.showText}</span>`,e,i))}))}onItemClick(e){e.delegateTarget||(e.delegateTarget=e.target);const t=e.delegateTarget;if(t&&X.hasClass(t,"selected"))return!1;const i="function"===typeof this.config.onItemClick?this.config.onItemClick:null,n=this.root.querySelector(".selected");X.addClass(t,"selected"),n&&X.removeClass(n,"selected"),i(e,{from:n?this.getAttrObj(n,this.attrKeys):null,to:this.getAttrObj(t,this.attrKeys)})}getAttrObj(e,t){if(!e||!t)return{};const i={};t.map((t=>{i[t]=e.getAttribute(t)}));const n=e.getAttribute("data-index");return n&&(i.index=Number(n)),i}show(){X.removeClass(this.root,"hide"),X.addClass(this.root,"active")}hide(){X.removeClass(this.root,"active"),X.addClass(this.root,"hide")}setStyle(e){Object.keys(e).forEach((t=>{this.root.style[t]=e[t]}))}destroy(){this._delegates&&(this._delegates.map((e=>{e.destroy&&e.destroy()})),this._delegates=null),this.root.innerHTML=null,this.parent.removeChild(this.root),this.root=null}}var Gs=Object.defineProperty,zs=(e,t,i)=>t in e?Gs(e,t,{enumerable:!0,configurable:!0,writable:!0,value:i}):e[t]=i,Ks=(e,t,i)=>(zs(e,"symbol"!==typeof t?t+"":t,i),i);const Ws={SIDE:"side",MIDDLE:"middle"},Ys={CLICK:"click",HOVER:"hover"};function $s(e,t){return e===Ws.SIDE?t===Ut.CONTROLS_LEFT?"xg-side-list xg-left-side":"xg-side-list xg-right-side":""}const Xs="mobile"===se.device;class qs extends Kt{constructor(e){super(e),Ks(this,"onEnter",(e=>{e.stopPropagation(),this.emit("icon_mouseenter",{pluginName:this.pluginName}),this.switchActiveState(e)})),Ks(this,"switchActiveState",(e=>{e.stopPropagation();const{toggleMode:t}=this.config;t===Ys.CLICK?this.toggle(!this.isActive):this.toggle(!0)})),Ks(this,"onLeave",(e=>{e.stopPropagation(),this.emit("icon_mouseleave",{pluginName:this.pluginName}),this.config.listType!==Ws.SIDE&&this.isActive&&this.toggle(!1)})),Ks(this,"onListEnter",(e=>{this.enterType=2})),Ks(this,"onListLeave",(e=>{this.enterType=0,this.isActive&&this.toggle(!1)})),this.isIcons=!1,this.isActive=!1,this.curValue=null,this.curIndex=0}static get pluginName(){return"optionsIcon"}static get defaultConfig(){return{position:Ut.CONTROLS_RIGHT,index:100,list:[],listType:"middle",listStyle:{},hidePortrait:!0,isShowIcon:!1,isItemClickHide:!0,toggleMode:Ys.HOVER,heightLimit:!0}}updateLang(e){this.renderItemList(this.config.list,this.curIndex)}afterCreate(){const{config:e}=this;this.initIcons(),Xs&&e.listType!==Ws.MIDDLE&&(e.listType=Ws.SIDE),e.hidePortrait&&X.addClass(this.root,"portrait"),this.on([et,We],(()=>{this._resizeList()})),this.once(ye,(()=>{e.list&&e.list.length>0&&(this.renderItemList(e.list),this.show())})),Xs&&this.on(Le,(()=>{this.isActive&&(this.optionsList&&this.optionsList.hide(),this.isActive=!1)})),Xs?(e.toggleMode=Ys.CLICK,this.activeEvent="touchend"):this.activeEvent=e.toggleMode===Ys.CLICK?"click":"mouseenter",e.toggleMode===Ys.CLICK?this.bind(this.activeEvent,this.switchActiveState):(this.bind(this.activeEvent,this.onEnter),this.bind("mouseleave",this.onLeave)),this.isIcons&&this.bind("click",this.onIconClick)}initIcons(){const{icons:e}=this,t=Object.keys(e);let i=!1;t.length>0&&(t.forEach((t=>{this.appendChild(".xgplayer-icon",e[t]),!i&&(i=e[t])})),this.isIcons=i),i||(this.appendChild(".xgplayer-icon",X.createDom("span","",{},"icon-text")),X.addClass(this.find(".xgplayer-icon"),"btn-text"))}show(e){!this.config.list||this.config.list.length<2||X.addClass(this.root,"show")}hide(){X.removeClass(this.root,"show")}getTextByLang(e,t,i){if(void 0===e)return"";const{list:n}=this.config;!i&&(i=this.player.lang),t=!t||X.isUndefined(e[t])?"text":t,"number"===typeof e&&(e=n[e]);try{return"object"===typeof e[t]?e[t][i]||e[t].en:e[t]}catch(s){return console.warn(s),""}}toggle(e){if(e===this.isActive)return;const{controls:t}=this.player,{listType:i}=this.config;e?(i===Ws.SIDE?t.blur():t.focus(),this.optionsList&&this.optionsList.show()):(i===Ws.SIDE?t.focus():t.focusAwhile(),this.optionsList&&this.optionsList.hide()),this.isActive=e}onItemClick(e,t){e.stopPropagation();const{listType:i,list:n}=this.config;this.curIndex=t.to.index,this.curItem=n[this.curIndex],this.changeCurrentText();const{isItemClickHide:s}=this.config;(s||Xs||i===Ws.SIDE)&&this.toggle(!1)}onIconClick(e){}changeCurrentText(){if(this.isIcons)return;const{list:e}=this.config,t=this.curIndex<e.length?this.curIndex:0,i=e[t];i&&(this.find(".icon-text").innerHTML=this.getTextByLang(i,"iconText"))}renderItemList(e,t){const{config:i,optionsList:n,player:s}=this;if("number"===typeof t&&(this.curIndex=t,this.curItem=i.list[t]),n)return n.renderItemList(e),void this.changeCurrentText();const r={config:{data:e||[],className:$s(i.listType,i.position),onItemClick:(e,t)=>{this.onItemClick(e,t)}},root:i.listType===Ws.SIDE?s.innerContainer||s.root:this.root};if(this.config.isShowIcon){const{height:e}=this.player.root.getBoundingClientRect(),t=i.listType===Ws.MIDDLE?e-50:e;t&&i.heightLimit&&(r.config.maxHeight=`${t}px`),this.optionsList=new Vs(r),this.changeCurrentText(),this.show()}this._resizeList()}_resizeList(){if(!this.config.heightLimit)return;const{height:e}=this.player.root.getBoundingClientRect(),t=this.config.listType===Ws.MIDDLE?e-50:e;this.optionsList&&this.optionsList.setStyle({maxHeight:`${t}px`})}destroy(){const{config:e}=this;e.toggleMode===Ys.CLICK?this.unbind(this.activeEvent,this.switchActiveState):(this.unbind(this.activeEvent,this.onEnter),this.unbind("mouseleave",this.onLeave)),this.isIcons&&this.unbind("click",this.onIconClick),this.optionsList&&(this.optionsList.destroy(),this.optionsList=null)}render(){if(this.config.isShowIcon)return`<xg-icon class="xg-options-icon ${this.config.className||""}">\n    <div class="xgplayer-icon">\n    </div>\n   </xg-icon>`}}class Qs extends qs{static get pluginName(){return"definition"}static get defaultConfig(){return{...qs.defaultConfig,position:Ut.CONTROLS_RIGHT,index:3,list:[],defaultDefinition:"",disable:!1,hidePortrait:!1,className:"xgplayer-definition",isShowIcon:!0}}beforeCreate(e){const{list:t}=e.config;Array.isArray(t)&&t.length>0&&(e.config.list=t.map((e=>(!e.text&&e.name&&(e.text=e.name),e.text||(e.text=e.definition),e))))}constructor(e){super(e),this.curTime=0,this.isPaused=!0}afterCreate(){super.afterCreate(),this.on("resourceReady",(e=>{this.changeDefinitionList(e)})),this.on(Xe,(e=>{this.renderItemList(this.config.list,e.to)})),this.player.definitionList.length<2&&this.hide()}show(e){!this.config.list||this.config.list.length<2||X.addClass(this.root,"show")}initDefinition(){const{list:e,defaultDefinition:t}=this.config;if(e.length>0){let i=null;e.map((e=>{e.definition===t&&(i=e)})),i||(i=e[0]),this.changeDefinition(i)}}renderItemList(e=this.config.list||[],t){const i=t&&t.definition?t.definition:this.config.defaultDefinition;t&&e.forEach((e=>{e.selected=!1}));let n=0;const s=e.map(((e,t)=>{const s={...e,showText:this.getTextByLang(e)||e.definition,selected:!1};return(e.selected||e.definition&&e.definition==i)&&(s.selected=!0,n=t),s}));super.renderItemList(s,n)}changeDefinitionList(e){Array.isArray(e)&&(this.config.list=e.map((e=>(!e.text&&e.name&&(e.text=e.name),e.text||(e.text=e.definition),e))),this.renderItemList(),this.config.list.length<2?this.hide():this.show())}changeDefinition(e,t){this.player.changeDefinition(e,t)}onItemClick(e,t){const{definitionList:i}=this.player;super.onItemClick(...arguments),this.emitUserAction(e,"change_definition",{from:t.from,to:t.to});for(let n=0;n<i.length;n++)t.to&&i[n].definition===t.to.definition&&(t.to.url=i[n].url),t.from&&i[n].definition===t.from.definition&&(t.from.url=i[n].url);this.player.changeDefinition(t.to,t.from)}}class Zs extends qs{static get pluginName(){return"playbackRate"}static get defaultConfig(){return{...qs.defaultConfig,position:Ut.CONTROLS_RIGHT,index:4,list:[2,1.5,1,.75,.5],className:"xgplayer-playbackrate",isShowIcon:!0,hidePortrait:!1}}constructor(e){super(e),this.curRate=1}beforeCreate(e){const{playbackRate:t}=e.player.config,i=t?Array.isArray(t)?t:e.config.list:[];Array.isArray(i)&&(e.config.list=i.map((e=>("number"===typeof e?e={rate:e,text:`${e}x`}:!e.text&&e.rate&&(e.text=`${e.rate}x`),e))))}afterCreate(){super.afterCreate(),this.on(ke,(()=>{this.curValue!==this.player.playbackRate&&this.renderItemList()})),this.renderItemList()}show(e){this.config.list&&0!==this.config.list.length&&super.show()}onItemClick(e,t){super.onItemClick(e,t);const i=e.delegateTarget,n=Number(i.getAttribute("rate"));if(!n||n===this.curValue)return!1;const s={playbackRate:{from:this.player.playbackRate,to:n}};this.emitUserAction(e,"change_rate",{props:s}),this.curValue=n,this.player.playbackRate=n}renderItemList(){const e=this.player.playbackRate||1;this.curValue=e;let t=-1;const i=this.config.list.map(((i,n)=>{const s={rate:i.rate};return s.rate===e&&(s.selected=!0,t=n),s.showText=this.getTextByLang(i),s}));super.renderItemList(i,t)}changeCurrentText(){if(this.isIcons)return;const{list:e}=this.config,t=this.curIndex<e.length?this.curIndex:0,i=e[t];let n="";n=!i||this.curIndex<0?`${this.player.playbackRate}x`:this.getTextByLang(i,"iconText"),this.find(".icon-text").innerHTML=n}destroy(){super.destroy()}}function Js(){return(new DOMParser).parseFromString('<svg xmlns="http://www.w3.org/2000/svg" width="31" height="40" viewBox="0 -5 31 40">\n  <path fill="#fff" transform="scale(1.3, 1.3)" class=\'path_full\' d="M9,10v1a.9.9,0,0,1-1,1,.9.9,0,0,1-1-1V9A.9.9,0,0,1,8,8h2a.9.9,0,0,1,1,1,.9.9,0,0,1-1,1Zm6,4V13a1,1,0,0,1,2,0v2a.9.9,0,0,1-1,1H14a1,1,0,0,1,0-2Zm3-7H6V17H18Zm2,0V17a2,2,0,0,1-2,2H6a2,2,0,0,1-2-2V7A2,2,0,0,1,6,5H18A2,2,0,0,1,20,7Z"></path>\n</svg>\n',"image/svg+xml").firstChild}function er(){return(new DOMParser).parseFromString('<svg xmlns="http://www.w3.org/2000/svg" width="31" height="40" viewBox="0 -5 31 40">\n  <path fill="#fff" transform="scale(1.3, 1.3)" d="M9,10V9a.9.9,0,0,1,1-1,.9.9,0,0,1,1,1v2a.9.9,0,0,1-1,1H8a.9.9,0,0,1-1-1,.9.9,0,0,1,1-1Zm6,4v1a1,1,0,0,1-2,0V13a.9.9,0,0,1,1-1h2a1,1,0,0,1,0,2Zm3-7H6V17H18Zm2,0V17a2,2,0,0,1-2,2H6a2,2,0,0,1-2-2V7A2,2,0,0,1,6,5H18A2,2,0,0,1,20,7Z"></path>\n</svg>\n',"image/svg+xml").firstChild}class tr extends Zn{static get pluginName(){return"cssFullscreen"}static get defaultConfig(){return{position:Ut.CONTROLS_RIGHT,index:1,disable:!1,target:null}}beforeCreate(e){"boolean"===typeof e.player.config.cssFullscreen&&(e.config.disable=!e.player.config.cssFullscreen)}afterCreate(){super.afterCreate(),this.config.disable||(this.config.target&&(this.playerConfig.fullscreenTarget=this.config.target),this.initIcons(),this.on(Ye,(e=>{this.animate(e)})),this.btnClick=this.btnClick.bind(this),this.handleCssFullscreen=this.hook("cssFullscreen_change",this.btnClick,{pre:e=>{e.preventDefault(),e.stopPropagation()}}),this.bind(["click","touchend"],this.handleCssFullscreen))}initIcons(){const{icons:e}=this,t=this.find(".xgplayer-icon");t.appendChild(e.cssFullscreen),t.appendChild(e.exitCssFullscreen)}btnClick(e){e.preventDefault(),e.stopPropagation();const{isCssfullScreen:t}=this.player;this.emitUserAction(e,"switch_cssfullscreen",{cssfullscreen:t}),t?this.player.exitCssFullscreen():this.player.getCssFullscreen()}animate(e){this.root&&(e?this.setAttr("data-state","full"):this.setAttr("data-state","normal"),this.switchTips(e))}switchTips(e){const{i18nKeys:t}=this,i=this.find(".xg-tips");i&&this.changeLangTextKey(i,e?t.EXITCSSFULLSCREEN_TIPS:t.CSSFULLSCREEN_TIPS)}registerIcons(){return{cssFullscreen:{icon:Js,class:"xg-get-cssfull"},exitCssFullscreen:{icon:er,class:"xg-exit-cssfull"}}}destroy(){super.destroy(),this.unbind(["click","touchend"],this.btnClick)}render(){if(!this.config.disable)return`<xg-icon class='xgplayer-cssfullscreen'>\n    <div class="xgplayer-icon">\n    </div>\n    ${Xi(this,"CSSFULLSCREEN_TIPS",this.playerConfig.isHideTips)}\n    </xg-icon>`}}class ir extends Kt{static get pluginName(){return"error"}afterCreate(){this.clickHandler=this.hook("errorRetry",this.errorRetry,{pre:e=>{e.preventDefault(),e.stopPropagation()}}),this.onError=this.hook("showError",this.handleError),this.bind(".xgplayer-error-refresh","click",this.clickHandler),this.on(pe,(e=>{this.onError(e)}))}errorRetry(e){this.emitUserAction(e,"error_retry",{}),this.player.retry()}handleError(e={}){const{player:t}=this,i=e.errorType;let n=t.errorNote?this.i18n[t.errorNote]:"";if(!n)switch(i){case"decoder":n=this.i18n.MEDIA_ERR_DECODE;break;case"network":n=this.i18n.MEDIA_ERR_NETWORK;break;default:n=this.i18n.MEDIA_ERR_SRC_NOT_SUPPORTED}this.find(".xgplayer-error-text").innerHTML=n,this.find(".xgplayer-error-tips").innerHTML=`${this.i18n.REFRESH_TIPS}<span class="xgplayer-error-refresh">${this.i18n.REFRESH}</span>`}destroy(){this.unbind(".xgplayer-error-refresh","click",this.clickHandler)}render(){return'<xg-error class="xgplayer-error">\n      <div class="xgplayer-errornote">\n       <span class="xgplayer-error-text"></span>\n       <span class="xgplayer-error-tips"><em class="xgplayer-error-refresh"></em></span>\n      </div>\n    </xg-error>'}}class nr extends Kt{static get pluginName(){return"prompt"}static get defaultConfig(){return{interval:3e3,style:{},mode:"arrow",autoHide:!0,detail:{text:"",highlight:""},onClick:()=>{}}}afterCreate(){this.intervalId=0,this.customConfig=null,this.bind(".highlight",["click","touchend"],(e=>{(this.config.onClick||this.customOnClick)&&(e.preventDefault(),e.stopPropagation(),this.customOnClick?this.customOnClick(e):this.config.onClick(e))})),this.player.showPrompt=(...e)=>{this.showPrompt(...e)},this.player.hidePrompt=()=>{this.hide()}}setStyle(e){Object.keys(e).map((t=>{this.root.style[t]=e[t]}))}showPrompt(e,t={},i=()=>{}){if(!e)return;this.customOnClick=i;const{interval:n}=this.config;this.intervalId&&(clearTimeout(this.intervalId),this.intervalId=null),X.addClass(this.root,"show"),"arrow"===t.mode&&X.addClass(this.root,"arrow"),this.find(".xgplayer-prompt-detail").innerHTML="string"===typeof e?e:`${e.text||""}${e.highlight?`<i class="highlight">${e.highlight}</i>`:""}`,t.style&&this.setStyle(t.style);const s="boolean"===typeof t.autoHide?t.autoHide:this.config.autoHide;if(s){const e=t.interval||n;this.intervalId=setTimeout((()=>{this.hide()}),e)}}hide(){X.removeClass(this.root,"show"),X.removeClass(this.root,"arrow"),this.root.removeAttribute("style"),this.customOnClick=null}render(){return`<xg-prompt class="xgplayer-prompt ${ei.CONTROLS_FOLLOW}">\n    <span class="xgplayer-prompt-detail"></span>\n    </xg-prompt>`}}const sr={time:0,text:"",id:1,duration:1,color:"#fff",style:{},width:6,height:6};function rr(e){Object.keys(sr).map((t=>{void 0===e[t]&&(e[t]=sr[t])}))}const or={_updateDotDom(e,t){if(!t)return;const i=this.calcuPosition(e.time,e.duration),n=e.style||{};n.left=`${i.left}%`,n.width=`${i.width}%`,t.setAttribute("data-text",e.text),t.setAttribute("data-time",e.time),i.isMini?X.addClass(t,"mini"):X.removeClass(t,"mini"),Object.keys(n).map((e=>{t.style[e]=n[e]}))},initDots(){this._ispots.map((e=>{this.createDot(e,!1)})),this.ispotsInit=!0},createDot(e,t=!0){const{progress:i}=this.player.plugins;if(!i)return;if(t&&(rr(e),this._ispots.push(e)),!this.ispotsInit&&t)return;const n=this.calcuPosition(e.time,e.duration),s=e.style||{};s.left=`${n.left}%`,s.width=`${n.width}%`;let r=`xgspot_${e.id} xgplayer-spot`;n.isMini&&(r+=" mini");const o=e.template?`<div class="xgplayer-spot-pop">${e.template}</div>`:"",a=X.createDom("xg-spot",o,{"data-text":e.text,"data-time":e.time,"data-id":e.id},r);Object.keys(s).map((e=>{a.style[e]=s[e]})),i.outer&&i.outer.appendChild(a),this.positionDot(a,e.id)},findDot(e){if(!this.player.plugins.progress)return;const t=this._ispots.filter(((t,i)=>t.id===e));return t.length>0?t[0]:null},updateDot(e,t=!1){const{progress:i}=this.player.plugins;if(!i)return;const n=this.findDot(e.id);if(n&&Object.keys(e).map((t=>{n[t]=e[t]})),!this.ispotsInit)return;const s=i.find(`xg-spot[data-id="${e.id}"]`);s&&(this._updateDotDom(e,s),t&&this.showDot(e.id))},deleteDot(e){const{_ispots:t}=this,{progress:i}=this.player.plugins;if(!i)return;const n=[];for(let r=0;r<t.length;r++)t[r].id===e&&n.push(r);const s=n.length;for(let r=s-1;r>=0;r--)if(t.splice(n[r],1),this.ispotsInit){const t=i.find(`xg-spot[data-id="${e}"]`);t&&t.parentElement.removeChild(t)}},deleteAllDots(){const{progress:e}=this.player.plugins;if(!e)return;if(!this.ispotsInit)return void(this._ispots=[]);const t=e.root.getElementsByTagName("xg-spot");for(let i=t.length-1;i>=0;i--)e.outer.removeChild(t[i]);this._ispots=[]},updateAllDots(e=[]){const{progress:t}=this.player.plugins;if(!t)return;if(!this.ispotsInit)return void(this._ispots=e);this._ispots=[];const i=t.root.getElementsByTagName("xg-spot"),n=i.length;if(n>e.length)for(let s=n-1;s>e.length-1;s--)t.outer.removeChild(i[s]);e.forEach(((e,t)=>{t<n?(i[t].setAttribute("data-id",`${e.id}`),this._ispots.push(e),this.updateDot(e)):this.createDot(e)}))},positionDots(){const{_ispots:e,playerSize:t}=this,{sizeInfo:i}=this.player,{progress:n}=this.player.plugins;n&&i.width!==t.width&&(t.width=i.width,t.left=i.left,e.forEach((e=>{const t=n.find(`xg-spot[data-id="${e.id}"]`);t&&this.positionDot(t,e.id)})))},positionDot(e,t){const i=X.findDom(e,".xgplayer-spot-pop");if(!i)return;const n=this.playerSize,s=e.getBoundingClientRect(),r=i.getBoundingClientRect(),o=s.left-n.left,a=n.width-o-s.width/2;if(o<r.width/2||n.width<r.width){const e=r.width/2-o;i.style.left=`${e}px`}else if(a<r.width/2){const e=a-r.width/2+s.width/2;i.style.left=`${e}px`}else i.style.left="50%"},updateDuration(){const{progress:e}=this.player.plugins;if(!e)return;const{_ispots:t}=this;t.forEach((t=>{const i=e.find(`xg-spot[data-id="${t.id}"]`);this._updateDotDom(t,i)}))},getAllDotsDom(){const{progress:e}=this.player.plugins;if(!e)return[];const t=e.root.getElementsByTagName("xg-spot");return t},getDotDom(e){const{progress:t}=this.player.plugins;if(t)return t.find(`xg-spot[data-id="${e}"]`)}};function ar(e){const{config:t,player:i}=e;Object.keys(or).map((t=>{e[t]=or[t].bind(e)}));const n=i.config.progressDot||t.ispots||[];e._ispots=n.map((e=>(rr(e),e))),e.ispotsInit=!1,e.playerSize={left:i.sizeInfo.left,width:i.sizeInfo.width},e.on(be,(()=>{e.ispotsInit?e.updateDuration():e.initDots()})),e.on(et,(()=>{e.positionDots()}))}var lr=Object.defineProperty,cr=(e,t,i)=>t in e?lr(e,t,{enumerable:!0,configurable:!0,writable:!0,value:i}):e[t]=i,ur=(e,t,i)=>(cr(e,"symbol"!==typeof t?t+"":t,i),i);const hr={dragmove:"onProgressMove",dragstart:"onProgressDragStart",dragend:"onProgressDragEnd",click:"onProgressClick",mouseover:"onProgressMouseOver",mouseenter:"onProgressMouseOver"};class dr extends Kt{constructor(e){super(e),ur(this,"onMousemove",(e=>{this.config.disable||(X.hasClass(e.target,"xg-spot-content")&&this.config.isHideThumbnailHover?this.player.plugins.progress.onMouseLeave(e):(this._state.f||X.hasClass(e.target,"xg-spot-content"))&&(X.event(e),e.stopPropagation()))})),ur(this,"onMousedown",(e=>{this.config.disable||(this._state.f||X.hasClass(e.target,"xg-spot-content"))&&(X.event(e),e.stopPropagation())})),ur(this,"onMouseup",(e=>{if(!this.isDrag)return;const{progress:t}=this.player.plugins;t&&t.pos&&(t.onMouseUp(e),!t.pos.isEnter&&t.onMouseLeave(e))})),ur(this,"onDotMouseLeave",(e=>{if(this.config.disable)return;this._curDot.removeEventListener("mouseleave",this.onDotMouseLeave),this.blurDot(e.target),this._curDot=null;const{progress:t}=this.player.plugins;t&&t.enableBlur(),this.show()})),ur(this,"onProgressMouseOver",((e,t)=>{if(!this.config.disable&&X.hasClass(t.target,"xgplayer-spot")&&!this._curDot){this._curDot=t.target,this.focusDot(t.target),this._curDot.children.length>0&&this.hide();const{progress:e}=this.player.plugins;e&&e.disableBlur(),this._curDot.addEventListener("mouseleave",this.onDotMouseLeave)}})),this._ispots=[],this.videoPreview=null,this.videothumbnail=null,this.thumbnail=null,this.timeStr="",this._state={now:0,f:!1}}static get pluginName(){return"progresspreview"}static get defaultConfig(){return{index:1,miniWidth:6,ispots:[],defaultText:"",isFocusDots:!0,isHideThumbnailHover:!0,isShowThumbnail:!0,isShowCoverPreview:!1,mode:"",disable:!1,width:160,height:90}}beforeCreate(e){const t=e.player.plugins.progress;t&&(e.root=t.root)}afterCreate(){this._curDot=null,this.handlerSpotClick=this.hook("spotClick",((e,t)=>{t.seekTime&&this.player.seek(t.seekTime)})),this.transformTimeHook=this.hook("transformTime",(e=>{this.setTimeContent(X.format(e))})),ar(this),this.on(be,(()=>{this.show()})),this.config.disable&&this.disable(),this.extTextRoot=this.find(".xg-spot-ext-text")}setConfig(e){e&&Object.keys(e).map((t=>{this.config[t]=e[t]}))}onPluginsReady(){const{player:e}=this;e.plugins.progress&&(this.previewLine=this.find(".xg-spot-line"),this.timePoint=this.find(".xgplayer-progress-point"),this.timeText=this.find(".xg-spot-time"),this.tipText=this.find(".spot-inner-text"),this._hasThumnail=!1,this.registerThumbnail(),this.bindEvents())}bindEvents(){const{progress:e}=this.player.plugins;if(!e)return;if(Object.keys(hr).map((t=>{this[hr[t]]=this[hr[t]].bind(this),e.addCallBack(t,this[hr[t]])})),"mobile"===se.device)return;this.bind(".xg-spot-info","mousemove",this.onMousemove),this.bind(".xg-spot-info","mousedown",this.onMousedown),this.bind(".xg-spot-info","mouseup",this.onMouseup);const t=this.hook("previewClick",((...e)=>{}));this.handlerPreviewClick=e=>{e.stopPropagation(),t(parseInt(1e3*this._state.now,10)/1e3,e)},this.bind(".xg-spot-content","mouseup",this.handlerPreviewClick)}onProgressMove(e,t){!this.config.disable&&this.player.duration&&this.updatePosition(e.offset,e.width,e.currentTime,e.e)}onProgressDragStart(e){!this.config.disable&&this.player.duration&&(this.isDrag=!0,this.videoPreview&&X.addClass(this.videoPreview,"show"))}onProgressDragEnd(e){!this.config.disable&&this.player.duration&&(this.isDrag=!1,this.videoPreview&&X.removeClass(this.videoPreview,"show"))}onProgressClick(e,t){this.config.disable||X.hasClass(t.target,"xgplayer-spot")&&(t.stopPropagation(),t.preventDefault(),["time","id","text"].map((i=>{e[i]=t.target.getAttribute(`data-${i}`)})),e.time&&(e.time=Number(e.time)),this.handlerSpotClick(t,e))}updateLinePos(e,t){const{root:i,previewLine:n,player:s,config:r}=this,{mode:o}=s.controls,a="flex"===o;let l=i.getBoundingClientRect().width;if(!l&&this._hasThumnail)return;l=this._hasThumnail&&l<r.width?r.width:l;let c,u=e-l/2;u<0&&!a?(u=0,c=e-l/2):u>t-l&&!a?(c=u-(t-l),u=t-l):c=0,void 0!==c&&(n.style.transform=`translateX(${c.toFixed(2)}px)`),i.style.transform=`translateX(${u.toFixed(2)}px) translateZ(0)`}updateTimeText(e){const{timeText:t,timePoint:i}=this;t.innerHTML=e,!this.thumbnail&&(i.innerHTML=e)}updatePosition(e,t,i,n){const{root:s,config:r,_state:o}=this;if(!s)return;o.now=i,this.transformTimeHook(i);const a=this.timeStr;n&&n.target&&X.hasClass(n.target,"xgplayer-spot")?(this.showTips(n.target.getAttribute("data-text"),!1,a),this.focusDot(n.target),o.f=!0,r.isFocusDots&&o.f&&(o.now=parseInt(n.target.getAttribute("data-time"),10))):r.defaultText?(o.f=!1,this.showTips(r.defaultText,!0,a)):(o.f=!1,this.hideTips("")),this.updateTimeText(a),this.updateThumbnails(o.now),this.updateLinePos(e,t)}setTimeContent(e){this.timeStr=e}updateThumbnails(e){const{player:t,videoPreview:i,config:n}=this,{thumbnail:s}=t.plugins;if(s&&s.usable){this.thumbnail&&s.update(this.thumbnail,e,n.width,n.height);const t=i&&i.getBoundingClientRect();this.videothumbnail&&s.update(this.videothumbnail,e,t.width,t.height)}}registerThumbnail(e={}){if("mobile"===se.device)return;const{player:t,config:i}=this,n=t.getPlugin("thumbnail");if(n&&n.setConfig(e),!(n&&n.usable&&i.isShowThumbnail))return void X.addClass(this.root,"short-line no-thumbnail");X.removeClass(this.root,"short-line no-thumbnail"),"short"===i.mode&&X.addClass(this.root,"short-line"),this._hasThumnail=!0;const s=this.find(".xg-spot-thumbnail");this.thumbnail=n.createThumbnail(s,"progress-thumbnail"),i.isShowCoverPreview&&(this.videoPreview=X.createDom("xg-video-preview","",{},"xgvideo-preview"),t.root.appendChild(this.videoPreview),this.videothumbnail=n.createThumbnail(this.videoPreview,"xgvideo-thumbnail")),this.updateThumbnails(0)}calcuPosition(e,t){const{progress:i}=this.player.plugins,{player:n}=this,s=i.root.getBoundingClientRect().width,r=n.duration/s*6;return e+t>n.duration&&(t=n.duration-e),n.duration,n.duration,{left:e/n.duration*100,width:t/n.duration*100,isMini:t<r}}showDot(e){const t=this.findDot(e);if(t){const e=this.root.getBoundingClientRect(),{width:i}=e,n=t.time/this.player.duration*i;this.updatePosition(n,i,t.time)}}focusDot(e,t){e&&(t||(t=e.getAttribute("data-id")),X.addClass(e,"active"),this._activeDotId=t)}blurDot(e){if(!e){const t=this._activeDotId;e=this.getDotDom(t)}e&&(X.removeClass(e,"active"),this._activeDotId=null)}showTips(e,t,i=""){X.addClass(this.root,"no-timepoint"),e&&(X.addClass(this.find(".xg-spot-content"),"show-text"),t&&"production"===this.config.mode?(X.addClass(this.root,"product"),this.tipText.textContent=e):(X.removeClass(this.root,"product"),this.tipText.textContent=this._hasThumnail?e:`${i} ${e}`))}hideTips(){X.removeClass(this.root,"no-timepoint"),this.tipText.textContent="",X.removeClass(this.find(".xg-spot-content"),"show-text"),X.removeClass(this.root,"product")}hide(){X.addClass(this.root,"hide")}show(e){X.removeClass(this.root,"hide")}enable(){const{config:e,playerConfig:t}=this;this.config.disable=!1,this.show(),!this.thumbnail&&e.isShowThumbnail&&this.registerThumbnail(t.thumbnail||{})}disable(){this.config.disable=!0,this.hide()}destroy(){const{progress:e}=this.player.plugins;e&&Object.keys(hr).map((t=>{e.removeCallBack(t,this[hr[t]])})),this.videothumbnail=null,this.thumbnail=null,this.videoPreview&&this.player.root.removeChild(this.videoPreview),this.unbind(".xg-spot-info","mousemove",this.onMousemove),this.unbind(".xg-spot-info","mousedown",this.onMousedown),this.unbind(".xg-spot-info","mouseup",this.onMouseup),this.unbind(".xg-spot-content","mouseup",this.handlerPreviewClick)}render(){return"mobile"===se.device||"mobile"===this.playerConfig.isMobileSimulateMode?"":`<div class="xg-spot-info hide ${"short"===this.config.mode?"short-line":""}">\n      <div class="xg-spot-content">\n        <div class="xg-spot-thumbnail">\n          <span class="xg-spot-time"></span>\n        </div>\n        <div class="xg-spot-text"><span class="spot-inner-text"></span></div>\n      </div>\n      <div class="xgplayer-progress-point">00:00</div>\n      <div class="xg-spot-ext-text"></div>\n      <div class="xg-spot-line"></div>\n    </div>`}}class pr extends Kt{static get pluginName(){return"thumbnail"}static get defaultConfig(){return{isShow:!1,urls:[],pic_num:0,col:0,row:0,height:90,width:160,scale:1,className:"",hidePortrait:!1}}constructor(e){super(e),this.ratio=1,this.interval=null,this._preloadMark={}}afterCreate(){this.usable&&this.initThumbnail(),this.on([be],(()=>{const{pic_num:e,interval:t}=this.config;this.usable&&(this.interval=t>0?t:Math.round(1e3*this.player.duration/e)/1e3)}))}setConfig(e){if(!e)return;const t=Object.keys(e);t.length<1||(t.forEach((t=>{this.config[t]=e[t]})),this.usable&&this.initThumbnail())}get usable(){const{urls:e,pic_num:t}=this.config;return e&&e.length>0&&t>0}initThumbnail(){const{width:e,height:t,pic_num:i,interval:n}=this.config;this.ratio=e/t*100,this.interval=n||Math.round(this.player.duration/i),this._preloadMark={}}getUrlByIndex(e){return e>=0&&e<this.config.urls.length?this.config.urls[e]:""}preload(e){if(this._preloadMark[e])return;const{urls:t}=this.config,i=t.length,n=[];e>0&&n.push(e-1),n.push(e),e>0&&e<i-1&&n.push(e+1),n.map((e=>{!this._preloadMark[e]&&e>=0&&e<i&&(this._preloadMark[e]=1,X.preloadImg(t[e],(()=>{this._preloadMark[e]=2})))}))}getPosition(e,t=0,i=0){const{pic_num:n,row:s,col:r,width:o,height:a}=this.config;this.interval=Math.round(this.player.duration/n);let l=Math.ceil(e/this.interval);l=l>n?n:l;const c=l<s*r?0:Math.ceil(l/(s*r))-1,u=l-c*(r*s),h=u>0?Math.ceil(u/r)-1:0,d=u>0?u-h*r-1:0;let p=0,f=0;if(t&&i){const e=t/i;e<o/a?(f=i,p=f*(o/a)):(p=t,f=p/(o/a))}else i?t||(f=i||a,p=f*(o/a)):(p=t||o,f=p/(o/a));const g=this.getUrlByIndex(c);return{urlIndex:c,rowIndex:h,colIndex:d,url:g,height:f,width:p,style:{backgroundImage:`url(${g})`,backgroundSize:p*r+"px auto",backgroundPosition:`-${d*p}px -${h*f}px`,width:`${p}px`,height:`${f}px`}}}update(e,t,i=0,n=0,s=""){const{pic_num:r,urls:o}=this.config;if(r<=0||!o||0===o.length)return;const a=this.getPosition(t,i,n);this.preload(a.urlIndex),Object.keys(a.style).map((t=>{e.style[t]=a.style[t]})),Object.keys(s).map((t=>{e.style[t]=s[t]}))}changeConfig(e={}){this.setConfig(e)}createThumbnail(e,t){const i=X.createDom("xg-thumbnail","",{},`thumbnail ${t}`);return e&&e.appendChild(i),i}}var fr=Object.defineProperty,gr=(e,t,i)=>t in e?fr(e,t,{enumerable:!0,configurable:!0,writable:!0,value:i}):e[t]=i,mr=(e,t,i)=>(gr(e,"symbol"!==typeof t?t+"":t,i),i);function vr(e){return e?`background:${e};`:""}class yr extends Kt{constructor(){super(...arguments),mr(this,"onTimeupdate",(()=>{const{ended:e}=this.player,{offsetDuration:t}=this;let i=this.currentTime;i=X.adjustTimeByDuration(i,t,e),this.update({played:i},t)}))}static get pluginName(){return"MiniProgress"}static get defaultConfig(){return{mode:"auto",height:2}}get offsetDuration(){return this.playerConfig.customDuration||this.player.offsetDuration||this.player.duration}get currentTime(){const{offsetCurrentTime:e,currentTime:t}=this.player;return e>=0?e:t}afterCreate(){this.root&&(this.on(me,this.onTimeupdate),this.on(Ce,(()=>{this.reset()})))}reset(){this.update({played:0,cached:0},0)}update(e={cached:0,played:0},t){t&&this.root&&(e.cached&&(this.find("xg-mini-progress-cache").style.width=e.cached/t*100+"%"),e.played&&(this.find("xg-mini-progress-played").style.width=e.played/t*100+"%"))}render(){const{commonStyle:e,miniprogress:t}=this.playerConfig;if(!t)return;const{mode:i,height:n}=this.config,s={cached:vr(e.cachedColor),played:vr(e.playedColor),progress:vr(e.progressColor),height:n>0&&2!==n?`height: ${n}px;`:""},r="show"===i?"xg-mini-progress-show":"";return`<xg-mini-progress class="xg-mini-progress ${r}" style="${s.progress} ${s.height}">\n    <xg-mini-progress-cache class="xg-mini-progress-cache" style="${s.cached}"></xg-mini-progress-cache>\n    <xg-mini-progress-played class="xg-mini-progress-played" style="${s.played}"></xg-mini-progress-played>\n    </xg-mini-progress>`}}var _r=Object.defineProperty,br=(e,t,i)=>t in e?_r(e,t,{enumerable:!0,configurable:!0,writable:!0,value:i}):e[t]=i,Sr=(e,t,i)=>(br(e,"symbol"!==typeof t?t+"":t,i),i);const Er={REAL_TIME:"realtime",FIRST_FRAME:"firstframe",FRAME_RATE:"framerate",POSTER:"poster"};function Tr(){try{return parseInt(window.performance.now(),10)}catch(e){return(new Date).getTime()}}function kr(){try{const e=document.createElement("canvas").getContext;return!!e}catch(e){return!1}}let wr=null;class xr extends Kt{constructor(){super(...arguments),Sr(this,"onLoadedData",(e=>{this.player&&(this._frameCount=this.config.startFrameCount,this.stop(),this.renderOnTimeupdate(e),this.off(me,this.renderOnTimeupdate),this.on(me,this.renderOnTimeupdate))})),Sr(this,"onVisibilitychange",(e=>{"visible"===document.visibilityState?this._checkIfCanStart()&&this.start():"hidden"===document.visibilityState&&this.stop()})),Sr(this,"renderOnTimeupdate",(e=>{if(this._frameCount>0)this.renderOnce(),this._frameCount--;else{this._isLoaded=!0,this.off(me,this.renderOnTimeupdate);const{startInterval:e}=this.config;!this.player.paused&&this._checkIfCanStart()&&this.start(0,e)}})),Sr(this,"start",((e,t)=>{const i=this.player.video,n=Tr(),s=this.checkVideoIsSupport(i);s&&this.canvasCtx&&(t||(t=this.interval),this.stop(),i.videoWidth&&i.videoHeight&&(this.videoPI=i.videoHeight>0?parseInt(i.videoWidth/i.videoHeight*100,10):0,(this.config.mode===Er.REAL_TIME||n-this.preTime>=t)&&(i&&i.videoWidth&&this.update(s,this.videoPI),this.preTime=n)),this.frameId="timer"===this._loopType?X.setTimeout(this,this.start,t):X.requestAnimationFrame(this.start))})),Sr(this,"stop",(()=>{this.frameId&&("timer"===this._loopType?X.clearTimeout(this,this.frameId):X.cancelAnimationFrame(this.frameId),this.frameId=null)}))}static get pluginName(){return"dynamicBg"}static get defaultConfig(){return{isInnerRender:!1,disable:!0,index:-1,mode:"framerate",frameRate:10,filter:"blur(50px)",startFrameCount:2,startInterval:0,addMask:!0,multiple:1.2,maskBg:"rgba(0,0,0,0.7)"}}static get isSupport(){return"boolean"===typeof wr||(wr=kr()),wr}static supportCanvasFilter(){return!("safari"===se.browser||"firefox"===se.browser)}afterCreate(){!0===this.playerConfig.dynamicBg&&(this.config.disable=!1),xr.isSupport||(this.config.disable=!0);const{disable:e,mode:t,frameRate:i}=this.config;e||(this._pos={width:0,height:0,rwidth:0,rheight:0,x:0,y:0,pi:0},this.isStart=!1,this._isLoaded=!1,this.videoPI=0,this.preTime=0,this.interval=parseInt(1e3/i,10),this.canvas=null,this.canvasCtx=null,this._frameCount=0,this._loopType=this.config.mode!==Er.REAL_TIME&&this.interval>=1e3?"timer":"animation",this.once(Fe,(()=>{this.player&&(this.init(),this.renderByPoster(),this.player.paused||this.start())})),t!==Er.POSTER&&(t!==Er.FIRST_FRAME&&(this.on(Ce,(()=>{this.stop()})),this.on(ce,(()=>{const{startInterval:e}=this.config;this._checkIfCanStart()&&this.start(0,e)})),this.on(de,(()=>{this.stop()}))),this.on(Ee,this.onLoadedData),this.on(xe,(()=>{this._isLoaded=!1,this.stop()})),document.addEventListener("visibilitychange",this.onVisibilitychange)))}setConfig(e){Object.keys(e).forEach((t=>{"root"===t&&e[t]!==this.config[t]?this.reRender(e[t]):"frameRate"===t?this.interval=parseInt(1e3/e[t],10):"disable"===t&&e[t]&&this.stop(),this.config[t]=e[t]}))}init(e){const{player:t,config:i}=this;this.canvasFilter=xr.supportCanvasFilter();try{let n=e||i.root;n||(n=i.isInnerRender&&t.innerContainer||t.root),n.insertAdjacentHTML("afterbegin",`<div class="xgplayer-dynamic-bg" data-index="${i.index}"><canvas>\n        </canvas><xgmask></xgmask></div>`),this.root=n.children[0],this.canvas=this.find("canvas"),this.canvasFilter||(this.canvas.style.filter=i.filter,this.canvas.style.webkitFilter=i.filter),this.mask=this.find("xgmask"),i.addMask&&(this.mask.style.background=i.maskBg),this.canvasCtx=this.canvas.getContext("2d")}catch(n){W.logError("plugin:DynamicBg",n)}}reRender(e){const{disable:t}=this.config;if(!t&&!this.root)return;this.stop();const i=this.root?this.root.parentElement:null;if(i!==e&&i.removeChild(this.root),!e)return void(this.root=null);this.init(e),this.renderOnce();const{startInterval:n}=this.config;this._checkIfCanStart()&&this.start(0,n)}checkVideoIsSupport(e){if(!e)return null;const t=e&&e instanceof window.HTMLVideoElement?e:e.canvas?e.canvas:e.flyVideo?e.flyVideo:null;if(t&&("safari"!==se.browser||!X.isMSE(t)))return t;const i=t?t.tagName.toLowerCase():"";return"canvas"===i||"img"===i?t:null}renderByPoster(){const{poster:e}=this.playerConfig;if(e){const t="String"===X.typeOf(e)?e:"String"===X.typeOf(e.poster)?e.poster:null;this.updateImg(t)}}_checkIfCanStart(){const{mode:e}=this.config;return this._isLoaded&&!this.player.paused&&e!==Er.FIRST_FRAME&&e!==Er.POSTER}renderOnce(){const e=this.player.video;if(!e.videoWidth||!e.videoHeight)return;this.videoPI=parseInt(e.videoWidth/e.videoHeight*100,10);const t=this.checkVideoIsSupport(e);t&&this.update(t,this.videoPI)}updateImg(e){if(!e)return;const{width:t,height:i}=this.canvas.getBoundingClientRect();let n=new window.Image;n.onload=()=>{if(!this.canvas||this.frameId||this.isStart)return;this.canvas.height=i,this.canvas.width=t;const e=parseInt(t/i*100,10);this.update(n,e),n=null},n.src=e}update(e,t){if(this.canvas&&this.canvasCtx&&t)try{const{_pos:i,config:n}=this,{width:s,height:r}=this.canvas.getBoundingClientRect();if(s!==i.width||r!==i.height||i.pi!==t){const e=parseInt(s/r*100,10);i.pi=t,i.width!==s&&(i.width=this.canvas.width=s),i.height!==r&&(i.height=this.canvas.height=r);let o=r,a=s;e<t?a=parseInt(r*t/100,10):e>t&&(o=parseInt(100*s/t,10)),i.rwidth=a*n.multiple,i.rheight=o*n.multiple,i.x=(s-i.rwidth)/2,i.y=(r-i.rheight)/2}this.canvasFilter&&(this.canvasCtx.filter=n.filter),this.canvasCtx.drawImage(e,i.x,i.y,i.rwidth,i.rheight)}catch(i){W.logError("plugin:DynamicBg",i)}}destroy(){this.stop(),document.removeEventListener("visibilitychange",this.onVisibilitychange),this.canvasCtx=null,this.canvas=null}render(){return""}}var Cr={LANG:"zh-cn",TEXT:{ERROR_TYPES:{network:{code:1,msg:"视频下载错误"},mse:{code:2,msg:"流追加错误"},parse:{code:3,msg:"解析错误"},format:{code:4,msg:"格式错误"},decoder:{code:5,msg:"解码错误"},runtime:{code:6,msg:"语法错误"},timeout:{code:7,msg:"播放超时"},other:{code:8,msg:"其他错误"}},HAVE_NOTHING:"没有关于音频/视频是否就绪的信息",HAVE_METADATA:"音频/视频的元数据已就绪",HAVE_CURRENT_DATA:"关于当前播放位置的数据是可用的，但没有足够的数据来播放下一帧/毫秒",HAVE_FUTURE_DATA:"当前及至少下一帧的数据是可用的",HAVE_ENOUGH_DATA:"可用数据足以开始播放",NETWORK_EMPTY:"音频/视频尚未初始化",NETWORK_IDLE:"音频/视频是活动的且已选取资源，但并未使用网络",NETWORK_LOADING:"浏览器正在下载数据",NETWORK_NO_SOURCE:"未找到音频/视频来源",MEDIA_ERR_ABORTED:"取回过程被用户中止",MEDIA_ERR_NETWORK:"网络错误",MEDIA_ERR_DECODE:"解码错误",MEDIA_ERR_SRC_NOT_SUPPORTED:"不支持的音频/视频格式",REPLAY:"重播",ERROR:"网络连接似乎出现了问题",PLAY_TIPS:"播放",PAUSE_TIPS:"暂停",PLAYNEXT_TIPS:"下一集",DOWNLOAD_TIPS:"下载",ROTATE_TIPS:"旋转",RELOAD_TIPS:"重新载入",FULLSCREEN_TIPS:"进入全屏",EXITFULLSCREEN_TIPS:"退出全屏",CSSFULLSCREEN_TIPS:"进入样式全屏",EXITCSSFULLSCREEN_TIPS:"退出样式全屏",TEXTTRACK:"字幕",PIP:"画中画",SCREENSHOT:"截图",LIVE:"正在直播",OFF:"关闭",OPEN:"开启",MINI_DRAG:"点击按住可拖动视频",MINISCREEN:"小屏幕",REFRESH_TIPS:"请试试",REFRESH:"刷新",FORWARD:"快进中",LIVE_TIP:"直播"}},Ar=(i(4603),i(7566),i(8721),Object.defineProperty),Pr=(e,t,i)=>t in e?Ar(e,t,{enumerable:!0,configurable:!0,writable:!0,value:i}):e[t]=i,Ir=(e,t,i)=>(Pr(e,"symbol"!==typeof t?t+"":t,i),i);const Dr="info",{STATS_EVENTS:Lr}=n;class Or extends Ot{constructor(){super(...arguments),Ir(this,"_recordUserActions",(e=>{const t=this._getTime(),i=Object.assign({},e,{msg:e.msg||e.action});this._stats[Dr].push({type:"userAction",...t,payload:i})})),Ir(this,"_onReset",(()=>{this.reset()})),Ir(this,"_recordInfo",(e=>{this.info(e)})),Ir(this,"_downloadStats",(()=>{const e=this.getStats(),t=new Blob([JSON.stringify(e)],{type:"application/json"}),i=window.URL.createObjectURL(t),n=document.createElement("a");n.style.display="none",n.href=i,n.download="player.txt",n.disabled=!1,n.click()}))}static get pluginName(){return"stats"}static get defaultConfig(){return{}}_getTime(){return{timestamp:Date.now(),timeFormat:(new Date).toISOString()}}afterCreate(){this.reset(),this.on(at,this._recordUserActions),this.on(Lr.STATS_INFO,this._recordInfo),this.on(Lr.STATS_DOWNLOAD,this._downloadStats),this.on(Lr.STATS_RESET,this._onReset)}destroy(){this.offAll()}downloadStats(){this._downloadStats()}info(e){e.profile?this._infoProfile(e):this._info(e)}_info(e){const t=this._getTime();this._stats[Dr].push({...t,payload:e})}_infoProfile(e){if(e&&e.startMs){const t=Date.now(),i=t-e.startMs,n={cat:"function",dur:i,name:e.name||e.msg,ph:"X",pid:0,tid:0,ts:e.startMs,profile:!0,...e};this._info(n)}else console.warn("infoProfile need object data, include startMs")}reset(){this._stats={[Dr]:[],media:{}}}getStats(){const{player:e}=this,t=e.media,i=[];for(let s=0;s<t.buffered.length;s++)i.push({start:t.buffered.start(s),end:t.buffered.end(s)});const n={currentTime:t.currentTime,readyState:t.readyState,buffered:i,paused:t.paused,ended:t.ended};return this._stats.media=n,{raw:this._stats,timestat:this._getTimeStats(),profile:this._getProfile()}}_getTimeStats(){const e=this._stats[Dr],t=e.map((e=>{const t=e.payload.data;let i="";try{t instanceof Error?i=t.msg:void 0!==t&&(i=JSON.stringify(t))}catch(n){console.log("err",n)}return`[${e.timeFormat}] : ${e.payload.msg} ${i} `}));return t}_getProfile(){const e={traceEvents:[]},t=this._stats[Dr];return t.forEach((t=>{t.payload.profile&&e.traceEvents.push(t.payload)})),e}}var Rr=Object.defineProperty,Mr=(e,t,i)=>t in e?Rr(e,t,{enumerable:!0,configurable:!0,writable:!0,value:i}):e[t]=i,Nr=(e,t,i)=>(Mr(e,"symbol"!==typeof t?t+"":t,i),i);class Ur extends Kt{constructor(){super(...arguments),Nr(this,"onGapJump",(()=>{const{player:e,config:t}=this;if(e.media.readyState===HTMLMediaElement.HAVE_NOTHING)return;if(e.media.seeking){if(!this.seekingEventReceived)return}else this.seekingEventReceived=!1;if(e.media.paused&&0!==e.media.currentTime&&this.hasPlayed)return;const i=e.media.buffered,n=t.smallGapLimit||.5,s=t.gapDetectionThreshold||.3,r=e.media.currentTime,o=this._getIndex(i,r,s);if(null===o||0===o)return;console.log("GapJump  bufferRange ",i.start(o),i.end(o));const a=i.start(o)+.1,l=e.media.duration;if(a>l)return;const c=a-r,u=c<=n;c<Ur.BROWSER_GAP_TOLERANCE||u&&(!1!==t.useGapJump&&(e.media.currentTime=this.isSafari?a+.1:a),this.player&&this.player.emit("detectGap"),console.log("gapJump gapIndex",o," isGapSamll:",u," currentTime:",e.media.currentTime," jumpSize:",r-e.media.currentTime),.08!==a&&e&&e.emit("log",{type:"oneevent",end_type:"gap",vid:e.config.vid,ext:{video_postion:Math.floor(1e3*a)}}))}))}static get pluginName(){return"gapJump"}static get defaultConfig(){return{useGapJump:!1,smallGapLimit:.5,gapDetectionThreshold:.3}}afterCreate(){const{useGapJump:e}=this.config;!1!==e&&(this.hasPlayed=!1,this.seekingEventReceived=!1,this.isSafari=/(Safari|iPhone|iPad|iPod)/.test(navigator.userAgent)&&!/Chrome/.test(navigator.userAgent)&&!/BlackBerry/.test(navigator.platform),this.on(ve,this.onGapJump),this.on(ce,(()=>{this.hasPlayed=!0})),this.on(fe,(()=>{this.seekingEventReceived=!0})))}_getIndex(e,t,i){if(!e||!e.length)return null;if(1===e.length&&e.end(0)-e.start(0)<1e-6)return null;const n=this._getBuffered(e);let s=null;for(let r=0;r<n.length;r++){const e=n[r];if(e.start>t&&(0===r||n[r-1].end-t<=i)){s=r;break}}return s}_getBuffered(e){if(!e)return[];const t=[];for(let i=0;i<e.length;i++)t.push({start:e.start(i),end:e.end(i)});return t}}Ur.BROWSER_GAP_TOLERANCE=.001;var Fr=Object.defineProperty,Br=(e,t,i)=>t in e?Fr(e,t,{enumerable:!0,configurable:!0,writable:!0,value:i}):e[t]=i,Hr=(e,t,i)=>(Br(e,"symbol"!==typeof t?t+"":t,i),i);class jr extends Kt{constructor(){super(...arguments),Hr(this,"onWaiting",(()=>{const{config:e}=this;this.jumpCnt>e.jumpCntMax||this.timer||!1===e.useWaitingTimeoutJump||(this.timer=setTimeout(this.onJump,1e3*e.waitingTime))})),Hr(this,"onJump",(()=>{const{player:e,config:t}=this;if(clearTimeout(this.timer),this.timer=null,this.jumpCnt>t.jumpCntMax||!1===t.useWaitingTimeoutJump)return;if(e.media.paused&&0!==e.media.currentTime&&this.hasPlayed)return;this.jumpSize=t.jumpSize*(this.jumpCnt+1),this.jumpCnt===t.jumpSize&&this.jumpSize<6&&(this.jumpSize=6);const i=e.currentTime+this.jumpSize,n=e.media.duration;i>n||(console.log("waitintTimeout, currentTime:",e.currentTime,", jumpTo:",i),this.jumpCnt++,e.currentTime=i)}))}static get pluginName(){return"waitingTimeoutJump"}static get defaultConfig(){return{useWaitingTimeoutJump:!1,waitingTime:15,jumpSize:2,jumpCntMax:4}}afterCreate(){const{useWaitingTimeoutJump:e,jumpSize:t}=this.config;!1!==e&&(this.hasPlayed=!1,this.jumpCnt=0,this.timer=null,this.jumpSize=t,this.on(ve,this.onWaiting),this.on([ue,ye],(()=>{clearTimeout(this.timer),this.timer=null,this.jumpSize=this.config.jumpSize})),this.on(ce,(()=>{this.hasPlayed=!0})))}}var Vr=Object.defineProperty,Gr=(e,t,i)=>t in e?Vr(e,t,{enumerable:!0,configurable:!0,writable:!0,value:i}):e[t]=i,zr=(e,t,i)=>(Gr(e,"symbol"!==typeof t?t+"":t,i),i);const Kr="cdn",Wr=["cdn"];class Yr extends Kt{constructor(){super(...arguments),zr(this,"getSpeed",((e=Kr)=>{if(!this.speedListCache||!this.speedListCache[e])return 0;if(this.speedListCache[e].length<=0)return 0;let t=0;return this.speedListCache[e].map((e=>{t+=e})),Math.floor(t/this.speedListCache[e].length)})),zr(this,"startTimer",(()=>{X.isMSE(this.player.video)||(this.initSpeedList(),this.cnt=0,this.timer=setTimeout(this.testSpeed,this.config.testTimeStep))})),zr(this,"initSpeedList",(()=>{this.speedListCache={},Wr.forEach((e=>{this.speedListCache[e]=[]}))})),zr(this,"_onRealSpeedChange",(e=>{e.speed&&this.appendList(e.speed,e.type||Kr)})),zr(this,"testSpeed",(()=>{if(clearTimeout(this.timer),this.timer=null,!this.player||!this.config.openSpeed)return;const{url:e,loadSize:t,testCnt:i,testTimeStep:n}=this.config,s=e+(e.indexOf("?")<0?"?testst=":"&testst=")+Date.now();if(!(this.cnt>=i)){this.cnt++;try{const e=(new Date).getTime();let i=null;const r=new XMLHttpRequest;this.xhr=r,r.open("GET",s);const o={},a=Math.floor(10*Math.random());o.Range="bytes="+a+"-"+(t+a),o&&Object.keys(o).forEach((e=>{r.setRequestHeader(e,o[e])})),r.onreadystatechange=()=>{if(4===r.readyState){this.xhr=null,i=(new Date).getTime();const t=r.getResponseHeader("Content-Length")/1024*8,s=Math.round(1e3*t/(i-e));this.appendList(s),this.timer=setTimeout(this.testSpeed,n)}},r.send()}catch(r){console.error(r)}}})),zr(this,"appendList",((e,t=Kr)=>{if(!this.speedListCache||!this.speedListCache[t])return;const{saveSpeedMax:i}=this.config;this.speedListCache[t].length>=i&&this.speedListCache[t].shift(),this.speedListCache[t].push(e);const{player:n}=this;n&&(t===Kr?n.realTimeSpeed=e:n[this.getSpeedName("realTime",t)]=e),this.updateSpeed(t)})),zr(this,"updateSpeed",((e=Kr)=>{const t=this.getSpeed(e),{player:i}=this;if(i)if(e===Kr)i.avgSpeed&&t===i.avgSpeed||(i.avgSpeed=t,i.emit(Ve,{speed:t,realTimeSpeed:i.realTimeSpeed}));else{const n=this.getSpeedName("avg",e);i[n]&&t===i[n]||(i[n]=t,i.emit(Ve,{speed:t,realTimeSpeed:i.realTimeSpeed}))}}))}static get pluginName(){return"testspeed"}static get defaultConfig(){return{openSpeed:!1,testCnt:3,loadSize:204800,testTimeStep:3e3,url:"",saveSpeedMax:5,addSpeedTypeList:[]}}afterCreate(){const{openSpeed:e,addSpeedTypeList:t}=this.config;(null==t?void 0:t.length)>0&&Wr.push(...t),this.initSpeedList(),this.on("real_time_speed",this._onRealSpeedChange),this.timer=null,this.cnt=0,this.xhr=null,e&&this.on([Ee,Be],this.startTimer)}getSpeedName(e,t){return e+"Speed"+t.toUpperCase()}set openSpeed(e){if(this.config.openSpeed=e,!e&&this.timer)return clearTimeout(this.timer),void(this.timer=null);if(this.config.openSpeed){if(this.timer)return;this.timer=setTimeout(this.testSpeed,this.config.testTimeStep)}}get openSpeed(){return this.config.openSpeed}destroy(){this.off("real_time_speed",this._onRealSpeedChange),this.off([Ee,Be],this.startTimer),Wr.forEach((e=>{this.speedListCache&&this.speedListCache[e]&&(this.speedListCache[e]=[])})),this.speedListCache&&(this.speedListCache={}),clearTimeout(this.timer),this.timer=null,this.xhr&&4!==this.xhr.readyState&&(this.xhr.cancel&&this.xhr.cancel(),this.xhr=null)}}class $r extends Kt{static get pluginName(){return"FpsDetect"}static get defaultConfig(){return{disabled:!1,tick:1e3,stuckCount:3,reportFrame:0}}afterCreate(){const{player:e,config:t}=this,i=e.media||e.video;if(this.timer=null,this._lastDecodedFrames=0,this._currentStuckCount=0,this._lastCheckPoint=null,this._payload=[],t.disabled)return;const n=i.getVideoPlaybackQuality;n&&(this.on(ce,(()=>{this._startTick()})),this.on(de,(()=>{this._stopTick()})),this.on(he,(()=>{this._stopTick()})),this.on(Ce,(()=>{this._stopTick()})))}_startTick(){this._stopTick(),this._timer=setTimeout((()=>{this._checkDecodeFPS(),this._startTick()}),this.config.tick)}_stopTick(){clearTimeout(this._timer),this._timer=null}_checkBuffer(e,t){let i=!1;const n=[];for(let s=0;s<t.length;s++){const r=t.start(s),o=t.end(s);if(n.push({start:r,end:o}),r<=e&&e<=o-1){i=!0;break}}return{enoughBuffer:i,buffers:n}}_checkStuck(e,t,i,n){const s=this.player.media||this.player.video,r=document.hidden,{paused:o,readyState:a,currentTime:l,buffered:c}=s;if(r||o||a<4)return;const{enoughBuffer:u,buffers:h}=this._checkBuffer(l,c);u&&(e<=this.config.reportFrame?(this._currentStuckCount++,this._payload.push({currentTime:l,buffers:h,curDecodedFrames:e,totalVideoFrames:t,droppedVideoFrames:i,checkInterval:n}),this._currentStuckCount>=this.config.stuckCount&&(this.emit(ft,this._payload),this._reset())):this._reset())}_reset(){this._payload=[],this._currentStuckCount=0}_checkDecodeFPS(){const e=this.player.media||this.player.video;if(!e)return;const{totalVideoFrames:t,droppedVideoFrames:i}=e.getVideoPlaybackQuality(),n=performance.now();if(t&&this._lastCheckPoint){const e=t-this._lastDecodedFrames,s=n-this._lastCheckPoint;this._checkStuck(e,t,i,s)}this._lastDecodedFrames=t,this._lastCheckPoint=n}destroy(){this._stopTick()}}ui.use(Cr);class Xr{constructor(e,t){const i=t&&"mobile"===t.isMobileSimulateMode,{isLive:n,controls:s}=t,r=s?[Pi]:[],o=n?r:[...r,ds,$n,yr,dr,ls],a=[...o,Jn,as,Ss,Os,Qs,Zs,Hs,js,_s,As],l=[Ui,Fi,Yi,jn,$i,ir,nr,pr,hn];this.plugins=[...a,Or,Mi,...l,Ur,jr];const c=i?"mobile":se.device;switch(c){case"pc":this.plugins.push(Bn,vn,tr,Yr,$r);break;case"mobile":this.plugins.push(On);break;default:this.plugins.push(Bn,vn,tr)}(se.os.isIpad||"pc"===c)&&this.plugins.push(xr),se.os.isIpad&&this.plugins.push(vn),this.ignores=[],this.i18n=[]}}var qr=Object.defineProperty,Qr=(e,t,i)=>t in e?qr(e,t,{enumerable:!0,configurable:!0,writable:!0,value:i}):e[t]=i,Zr=(e,t,i)=>(Qr(e,"symbol"!==typeof t?t+"":t,i),i);class Jr extends wi{}Zr(Jr,"defaultPreset",Xr),Zr(Jr,"Util",X),Zr(Jr,"Sniffer",se),Zr(Jr,"Errors",le),Zr(Jr,"Events",n),Zr(Jr,"Plugin",Kt),Zr(Jr,"BasePlugin",Ot),Zr(Jr,"I18N",ui),Zr(Jr,"STATE_CLASS",ei),Zr(Jr,"InstManager",gi);i(641);function eo(e,t){var i=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=i){var n,s,r,o,a=[],l=!0,c=!1;try{if(r=(i=i.call(e)).next,0===t){if(Object(i)!==i)return;l=!1}else for(;!(l=(n=r.call(i)).done)&&(a.push(n.value),a.length!==t);l=!0);}catch(u){c=!0,s=u}finally{try{if(!l&&null!=i.return&&(o=i.return(),Object(o)!==o))return}finally{if(c)throw s}}return a}}function to(e,t){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),i.push.apply(i,n)}return i}function io(e){for(var t=1;t<arguments.length;t++){var i=null!=arguments[t]?arguments[t]:{};t%2?to(Object(i),!0).forEach((function(t){uo(e,t,i[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):to(Object(i)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(i,t))}))}return e}function no(){no=function(){return e};var e={},t=Object.prototype,i=t.hasOwnProperty,n=Object.defineProperty||function(e,t,i){e[t]=i.value},s="function"==typeof Symbol?Symbol:{},r=s.iterator||"@@iterator",o=s.asyncIterator||"@@asyncIterator",a=s.toStringTag||"@@toStringTag";function l(e,t,i){return Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{l({},"")}catch(A){l=function(e,t,i){return e[t]=i}}function c(e,t,i,s){var r=t&&t.prototype instanceof d?t:d,o=Object.create(r.prototype),a=new w(s||[]);return n(o,"_invoke",{value:S(e,i,a)}),o}function u(e,t,i){try{return{type:"normal",arg:e.call(t,i)}}catch(A){return{type:"throw",arg:A}}}e.wrap=c;var h={};function d(){}function p(){}function f(){}var g={};l(g,r,(function(){return this}));var m=Object.getPrototypeOf,v=m&&m(m(x([])));v&&v!==t&&i.call(v,r)&&(g=v);var y=f.prototype=d.prototype=Object.create(g);function _(e){["next","throw","return"].forEach((function(t){l(e,t,(function(e){return this._invoke(t,e)}))}))}function b(e,t){function s(n,r,o,a){var l=u(e[n],e,r);if("throw"!==l.type){var c=l.arg,h=c.value;return h&&"object"==typeof h&&i.call(h,"__await")?t.resolve(h.__await).then((function(e){s("next",e,o,a)}),(function(e){s("throw",e,o,a)})):t.resolve(h).then((function(e){c.value=e,o(c)}),(function(e){return s("throw",e,o,a)}))}a(l.arg)}var r;n(this,"_invoke",{value:function(e,i){function n(){return new t((function(t,n){s(e,i,t,n)}))}return r=r?r.then(n,n):n()}})}function S(e,t,i){var n="suspendedStart";return function(s,r){if("executing"===n)throw new Error("Generator is already running");if("completed"===n){if("throw"===s)throw r;return C()}for(i.method=s,i.arg=r;;){var o=i.delegate;if(o){var a=E(o,i);if(a){if(a===h)continue;return a}}if("next"===i.method)i.sent=i._sent=i.arg;else if("throw"===i.method){if("suspendedStart"===n)throw n="completed",i.arg;i.dispatchException(i.arg)}else"return"===i.method&&i.abrupt("return",i.arg);n="executing";var l=u(e,t,i);if("normal"===l.type){if(n=i.done?"completed":"suspendedYield",l.arg===h)continue;return{value:l.arg,done:i.done}}"throw"===l.type&&(n="completed",i.method="throw",i.arg=l.arg)}}}function E(e,t){var i=t.method,n=e.iterator[i];if(void 0===n)return t.delegate=null,"throw"===i&&e.iterator.return&&(t.method="return",t.arg=void 0,E(e,t),"throw"===t.method)||"return"!==i&&(t.method="throw",t.arg=new TypeError("The iterator does not provide a '"+i+"' method")),h;var s=u(n,e.iterator,t.arg);if("throw"===s.type)return t.method="throw",t.arg=s.arg,t.delegate=null,h;var r=s.arg;return r?r.done?(t[e.resultName]=r.value,t.next=e.nextLoc,"return"!==t.method&&(t.method="next",t.arg=void 0),t.delegate=null,h):r:(t.method="throw",t.arg=new TypeError("iterator result is not an object"),t.delegate=null,h)}function T(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function k(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function w(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(T,this),this.reset(!0)}function x(e){if(e){var t=e[r];if(t)return t.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var n=-1,s=function t(){for(;++n<e.length;)if(i.call(e,n))return t.value=e[n],t.done=!1,t;return t.value=void 0,t.done=!0,t};return s.next=s}}return{next:C}}function C(){return{value:void 0,done:!0}}return p.prototype=f,n(y,"constructor",{value:f,configurable:!0}),n(f,"constructor",{value:p,configurable:!0}),p.displayName=l(f,a,"GeneratorFunction"),e.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===p||"GeneratorFunction"===(t.displayName||t.name))},e.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,f):(e.__proto__=f,l(e,a,"GeneratorFunction")),e.prototype=Object.create(y),e},e.awrap=function(e){return{__await:e}},_(b.prototype),l(b.prototype,o,(function(){return this})),e.AsyncIterator=b,e.async=function(t,i,n,s,r){void 0===r&&(r=Promise);var o=new b(c(t,i,n,s),r);return e.isGeneratorFunction(i)?o:o.next().then((function(e){return e.done?e.value:o.next()}))},_(y),l(y,a,"Generator"),l(y,r,(function(){return this})),l(y,"toString",(function(){return"[object Generator]"})),e.keys=function(e){var t=Object(e),i=[];for(var n in t)i.push(n);return i.reverse(),function e(){for(;i.length;){var n=i.pop();if(n in t)return e.value=n,e.done=!1,e}return e.done=!0,e}},e.values=x,w.prototype={constructor:w,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(k),!e)for(var t in this)"t"===t.charAt(0)&&i.call(this,t)&&!isNaN(+t.slice(1))&&(this[t]=void 0)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var t=this;function n(i,n){return o.type="throw",o.arg=e,t.next=i,n&&(t.method="next",t.arg=void 0),!!n}for(var s=this.tryEntries.length-1;s>=0;--s){var r=this.tryEntries[s],o=r.completion;if("root"===r.tryLoc)return n("end");if(r.tryLoc<=this.prev){var a=i.call(r,"catchLoc"),l=i.call(r,"finallyLoc");if(a&&l){if(this.prev<r.catchLoc)return n(r.catchLoc,!0);if(this.prev<r.finallyLoc)return n(r.finallyLoc)}else if(a){if(this.prev<r.catchLoc)return n(r.catchLoc,!0)}else{if(!l)throw new Error("try statement without catch or finally");if(this.prev<r.finallyLoc)return n(r.finallyLoc)}}}},abrupt:function(e,t){for(var n=this.tryEntries.length-1;n>=0;--n){var s=this.tryEntries[n];if(s.tryLoc<=this.prev&&i.call(s,"finallyLoc")&&this.prev<s.finallyLoc){var r=s;break}}r&&("break"===e||"continue"===e)&&r.tryLoc<=t&&t<=r.finallyLoc&&(r=null);var o=r?r.completion:{};return o.type=e,o.arg=t,r?(this.method="next",this.next=r.finallyLoc,h):this.complete(o)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),h},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var i=this.tryEntries[t];if(i.finallyLoc===e)return this.complete(i.completion,i.afterLoc),k(i),h}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var i=this.tryEntries[t];if(i.tryLoc===e){var n=i.completion;if("throw"===n.type){var s=n.arg;k(i)}return s}}throw new Error("illegal catch attempt")},delegateYield:function(e,t,i){return this.delegate={iterator:x(e),resultName:t,nextLoc:i},"next"===this.method&&(this.arg=void 0),h}},e}function so(e){return so="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},so(e)}function ro(e,t,i,n,s,r,o){try{var a=e[r](o),l=a.value}catch(c){return void i(c)}a.done?t(l):Promise.resolve(l).then(n,s)}function oo(e){return function(){var t=this,i=arguments;return new Promise((function(n,s){var r=e.apply(t,i);function o(e){ro(r,n,s,o,a,"next",e)}function a(e){ro(r,n,s,o,a,"throw",e)}o(void 0)}))}}function ao(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function lo(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,Do(n.key),n)}}function co(e,t,i){return t&&lo(e.prototype,t),i&&lo(e,i),Object.defineProperty(e,"prototype",{writable:!1}),e}function uo(e,t,i){return t=Do(t),t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}function ho(e,t){if("function"!==typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&fo(e,t)}function po(e){return po=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},po(e)}function fo(e,t){return fo=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},fo(e,t)}function go(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}function mo(e,t){if(null==e)return{};var i,n,s={},r=Object.keys(e);for(n=0;n<r.length;n++)i=r[n],t.indexOf(i)>=0||(s[i]=e[i]);return s}function vo(e,t){if(null==e)return{};var i,n,s=mo(e,t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);for(n=0;n<r.length;n++)i=r[n],t.indexOf(i)>=0||Object.prototype.propertyIsEnumerable.call(e,i)&&(s[i]=e[i])}return s}function yo(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function _o(e,t){if(t&&("object"===typeof t||"function"===typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return yo(e)}function bo(e){var t=go();return function(){var i,n=po(e);if(t){var s=po(this).constructor;i=Reflect.construct(n,arguments,s)}else i=n.apply(this,arguments);return _o(this,i)}}function So(e,t){return ko(e)||eo(e,t)||xo(e,t)||Po()}function Eo(e){return To(e)||wo(e)||xo(e)||Ao()}function To(e){if(Array.isArray(e))return Co(e)}function ko(e){if(Array.isArray(e))return e}function wo(e){if("undefined"!==typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}function xo(e,t){if(e){if("string"===typeof e)return Co(e,t);var i=Object.prototype.toString.call(e).slice(8,-1);return"Object"===i&&e.constructor&&(i=e.constructor.name),"Map"===i||"Set"===i?Array.from(e):"Arguments"===i||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i)?Co(e,t):void 0}}function Co(e,t){(null==t||t>e.length)&&(t=e.length);for(var i=0,n=new Array(t);i<t;i++)n[i]=e[i];return n}function Ao(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function Po(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function Io(e,t){if("object"!==typeof e||null===e)return e;var i=e[Symbol.toPrimitive];if(void 0!==i){var n=i.call(e,t||"default");if("object"!==typeof n)return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}function Do(e){var t=Io(e,"string");return"symbol"===typeof t?t:String(t)}function Lo(e,t){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),i.push.apply(i,n)}return i}function Oo(e){for(var t=1;t<arguments.length;t++){var i=null!=arguments[t]?arguments[t]:{};t%2?Lo(Object(i),!0).forEach((function(t){jo(e,t,i[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):Lo(Object(i)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(i,t))}))}return e}function Ro(){Ro=function(){return e};var e={},t=Object.prototype,i=t.hasOwnProperty,n=Object.defineProperty||function(e,t,i){e[t]=i.value},s="function"==typeof Symbol?Symbol:{},r=s.iterator||"@@iterator",o=s.asyncIterator||"@@asyncIterator",a=s.toStringTag||"@@toStringTag";function l(e,t,i){return Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{l({},"")}catch(A){l=function(e,t,i){return e[t]=i}}function c(e,t,i,s){var r=t&&t.prototype instanceof d?t:d,o=Object.create(r.prototype),a=new w(s||[]);return n(o,"_invoke",{value:S(e,i,a)}),o}function u(e,t,i){try{return{type:"normal",arg:e.call(t,i)}}catch(A){return{type:"throw",arg:A}}}e.wrap=c;var h={};function d(){}function p(){}function f(){}var g={};l(g,r,(function(){return this}));var m=Object.getPrototypeOf,v=m&&m(m(x([])));v&&v!==t&&i.call(v,r)&&(g=v);var y=f.prototype=d.prototype=Object.create(g);function _(e){["next","throw","return"].forEach((function(t){l(e,t,(function(e){return this._invoke(t,e)}))}))}function b(e,t){function s(n,r,o,a){var l=u(e[n],e,r);if("throw"!==l.type){var c=l.arg,h=c.value;return h&&"object"==typeof h&&i.call(h,"__await")?t.resolve(h.__await).then((function(e){s("next",e,o,a)}),(function(e){s("throw",e,o,a)})):t.resolve(h).then((function(e){c.value=e,o(c)}),(function(e){return s("throw",e,o,a)}))}a(l.arg)}var r;n(this,"_invoke",{value:function(e,i){function n(){return new t((function(t,n){s(e,i,t,n)}))}return r=r?r.then(n,n):n()}})}function S(e,t,i){var n="suspendedStart";return function(s,r){if("executing"===n)throw new Error("Generator is already running");if("completed"===n){if("throw"===s)throw r;return C()}for(i.method=s,i.arg=r;;){var o=i.delegate;if(o){var a=E(o,i);if(a){if(a===h)continue;return a}}if("next"===i.method)i.sent=i._sent=i.arg;else if("throw"===i.method){if("suspendedStart"===n)throw n="completed",i.arg;i.dispatchException(i.arg)}else"return"===i.method&&i.abrupt("return",i.arg);n="executing";var l=u(e,t,i);if("normal"===l.type){if(n=i.done?"completed":"suspendedYield",l.arg===h)continue;return{value:l.arg,done:i.done}}"throw"===l.type&&(n="completed",i.method="throw",i.arg=l.arg)}}}function E(e,t){var i=t.method,n=e.iterator[i];if(void 0===n)return t.delegate=null,"throw"===i&&e.iterator.return&&(t.method="return",t.arg=void 0,E(e,t),"throw"===t.method)||"return"!==i&&(t.method="throw",t.arg=new TypeError("The iterator does not provide a '"+i+"' method")),h;var s=u(n,e.iterator,t.arg);if("throw"===s.type)return t.method="throw",t.arg=s.arg,t.delegate=null,h;var r=s.arg;return r?r.done?(t[e.resultName]=r.value,t.next=e.nextLoc,"return"!==t.method&&(t.method="next",t.arg=void 0),t.delegate=null,h):r:(t.method="throw",t.arg=new TypeError("iterator result is not an object"),t.delegate=null,h)}function T(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function k(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function w(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(T,this),this.reset(!0)}function x(e){if(e){var t=e[r];if(t)return t.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var n=-1,s=function t(){for(;++n<e.length;)if(i.call(e,n))return t.value=e[n],t.done=!1,t;return t.value=void 0,t.done=!0,t};return s.next=s}}return{next:C}}function C(){return{value:void 0,done:!0}}return p.prototype=f,n(y,"constructor",{value:f,configurable:!0}),n(f,"constructor",{value:p,configurable:!0}),p.displayName=l(f,a,"GeneratorFunction"),e.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===p||"GeneratorFunction"===(t.displayName||t.name))},e.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,f):(e.__proto__=f,l(e,a,"GeneratorFunction")),e.prototype=Object.create(y),e},e.awrap=function(e){return{__await:e}},_(b.prototype),l(b.prototype,o,(function(){return this})),e.AsyncIterator=b,e.async=function(t,i,n,s,r){void 0===r&&(r=Promise);var o=new b(c(t,i,n,s),r);return e.isGeneratorFunction(i)?o:o.next().then((function(e){return e.done?e.value:o.next()}))},_(y),l(y,a,"Generator"),l(y,r,(function(){return this})),l(y,"toString",(function(){return"[object Generator]"})),e.keys=function(e){var t=Object(e),i=[];for(var n in t)i.push(n);return i.reverse(),function e(){for(;i.length;){var n=i.pop();if(n in t)return e.value=n,e.done=!1,e}return e.done=!0,e}},e.values=x,w.prototype={constructor:w,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(k),!e)for(var t in this)"t"===t.charAt(0)&&i.call(this,t)&&!isNaN(+t.slice(1))&&(this[t]=void 0)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var t=this;function n(i,n){return o.type="throw",o.arg=e,t.next=i,n&&(t.method="next",t.arg=void 0),!!n}for(var s=this.tryEntries.length-1;s>=0;--s){var r=this.tryEntries[s],o=r.completion;if("root"===r.tryLoc)return n("end");if(r.tryLoc<=this.prev){var a=i.call(r,"catchLoc"),l=i.call(r,"finallyLoc");if(a&&l){if(this.prev<r.catchLoc)return n(r.catchLoc,!0);if(this.prev<r.finallyLoc)return n(r.finallyLoc)}else if(a){if(this.prev<r.catchLoc)return n(r.catchLoc,!0)}else{if(!l)throw new Error("try statement without catch or finally");if(this.prev<r.finallyLoc)return n(r.finallyLoc)}}}},abrupt:function(e,t){for(var n=this.tryEntries.length-1;n>=0;--n){var s=this.tryEntries[n];if(s.tryLoc<=this.prev&&i.call(s,"finallyLoc")&&this.prev<s.finallyLoc){var r=s;break}}r&&("break"===e||"continue"===e)&&r.tryLoc<=t&&t<=r.finallyLoc&&(r=null);var o=r?r.completion:{};return o.type=e,o.arg=t,r?(this.method="next",this.next=r.finallyLoc,h):this.complete(o)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),h},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var i=this.tryEntries[t];if(i.finallyLoc===e)return this.complete(i.completion,i.afterLoc),k(i),h}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var i=this.tryEntries[t];if(i.tryLoc===e){var n=i.completion;if("throw"===n.type){var s=n.arg;k(i)}return s}}throw new Error("illegal catch attempt")},delegateYield:function(e,t,i){return this.delegate={iterator:x(e),resultName:t,nextLoc:i},"next"===this.method&&(this.arg=void 0),h}},e}function Mo(e){return Mo="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Mo(e)}function No(e,t,i,n,s,r,o){try{var a=e[r](o),l=a.value}catch(c){return void i(c)}a.done?t(l):Promise.resolve(l).then(n,s)}function Uo(e){return function(){var t=this,i=arguments;return new Promise((function(n,s){var r=e.apply(t,i);function o(e){No(r,n,s,o,a,"next",e)}function a(e){No(r,n,s,o,a,"throw",e)}o(void 0)}))}}function Fo(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function Bo(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,oa(n.key),n)}}function Ho(e,t,i){return t&&Bo(e.prototype,t),i&&Bo(e,i),Object.defineProperty(e,"prototype",{writable:!1}),e}function jo(e,t,i){return t=oa(t),t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}function Vo(e,t){if("function"!==typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&zo(e,t)}function Go(e){return Go=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},Go(e)}function zo(e,t){return zo=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},zo(e,t)}function Ko(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}function Wo(e,t,i){return Wo=Ko()?Reflect.construct.bind():function(e,t,i){var n=[null];n.push.apply(n,t);var s=Function.bind.apply(e,n),r=new s;return i&&zo(r,i.prototype),r},Wo.apply(null,arguments)}function Yo(e){return-1!==Function.toString.call(e).indexOf("[native code]")}function $o(e){var t="function"===typeof Map?new Map:void 0;return $o=function(e){if(null===e||!Yo(e))return e;if("function"!==typeof e)throw new TypeError("Super expression must either be null or a function");if("undefined"!==typeof t){if(t.has(e))return t.get(e);t.set(e,i)}function i(){return Wo(e,arguments,Go(this).constructor)}return i.prototype=Object.create(e.prototype,{constructor:{value:i,enumerable:!1,writable:!0,configurable:!0}}),zo(i,e)},$o(e)}function Xo(e,t){if(null==e)return{};var i,n,s={},r=Object.keys(e);for(n=0;n<r.length;n++)i=r[n],t.indexOf(i)>=0||(s[i]=e[i]);return s}function qo(e,t){if(null==e)return{};var i,n,s=Xo(e,t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);for(n=0;n<r.length;n++)i=r[n],t.indexOf(i)>=0||Object.prototype.propertyIsEnumerable.call(e,i)&&(s[i]=e[i])}return s}function Qo(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function Zo(e,t){if(t&&("object"===typeof t||"function"===typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return Qo(e)}function Jo(e){var t=Ko();return function(){var i,n=Go(e);if(t){var s=Go(this).constructor;i=Reflect.construct(n,arguments,s)}else i=n.apply(this,arguments);return Zo(this,i)}}function ea(e,t){while(!Object.prototype.hasOwnProperty.call(e,t))if(e=Go(e),null===e)break;return e}function ta(){return ta="undefined"!==typeof Reflect&&Reflect.get?Reflect.get.bind():function(e,t,i){var n=ea(e,t);if(n){var s=Object.getOwnPropertyDescriptor(n,t);return s.get?s.get.call(arguments.length<3?e:i):s.value}},ta.apply(this,arguments)}function ia(e,t){if(e){if("string"===typeof e)return na(e,t);var i=Object.prototype.toString.call(e).slice(8,-1);return"Object"===i&&e.constructor&&(i=e.constructor.name),"Map"===i||"Set"===i?Array.from(e):"Arguments"===i||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i)?na(e,t):void 0}}function na(e,t){(null==t||t>e.length)&&(t=e.length);for(var i=0,n=new Array(t);i<t;i++)n[i]=e[i];return n}function sa(e,t){var i="undefined"!==typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!i){if(Array.isArray(e)||(i=ia(e))||t&&e&&"number"===typeof e.length){i&&(e=i);var n=0,s=function(){};return{s:s,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(e){throw e},f:s}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var r,o=!0,a=!1;return{s:function(){i=i.call(e)},n:function(){var e=i.next();return o=e.done,e},e:function(e){a=!0,r=e},f:function(){try{o||null==i.return||i.return()}finally{if(a)throw r}}}}function ra(e,t){if("object"!==typeof e||null===e)return e;var i=e[Symbol.toPrimitive];if(void 0!==i){var n=i.call(e,t||"default");if("object"!==typeof n)return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}function oa(e){var t=ra(e,"string");return"symbol"===typeof t?t:String(t)}i(8872);var aa,la=function(){function e(){Fo(this,e)}return Ho(e,null,[{key:"start",value:function(e){return e&&e.length?1===e.length&&e.end(0)-e.start(0)<1e-6||1===e.length&&e.start(0)<0?0:e.start(0):0}},{key:"end",value:function(e){return e&&e.length?1===e.length&&e.end(0)-e.start(0)<1e-6?0:e.end(e.length-1):0}},{key:"get",value:function(e){if(e)try{return e.buffered}catch(t){}}},{key:"buffers",value:function(e,t){if(!e||!e.length)return[];for(var i=[],n=0,s=e.length;n<s;n++){var r=i.length;if(r&&t){var o=i[r-1],a=o[1],l=e.start(n);if(l-a<=t){var c=e.end(n);c>a&&(o[1]=c)}else i.push([e.start(n),e.end(n)])}else i.push([e.start(n),e.end(n)])}return i}},{key:"totalLength",value:function(e){return e&&e.length?e.reduce((function(e,t){return e+(t[1]-t[0])}),0):0}},{key:"info",value:function(t){var i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;if(!t||!t.length)return{start:0,end:0,buffers:[]};for(var s=0,r=0,o=0,a=0,l=0,c=0,u=0,h=e.buffers(t,n),d=0,p=h.length;d<p;d++){var f=h[d];if(i+n>=f[0]&&i<=f[1])s=f[0],r=f[1],o=d;else{if(i+n<f[0]){a=f[0],l=f[1];break}i+n>f[1]&&(c=f[0],u=f[1])}}return{start:s,end:r,index:o,buffers:h,nextStart:a,nextEnd:l,prevStart:c,prevEnd:u,currentTime:i,behind:i-s,remaining:r?r-i:0,length:e.totalLength&&e.totalLength(h)}}},{key:"isBuffered",value:function(t,i){if(t){var n=e.get(t);if(null!==n&&void 0!==n&&n.length)for(var s=0;s<n.length;s++)if(i>=n.start(s)&&i<=n.end(s))return!0}return!1}}]),e}(),ca="undefined"!==typeof window,ua={MANIFEST:"manifest",NETWORK:"network",NETWORK_TIMEOUT:"network_timeout",NETWORK_FORBIDDEN:"network_forbidden",NETWORK_NOTFOUND:"network_notfound",NETWROK_RANGE_NOT_SATISFIABLE:"network_range_not_satisfiable",DEMUX:"demux",REMUX:"remux",MEDIA:"media",DRM:"drm",OTHER:"other",RUNTIME:"runtime",SUB_TYPES:{FLV:"FLV",HLS:"HLS",MP4:"MP4",FMP4:"FMP4",MSE_ADD_SB:"MSE_ADD_SB",MSE_APPEND_BUFFER:"MSE_APPEND_BUFFER",MSE_OTHER:"MSE_OTHER",MSE_FULL:"MSE_FULL",MSE_CHANGE_TYPE:"MSE_CHANGE_TYPE",OPTION:"OPTION",DASH:"DASH",LICENSE:"LICENSE",CUSTOM_LICENSE:"CUSTOM_LICENSE",MSE_HIJACK:"MSE_HIJACK",EME_HIJACK:"EME_HIJACK",SIDX:"SIDX",NO_CANPLAY_ERROR:"NO_CANPLAY_ERROR",BUFFERBREAK_ERROR:"BUFFERBREAK_ERROR",WAITING_TIMEOUT_ERROR:"WAITING_TIMEOUT_ERROR",MEDIA_ERR_ABORTED:"MEDIA_ERR_ABORTED",MEDIA_ERR_NETWORK:"MEDIA_ERR_NETWORK",MEDIA_ERR_DECODE:"MEDIA_ERR_DECODE",MEDIA_ERR_SRC_NOT_SUPPORTED:"MEDIA_ERR_SRC_NOT_SUPPORTED",MEDIA_ERR_CODEC_NOT_SUPPORTED:"MEDIA_ERR_CODEC_NOT_SUPPORTED",MEDIA_ERR_URL_EMPTY:"MEDIA_ERR_URL_EMPTY"}},ha=(aa={},jo(aa,ua.MANIFEST,{HLS:1100,DASH:1200}),jo(aa,ua.NETWORK,2100),jo(aa,ua.NETWORK_TIMEOUT,2101),jo(aa,ua.NETWORK_FORBIDDEN,2103),jo(aa,ua.NETWORK_NOTFOUND,2104),jo(aa,ua.NETWROK_RANGE_NOT_SATISFIABLE,2116),jo(aa,ua.DEMUX,{FLV:3100,HLS:3200,MP4:3300,FMP4:3400,SIDX:3410}),jo(aa,ua.REMUX,{FMP4:4100,MP4:4200}),jo(aa,ua.MEDIA,{MEDIA_ERR_ABORTED:5101,MEDIA_ERR_NETWORK:5102,MEDIA_ERR_DECODE:5103,MEDIA_ERR_SRC_NOT_SUPPORTED:5104,MEDIA_ERR_CODEC_NOT_SUPPORTED:5105,MEDIA_ERR_URL_EMPTY:5106,MSE_ADD_SB:5200,MSE_APPEND_BUFFER:5201,MSE_OTHER:5202,MSE_FULL:5203,MSE_HIJACK:5204,MSE_CHANGE_TYPE:5205,EME_HIJACK:5301}),jo(aa,ua.DRM,{LICENSE:7100,CUSTOM_LICENSE:7200}),jo(aa,ua.OTHER,8e3),jo(aa,ua.RUNTIME,{NO_CANPLAY_ERROR:9001,BUFFERBREAK_ERROR:9002,WAITING_TIMEOUT_ERROR:9003}),aa),da=function(e){Vo(i,e);var t=Jo(i);function i(e,n,s,r,o){var a;return Fo(this,i),a=t.call(this,o||(null===s||void 0===s?void 0:s.message)),a.errorType=e===ua.NETWORK_TIMEOUT?ua.NETWORK:e,a.originError=s,a.ext=r,a.errorCode=ha[e][n]||ha[e],a.errorMessage=a.message,a.errorCode||(a.errorType=ua.OTHER,a.errorCode=ha[a.errorType]),a}return Ho(i,null,[{key:"create",value:function(e,t,n,s,r){return e instanceof i?e:(e instanceof Error&&(n=e,e=""),e||(e=ua.OTHER),new i(e,t,n,s,r))}},{key:"network",value:function(e){var t;return new i(null!==e&&void 0!==e&&e.isTimeout?ua.NETWORK_TIMEOUT:ua.NETWORK,null,e instanceof Error?e:null,{url:null===e||void 0===e?void 0:e.url,response:null===e||void 0===e?void 0:e.response,httpCode:null===e||void 0===e||null===(t=e.response)||void 0===t?void 0:t.status})}}]),i}($o(Error)),pa={DEBUG:1,LOG:2,WARN:3,ERROR:4},fa=204800,ga=["Boolean","Number","String","Undefined","Null","Date","Object"],ma=function(){function e(t,i){Fo(this,e),this.name=t||"",this._prefix="[".concat(this.name,"]"),this.logCacheLevel=(null===i||void 0===i?void 0:i.logCacheLevel)||3,this.logMaxSize=(null===i||void 0===i?void 0:i.logMaxSize)||fa,this.logSize=0,this.logTextArray=[]}return Ho(e,[{key:"debug",value:function(){for(var t,i=arguments.length,n=new Array(i),s=0;s<i;s++)n[s]=arguments[s];this.logCache.apply(this,[pa.DEBUG].concat(n)),e.disabled||(t=console).debug.apply(t,["[".concat(va(),"]"),this._prefix].concat(n))}},{key:"log",value:function(){for(var t,i=arguments.length,n=new Array(i),s=0;s<i;s++)n[s]=arguments[s];this.logCache.apply(this,[pa.LOG].concat(n)),e.disabled||(t=console).log.apply(t,["[".concat(va(),"]"),this._prefix].concat(n))}},{key:"warn",value:function(){for(var t,i=arguments.length,n=new Array(i),s=0;s<i;s++)n[s]=arguments[s];this.logCache.apply(this,[pa.WARN].concat(n)),e.disabled||(t=console).warn.apply(t,["[".concat(va(),"]"),this._prefix].concat(n))}},{key:"error",value:function(){for(var t,i=arguments.length,n=new Array(i),s=0;s<i;s++)n[s]=arguments[s];this.logCache.apply(this,[pa.ERROR].concat(n)),e.disabled||(t=console).error.apply(t,["[".concat(va(),"]"),this._prefix].concat(n))}},{key:"logCache",value:function(e){if(!(e<this.logCacheLevel)){var t="";try{for(var i=arguments.length,n=new Array(i>1?i-1:0),s=1;s<i;s++)n[s-1]=arguments[s];var r=n.map((function(e){return _a(e)}));t="[".concat(va(),"]")+this._prefix+JSON.stringify(r)}catch(a){return}if(e>=this.logCacheLevel&&(this.logSize+=t.length,this.logTextArray.push(t)),this.logSize>this.logMaxSize){var o=this.logTextArray.shift();this.logSize-=o.length}}}},{key:"getLogCache",value:function(){var e=this.logTextArray.join("\n");return this.reset(),e}},{key:"reset",value:function(){this.logTextArray=[],this.logSize=0}},{key:"table",value:function(){var t;e.disabled||(console.group(this._prefix),(t=console).table.apply(t,arguments),console.groupEnd())}},{key:"setLogLevel",value:function(e){this.logCacheLevel=e}}],[{key:"enable",value:function(){e.disabled=!1}},{key:"disable",value:function(){e.disabled=!0}}]),e}();function va(){return(new Date).toLocaleString()}function ya(e){if("object"!==Mo(e))return e;var t=Object.prototype.toString.call(e).slice(8,-1);switch(t){case"Array":case"Uint8Array":case"ArrayBuffer":return t+"["+e.length+"]";case"Object":return"{}";default:return t}}function _a(e,t,i){i||(i=1),t||(t=2);var n={};if(!e||"object"!==Mo(e))return e;var s=Object.prototype.toString.call(e).slice(8,-1);if(!ga.includes(s))return s;if(!(i>t)){for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(i===t?n[r]=ya(e[r]):"object"===Mo(e[r])?n[r]=_a(e[r],t,i+1):n[r]=e[r]);return n}}function ba(){var e,t,i=new Promise((function(i,n){e=i,t=n}));return i.used=!1,i.resolve=function(){return i.used=!0,e.apply(void 0,arguments)},i.reject=function(){return i.used=!0,t.apply(void 0,arguments)},i}function Sa(){try{return parseInt(performance.now(),10)}catch(e){return(new Date).getTime()}}jo(ma,"disabled",!0);var Ea={stringify:function(e){try{return JSON.stringify(e)}catch(t){return""}},parse:function(e){try{return JSON.parse(e)}catch(t){return}}};function Ta(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];try{return ca?e&&"undefined"!==typeof ManagedMediaSource?ManagedMediaSource:window.MediaSource:null}catch(t){}}function ka(e){return/ManagedMediaSource/gi.test(Object.prototype.toString.call(e))}function wa(e){var t=[];if(e instanceof TimeRanges)for(var i=0;i<e.length;i++)t.push({start:e.start(i),end:e.end(i)});return t}var xa={APPEND:"appendBuffer",REMOVE:"removeBuffer",UPDATE_DURATION:"updateDuration"},Ca=function(){function e(t,i){var n=this;Fo(this,e),jo(this,"media",null),jo(this,"mediaSource",null),jo(this,"_openPromise",ba()),jo(this,"_queue",Object.create(null)),jo(this,"_sourceBuffer",Object.create(null)),jo(this,"_mseFullFlag",{}),jo(this,"_st",0),jo(this,"_opst",0),jo(this,"_logger",null),jo(this,"_config",null),jo(this,"_url",null),jo(this,"_onStartStreaming",(function(){n._logger.debug("startstreaming")})),jo(this,"_onEndStreaming",(function(){n._logger.debug("endstreaming")})),jo(this,"_onSBUpdateEnd",(function(e){var t=n._queue[e];if(t){var i=t[0];if((null===i||void 0===i?void 0:i.opName)!==xa.UPDATE_DURATION&&t.shift(),i){var s,r,o=Sa()-n._opst;n._logger.debug("UpdateEnd(".concat(e,"/").concat(i.opName,")"),Ea.stringify(wa(null===(s=n._sourceBuffer[e])||void 0===s?void 0:s.buffered)),o,i.context),i.promise.resolve({name:i.opName,context:i.context,costtime:o});var a=null===(r=i.context)||void 0===r?void 0:r.callback;a&&"function"===typeof a&&a(i.context),n._startQueue(e)}}})),jo(this,"_onSBUpdateError",(function(e,t){var i=n._queue[e];if(i){var s=i[0];s&&(n._logger.error("UpdateError",e,s.opName,s.context),s.promise.reject(new da(ua.MEDIA,ua.SUB_TYPES.MSE_APPEND_BUFFER,t)))}})),this._config=Object.assign(e.getDefaultConfig(),i),t&&this.bindMedia(t),this._logger=new ma("MSE"),this._config.openLog&&ma.enable()}return Ho(e,[{key:"isOpened",get:function(){var e;return"open"===(null===(e=this.mediaSource)||void 0===e?void 0:e.readyState)}},{key:"hasOpTasks",get:function(){var e=this,t=!1;return Object.keys(this._queue).forEach((function(i){var n=e._queue[i];Array.isArray(n)&&(t||(t=n.length>0))})),t}},{key:"url",get:function(){return this._url}},{key:"duration",get:function(){var e;return(null===(e=this.mediaSource)||void 0===e?void 0:e.duration)||-1}},{key:"isEnded",get:function(){return!!this.mediaSource&&"ended"===this.mediaSource.readyState}},{key:"streaming",get:function(){return!ka(this.mediaSource)||this.mediaSource.streaming}},{key:"isFull",value:function(t){return t?this._mseFullFlag[t]:this._mseFullFlag[e.VIDEO]}},{key:"updateDuration",value:function(e){var t=this,i=this.mediaSource&&this.mediaSource.duration>e;if(this.mediaSource&&this.mediaSource.duration>e){var n=0;if(Object.keys(this._sourceBuffer).forEach((function(e){try{n=Math.max(t.bufferEnd(e)||0,n)}catch(i){}})),e<n)return Promise.resolve()}return this._enqueueBlockingOp((function(){t.isEnded?t._logger.debug("setDuration but ended"):t.mediaSource&&(t.mediaSource.duration=e,t._logger.debug("setDuration",e))}),xa.UPDATE_DURATION,{isReduceDuration:i})}},{key:"open",value:function(){var e=this;if(this._openPromise.used&&!this.isOpened&&this.mediaSource){var t=this.mediaSource,i=function i(){var n=Sa()-e._st;e._logger.debug("sourceopen",n),t.removeEventListener("sourceopen",i),e._openPromise.resolve({costtime:n})};t.addEventListener("sourceopen",i),this._openPromise=ba()}return this._openPromise}},{key:"bindMedia",value:function(){var e=Uo(Ro().mark((function e(t){var i,n,s,r,o=this;return Ro().wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(!this.mediaSource&&!this.media){e.next=3;break}return e.next=3,this.unbindMedia();case 3:if(i=Ta(this._config.preferMMS),t&&i){e.next=6;break}throw new Error("Param media or MediaSource does not exist");case 6:return this.media=t,n=this.mediaSource=new i,s=ka(n),this._st=Sa(),r=function e(){var i=Sa()-o._st;o._logger.debug("sourceopen"),n.removeEventListener("sourceopen",e),URL.revokeObjectURL(t.src),o._openPromise.resolve({costtime:i})},n.addEventListener("sourceopen",r),s&&(n.addEventListener("startstreaming",this._onStartStreaming),n.addEventListener("endstreaming",this._onEndStreaming)),this._url=URL.createObjectURL(n),t.src=this._url,t.disableRemotePlayback=s,e.abrupt("return",this._openPromise);case 17:case"end":return e.stop()}}),e,this)})));function t(t){return e.apply(this,arguments)}return t}()},{key:"unbindMedia",value:function(){var e=Uo(Ro().mark((function e(){var t,i,n,s=this;return Ro().wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(this._openPromise.used||this._openPromise.resolve(),t=this.mediaSource,t){if(Object.keys(this._queue).forEach((function(e){var t=s._queue[e];t&&t.forEach((function(e){var t,i;return null===(t=e.promise)||void 0===t||null===(i=t.resolve)||void 0===i?void 0:i.call(t)}))})),i=!!this.media&&this.media.readyState>=1,n="open"===t.readyState,i&&n)try{t.endOfStream()}catch(r){}Object.keys(this._sourceBuffer).forEach((function(e){try{t.removeSourceBuffer(s._sourceBuffer[e])}catch(r){}})),ka(t)&&(t.removeEventListener("startstreaming",this._onStartStreaming),t.removeEventListener("endstreaming",this._onEndStreaming))}if(this.media){this.media.disableRemotePlayback=!1,this.media.removeAttribute("src");try{this.media.load()}catch(r){}this.media=null}this.mediaSource=null,this._openPromise=ba(),this._queue=Object.create(null),this._sourceBuffer=Object.create(null);case 8:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}()},{key:"createSource",value:function(e,t){if(!this._sourceBuffer[e]&&this.mediaSource){var i;try{i=this._sourceBuffer[e]=this.mediaSource.addSourceBuffer(t)}catch(n){throw new da(ua.MEDIA,ua.SUB_TYPES.MSE_ADD_SB,n)}i.mimeType=t,i.addEventListener("updateend",this._onSBUpdateEnd.bind(this,e)),i.addEventListener("error",this._onSBUpdateError.bind(this,e))}}},{key:"changeType",value:function(e,t){var i=this,n=this._sourceBuffer[e];return this.mediaSource&&n&&n.mimeType!==t?"function"!==typeof n.changeType?Promise.reject(new da(ua.MEDIA,ua.SUB_TYPES.MSE_CHANGE_TYPE,new Error("changeType is not a function"))):this._enqueueOp(e,(function(){try{n.changeType(t)}catch(s){throw new da(ua.MEDIA,ua.SUB_TYPES.MSE_CHANGE_TYPE,s)}n.mimeType=t,i._onSBUpdateEnd(e)}),"changeType",{mimeType:t}):Promise.resolve()}},{key:"createOrChangeSource",value:function(e,t){return this.createSource(e,t),this.changeType(e,t)}},{key:"append",value:function(e,t,i){var n=this;return t&&t.byteLength&&this._sourceBuffer[e]?this._enqueueOp(e,(function(){var s;n.mediaSource&&!n.media.error&&(n._logger.debug("MSE APPEND START",i),n._opst=Sa(),null===(s=n._sourceBuffer[e])||void 0===s||s.appendBuffer(t))}),xa.APPEND,i):Promise.resolve()}},{key:"remove",value:function(e,t,i,n){var s=this,r=!1;return this._mseFullFlag[e]&&(r=!0),this._enqueueOp(e,(function(){if(s.mediaSource&&!s.media.error){var r=s._sourceBuffer[e];t>=i||!r?s._onSBUpdateEnd(e):(s._opst=Sa(),s._logger.debug("MSE REMOVE START",e,t,i,n),r.remove(t,i))}}),xa.REMOVE,n,r)}},{key:"clearBuffer",value:function(e,t){var i,n=this;return Object.keys(this._sourceBuffer).forEach((function(s){i=n.remove(s,e,t)})),i||Promise.resolve()}},{key:"clearAllBuffer",value:function(){var e,t=this;return Object.keys(this._sourceBuffer).forEach((function(i){var n=t._sourceBuffer[i];e=t.remove(i,0,la.end(la.get(n)))})),e}},{key:"clearOpQueues",value:function(e,t){var i;this._logger.debug("MSE clearOpQueue START");var n=this._queue[e];if(t&&n)this._queue[e]=[];else if(n&&n[e]&&!(n.length<5)){var s=[];n.forEach((function(e){e.context&&e.context.isinit&&s.push(e)})),this._queue[e]=n.slice(0,2),s.length>0&&(i=this._queue[e]).push.apply(i,s)}}},{key:"endOfStream",value:function(e){var t=this;return this.mediaSource&&"open"===this.mediaSource.readyState?this._enqueueBlockingOp((function(){var i=t.mediaSource;i&&"open"===i.readyState&&(t._logger.debug("MSE endOfStream START"),e?i.endOfStream(e):i.endOfStream())}),"endOfStream"):Promise.resolve()}},{key:"setLiveSeekableRange",value:function(e,t){var i=this.mediaSource;e<0||t<e||null===i||void 0===i||!i.setLiveSeekableRange||"open"!==i.readyState||i.setLiveSeekableRange(e,t)}},{key:"getSourceBuffer",value:function(e){return this._sourceBuffer[e]}},{key:"buffered",value:function(e){return la.get(this._sourceBuffer[e])}},{key:"bufferStart",value:function(e){return la.start(this.buffered(e))}},{key:"bufferEnd",value:function(e){return la.end(this.buffered(e))}},{key:"_enqueueOp",value:function(e,t,i,n,s){var r=this;if(!this.mediaSource)return Promise.resolve();var o=this._queue[e]=this._queue[e]||[],a={exec:t,promise:ba(),opName:i,context:n};return s?(o.splice(0,0,a),this._mseFullFlag[e]=!1,this._startQueue(e)):o.push(a),this.isOpened||this.isEnded?1===o.length&&this._startQueue(e):this._openPromise.then((function(){1===o.length&&r._startQueue(e)})),a.promise}},{key:"_enqueueBlockingOp",value:function(){var e=Uo(Ro().mark((function e(t,i,n){var s,r,o=this;return Ro().wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(this.mediaSource){e.next=2;break}return e.abrupt("return",Promise.resolve());case 2:if(s=Object.keys(this._sourceBuffer),s.length){e.next=5;break}return e.abrupt("return",t());case 5:return r=[],s.forEach((function(e){var t=o._queue[e],s=ba();r.push(s),t.push({exec:function(){s.resolve()},promise:s,opName:i,context:n}),1===t.length&&o._startQueue(e)})),e.abrupt("return",Promise.all(r).then((function(){try{return t()}finally{s.forEach((function(e){var t=o._queue[e],i=o._sourceBuffer[e];null===t||void 0===t||t.shift(),i&&i.updating||o._startQueue(e)}))}})));case 8:case"end":return e.stop()}}),e,this)})));function t(t,i,n){return e.apply(this,arguments)}return t}()},{key:"_startQueue",value:function(e){var t=this._queue[e];if(t){var i=t[0];if(i&&!this._mseFullFlag[e])try{i.exec()}catch(n){n&&n.message&&n.message.indexOf("SourceBuffer is full")>=0?(this._mseFullFlag[e]=!0,i.context&&"object"===Mo(i.context)&&(i.context.isFull=!0),this._logger.error("[MSE error],  context,",i.context," ,name,",i.opName,",err,SourceBuffer is full"),i.promise.reject(new da(ua.MEDIA,ua.SUB_TYPES.MSE_FULL,n))):(this._logger.error(n),i.promise.reject(n.constructor===da?n:new da(ua.MEDIA,ua.SUB_TYPES.MSE_OTHER,n)),t.shift(),this._startQueue(e))}}}},{key:"setTimeoffset",value:function(e,t,i){var n=this;return this._enqueueOp(e,(function(){t<0&&(t+=.001),n._sourceBuffer[e].timestampOffset=t,n._onSBUpdateEnd(e)}),"setTimeoffset",i)}},{key:"abort",value:function(e,t){var i=this;return this.isOpened?this._enqueueOp(e,(function(){i._sourceBuffer[e].abort(),i._onSBUpdateEnd(e)}),"abort",t):Promise.resolve()}}],[{key:"isSupported",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:'video/mp4; codecs="avc1.42E01E,mp4a.40.2"',t=Ta();if(!t)return!1;try{return t.isTypeSupported(e)}catch(i){return this._logger.error(e,i),!1}}},{key:"isMMSOnly",value:function(){return"undefined"!==typeof ManagedMediaSource&&"undefined"===typeof MediaSource}},{key:"getDefaultConfig",value:function(){return{openLog:!1,preferMMS:!1}}}]),e}();jo(Ca,"VIDEO","video"),jo(Ca,"AUDIO","audio");var Aa={ERROR:"error",TTFB:"core.ttfb",LOAD_START:"core.loadstart",LOAD_RESPONSE_HEADERS:"core.loadresponseheaders",LOAD_COMPLETE:"core.loadcomplete",LOAD_RETRY:"core.loadretry",SOURCEBUFFER_CREATED:"core.sourcebuffercreated",MEDIASOURCE_OPENED:"core.mediasourceopened",ANALYZE_DURATION_EXCEEDED:"core.analyzedurationexceeded",APPEND_BUFFER:"core.appendbuffer",REMOVE_BUFFER:"core.removebuffer",BUFFEREOS:"core.buffereos",KEYFRAME:"core.keyframe",CHASEFRAME:"core.chaseframe",METADATA_PARSED:"core.metadataparsed",SEI:"core.sei",SEI_IN_TIME:"core.seiintime",FLV_SCRIPT_DATA:"core.flvscriptdata",LOWDECODE:"core.lowdecode",SWITCH_URL_SUCCESS:"core.switchurlsuccess",SWITCH_URL_FAILED:"core.switchurlfailed",SPEED:"core.speed",HLS_MANIFEST_LOADED:"core.hlsmanifestloaded",HLS_LEVEL_LOADED:"core.hlslevelloaded",DEMUXED_TRACK:"core.demuxedtrack",STREAM_EXCEPTION:"core.streamexception",LARGE_AV_FIRST_FRAME_GAP_DETECT:"LARGE_AV_FIRST_FRAME_GAP_DETECT",LARGE_VIDEO_DTS_GAP_DETECT:"LARGE_VIDEO_DTS_GAP_DETECT",LARGE_AUDIO_DTS_GAP_DETECT:"LARGE_AUDIO_DTS_GAP_DETECT",AUDIO_GAP_DETECT:"AUDIO_GAP_DETECT",AUDIO_OVERLAP_DETECT:"AUDIO_OVERLAP_DETECT",MAX_DTS_DELTA_WITH_NEXT_SEGMENT_DETECT:"MAX_DTS_DELTA_WITH_NEXT_SEGMENT_DETECT",REAL_TIME_SPEED:"real_time_speed"};i(6573),i(8100),i(7936),i(7467),i(4732),i(9577);function Pa(e){return e&&!e.paused&&!e.ended&&0!==e.playbackRate&&0!==e.readyState}function Ia(e){if(!e)return{};if("function"===typeof e.getVideoPlaybackQuality){var t=e.getVideoPlaybackQuality();return{droppedVideoFrames:t.droppedVideoFrames||t.corruptedVideoFrames,totalVideoFrames:t.totalVideoFrames,creationTime:t.creationTime}}return{droppedVideoFrames:e.webkitDroppedFrameCount,totalVideoFrames:e.webkitDecodedFrameCount,creationTime:performance.now()}}function Da(){for(var e=arguments.length,t=new Array(e),i=0;i<e;i++)t[i]=arguments[i];if(t=t.filter(Boolean),t.length<2)return t[0];var n=new Uint8Array(t.reduce((function(e,t){return e+t.byteLength}),0)),s=0;return t.forEach((function(e){n.set(e,s),s+=e.byteLength})),n}function La(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return new Promise((function(t){return setTimeout(t,e)}))}i(7642),i(8004),i(3853),i(5876),i(2475),i(5024),i(1698);var Oa=function(){function e(t){var i=this;Fo(this,e),jo(this,"_seiSet",new Set),this.emitter=t,t.on(Aa.SEI,(function(e){e&&i._seiSet.add(e)}))}return Ho(e,[{key:"throw",value:function(e,t){var i=this;if(null!==e&&void 0!==e&&this._seiSet.size){var n=e-.2,s=e+.2,r=[];this._seiSet.forEach((function(e){e.time>=n&&e.time<=s&&r.push(e)})),r.forEach((function(e){i._seiSet.delete(e),i.emitter.emit(Aa.SEI_IN_TIME,e)})),t&&this._seiSet.forEach((function(t){t.time<e-5&&i._seiSet.delete(t)}))}}},{key:"reset",value:function(){this._seiSet.clear()}}]),e}(),Ra=function(){function e(){Fo(this,e),jo(this,"_prevCurrentTime",0)}return Ho(e,[{key:"do",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:3,i=arguments.length>2?arguments[2]:void 0,n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1;if(e){var s=e.currentTime,r=0;if(this._prevCurrentTime===s){var o=la.info(la.get(e),s);if(!o.buffers.length)return;i&&o.nextStart||o.nextStart&&o.nextStart-s<t?r=o.nextStart+.1:o.end&&o.end-s>n&&!e.seeking&&(r=s+.1)}this._prevCurrentTime=s,r&&s!==r&&(e.currentTime=r)}}}]),e}(),Ma=function(){function e(t){Fo(this,e),jo(this,"encodeType",""),jo(this,"audioCodec",""),jo(this,"videoCodec",""),jo(this,"domain",""),jo(this,"fps",0),jo(this,"bitrate",0),jo(this,"width",0),jo(this,"height",0),jo(this,"samplerate",0),jo(this,"channelCount",0),jo(this,"gop",0),jo(this,"_bitsAccumulateSize",0),jo(this,"_bitsAccumulateDuration",0),jo(this,"_startGopId",-1),this._timescale=t}return Ho(e,[{key:"getStats",value:function(){return{encodeType:this.encodeType,audioCodec:this.audioCodec,videoCodec:this.videoCodec,domain:this.domain,fps:this.fps,bitrate:this.bitrate,width:this.width,height:this.height,samplerate:this.samplerate,channelCount:this.channelCount,gop:this.gop}}},{key:"setEncodeType",value:function(e){this.encodeType=e}},{key:"setFpsFromScriptData",value:function(e){var t,i=e.data,n=null===i||void 0===i||null===(t=i.onMetaData)||void 0===t?void 0:t.framerate;n&&n>0&&n<100&&(this.fps=n)}},{key:"setVideoMeta",value:function(e){if(this.width=e.width,this.height=e.height,this.videoCodec=e.codec,this.encodeType=e.codecType,e.fpsNum&&e.fpsDen){var t=e.fpsNum/e.fpsDen;t>0&&t<100&&(this.fps=t)}}},{key:"setAudioMeta",value:function(e){this.audioCodec=e.codec,this.samplerate=e.sampleRate,this.channelCount=e.channelCount}},{key:"setDomain",value:function(e){this.domain=e.split("/").slice(2,3)[0]}},{key:"updateBitrate",value:function(e){var t=this;if((!this.fps||this.fps>=100)&&e.length){var i=e.reduce((function(e,t){return e+t.duration}),0)/e.length;this.fps=Math.round(this._timescale/i)}e.forEach((function(e){-1===t._startGopId&&(t._startGopId=e.gopId),e.gopId===t._startGopId&&t.gop++,t._bitsAccumulateDuration+=e.duration/(t._timescale/1e3),t._bitsAccumulateSize+=e.units.reduce((function(e,t){return e+t.length}),0),t._bitsAccumulateDuration>=1e3&&(t.bitrate=8*t._bitsAccumulateSize,t._bitsAccumulateDuration=0,t._bitsAccumulateSize=0)}))}}]),e}(),Na=function(){function e(t){var i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1e3;Fo(this,e),jo(this,"_core",null),jo(this,"_samples",[]),this._core=t,this._timescale=i,this._stats=new Ma(i),this._bindEvents()}return Ho(e,[{key:"getStats",value:function(){var e,t,i,n,s,r,o,a,l,c,u,h=(null===(e=this._core)||void 0===e?void 0:e.media)||{},d=h.currentTime,p=void 0===d?0:d,f=h.decodeFps,g=void 0===f?0:f;return Oo(Oo({},this._stats.getStats()),{},{downloadSpeed:(null===(t=this._core)||void 0===t||null===(i=t.speedInfo)||void 0===i?void 0:i.call(t).speed)||0,avgSpeed:(null===(n=this._core)||void 0===n||null===(s=n.speedInfo)||void 0===s?void 0:s.call(n).avgSpeed)||0,totalReceivedByte:(null===(r=this._core)||void 0===r||null===(o=r.speedInfo)||void 0===o?void 0:o.call(r).totalSize)||0,totalReceivedCost:(null===(a=this._core)||void 0===a||null===(l=a.speedInfo)||void 0===l?void 0:l.call(a).totalCost)||0,currentTime:p,bufferEnd:(null===(c=this._core)||void 0===c||null===(u=c.bufferInfo())||void 0===u?void 0:u.remaining)||0,decodeFps:g})}},{key:"_bindEvents",value:function(){var e=this;this._core.on(Aa.DEMUXED_TRACK,(function(t){var i=t.videoTrack;return e._stats.updateBitrate(i.samples)})),this._core.on(Aa.FLV_SCRIPT_DATA,(function(t){e._stats.setFpsFromScriptData(t)})),this._core.on(Aa.METADATA_PARSED,(function(t){"video"===t.type?e._stats.setVideoMeta(t.track):e._stats.setAudioMeta(t.track)})),this._core.on(Aa.TTFB,(function(t){e._stats.setDomain(t.responseUrl)}))}},{key:"reset",value:function(){this._samples=[],this._stats=new Ma(this._timescale)}}]),e}();function Ua(e,t){var i=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=i){var n,s,r,o,a=[],l=!0,c=!1;try{if(r=(i=i.call(e)).next,0===t){if(Object(i)!==i)return;l=!1}else for(;!(l=(n=r.call(i)).done)&&(a.push(n.value),a.length!==t);l=!0);}catch(u){c=!0,s=u}finally{try{if(!l&&null!=i.return&&(o=i.return(),Object(o)!==o))return}finally{if(c)throw s}}return a}}function Fa(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function Ba(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,ol(n.key),n)}}function Ha(e,t,i){return t&&Ba(e.prototype,t),i&&Ba(e,i),Object.defineProperty(e,"prototype",{writable:!1}),e}function ja(e,t,i){return t=ol(t),t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}function Va(e,t){if("function"!==typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&za(e,t)}function Ga(e){return Ga=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},Ga(e)}function za(e,t){return za=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},za(e,t)}function Ka(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}function Wa(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function Ya(e,t){if(t&&("object"===typeof t||"function"===typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return Wa(e)}function $a(e){var t=Ka();return function(){var i,n=Ga(e);if(t){var s=Ga(this).constructor;i=Reflect.construct(n,arguments,s)}else i=n.apply(this,arguments);return Ya(this,i)}}function Xa(e,t){return Za(e)||Ua(e,t)||el(e,t)||nl()}function qa(e){return Qa(e)||Ja(e)||el(e)||il()}function Qa(e){if(Array.isArray(e))return tl(e)}function Za(e){if(Array.isArray(e))return e}function Ja(e){if("undefined"!==typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}function el(e,t){if(e){if("string"===typeof e)return tl(e,t);var i=Object.prototype.toString.call(e).slice(8,-1);return"Object"===i&&e.constructor&&(i=e.constructor.name),"Map"===i||"Set"===i?Array.from(e):"Arguments"===i||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i)?tl(e,t):void 0}}function tl(e,t){(null==t||t>e.length)&&(t=e.length);for(var i=0,n=new Array(t);i<t;i++)n[i]=e[i];return n}function il(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function nl(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function sl(e,t){var i="undefined"!==typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!i){if(Array.isArray(e)||(i=el(e))||t&&e&&"number"===typeof e.length){i&&(e=i);var n=0,s=function(){};return{s:s,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(e){throw e},f:s}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var r,o=!0,a=!1;return{s:function(){i=i.call(e)},n:function(){var e=i.next();return o=e.done,e},e:function(e){a=!0,r=e},f:function(){try{o||null==i.return||i.return()}finally{if(a)throw r}}}}function rl(e,t){if("object"!==typeof e||null===e)return e;var i=e[Symbol.toPrimitive];if(void 0!==i){var n=i.call(e,t||"default");if("object"!==typeof n)return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}function ol(e){var t=rl(e,"string");return"symbol"===typeof t?t:String(t)}var al=function(){function e(t){Fa(this,e),this.name=t||"",this._prefix="[".concat(this.name,"]")}return Ha(e,[{key:"warn",value:function(){var t;if(!e.disabled){for(var i=arguments.length,n=new Array(i),s=0;s<i;s++)n[s]=arguments[s];(t=console).warn.apply(t,[this._prefix].concat(n))}}}],[{key:"enable",value:function(){e.disabled=!1}},{key:"disable",value:function(){e.disabled=!0}}]),e}();ja(al,"disabled",!0);var ll={VIDEO:"video",AUDIO:"audio",METADATA:"metadata"},cl={AV1:"av1",AVC:"avc",HEVC:"hevc"},ul={AAC:"aac",G711PCMA:"g7110a",G711PCMU:"g7110m",OPUS:"opus"},hl={LARGE_AV_SHIFT:"LARGE_AV_SHIFT",LARGE_VIDEO_GAP:"LARGE_VIDEO_GAP",LARGE_VIDEO_GAP_BETWEEN_CHUNK:"LARGE_VIDEO_GAP_BETWEEN_CHUNK",LARGE_AUDIO_GAP:"LARGE_AUDIO_GAP",AUDIO_FILLED:"AUDIO_FILLED",AUDIO_DROPPED:"AUDIO_DROPPED"},dl=Ha((function e(t,i,n,s){Fa(this,e),ja(this,"duration",1024),ja(this,"flag",{dependsOn:2,isNonSyncSample:0}),ja(this,"keyframe",!0),this.originPts=this.pts=this.dts=t,this.data=i,this.size=i.byteLength,this.sampleOffset=s,n&&(this.duration=n)})),pl="undefined"!==typeof window,fl=pl&&navigator.userAgent.toLocaleLowerCase(),gl=pl&&/^((?!chrome|android).)*safari/.test(fl),ml=pl&&fl.includes("firefox"),vl=pl&&fl.includes("android"),yl=function(){function e(){Fa(this,e)}return Ha(e,null,[{key:"getRateIndexByRate",value:function(t){return e.FREQ.indexOf(t)}},{key:"parseADTS",value:function(t,i){var n=t.length,s=0;while(s+2<n){if(255===t[s]&&240===(246&t[s+1]))break;s++}if(!(s>=n)){var r=s,o=[],a=(60&t[s+2])>>>2,l=e.FREQ[a];if(!l)throw new Error("Invalid sampling index: ".concat(a));var c,u,h=1+((192&t[s+2])>>>6),d=(1&t[s+2])<<2|(192&t[s+3])>>>6,p=e._getConfig(a,d,h),f=p.config,g=p.codec,m=0,v=e.getFrameDuration(l);while(s+7<n)if(255===t[s]&&240===(246&t[s+1])){if(u=(3&t[s+3])<<11|t[s+4]<<3|(224&t[s+5])>>5,!u||n-s<u)break;c=2*(1&~t[s+1]),o.push({pts:i+m*v,data:t.subarray(s+7+c,s+u)}),m++,s+=u}else s++;return{skip:r,remaining:s>=n?void 0:t.subarray(s),frames:o,samplingFrequencyIndex:a,sampleRate:l,objectType:h,channelCount:d,codec:g,config:f,originCodec:"mp4a.40.".concat(h)}}}},{key:"parseAudioSpecificConfig",value:function(t){if(t.length){var i=t[0]>>>3,n=(7&t[0])<<1|t[1]>>>7,s=(120&t[1])>>>3,r=e.FREQ[n];if(r){var o=e._getConfig(n,s,i),a=o.config,l=o.codec;return{samplingFrequencyIndex:n,sampleRate:r,objectType:i,channelCount:s,config:a,codec:l,originCodec:"mp4a.40.".concat(i)}}}}},{key:"getFrameDuration",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:9e4;return 1024*t/e}},{key:"_getConfig",value:function(e,t,i){var n,s,r=[];return ml?e>=6?(n=5,s=e-3):(n=2,s=e):vl?(n=2,s=e):(n=2===i||5===i?i:5,s=e,e>=6?s=e-3:1===t&&(n=2,s=e)),r[0]=n<<3,r[0]|=(14&e)>>1,r[1]=(1&e)<<7,r[1]|=t<<3,5===n&&(r[1]|=(14&s)>>1,r[2]=(1&s)<<7,r[2]|=8,r[3]=0),{config:r,codec:"mp4a.40.".concat(n)}}},{key:"getSilentFrame",value:function(e,t){switch(e){case"mp4a.40.2":if(1===t)return new Uint8Array([0,200,0,128,35,128]);if(2===t)return new Uint8Array([33,0,73,144,2,25,0,35,128]);if(3===t)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,142]);if(4===t)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,128,44,128,8,2,56]);if(5===t)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,130,48,4,153,0,33,144,2,56]);if(6===t)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,130,48,4,153,0,33,144,2,0,178,0,32,8,224]);break;default:if(1===t)return new Uint8Array([1,64,34,128,163,78,230,128,186,8,0,0,0,28,6,241,193,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);if(2===t)return new Uint8Array([1,64,34,128,163,94,230,128,186,8,0,0,0,0,149,0,6,241,161,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);if(3===t)return new Uint8Array([1,64,34,128,163,94,230,128,186,8,0,0,0,0,149,0,6,241,161,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);break}}}]),e}();ja(yl,"FREQ",[96e3,88200,64e3,48e3,44100,32e3,24e3,22050,16e3,12e3,11025,8e3,7350]);var _l=45e3,bl=3,Sl=9e4,El=45e4,Tl=9e4,kl=45e3,wl=45e4,xl=function(){function e(t,i,n,s){Fa(this,e),this.videoTrack=t,this.audioTrack=i,this.metadataTrack=n,this._baseDts=-1,this._baseVideoDts=-1,this._baseAudioDts=-1,this._baseDtsInited=!1,this._audioNextPts=void 0,this._videoNextDts=void 0,this._audioTimestampBreak=!1,this._videoTimestampBreak=!1,this._lastAudioExceptionGapDot=0,this._lastAudioExceptionOverlapDot=0,this._lastAudioExceptionLargeGapDot=0,this._needForceFixLargeGap=null===s||void 0===s?void 0:s.forceFixLargeGap,this._largeGapThreshold=(null===s||void 0===s?void 0:s.largeGapThreshold)||wl}return Ha(e,[{key:"fix",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,i=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];t=Math.round(9e4*t);var s=this.videoTrack,r=this.audioTrack,o=s.samples,a=r.samples;if(o.length||a.length){var l=o[0],c=a[0],u=0;if(o.length&&a.length&&(u=l.dts-c.pts),this._baseDtsInited||this._calculateBaseDts(this.audioTrack,this.videoTrack),i&&(this._calculateBaseDts(this.audioTrack,this.videoTrack),this._baseDts-=t,this._baseAudioDts-=t,this._baseVideoDts-=t),!n){this._videoNextDts=u>0?t+u:t,this._audioNextPts=u>0?t:t-u,this._needForceFixLargeGap&&(this._videoNextDts=0,this._audioNextPts=0);var h=l?l.dts-this._baseDts-this._videoNextDts:0,d=c?c.pts-this._baseDts-this._audioNextPts:0;Math.abs(h||d)>Tl&&(this._calculateBaseDts(this.audioTrack,this.videoTrack),this._baseDts-=t)}if(this._resetBaseDtsWhenStreamBreaked(),this._fixAudio(r),this._fixVideo(s),this.metadataTrack.exist()){var p=this.metadataTrack.timescale;this.metadataTrack.seiSamples.forEach((function(t){t.pts=t.originPts-e._baseDts,t.time=Math.max(0,t.pts)/p}))}s.samples.length&&(s.baseMediaDecodeTime=s.samples[0].dts),r.samples.length&&(r.baseMediaDecodeTime=r.samples[0].pts*r.timescale/9e4)}}},{key:"_fixVideo",value:function(e){var t=this,i=e.samples;if(i.length){if(i.forEach((function(e){e.dts-=t._needForceFixLargeGap?t._baseVideoDts:t._baseDts,e.pts-=t._needForceFixLargeGap?t._baseVideoDts:t._baseDts})),void 0===this._videoNextDts){var n=i[0];this._videoNextDts=n.dts}var s,r,o=i.length,a=0,l=i[0],c=i[1],u=this._videoNextDts-l.dts;if(Math.abs(u)>kl)if(e.warnings.push({type:hl.LARGE_VIDEO_GAP_BETWEEN_CHUNK,nextDts:this._videoNextDts/90,firstSampleDts:l.dts/90,nextSampleDts:((null===(s=i[1])||void 0===s?void 0:s.dts)||0)/90,sampleDuration:u/90}),l.dts+=u,l.pts+=u,c&&Math.abs(c.dts-l.dts)>Tl)this._videoTimestampBreak=!0,i.forEach((function(e,t){0!==t&&(e.dts+=u,e.pts+=u)}));else for(var h=1;h<o-1;h++){var d,p=null===(d=i[h])||void 0===d?void 0:d.dts,f=i[h-1].dts;p&&p-f<0&&(i[h].dts+=u,i[h].pts+=u)}if(e.fpsNum&&e.fpsDen&&(r=e.timescale*(e.fpsDen/e.fpsNum)),r<900&&(r=0),!r){var g=e.samples[0],m=e.samples[1];r=1===o?9e3:Math.floor(m.dts-g.dts)}for(var v=0;v<o;v++){var y=i[v].dts,_=i[v+1];if(a=v<o-1?_.dts-y:i[v-1]?Math.min(y-i[v-1].dts,r):r,a>Tl||a<0){this._videoTimestampBreak=!0,a=this._audioTimestampBreak?r:Math.max(a,2700);var b=this._audioNextPts||0;_&&_.dts>b&&(a=r),e.warnings.push({type:hl.LARGE_VIDEO_GAP,time:y/e.timescale,dts:y,originDts:i[v].originDts,nextDts:this._videoNextDts,sampleDuration:a,refSampleDuration:r})}i[v].duration=a,this._videoNextDts+=a}}}},{key:"_fixAudio",value:function(e){var t=this,i=e.samples;i.length&&(i.forEach((function(e){e.pts-=t._needForceFixLargeGap?t._baseAudioDts:t._baseDts,e.dts=e.pts})),this._doFixAudioInternal(e,i,9e4))}},{key:"_calculateBaseDts",value:function(e,t){var i=e.samples,n=t.samples;if(!i.length&&!n.length)return!1;var s=1/0,r=1/0;i.length&&(e.baseDts=s=i[0].pts,this._baseAudioDts=s),n.length&&(t.baseDts=r=n[0].dts,this._baseVideoDts=r),this._baseDts=Math.min(s,r);var o=r-s,a=!1;return Number.isFinite(o)&&Math.abs(o)>_l&&t.warnings.push({type:hl.LARGE_AV_SHIFT,videoBaseDts:r,audioBasePts:s,baseDts:this._baseDts,delta:o}),Number.isFinite(o)&&Math.abs(o)>this._largeGapThreshold*Sl&&(a=!0),this._baseDtsInited||(a&&this._needForceFixLargeGap?this._needForceFixLargeGap=!0:this._needForceFixLargeGap=!1),this._baseDtsInited=!0,!0}},{key:"_resetBaseDtsWhenStreamBreaked",value:function(){if(this._baseDtsInited&&this._videoTimestampBreak&&this._audioTimestampBreak){var e=this._calculateBaseDts(this.audioTrack,this.videoTrack);if(!e)return;this._baseDts-=Math.min(this._audioNextPts,this._videoNextDts),this._audioLastSample=null,this._videoLastSample=null,this._videoTimestampBreak=!1,this._audioTimestampBreak=!1}}},{key:"_doFixAudioInternal",value:function(e,t,i){e.sampleDuration||(e.sampleDuration=yl.getFrameDuration(e.timescale,i));var n=e.sampleDuration;if(void 0===this._audioNextPts){var s=t[0];this._audioNextPts=s.pts}for(var r=0;r<t.length;r++){var o=this._audioNextPts,a=t[r],l=a.pts-o;if(!this._audioTimestampBreak&&l>=bl*n&&l<=Sl&&!gl){var c=yl.getSilentFrame(e.codec,e.channelCount)||t[0].data.subarray(),u=Math.floor(l/n);Math.abs(a.pts-this._lastAudioExceptionGapDot)>El&&(this._lastAudioExceptionGapDot=a.pts),e.warnings.push({type:hl.AUDIO_FILLED,pts:a.pts/90,originPts:a.originPts,count:u,nextPts:o/90,refSampleDuration:n});for(var h=0;h<u;h++){var d=new dl(Math.floor(o),c);d.originPts=Math.floor(this._baseDts+o),t.splice(r,0,d),this._audioNextPts+=n,r++}r--}else l<=-bl*n&&l>=-1*Sl?(Math.abs(a.pts-this._lastAudioExceptionOverlapDot)>El&&(this._lastAudioExceptionOverlapDot=a.pts,e.warnings.push({type:hl.AUDIO_DROPPED,pts:a.pts/90,originPts:a.originPts,nextPts:o/90,refSampleDuration:n})),t.splice(r,1),r--):(Math.abs(l)>=Sl&&(this._audioTimestampBreak=!0,Math.abs(a.pts-this._lastAudioExceptionLargeGapDot)>El&&(this._lastAudioExceptionLargeGapDot=a.pts,e.warnings.push({type:hl.LARGE_AUDIO_GAP,time:a.pts/1e3,pts:a.pts/90,originPts:a.originPts,nextPts:o/90,sampleDuration:l,refSampleDuration:n}))),a.dts=a.pts=o,this._audioNextPts+=n)}}}]),e}();function Cl(){for(var e=arguments.length,t=new Array(e),i=0;i<e;i++)t[i]=arguments[i];t=t.filter(Boolean);var n=new Uint8Array(t.reduce((function(e,t){return e+t.byteLength}),0)),s=0;return t.forEach((function(e){n.set(e,s),s+=e.byteLength})),n}var Al=Math.pow(2,32);function Pl(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return(e[t]<<8)+(e[t+1]||0)}function Il(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return(e[t]<<16)+(e[t+1]<<8)+(e[t+2]||0)}function Dl(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return(e[t]<<24>>>0)+(e[t+1]<<16)+(e[t+2]<<8)+(e[t+3]||0)}function Ll(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return Dl(e,t)*Al+Dl(e,t+4)}function Ol(e){for(var t,i="avc1.",n=0;n<3;n++)t=e[n].toString(16),t.length<2&&(t="0".concat(t)),i+=t;return i}function Rl(e){if(!Array.isArray(e)){for(var t=[],i="",n=0;n<e.length;n++)n%2&&(i=e[n-1]+e[n],t.push(parseInt(i,16)),i="");return t}return e.map((function(e){return parseInt(e,16)}))}function Ml(e,t){return Number(e+"."+t)}function Nl(e){if(e.length<5)return 0;var t=Math.hypot(e[0],e[3]),i=Math.hypot(e[1],e[4]);return 0===t||0===i?0:180*Math.atan2(e[1]/i,e[0]/t)/Math.PI}var Ul=function(){function e(){Fa(this,e)}return Ha(e,null,[{key:"parseAnnexB",value:function(e){var t=e.length,i=2,n=0;while(null!==e[i]&&void 0!==e[i]&&1!==e[i])i++;if(i++,n=i+2,n>=t)return[];var s=[];while(n<t)switch(e[n]){case 0:if(0!==e[n-1]){n+=2;break}if(0!==e[n-2]){n++;break}i!==n-2&&s.push(e.subarray(i,n-2));do{n++}while(1!==e[n]&&n<t);i=n+1,n=i+2;break;case 1:if(0!==e[n-1]||0!==e[n-2]){n+=3;break}i!==n-2&&s.push(e.subarray(i,n-2)),i=n+1,n=i+2;break;default:n+=3;break}return i<t&&s.push(e.subarray(i)),s}},{key:"parseAvcC",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:4;if(!(e.length<4)){var i,n=e.length,s=[],r=0;while(r+t<n)if(i=Dl(e,r),3===t&&(i>>>=8),r+=t,i){if(r+i>n)break;s.push(e.subarray(r,r+i)),r+=i}return s}}},{key:"parseSEI",value:function(e,t){var i=e.length,n=t?2:1,s=0,r=0,o="";while(255===e[n])s+=255,n++;s+=e[n++];while(255===e[n])r+=255,n++;if(r+=e[n++],5===s&&i>n+16)for(var a=0;a<16;a++)o+=e[n].toString(16),n++;return{payload:e.subarray(n,n+r),type:s,size:r,uuid:o}}},{key:"removeEPB",value:function(e){var t=e.byteLength,i=[],n=1;while(n<t-2)0===e[n]&&0===e[n+1]&&3===e[n+2]?(i.push(n+2),n+=2):n++;if(!i.length)return e;var s=t-i.length,r=new Uint8Array(s),o=0;for(n=0;n<s;o++,n++)o===i[0]&&(o++,i.shift()),r[n]=e[o];return r}}]),e}(),Fl=function(){function e(t){if(Fa(this,e),ja(this,"_bytesAvailable",void 0),ja(this,"_bitsAvailable",0),ja(this,"_word",0),!t)throw new Error("ExpGolomb data params is required");this._data=t,this._bytesAvailable=t.byteLength,this._bytesAvailable&&this._loadWord()}return Ha(e,[{key:"bitsAvailable",get:function(){return this._bitsAvailable}},{key:"_loadWord",value:function(){var e=this._data.byteLength-this._bytesAvailable,t=Math.min(4,this._bytesAvailable);if(0===t)throw new Error("No bytes available");var i=new Uint8Array(4);i.set(this._data.subarray(e,e+t)),this._word=new DataView(i.buffer).getUint32(0),this._bitsAvailable=8*t,this._bytesAvailable-=t}},{key:"skipBits",value:function(e){if(this._bitsAvailable>e)this._word<<=e,this._bitsAvailable-=e;else{e-=this._bitsAvailable;var t=Math.floor(e/8);e-=8*t,this._bytesAvailable-=t,this._loadWord(),this._word<<=e,this._bitsAvailable-=e}}},{key:"readBits",value:function(e){if(e>32)throw new Error("Cannot read more than 32 bits");var t=Math.min(this._bitsAvailable,e),i=this._word>>>32-t;return this._bitsAvailable-=t,this._bitsAvailable>0?this._word<<=t:this._bytesAvailable>0&&this._loadWord(),t=e-t,t>0&&this._bitsAvailable?i<<t|this.readBits(t):i}},{key:"skipLZ",value:function(){var e;for(e=0;e<this._bitsAvailable;++e)if(0!==(this._word&2147483648>>>e))return this._word<<=e,this._bitsAvailable-=e,e;return this._loadWord(),e+this.skipLZ()}},{key:"skipUEG",value:function(){this.skipBits(1+this.skipLZ())}},{key:"readUEG",value:function(){var e=this.skipLZ();return this.readBits(e+1)-1}},{key:"readEG",value:function(){var e=this.readUEG();return 1&e?1+e>>>1:-1*(e>>>1)}},{key:"readBool",value:function(){return 1===this.readBits(1)}},{key:"readUByte",value:function(){return this.readBits(8)}},{key:"skipScalingList",value:function(e){for(var t,i=8,n=8,s=0;s<e;s++)0!==n&&(t=this.readEG(),n=(i+t+256)%256),i=0===n?i:n}}]),e}(),Bl=function(){function e(){Fa(this,e)}return Ha(e,null,[{key:"parseAVCDecoderConfigurationRecord",value:function(t){if(!(t.length<7)){for(var i,n,s=1+(3&t[4]),r=[],o=[],a=6,l=31&t[5],c=0;c<l;c++)if(n=t[a]<<8|t[a+1],a+=2,n){var u=t.subarray(a,a+n);a+=n,r.push(u),i||(i=e.parseSPS(Ul.removeEPB(u)))}var h,d=t[a];a++;for(var p=0;p<d;p++)h=t[a]<<8|t[a+1],a+=2,h&&(o.push(t.subarray(a,a+h)),a+=h);return{sps:i,spsArr:r,ppsArr:o,nalUnitSize:s}}}},{key:"parseSPS",value:function(e){var t=new Fl(e);t.readUByte();var i=t.readUByte(),n=t.readUByte(),s=t.readUByte();t.skipUEG();var r=420;if(100===i||110===i||122===i||244===i||44===i||83===i||86===i||118===i||128===i||138===i||144===i){var o=t.readUEG();if(o<=3&&(r=[0,420,422,444][o]),3===o&&t.skipBits(1),t.skipUEG(),t.skipUEG(),t.skipBits(1),t.readBool())for(var a=3!==o?8:12,l=0;l<a;l++)t.readBool()&&(l<6?t.skipScalingList(16):t.skipScalingList(64))}t.skipUEG();var c=t.readUEG();if(0===c)t.readUEG();else if(1===c){t.skipBits(1),t.skipUEG(),t.skipUEG();for(var u=t.readUEG(),h=0;h<u;h++)t.skipUEG()}t.skipUEG(),t.skipBits(1);var d=t.readUEG(),p=t.readUEG(),f=t.readBits(1);0===f&&t.skipBits(1),t.skipBits(1);var g,m,v,y,_,b=0,S=0,E=0,T=0;if(t.readBool()&&(b=t.readUEG(),S=t.readUEG(),E=t.readUEG(),T=t.readUEG()),t.readBool()){if(t.readBool()){var k=t.readUByte();switch(k){case 1:g=[1,1];break;case 2:g=[12,11];break;case 3:g=[10,11];break;case 4:g=[16,11];break;case 5:g=[40,33];break;case 6:g=[24,11];break;case 7:g=[20,11];break;case 8:g=[32,11];break;case 9:g=[80,33];break;case 10:g=[18,11];break;case 11:g=[15,11];break;case 12:g=[64,33];break;case 13:g=[160,99];break;case 14:g=[4,3];break;case 15:g=[3,2];break;case 16:g=[2,1];break;case 255:g=[t.readUByte()<<8|t.readUByte(),t.readUByte()<<8|t.readUByte()];break}}if(t.readBool()&&t.readBool(),t.readBool()&&(t.readBits(4),t.readBool()&&t.readBits(24)),t.readBool()&&(t.readUEG(),t.readUEG()),t.readBool()){var w=t.readBits(32),x=t.readBits(32);m=t.readBool(),v=x,y=2*w,_=v/y}}return{codec:Ol(e.subarray(1,4)),profileIdc:i,profileCompatibility:n,levelIdc:s,chromaFormat:r,width:Math.ceil(16*(d+1)-2*(b+S)),height:(2-f)*(p+1)*16-(f?2:4)*(E+T),sarRatio:g,fpsNum:v,fpsDen:y,fps:_,fixedFrame:m}}}]),e}(),Hl=function(){function e(){Fa(this,e)}return Ha(e,null,[{key:"parseHEVCDecoderConfigurationRecord",value:function(t){var i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(!(t.length<23)){i=i||{};for(var n,s,r,o,a,l=1+(3&t[21]),c=[],u=[],h=[],d=23,p=t[22],f=0;f<p;f++){r=63&t[d],o=t[d+1]<<8|t[d+2],d+=3;for(var g=0;g<o;g++)if(a=t[d]<<8|t[d+1],d+=2,a){switch(r){case 32:var m=t.subarray(d,d+a);n||(n=e.parseVPS(Ul.removeEPB(m),i)),h.push(m);break;case 33:var v=t.subarray(d,d+a);s||(s=e.parseSPS(Ul.removeEPB(v),i)),c.push(v);break;case 34:u.push(t.subarray(d,d+a));break}d+=a}}return{hvcC:i,sps:s,spsArr:c,ppsArr:u,vpsArr:h,nalUnitSize:l}}}},{key:"parseVPS",value:function(t,i){i=i||{};var n=new Fl(t);n.readUByte(),n.readUByte(),n.readBits(12);var s=n.readBits(3);return i.numTemporalLayers=Math.max(i.numTemporalLayers||0,s+1),n.readBits(17),e._parseProfileTierLevel(n,s,i),i}},{key:"parseSPS",value:function(t){var i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};i=i||{};var n=new Fl(t);n.readUByte(),n.readUByte(),n.readBits(4);var s=n.readBits(3);i.numTemporalLayers=Math.max(s+1,i.numTemporalLayers||0),i.temporalIdNested=n.readBits(1),e._parseProfileTierLevel(n,s,i),n.readUEG();var r=i.chromaFormatIdc=n.readUEG(),o=420;r<=3&&(o=[0,420,422,444][r]);var a=0;3===r&&(a=n.readBits(1));var l,c,u,h,d=n.readUEG(),p=n.readUEG(),f=n.readBits(1);if(1===f&&(l=n.readUEG(),c=n.readUEG(),u=n.readUEG(),h=n.readUEG()),i.bitDepthLumaMinus8=n.readUEG(),i.bitDepthChromaMinus8=n.readUEG(),1===f){var g=1!==r&&2!==r||0!==a?1:2,m=1===r&&0===a?2:1;d-=g*(c+l),p-=m*(h+u)}return{codec:"hev1.1.6.L93.B0",width:d,height:p,chromaFormat:o,hvcC:i}}},{key:"_parseProfileTierLevel",value:function(e,t,i){var n=i.generalTierFlag||0;i.generalProfileSpace=e.readBits(2),i.generalTierFlag=Math.max(e.readBits(1),n),i.generalProfileIdc=Math.max(e.readBits(5),i.generalProfileIdc||0),i.generalProfileCompatibilityFlags=e.readBits(32),i.generalConstraintIndicatorFlags=[e.readBits(8),e.readBits(8),e.readBits(8),e.readBits(8),e.readBits(8),e.readBits(8)];var s=e.readBits(8);n<i.generalTierFlag?i.generalLevelIdc=s:i.generalLevelIdc=Math.max(s,i.generalLevelIdc||0);var r=[],o=[];if(t>e.bitsAvailable)throw new Error("maxSubLayersMinus inavlid size ".concat(t));for(var a=0;a<t;a++)r[a]=e.readBits(1),o[a]=e.readBits(1);t>0&&e.readBits(2*(8-t));for(var l=0;l<t;l++)0!==r[l]&&(e.readBits(2),e.readBits(1),e.readBits(5),e.readBits(16),e.readBits(16),e.readBits(4),e.readBits(16),e.readBits(16),e.readBits(12)),0!==o[l]&&e.readBits(8)}}]),e}(),jl=function(){function e(){Fa(this,e),ja(this,"id",1),ja(this,"type",ll.VIDEO),ja(this,"codecType",cl.AVC),ja(this,"pid",-1),ja(this,"hvcC",void 0),ja(this,"codec",""),ja(this,"timescale",0),ja(this,"formatTimescale",0),ja(this,"sequenceNumber",0),ja(this,"baseMediaDecodeTime",0),ja(this,"baseDts",0),ja(this,"duration",0),ja(this,"warnings",[]),ja(this,"samples",[]),ja(this,"pps",[]),ja(this,"sps",[]),ja(this,"vps",[]),ja(this,"fpsNum",0),ja(this,"fpsDen",0),ja(this,"sarRatio",[]),ja(this,"width",0),ja(this,"height",0),ja(this,"nalUnitSize",4),ja(this,"present",!1),ja(this,"isVideoEncryption",!1),ja(this,"isAudioEncryption",!1),ja(this,"isVideo",!0),ja(this,"lastKeyFrameDts",0),ja(this,"kid",null),ja(this,"pssh",null),ja(this,"ext",void 0)}return Ha(e,[{key:"reset",value:function(){this.sequenceNumber=this.width=this.height=this.fpsDen=this.fpsNum=this.duration=this.baseMediaDecodeTime=this.timescale=0,this.codec="",this.present=!1,this.pid=-1,this.pps=[],this.sps=[],this.vps=[],this.sarRatio=[],this.samples=[],this.warnings=[],this.hvcC=null}},{key:"firstDts",get:function(){return this.samples.length?this.samples[0].dts:null}},{key:"firstPts",get:function(){return this.samples.length?this.samples[0].pts:null}},{key:"samplesDuration",get:function(){if(this.samples.length>0){var e=this.samples[0],t=this.samples[this.samples.length-1];return t.dts-e.dts+t.duration}return 0}},{key:"exist",value:function(){return!!/av01/.test(this.codec)||!!(this.pps.length&&this.sps.length&&this.codec)}},{key:"hasSample",value:function(){return!!this.samples.length}},{key:"isEncryption",get:function(){return this.isVideoEncryption}}]),e}(),Vl=function(){function e(){Fa(this,e),ja(this,"id",2),ja(this,"type",ll.AUDIO),ja(this,"codecType",ul.AAC),ja(this,"pid",-1),ja(this,"codec",""),ja(this,"sequenceNumber",0),ja(this,"sampleDuration",0),ja(this,"timescale",0),ja(this,"formatTimescale",0),ja(this,"baseMediaDecodeTime",0),ja(this,"duration",0),ja(this,"warnings",[]),ja(this,"samples",[]),ja(this,"baseDts",0),ja(this,"sampleSize",16),ja(this,"sampleRate",0),ja(this,"channelCount",0),ja(this,"objectType",0),ja(this,"sampleRateIndex",0),ja(this,"config",[]),ja(this,"present",!1),ja(this,"isVideoEncryption",!1),ja(this,"isAudioEncryption",!1),ja(this,"kid",null),ja(this,"ext",void 0)}return Ha(e,[{key:"reset",value:function(){this.sequenceNumber=0,this.timescale=0,this.sampleDuration=0,this.sampleRate=0,this.channelCount=0,this.baseMediaDecodeTime=0,this.present=!1,this.pid=-1,this.codec="",this.samples=[],this.config=[],this.warnings=[]}},{key:"exist",value:function(){return!(!(this.sampleRate&&this.channelCount&&this.codec)||this.codecType!==ul.AAC&&this.codecType!==ul.G711PCMA&&this.codecType!==ul.G711PCMU&&this.codecType!==ul.OPUS)}},{key:"hasSample",value:function(){return!!this.samples.length}},{key:"isEncryption",get:function(){return this.isAudioEncryption}},{key:"firstDts",get:function(){return this.samples.length?this.samples[0].dts:null}},{key:"firstPts",get:function(){return this.samples.length?this.samples[0].pts:null}},{key:"samplesDuration",get:function(){if(this.samples.length>0){var e=this.samples[0],t=this.samples[this.samples.length-1];return t.dts-e.dts+t.duration}return 0}}]),e}(),Gl=function(){function e(t,i,n){Fa(this,e),ja(this,"flag",{}),ja(this,"keyframe",!1),ja(this,"gopId",0),ja(this,"duration",0),ja(this,"size",0),ja(this,"units",[]),ja(this,"chromaFormat",420),this.originPts=this.pts=t,this.originDts=this.dts=i,n&&(this.units=n)}return Ha(e,[{key:"cts",get:function(){return this.pts-this.dts}},{key:"setToKeyframe",value:function(){this.keyframe=!0,this.flag.dependsOn=2,this.flag.isNonSyncSample=0}}]),e}(),zl=Ha((function e(t,i){Fa(this,e),ja(this,"time",0),this.data=t,this.originPts=this.pts=i})),Kl=function(e){Va(i,e);var t=$a(i);function i(){return Fa(this,i),t.apply(this,arguments)}return Ha(i)}(zl),Wl=function(){function e(){Fa(this,e),ja(this,"id",3),ja(this,"type",ll.METADATA),ja(this,"timescale",0),ja(this,"flvScriptSamples",[]),ja(this,"seiSamples",[])}return Ha(e,[{key:"exist",value:function(){return!(!this.flvScriptSamples.length&&!this.seiSamples.length||!this.timescale)}},{key:"reset",value:function(){this.timescale=0,this.flvScriptSamples=[],this.seiSamples=[]}},{key:"hasSample",value:function(){return!(!this.flvScriptSamples.length&&!this.seiSamples.length)}}]),e}(),Yl=new al("TsDemuxer"),$l=function(){function e(t,i,n){var s=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};Fa(this,e),ja(this,"_pmtId",-1),ja(this,"_remainingPacketData",null),ja(this,"_videoPesData",[]),ja(this,"_audioPesData",[]),ja(this,"_gopId",0),this.videoTrack=t||new jl,this.audioTrack=i||new Vl,this.metadataTrack=n||new Wl,this._fixer=new xl(this.videoTrack,this.audioTrack,this.metadataTrack,s)}return Ha(e,[{key:"demux",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],i=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],n=this.audioTrack,s=this.videoTrack,r=this.metadataTrack;t&&(this._pmtId=-1,s.reset(),n.reset(),r.reset()),!i||t?(this._remainingPacketData=null,this._videoPesData=[],this._audioPesData=[]):(s.samples=[],n.samples=[],r.seiSamples=[],s.warnings=[],n.warnings=[],this._remainingPacketData&&(e=Cl(this._remainingPacketData,e),this._remainingPacketData=null));var o=e.length,a=o%188;a&&(this._remainingPacketData=e.subarray(o-a),o-=a);for(var l=s.pid,c=n.pid,u=0;u<o;u+=188){if(71!==e[u])throw new Error("TS packet did not start with 0x47");var h=!!(64&e[u+1]),d=((31&e[u+1])<<8)+e[u+2],p=(48&e[u+3])>>4,f=void 0;if(p>1){if(f=u+5+e[u+4],f===u+188)continue}else f=u+4;switch(d){case 0:h&&(f+=e[f]+1),this._pmtId=(31&e[f+10])<<8|e[f+11];break;case this._pmtId:h&&(f+=e[f]+1);var g=f+3+((15&e[f+1])<<8|e[f+2])-4,m=(15&e[f+10])<<8|e[f+11];f+=12+m;while(f<g){var v=(31&e[f+1])<<8|e[f+2];switch(e[f]){case 15:n.pid=c=v;break;case 27:if(-1!==l)break;s.codecType=cl.AVC,s.pid=l=v;break;case 36:if(-1!==l)break;s.codecType=cl.HEVC,s.pid=l=v;break;default:Yl.warn("Unsupported stream. type: ".concat(e[f],", pid: ").concat(v))}f+=5+((15&e[f+3])<<8|e[f+4])}break;case l:h&&this._videoPesData.length&&this._parseVideoData(),this._videoPesData.push(e.subarray(f,u+188));break;case c:h&&this._audioPesData.length&&this._parseAudioData(),this._audioPesData.push(e.subarray(f,u+188));break;case 17:case 8191:break;default:Yl.warn("Unknown pid: ".concat(d))}}return this._parseVideoData(),this._parseAudioData(),n.formatTimescale=s.formatTimescale=s.timescale=r.timescale=9e4,n.timescale=n.sampleRate||0,{videoTrack:s,audioTrack:n,metadataTrack:r}}},{key:"fix",value:function(e,t,i){return this._fixer.fix(e,t,i),{videoTrack:this.videoTrack,audioTrack:this.audioTrack,metadataTrack:this.metadataTrack}}},{key:"demuxAndFix",value:function(e,t,i,n){return this.demux(e,t,i),this.fix(n,t,i)}},{key:"_parseVideoData",value:function(){if(this._videoPesData.length){var t=e._parsePES(Cl.apply(void 0,qa(this._videoPesData)));if(t){var i=Ul.parseAnnexB(t.data);i?this._createVideoSample(i,t.pts,t.dts):Yl.warn("Cannot parse avc units",t),this._videoPesData=[]}else Yl.warn("Cannot parse video pes",this._videoPesData)}}},{key:"_createVideoSample",value:function(e,t,i){var n=this;if(e.length){var s=this.videoTrack,r=s.codecType===cl.HEVC,o=new Gl(t,i);e.forEach((function(e){var i=r?e[0]>>>1&63:31&e[0];switch(i){case 5:case 16:case 17:case 18:case 19:case 20:case 21:case 22:case 23:if(!r&&5!==i||r&&5===i)break;o.setToKeyframe(),n._gopId++;break;case 6:case 39:case 40:if(!r&&6!==i||r&&6===i)break;return void n.metadataTrack.seiSamples.push(new Kl(Ul.parseSEI(Ul.removeEPB(e),r),t));case 32:if(!r)break;if(!s.vps.length){var a=Hl.parseVPS(Ul.removeEPB(e),s.hvcC);s.hvcC=s.hvcC||a,s.vps=[e]}break;case 7:case 33:if(!r&&7!==i||r&&7===i)break;if(!s.sps.length){var l=Ul.removeEPB(e),c=r?Hl.parseSPS(l,s.hvcC):Bl.parseSPS(l);s.sps=[e],s.hvcC=s.hvcC||c.hvcC,s.codec=c.codec,s.width=c.width,s.height=c.height,s.sarRatio=c.sarRatio,s.fpsNum=c.fpsNum,s.fpsDen=c.fpsDen}break;case 8:case 34:if(!r&&8!==i||r&&8===i)break;s.pps.length||(s.pps=[e]);break;case 9:case 35:break;case 38:if(r){for(var u=!1,h=2;h<e.byteLength;h++)if(255===e[h]){u=!0;break}if(!u)return}break}o.units.push(e)})),o.gopId=this._gopId,this._pushVideoSample(s,o)}}},{key:"_pushVideoSample",value:function(e,t){if(t.units.length)if(null===t.pts||void 0===t.pts){Yl.warn("Video sample no pts",t);var i=e.samples[e.samples.length-1];i?(t.pts=i.pts,t.dts=i.dts):Yl.warn("Drop video sample",t)}else e.samples.push(t)}},{key:"_parseAudioData",value:function(){if(this._audioPesData.length){var t=e._parsePES(Cl.apply(void 0,qa(this._audioPesData)));t?(this._parseAacData(t),this._audioPesData=[]):Yl.warn("Cannot parse audio pes",this._audioPesData)}}},{key:"_parseAacData",value:function(e){var t=this.audioTrack,i=e.pts;if(null===i||void 0===i){if(Yl.warn("AAC pes not pts",t),!t.samples.length||!t.sampleRate)return;i=t.samples[t.samples.length-1].pts+yl.getFrameDuration(t.sampleRate)}var n,s=yl.parseADTS(e.data,i);s?(t.codec=s.codec,t.channelCount=s.channelCount,t.sampleRate=s.sampleRate,t.objectType=s.objectType,t.sampleRateIndex=s.samplingFrequencyIndex,t.config=s.config,(n=t.samples).push.apply(n,qa(s.frames.map((function(e){return new dl(e.pts,e.data)})))),s.skip&&Yl.warn("Skip aac adts ".concat(s.skip," bits")),s.remaining&&Yl.warn("Remaining aac adts ".concat(s.remaining," bits"))):Yl.warn("Cannot parse aac adts",e)}}],[{key:"probe",value:function(e){return!!e.length&&(71===e[0]&&71===e[188]&&71===e[376])}},{key:"_parsePES",value:function(e){var t=e[8];if(!(null===t||void 0===t||e.length<t+9)){var i=e[0]<<16|e[1]<<8|e[2];if(1===i){var n=(e[4]<<8)+e[5];if(!(n&&n>e.length-6)){var s,r,o=e[7];return 192&o&&(s=536870912*(14&e[9])+4194304*(255&e[10])+16384*(254&e[11])+128*(255&e[12])+(254&e[13])/2,64&o?(r=536870912*(14&e[14])+4194304*(255&e[15])+16384*(254&e[16])+128*(255&e[17])+(254&e[18])/2,s-r>54e5&&(s=r)):r=s),{data:e.subarray(9+t),pts:s,dts:r}}}}}}]),e}(),Xl=(i(9479),function(){function e(t,i,n){Fa(this,e),this.dv=new DataView(t),this.start=this.offset=i||this.dv.byteOffset,this.end=n?this.start+n:this.start+this.dv.byteLength}return Ha(e,[{key:"buffer",get:function(){return this.dv.buffer}},{key:"unreadLength",get:function(){return Math.max(this.end-this.offset,0)}},{key:"size",get:function(){return this.end-this.start}},{key:"readFloat",value:function(e){var t=0;switch(e){case 4:t=this.dv.getFloat32(this.offset);break;case 8:t=this.dv.getFloat64(this.offset);break;default:throw new Error("read ".concat(e,"-byte float is not supported"))}return this.offset+=e,t}},{key:"back",value:function(e){this.offset-=e}},{key:"skip",value:function(e){this.offset+=e}},{key:"readInt",value:function(e){var t=this.offset;switch(this.offset+=e,e){case 1:return this.dv.getInt8(t);case 2:return this.dv.getInt16(t);case 4:return this.dv.getInt32(t);default:throw new Error("read ".concat(e,"-byte integers is not supported"))}}},{key:"read",value:function(e){var t=this.offset;switch(this.offset+=e,e){case 1:return this.dv.getUint8(t);case 2:return this.dv.getUint16(t);case 3:return(this.dv.getUint16(t)<<8)+this.dv.getUint8(t+2);case 4:return this.dv.getUint32(t);default:return this.back(e-4),this.read(e-4)+this.dv.getUint32(t)*Math.pow(256,e-4)}}},{key:"write",value:function(e,t){var i=this.offset;switch(this.offset+=e,e){case 1:return this.dv.setUint8(i,t);case 2:return this.dv.setUint16(i,t);case 3:return this.dv.setUint8(i,t>>>16),this.dv.setUint16(i+1,65535&t);case 4:return this.dv.setUint32(i,t);default:throw new Error("write ".concat(e,"-byte integers is not supported"))}}},{key:"readToBuffer",value:function(e){var t;return t=this.offset||e?this.dv.buffer.slice(this.offset,e?this.offset+e:this.end):this.dv.buffer,this.offset+=t.byteLength,t}},{key:"readToUint8",value:function(e){var t=new Uint8Array(this.dv.buffer,this.offset,e||this.unreadLength);return this.offset+=t.byteLength,t}},{key:"readString",value:function(e){for(var t=0,i="";t<e;t++)i+=String.fromCharCode(this.dv.getUint8(this.offset)),this.offset++;return i}}],[{key:"fromUint8",value:function(t){return new e(t.buffer,t.byteOffset,t.byteLength)}},{key:"concatUint8s",value:function(e){var t=new Uint8Array(e.reduce((function(e,t){return e+t.byteLength}),0)),i=0;return e.forEach((function(e){t.set(e,i),i+=e.byteLength})),t}},{key:"concatUint8",value:function(){for(var e=arguments.length,t=new Array(e),i=0;i<e;i++)t[i]=arguments[i];return this.concatUint8s(t)}}]),e}()),ql=function(){function e(t,i){Fa(this,e),this.offset=0,this.val=t,this.size=i}return Ha(e,[{key:"skip",value:function(e){this.offset+=e}},{key:"read",value:function(e){var t=this.size-this.offset-e;if(t>=0){var i=0,n=0;if(this.offset+=e,this.size>31){for(;n<e;n++)i+=Math.pow(2,n);return this.val/Math.pow(2,t)&i}for(;n<e;n++)i+=1<<n;return this.val>>>t&i}throw new Error("the number of the read operation exceeds the total length limit of bits")}}],[{key:"fromByte",value:function(t,i){return new e(t.read(i),i<<3)}}]),e}(),Ql=function(){function e(){Fa(this,e)}return Ha(e,null,[{key:"findBox",value:function(t,i){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,s=[];if(!t)return s;var r=0,o="",a=0;while(t.length>7){if(r=Dl(t),o=String.fromCharCode.apply(null,t.subarray(4,8)),a=8,1===r?(r=Ll(t,8),a+=8):r||(r=t.length),!i[0]||o===i[0]){var l=t.subarray(0,r);if(!(i.length<2))return e.findBox(l.subarray(a),i.slice(1),n+a);s.push({start:n,size:r,headerSize:a,type:o,data:l})}n+=r,t=t.subarray(r)}return s}},{key:"tfhd",value:function(e){return tc(e,!0,(function(e,t){e.trackId=Dl(t);var i=4,n=1&e.flags,s=2&e.flags,r=8&e.flags,o=16&e.flags,a=32&e.flags;n&&(i+=4,e.baseDataOffset=Dl(t,i),i+=4),s&&(e.sampleDescriptionIndex=Dl(t,i),i+=4),r&&(e.defaultSampleDuration=Dl(t,i),i+=4),o&&(e.defaultSampleSize=Dl(t,i),i+=4),a&&(e.defaultSampleFlags=Dl(t,i))}))}},{key:"sidx",value:function(e){return tc(e,!0,(function(e,t){var i=0;e.reference_ID=Dl(t,i),i+=4,e.timescale=Dl(t,i),i+=4,0===e.version?(e.earliest_presentation_time=Dl(t,i),i+=4,e.first_offset=Dl(t,i),i+=4):(e.earliest_presentation_time=Ll(t,i),i+=8,e.first_offset=Ll(t,i),i+=8),i+=2,e.references=[];var n=Pl(t,i);i+=2;for(var s=0;s<n;s++){var r={};e.references.push(r);var o=Dl(t,i);i+=4,r.reference_type=o>>31&1,r.referenced_size=2147483647&o,r.subsegment_duration=Dl(t,i),i+=4,o=Dl(t,i),i+=4,r.starts_with_SAP=o>>31&1,r.SAP_type=o>>28&7,r.SAP_delta_time=268435455&o}}))}},{key:"moov",value:function(t){return tc(t,!1,(function(t,i,n){t.mvhd=e.mvhd(e.findBox(i,["mvhd"],n)[0]),t.trak=e.findBox(i,["trak"],n).map((function(t){return e.trak(t)})),t.pssh=e.pssh(e.findBox(i,["pssh"],n)[0])}))}},{key:"mvhd",value:function(e){return tc(e,!0,(function(e,t){var i=0;1===e.version?(e.timescale=Dl(t,16),e.duration=Ll(t,20),i+=28):(e.timescale=Dl(t,8),e.duration=Dl(t,12),i+=16),e.nextTrackId=Dl(t,i+76)}))}},{key:"trak",value:function(t){return tc(t,!1,(function(t,i,n){t.tkhd=e.tkhd(e.findBox(i,["tkhd"],n)[0]),t.mdia=e.mdia(e.findBox(i,["mdia"],n)[0])}))}},{key:"tkhd",value:function(e){return tc(e,!0,(function(e,t){var i=Xl.fromUint8(t);1===e.version?(i.read(8),i.read(8),e.trackId=i.read(4),i.read(4),e.duration=i.read(8)):(i.read(4),i.read(4),e.trackId=i.read(4),i.read(4),e.duration=i.read(4)),i.skip(16),e.matrix=[];for(var n=0;n<36;n++)e.matrix.push(i.read(1));i.back(36);for(var s,r=[],o=0;o<3;o++)r.push(Ml(i.readInt(2),i.readInt(2))),r.push(Ml(i.readInt(2),i.readInt(2))),s=i.readInt(4),r.push(Ml(s>>30,1073741823&s));e.rotation=Nl(r),e.width=i.read(4),e.height=i.read(4)}))}},{key:"mdia",value:function(t){return tc(t,!1,(function(t,i,n){t.mdhd=e.mdhd(e.findBox(i,["mdhd"],n)[0]),t.hdlr=e.hdlr(e.findBox(i,["hdlr"],n)[0]),t.minf=e.minf(e.findBox(i,["minf"],n)[0])}))}},{key:"mdhd",value:function(e){return tc(e,!0,(function(e,t){var i=0;1===e.version?(e.timescale=Dl(t,16),e.duration=Ll(t,20),i+=28):(e.timescale=Dl(t,8),e.duration=Dl(t,12),i+=16);var n=Pl(t,i);e.language=String.fromCharCode(96+(n>>10&31),96+(n>>5&31),96+(31&n))}))}},{key:"hdlr",value:function(e){return tc(e,!0,(function(e,t){0===e.version&&(e.handlerType=String.fromCharCode.apply(null,t.subarray(4,8)))}))}},{key:"minf",value:function(t){return tc(t,!1,(function(t,i,n){t.vmhd=e.vmhd(e.findBox(i,["vmhd"],n)[0]),t.smhd=e.smhd(e.findBox(i,["smhd"],n)[0]),t.stbl=e.stbl(e.findBox(i,["stbl"],n)[0])}))}},{key:"vmhd",value:function(e){return tc(e,!0,(function(e,t){e.graphicsmode=Pl(t),e.opcolor=[Pl(t,2),Pl(t,4),Pl(t,6)]}))}},{key:"smhd",value:function(e){return tc(e,!0,(function(e,t){e.balance=Pl(t)}))}},{key:"stbl",value:function(t){return tc(t,!1,(function(t,i,n){var s,r,o;t.stsd=e.stsd(e.findBox(i,["stsd"],n)[0]),t.stts=e.stts(e.findBox(i,["stts"],n)[0]),t.ctts=e.ctts(e.findBox(i,["ctts"],n)[0]),t.stsc=e.stsc(e.findBox(i,["stsc"],n)[0]),t.stsz=e.stsz(e.findBox(i,["stsz"],n)[0]),t.stco=e.stco(e.findBox(i,["stco"],n)[0]),t.stco||(t.co64=e.co64(e.findBox(i,["co64"],n)[0]),t.stco=t.co64);var a=null===(s=t.stsd.entries[0])||void 0===s||null===(r=s.sinf)||void 0===r||null===(o=r.schi)||void 0===o?void 0:o.tenc.default_IV_size;t.stss=e.stss(e.findBox(i,["stss"],n)[0]),t.senc=e.senc(e.findBox(i,["senc"],n)[0],a)}))}},{key:"senc",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:8;return tc(e,!0,(function(e,i){var n=0,s=Dl(i,n);n+=4,e.samples=[];for(var r=0;r<s;r++){for(var o={InitializationVector:[]},a=0;a<t;a++)o.InitializationVector[a]=i[n+a];if(n+=t,2&e.flags){o.subsamples=[];var l=Pl(i,n);n+=2;for(var c=0;c<l;c++){var u={};u.BytesOfClearData=Pl(i,n),n+=2,u.BytesOfProtectedData=Dl(i,n),n+=4,o.subsamples.push(u)}}e.samples.push(o)}}))}},{key:"pssh",value:function(e){return tc(e,!0,(function(e,t){for(var i=[],n=[],s=0,r=0;r<16;r++)n.push(nc(t[s+r]));if(s+=16,e.version>0){var o=Dl(t,s);s+=4;for(var a=0;a<(""+o).length;a++)for(var l=0;l<16;l++){var c=t[s];s+=1,i.push(nc(c))}}var u=Dl(t,s);e.data_size=u,s+=4,e.kid=i,e.system_id=n,e.buffer=t}))}},{key:"stsd",value:function(t){return tc(t,!0,(function(t,i,n){t.entryCount=Dl(i),t.entries=e.findBox(i.subarray(4),[],n+4).map((function(t){switch(t.type){case"av01":return e.av01(t);case"avc1":case"avc2":case"avc3":case"avc4":return e.avc1(t);case"hvc1":case"hev1":return e.hvc1(t);case"mp4a":return e.mp4a(t);case"alaw":case"ulaw":return e.alaw(t);case"enca":return tc(t,!1,(function(t,i,n){t.channelCount=Pl(i,16),t.samplesize=Pl(i,18),t.sampleRate=Dl(i,24)/65536,i=i.subarray(28),t.sinf=e.sinf(e.findBox(i,["sinf"],n)[0]),t.esds=e.esds(e.findBox(i,["esds"],n)[0])}));case"encv":return tc(t,!1,(function(t,i,n){t.width=Pl(i,24),t.height=Pl(i,26),t.horizresolution=Dl(i,28),t.vertresolution=Dl(i,32),i=i.subarray(78),t.sinf=e.sinf(e.findBox(i,["sinf"],n)[0]),t.avcC=e.avcC(e.findBox(i,["avcC"],n)[0]),t.hvcC=e.hvcC(e.findBox(i,["hvcC"],n)[0]),t.pasp=e.pasp(e.findBox(i,["pasp"],n)[0])}))}})).filter(Boolean)}))}},{key:"tenc",value:function(e){return tc(e,!1,(function(e,t){var i=6;e.default_IsEncrypted=t[i],i+=1,e.default_IV_size=t[i],i+=1,e.default_KID=[];for(var n=0;n<16;n++)e.default_KID.push(nc(t[i])),i+=1}))}},{key:"schi",value:function(t){return tc(t,!1,(function(t,i,n){t.tenc=e.tenc(e.findBox(i,["tenc"],n)[0])}))}},{key:"sinf",value:function(t){return tc(t,!1,(function(t,i,n){t.schi=e.schi(e.findBox(i,["schi"],n)[0]),t.frma=e.frma(e.findBox(i,["frma"],n)[0])}))}},{key:"frma",value:function(e){return tc(e,!1,(function(e,t){e.data_format="";for(var i=0;i<4;i++)e.data_format+=String.fromCharCode(t[i])}))}},{key:"colr",value:function(e){return tc(e,!1,(function(t,i){var n=Xl.fromUint8(i);t.data=e.data,t.colorType=n.readString(4),"nclx"===t.colorType?(t.colorPrimaries=n.read(2),t.transferCharacteristics=n.read(2),t.matrixCoefficients=n.read(2),t.fullRangeFlag=n.read(1)>>7):"rICC"!==t.colorType&&"prof"!==t.colorType||(t.iccProfile=i.readToUint8())}))}},{key:"av01",value:function(t){return tc(t,!1,(function(t,i,n){var s=Jl(t,i),r=i.subarray(s);n+=s,t.av1C=e.av1C(e.findBox(r,["av1C"],n)[0]),t.colr=e.colr(e.findBox(r,["colr"],n)[0])}))}},{key:"av1C",value:function(e){return tc(e,!1,(function(t,i){t.data=e.data;var n,s=Xl.fromUint8(i),r=ql.fromByte(s,4);t.marker=r.read(1),t.version=r.read(7),t.seqProfile=r.read(3),t.seqLevelIdx0=r.read(5),t.seqTier0=r.read(1),t.highBitdepth=r.read(1),t.twelveBit=r.read(1),t.monochrome=r.read(1),t.chromaSubsamplingX=r.read(1),t.chromaSubsamplingY=r.read(1),t.chromaSamplePosition=r.read(2),t.reserved=r.read(3),t.initialPresentationDelayPresent=r.read(1),t.initialPresentationDelayPresent?t.initialPresentationDelayMinusOne=r.read(4):t.initialPresentationDelayMinusOne=0,t.configOBUs=s.readToUint8(),2===t.seqLevelIdx0&&1===t.highBitdepth?n=1===t.twelveBit?"12":"10":t.seqProfile<=2&&(n=1===t.highBitdepth?"10":"08"),t.codec=["av01",t.seqProfile,(t.seqLevelIdx0<10?"0"+t.seqLevelIdx0:t.seqLevelIdx0)+(t.seqTier0?"H":"M"),n].join(".")}))}},{key:"avc1",value:function(t){return tc(t,!1,(function(t,i,n){var s=Jl(t,i),r=i.subarray(s);n+=s,t.avcC=e.avcC(e.findBox(r,["avcC"],n)[0]),t.pasp=e.pasp(e.findBox(r,["pasp"],n)[0])}))}},{key:"avcC",value:function(e){return tc(e,!1,(function(t,i){t.data=e.data,t.configurationVersion=i[0],t.AVCProfileIndication=i[1],t.profileCompatibility=i[2],t.AVCLevelIndication=i[3],t.codec=Ol([i[1],i[2],i[3]]),t.lengthSizeMinusOne=3&i[4],t.spsLength=31&i[5],t.sps=[];for(var n=6,s=0;s<t.spsLength;s++){var r=Pl(i,n);n+=2,t.sps.push(i.subarray(n,n+r)),n+=r}t.ppsLength=i[n],n+=1,t.pps=[];for(var o=0;o<t.ppsLength;o++){var a=Pl(i,n);n+=2,t.pps.push(i.subarray(n,n+=a)),n+=a}}))}},{key:"hvc1",value:function(t){return tc(t,!1,(function(t,i,n){var s=Jl(t,i),r=i.subarray(s);n+=s,t.hvcC=e.hvcC(e.findBox(r,["hvcC"],n)[0]),t.pasp=e.pasp(e.findBox(r,["pasp"],n)[0])}))}},{key:"hvcC",value:function(e){return tc(e,!1,(function(t,i){t.data=e.data,t.codec="hev1.1.6.L93.B0",t.configurationVersion=i[0];var n=i[1];t.generalProfileSpace=n>>6,t.generalTierFlag=(32&n)>>5,t.generalProfileIdc=31&n,t.generalProfileCompatibility=Dl(i,2),t.generalConstraintIndicatorFlags=i.subarray(6,12),t.generalLevelIdc=i[12],t.avgFrameRate=Pl(i,19),t.numOfArrays=i[22],t.vps=[],t.sps=[],t.pps=[];for(var s=23,r=0,o=0,a=0,l=0;l<t.numOfArrays;l++){r=63&i[s],o=Pl(i,s+1),s+=3;for(var c,u=[],h=0;h<o;h++)a=Pl(i,s),s+=2,u.push(i.subarray(s,s+a)),s+=a;if(32===r)(c=t.vps).push.apply(c,u);else if(33===r){var d;(d=t.sps).push.apply(d,u)}else if(34===r){var p;(p=t.pps).push.apply(p,u)}}}))}},{key:"pasp",value:function(e){return tc(e,!1,(function(e,t){e.hSpacing=Dl(t),e.vSpacing=Dl(t,4)}))}},{key:"mp4a",value:function(t){return tc(t,!1,(function(t,i,n){var s=ec(t,i);t.esds=e.esds(e.findBox(i.subarray(s),["esds"],n+s)[0])}))}},{key:"esds",value:function(e){return tc(e,!0,(function(e,t){e.codec="mp4a.";var i=0,n=0,s=0,r=0;while(t.length){i=0,r=t[i],n=t[i+1],i+=2;while(128&n)s=(127&n)<<7,n=t[i],i+=1;if(s+=127&n,3===r)t=t.subarray(i+3);else{if(4!==r){if(5===r){var o=e.config=t.subarray(i,i+s),a=(248&o[0])>>3;return 31===a&&o.length>=2&&(a=32+((7&o[0])<<3)+((224&o[1])>>5)),e.objectType=a,e.codec+=a.toString(16),void("."===e.codec[e.codec.length-1]&&(e.codec=e.codec.substring(0,e.codec.length-1)))}return void("."===e.codec[e.codec.length-1]&&(e.codec=e.codec.substring(0,e.codec.length-1)))}e.codec+=(t[i].toString(16)+".").padStart(3,"0"),t=t.subarray(i+13)}}}))}},{key:"alaw",value:function(e){return tc(e,!1,(function(e,t){ec(e,t)}))}},{key:"stts",value:function(e){return tc(e,!0,(function(e,t){for(var i=Dl(t),n=[],s=4,r=0;r<i;r++)n.push({count:Dl(t,s),delta:Dl(t,s+4)}),s+=8;e.entryCount=i,e.entries=n}))}},{key:"ctts",value:function(e){return tc(e,!0,(function(e,t){var i=Dl(t),n=[],s=4;if(1===e.version)for(var r=0;r<i;r++)n.push({count:Dl(t,s),offset:Dl(t,s+4)}),s+=8;else for(var o=0;o<i;o++)n.push({count:Dl(t,s),offset:-(1+~Dl(t,s+4))}),s+=8;e.entryCount=i,e.entries=n}))}},{key:"stsc",value:function(e){return tc(e,!0,(function(e,t){for(var i=Dl(t),n=[],s=4,r=0;r<i;r++)n.push({firstChunk:Dl(t,s),samplesPerChunk:Dl(t,s+4),sampleDescriptionIndex:Dl(t,s+8)}),s+=12;e.entryCount=i,e.entries=n}))}},{key:"stsz",value:function(e){return tc(e,!0,(function(e,t){var i=Dl(t),n=Dl(t,4),s=[];if(!i)for(var r=8,o=0;o<n;o++)s.push(Dl(t,r)),r+=4;e.sampleSize=i,e.sampleCount=n,e.entrySizes=s}))}},{key:"stco",value:function(e){return tc(e,!0,(function(e,t){for(var i=Dl(t),n=[],s=4,r=0;r<i;r++)n.push(Dl(t,s)),s+=4;e.entryCount=i,e.entries=n}))}},{key:"co64",value:function(e){return tc(e,!0,(function(e,t){for(var i=Dl(t),n=[],s=4,r=0;r<i;r++)n.push(Ll(t,s)),s+=8;e.entryCount=i,e.entries=n}))}},{key:"stss",value:function(e){return tc(e,!0,(function(e,t){for(var i=Dl(t),n=[],s=4,r=0;r<i;r++)n.push(Dl(t,s)),s+=4;e.entryCount=i,e.entries=n}))}},{key:"moof",value:function(t){return tc(t,!1,(function(t,i,n){t.mfhd=e.mfhd(e.findBox(i,["mfhd"],n)[0]),t.traf=e.findBox(i,["traf"],n).map((function(t){return e.traf(t)}))}))}},{key:"mfhd",value:function(e){return tc(e,!0,(function(e,t){e.sequenceNumber=Dl(t)}))}},{key:"traf",value:function(t){return tc(t,!1,(function(t,i,n){t.tfhd=e.tfhd(e.findBox(i,["tfhd"],n)[0]),t.tfdt=e.tfdt(e.findBox(i,["tfdt"],n)[0]),t.trun=e.trun(e.findBox(i,["trun"],n)[0])}))}},{key:"trun",value:function(e){return tc(e,!0,(function(e,t){var i=e.version,n=e.flags,s=t.length,r=e.sampleCount=Dl(t),o=4;if(s>o&&1&n&&(e.dataOffset=-(1+~Dl(t,o)),o+=4),s>o&&4&n&&(e.firstSampleFlags=Dl(t,o),o+=4),e.samples=[],s>o)for(var a,l=0;l<r;l++)a={},256&n&&(a.duration=Dl(t,o),o+=4),512&n&&(a.size=Dl(t,o),o+=4),1024&n&&(a.flags=Dl(t,o),o+=4),2048&n&&(a.cts=i?-(1+~Dl(t,o+4)):Dl(t,o),o+=4),e.samples.push(a)}))}},{key:"tfdt",value:function(e){return tc(e,!0,(function(e,t){1===e.version?e.baseMediaDecodeTime=Ll(t):e.baseMediaDecodeTime=Dl(t)}))}},{key:"probe",value:function(t){return!!e.findBox(t,["ftyp"])}},{key:"parseSampleFlags",value:function(e){return{isLeading:(12&e[0])>>>2,dependsOn:3&e[0],isDependedOn:(192&e[1])>>>6,hasRedundancy:(48&e[1])>>>4,paddingValue:(14&e[1])>>>1,isNonSyncSample:1&e[1],degradationPriority:e[2]<<8|e[3]}}},{key:"moovToTrack",value:function(e,t,i){var n,s,r=e.trak;if(r&&r.length){var o=r.find((function(e){var t,i;return"vide"===(null===(t=e.mdia)||void 0===t||null===(i=t.hdlr)||void 0===i?void 0:i.handlerType)})),a=r.find((function(e){var t,i;return"soun"===(null===(t=e.mdia)||void 0===t||null===(i=t.hdlr)||void 0===i?void 0:i.handlerType)}));if(o&&t){var l,c,u,h,d,p,f,g=t,m=null===(l=o.tkhd)||void 0===l?void 0:l.trackId;null!==m&&void 0!==m&&(g.id=o.tkhd.trackId),g.tkhdDuration=o.tkhd.duration,g.mvhdDurtion=e.mvhd.duration,g.mvhdTimecale=e.mvhd.timescale,g.timescale=g.formatTimescale=o.mdia.mdhd.timescale,g.duration=o.mdia.mdhd.duration||g.mvhdDurtion/g.mvhdTimecale*g.timescale,g.rotation=o.tkhd.rotation,g.matrix=o.tkhd.matrix;var v,y,_,b,S,E,T,k,w=o.mdia.minf.stbl.stsd.entries[0];if(g.width=w.width,g.height=w.height,w.pasp&&(g.sarRatio=[w.pasp.hSpacing,w.pasp.vSpacing]),w.av1C)g.codecType=cl.AV1,g.codec=w.av1C.codec,g.av1C=w.av1C.data,g.colr=w.colr.data;else if(w.hvcC)g.codecType=cl.HEVC,g.codec=w.hvcC.codec,g.vps=w.hvcC.vps,g.sps=w.hvcC.sps,g.pps=w.hvcC.pps,g.hvcC=w.hvcC.data;else{if(!w.avcC)throw new Error("unknown video stsd entry");g.codec=w.avcC.codec,g.sps=w.avcC.sps,g.pps=w.avcC.pps}if(g.present=!0,g.ext={},g.ext.stss=null===(c=o.mdia)||void 0===c||null===(u=c.minf)||void 0===u||null===(h=u.stbl)||void 0===h?void 0:h.stss,g.ext.ctts=null===(d=o.mdia)||void 0===d||null===(p=d.minf)||void 0===p||null===(f=p.stbl)||void 0===f?void 0:f.ctts,w&&"encv"===w.type)g.isVideoEncryption=!0,w.default_KID=null===(v=w.sinf)||void 0===v||null===(y=v.schi)||void 0===y?void 0:y.tenc.default_KID,w.default_IsEncrypted=null===(_=w.sinf)||void 0===_||null===(b=_.schi)||void 0===b?void 0:b.tenc.default_IsEncrypted,w.default_IV_size=null===(S=w.sinf)||void 0===S||null===(E=S.schi)||void 0===E?void 0:E.tenc.default_IV_size,g.videoSenc=o.mdia.minf.stbl.senc&&o.mdia.minf.stbl.senc.samples,w.data_format=null===(T=w.sinf)||void 0===T||null===(k=T.frma)||void 0===k?void 0:k.data_format,g.useEME=e.useEME,g.kidValue=e.kidValue,g.pssh=e.pssh,g.encv=w}if(a&&i){var x,C,A,P,I,D,L,O,R,M=i,N=null===(x=a.tkhd)||void 0===x?void 0:x.trackId;null!==N&&void 0!==N&&(M.id=a.tkhd.trackId),M.tkhdDuration=a.tkhd.duration,M.mvhdDurtion=e.mvhd.duration,M.mvhdTimecale=e.mvhd.timescale,M.timescale=M.formatTimescale=a.mdia.mdhd.timescale,M.duration=a.mdia.mdhd.duration||M.mvhdDurtion/M.mvhdTimecale*M.timescale;var U,F,B,H,j,V,G,z,K=a.mdia.minf.stbl.stsd.entries[0];switch(M.sampleSize=K.sampleSize,M.sampleRate=K.sampleRate,M.channelCount=K.channelCount,M.present=!0,K.type){case"alaw":M.codecType=M.codec=ul.G711PCMA,M.sampleRate=8e3;break;case"ulaw":M.codecType=M.codec=ul.G711PCMU,M.sampleRate=8e3;break;default:M.sampleDuration=yl.getFrameDuration(M.sampleRate,M.timescale),M.sampleRateIndex=yl.getRateIndexByRate(M.sampleRate),M.objectType=(null===(n=K.esds)||void 0===n?void 0:n.objectType)||2,K.esds&&(M.config=Array.from(K.esds.config)),M.codec=(null===(s=K.esds)||void 0===s?void 0:s.codec)||"mp4a.40.2";break}if(M.sampleDuration=yl.getFrameDuration(M.sampleRate,M.timescale),M.objectType=(null===(C=K.esds)||void 0===C?void 0:C.objectType)||2,K.esds&&(K.esds.config?M.config=Array.from(K.esds.config):console.warn("esds config is null")),M.codec=(null===(A=K.esds)||void 0===A?void 0:A.codec)||"mp4a.40.2",M.sampleRateIndex=yl.getRateIndexByRate(M.sampleRate),M.ext={},M.ext.stss=null===(P=a.mdia)||void 0===P||null===(I=P.minf)||void 0===I||null===(D=I.stbl)||void 0===D?void 0:D.stss,M.ext.ctts=null===(L=a.mdia)||void 0===L||null===(O=L.minf)||void 0===O||null===(R=O.stbl)||void 0===R?void 0:R.ctts,M.present=!0,K&&"enca"===K.type)M.isAudioEncryption=!0,K.data_format=null===(U=K.sinf)||void 0===U||null===(F=U.frma)||void 0===F?void 0:F.data_format,K.default_KID=null===(B=K.sinf)||void 0===B||null===(H=B.schi)||void 0===H?void 0:H.tenc.default_KID,K.default_IsEncrypted=null===(j=K.sinf)||void 0===j||null===(V=j.schi)||void 0===V?void 0:V.tenc.default_IsEncrypted,K.default_IV_size=null===(G=K.sinf)||void 0===G||null===(z=G.schi)||void 0===z?void 0:z.tenc.default_IV_size,M.audioSenc=a.mdia.minf.stbl.senc&&a.mdia.minf.stbl.senc.samples,M.useEME=e.useEME,M.kidValue=e.kidValue,M.enca=K}if(i&&(i.isVideoEncryption=!!t&&t.isVideoEncryption),t&&(t.isAudioEncryption=!!i&&i.isAudioEncryption),null!==t&&void 0!==t&&t.encv||null!==i&&void 0!==i&&i.enca){var W,Y,$=null===t||void 0===t||null===(W=t.encv)||void 0===W?void 0:W.default_KID,X=null===i||void 0===i||null===(Y=i.enca)||void 0===Y?void 0:Y.default_KID,q=$||X?($||X).join(""):null;t&&(t.kid=q),i&&(i.kid=q)}return t&&(t.flags=3841),i&&(i.flags=1793),{videoTrack:t,audioTrack:i}}}},{key:"evaluateDefaultDuration",value:function(e,t,i){var n,s=null===t||void 0===t||null===(n=t.samples)||void 0===n?void 0:n.length;if(!s)return 1024;var r=1024*s/t.timescale;return r*e.timescale/i}},{key:"moofToSamples",value:function(t,i,n){var s={};return t.mfhd&&(i&&(i.sequenceNumber=t.mfhd.sequenceNumber),n&&(n.sequenceNumber=t.mfhd.sequenceNumber)),t.traf.forEach((function(t){var r=t.tfhd,o=t.tfdt,a=t.trun;if(r&&a){o&&(i&&i.id===r.trackId&&(i.baseMediaDecodeTime=o.baseMediaDecodeTime),n&&n.id===r.trackId&&(n.baseMediaDecodeTime=o.baseMediaDecodeTime));var l=r.defaultSampleSize||0,c=r.defaultSampleDuration||e.evaluateDefaultDuration(i,n,a.samples.length||a.sampleCount),u=a.dataOffset||0,h=0,d=-1;if(!a.samples.length&&a.sampleCount){s[r.trackId]=[];for(var p=0;p<a.sampleCount;p++)s[r.trackId].push({offset:u,dts:h,duration:c,size:l}),h+=c,u+=l}else s[r.trackId]=a.samples.map((function(e,t){return e={offset:u,dts:h,pts:h+(e.cts||0),duration:e.duration||c,size:e.size||l,gopId:d,keyframe:0===t||null!==e.flags&&void 0!==e.flags&&(65536&e.flags)>>>0!==65536},e.keyframe&&(d++,e.gopId=d),h+=e.duration,u+=e.size,e}))}})),s}},{key:"moovToSamples",value:function(e){var t=e.trak;if(t&&t.length){var i=t.find((function(e){var t,i;return"vide"===(null===(t=e.mdia)||void 0===t||null===(i=t.hdlr)||void 0===i?void 0:i.handlerType)})),n=t.find((function(e){var t,i;return"soun"===(null===(t=e.mdia)||void 0===t||null===(i=t.hdlr)||void 0===i?void 0:i.handlerType)}));if(i||n){var s,r;if(i){var o,a,l=null===(o=i.mdia)||void 0===o||null===(a=o.minf)||void 0===a?void 0:a.stbl;if(!l)return;var c=l.stts,u=l.stsc,h=l.stsz,d=l.stco,p=l.stss,f=l.ctts;if(!c||!u||!h||!d||!p)return;s=Zl(c,u,h,d,f,p)}if(n){var g,m,v,y=null===(g=n.mdia)||void 0===g||null===(m=g.minf)||void 0===m?void 0:m.stbl;if(!y)return;var _=null===(v=n.mdia.mdhd)||void 0===v?void 0:v.timescale,b=y.stts,S=y.stsc,E=y.stsz,T=y.stco;if(!_||!b||!S||!E||!T)return;r=Zl(b,S,E,T)}return{videoSamples:s,audioSamples:r}}}}}]),e}();function Zl(e,t,i,n,s,r){var o,a,l,c=[],u=null===s||void 0===s?void 0:s.entries,h=t.entries,d=n.entries,p=i.entrySizes,f=null===r||void 0===r?void 0:r.entries;f&&(o={},f.forEach((function(e){o[e-1]=!0}))),u&&(a=[],u.forEach((function(e){for(var t=e.count,i=e.offset,n=0;n<t;n++)a.push(i)})));var g=-1,m=0,v=0,y=0,_=0,b=0,S=h[0].samplesPerChunk,E=h[1]?h[1].firstChunk-1:1/0;return e.entries.forEach((function(e){for(var t=e.count,n=e.delta,s=0;s<t;s++)l={dts:m,duration:n,size:p[v]||i.sampleSize,offset:d[y]+b,index:v},f&&(l.keyframe=o[v],l.keyframe&&g++,l.gopId=g),a&&v<a.length&&(l.pts=l.dts+a[v]),c.push(l),m+=n,v++,v<S?b+=l.size:(y++,b=0,y>=E&&(_++,E=h[_+1]?h[_+1].firstChunk-1:1/0),S+=h[_].samplesPerChunk)})),c}function Jl(e,t){return e.dataReferenceIndex=Pl(t,6),e.width=Pl(t,24),e.height=Pl(t,26),e.horizresolution=Dl(t,28),e.vertresolution=Dl(t,32),e.frameCount=Pl(t,40),e.depth=Pl(t,74),78}function ec(e,t){return e.dataReferenceIndex=Pl(t,6),e.channelCount=Pl(t,16),e.sampleSize=Pl(t,18),e.sampleRate=Dl(t,24)/65536,28}function tc(e,t,i){if(e){if(e.size!==e.data.length)throw new Error("box ".concat(e.type," size !== data.length"));var n={start:e.start,size:e.size,headerSize:e.headerSize,type:e.type};return t&&(n.version=e.data[e.headerSize],n.flags=Il(e.data,e.headerSize+1),n.headerSize+=4),i(n,e.data.subarray(n.headerSize),n.start+n.headerSize),n}}var ic=function(e,t,i){var n=String(i),s=t|0,r=Math.ceil(s/n.length),o=[],a=String(e);while(r--)o.push(n);return o.join("").substring(0,s-a.length)+a},nc=function(){for(var e=[],t=arguments.length,i=new Array(t),n=0;n<t;n++)i[n]=arguments[n];return i.forEach((function(t){e.push(ic(Number(t).toString(16),2,0))})),e[0]},sc=function(){function e(){ao(this,e);var t=window.crypto||window.msCrypto;this.subtle=t&&(t.subtle||t.webkitSubtle),this.externalDecryptor=null}return co(e,[{key:"destroy",value:function(){var e;null!==(e=this.externalDecryptor)&&void 0!==e&&e.destroy&&this.externalDecryptor.destroy()}},{key:"decrypt",value:function(e,t){if(e||t){var i=[];return e&&(i[0]=this._decryptSegment(e)),t&&(i[1]=this._decryptSegment(t)),Promise.all(i)}}},{key:"_decryptSegment",value:function(){var e=oo(no().mark((function e(t){var i;return no().wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(i=t.data,!t.key){e.next=5;break}return e.next=4,this._decryptData(t.data,t.key,t.keyIv);case 4:i=e.sent;case 5:if(t.map){e.next=7;break}return e.abrupt("return",i);case 7:return e.abrupt("return",Da(t.map,i));case 8:case"end":return e.stop()}}),e,this)})));function t(t){return e.apply(this,arguments)}return t}()},{key:"_decryptData",value:function(){var e=oo(no().mark((function e(t,i,n){var s;return no().wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(!this.externalDecryptor){e.next=6;break}return e.next=3,this.externalDecryptor.decrypt(t,i,n);case 3:return e.abrupt("return",e.sent);case 6:if(this.subtle){e.next=8;break}throw new Error("crypto is not defined");case 8:return e.next=10,this.subtle.importKey("raw",i,{name:"AES-CBC"},!1,["encrypt","decrypt"]);case 10:return s=e.sent,e.t0=Uint8Array,e.next=14,this.subtle.decrypt({name:"AES-CBC",iv:n},s,t);case 14:return e.t1=e.sent,e.abrupt("return",new e.t0(e.t1));case 16:case"end":return e.stop()}}),e,this)})));function t(t,i,n){return e.apply(this,arguments)}return t}()}]),e}(),rc=(i(7550),function(){function e(t,i,n){Fa(this,e),ja(this,"__loadedMoofWraps",[]),ja(this,"__lastRemainData",null),ja(this,"__lastRemainDataStart",0),ja(this,"__nextMoofStart",-1),this.videoTrack=t||new jl,this.audioTrack=i||new Vl,this.metadataTrack=n||new Wl}return Ha(e,[{key:"demuxPart",value:function(e,t,i){var n=this,s=this.videoTrack,r=this.audioTrack,o=s.exist(),a=r.exist(),l=/av01/.test(s.codec);s.samples=[],r.samples=[];var c=e,u=t;if(this.__lastRemainData){var h=this.__lastRemainDataStart+this.__lastRemainData.byteLength,d=t<=h&&t>this.__lastRemainDataStart&&t+e.byteLength>h;if(d){var p=e.subarray(this.__lastRemainData.byteLength+this.__lastRemainDataStart-t);c=Cl(this.__lastRemainData,p),u=this.__lastRemainDataStart,this.__lastRemainData=null}else this.__lastRemainData=null,this.__lastRemainDataStart=0,this.__nextMoofStart=-1}if(!i){var f=Ql.findBox(c,["moov"])[0];if(!f)throw new Error("cannot found moov box");i=Ql.moov(f)}if(c){var g=u+c.byteLength;o||a||Ql.moovToTrack(i,s,r);var m=[];this.__nextMoofStart<0?Ql.findBox(c,["moof"],u).forEach((function(e){return m.push(e)})):this.__nextMoofStart>=u&&this.__nextMoofStart<=g-8&&Ql.findBox(c.subarray(this.__nextMoofStart-u),["moof"],this.__nextMoofStart).forEach((function(e){return m.push(e)})),m.filter((function(e){return e.size<=e.data.length})).forEach((function(e){var t=Ql.moof(e);n.__nextMoofStart=t.start+Math.max.apply(Math,qa(t.traf.map((function(e){return e.trun.samples.reduce((function(e,t){return e+t.size}),e.trun.dataOffset||0)})))),n.__loadedMoofWraps.push({start:t.start,nextMoofStart:n.__nextMoofStart,moof:t}),n.__loadedMoofWraps.sort((function(e,t){return e.start-t.start}))}));var v,y=sl(this.__loadedMoofWraps);try{var _=function(){var e=v.value;if(e.start>g||e.nextMoofStart<u)return"continue";var t,i=e.start,o=Ql.moofToSamples(e.moof,s,r),a=s.baseMediaDecodeTime,h=r.baseMediaDecodeTime;Object.keys(o).forEach((function(e){s.id==e?o[e].some((function(e){var r=e.offset+=i;if(!(r<u)){if(r+e.size>g)return!0;var o=new Gl((e.pts||e.dts)+a,e.dts+a);o.duration=e.duration,o.gopId=e.gopId,e.keyframe&&o.setToKeyframe();var h=c.subarray(r-u,r-u+e.size);if(o.data=h,!l){var d=0,p=h.length-1;while(d<p)t=Dl(h,d),d+=4,o.units.push(h.subarray(d,d+t)),d+=t}n.__lastRemainDataStart=r+e.size,s.samples.push(o)}})):r.id==e&&o[e].some((function(e){var t=e.offset+i;if(!(t<u)){if(t+e.size>g)return!0;var s=c.subarray(t-u,t-u+e.size);r.samples.push(new dl(e.dts+h,s,e.duration)),n.__lastRemainDataStart=t+e.size}}))}))};for(y.s();!(v=y.n()).done;)_()}catch(b){y.e(b)}finally{y.f()}}return this.__lastRemainDataStart>u&&this.__lastRemainDataStart<c.byteLength+u?this.__lastRemainData=c.subarray(this.__lastRemainDataStart-u):(this.__lastRemainData=c,this.__lastRemainDataStart=u),s.samples.length&&(s.baseMediaDecodeTime=s.samples[0].pts),r.samples.length&&(r.baseMediaDecodeTime=r.samples[0].pts),{videoTrack:s,audioTrack:r,metadataTrack:this.metadataTrack}}},{key:"demux",value:function(e,t){var i=this.videoTrack,n=this.audioTrack,s=i.exist(),r=n.exist();if(i.samples=[],n.samples=[],t){if(!r){var o=Ql.findBox(t,["moov"])[0];if(!o)throw new Error("cannot found moov box");Ql.moovToTrack(Ql.moov(o),null,n)}var a=Ql.findBox(t,["moof"])[0];if(a){var l=Ql.moofToSamples(Ql.moof(a),null,n)[n.id],c=n.baseMediaDecodeTime;if(l){var u=a.start;l.map((function(e){e.offset+=u;var i=t.subarray(e.offset,e.offset+e.size);n.samples.push(new dl(e.dts+c,i,e.duration))}))}}}if(e){if(!s&&!r){var h=Ql.findBox(e,["moov"])[0];if(!h)throw new Error("cannot found moov box");Ql.moovToTrack(Ql.moov(h),i,n)}var d=Ql.findBox(e,["moof"])[0];if(d){var p,f=Ql.moofToSamples(Ql.moof(d),i,n),g=i.baseMediaDecodeTime,m=n.baseMediaDecodeTime,v=d.start;Object.keys(f).forEach((function(t){i.id==t?f[t].map((function(t){t.offset+=v;var n=new Gl((t.pts||t.dts)+g,t.dts+g);n.duration=t.duration,n.gopId=t.gopId,t.keyframe&&n.setToKeyframe();var s=e.subarray(t.offset,t.offset+t.size);n.data=s;var r=0,o=s.length-1;while(r<o)p=Dl(s,r),r+=4,n.units.push(s.subarray(r,r+p)),r+=p;i.samples.push(n)})):n.id==t&&f[t].map((function(t){t.offset+=v;var i=e.subarray(t.offset,t.offset+t.size);n.samples.push(new dl(t.dts+m,i,t.duration))}))}))}}return{videoTrack:i,audioTrack:n,metadataTrack:this.metadataTrack}}},{key:"reset",value:function(){this.videoTrack.reset(),this.audioTrack.reset(),this.metadataTrack.reset()}}],[{key:"probe",value:function(e){return Ql.probe(e)}}]),e}());function oc(e){for(var t=0,i=arguments.length,n=new Array(i>1?i-1:0),s=1;s<i;s++)n[s-1]=arguments[s];n.forEach((function(e){t+=e.length}));var r=new e(t),o=0;return n.forEach((function(e){r.set(e,o),o+=e.length})),r}var ac=function(){function e(){Fa(this,e),this.buffer=new Uint8Array(0)}return Ha(e,[{key:"write",value:function(){for(var e=this,t=arguments.length,i=new Array(t),n=0;n<t;n++)i[n]=arguments[n];i.forEach((function(t){t?e.buffer=oc(Uint8Array,e.buffer,t):window.console.warn(t)}))}}],[{key:"writeUint16",value:function(e){return new Uint8Array([e>>8&255,255&e])}},{key:"writeUint32",value:function(e){return new Uint8Array([e>>24,e>>16&255,e>>8&255,255&e])}}]),e}(),lc=Math.pow(2,32)-1,cc=function(){function e(){Fa(this,e)}return Ha(e,null,[{key:"box",value:function(e){for(var t=arguments.length,i=new Array(t>1?t-1:0),n=1;n<t;n++)i[n-1]=arguments[n];i=i.filter(Boolean);var s=8+i.reduce((function(e,t){return e+t.byteLength}),0),r=new Uint8Array(s);r[0]=s>>24&255,r[1]=s>>16&255,r[2]=s>>8&255,r[3]=255&s,r.set(e,4);var o=8;return i.forEach((function(e){r.set(e,o),o+=e.byteLength})),r}},{key:"ftyp",value:function(t){var i=t.find((function(e){return e.type===ll.VIDEO&&e.codecType===cl.HEVC}));return i?e.FTYPHEV1:e.FTYPAVC1}},{key:"initSegment",value:function(t){var i=e.ftyp(t),n=Cl(i,e.moov(t));return n}},{key:"pssh",value:function(t){var i=new Uint8Array([1,0,0,0].concat([16,119,239,236,192,178,77,2,172,227,60,30,82,226,251,75],[0,0,0,1],Rl(t.kid),[0,0,0,0]));return e.box(e.types.pssh,i)}},{key:"moov",value:function(t){if(t[0].useEME&&(t[0].encv||t[0].enca)){t[0].pssh||(t[0].pssh={kid:t[0].kid});var i=this.pssh(t[0].pssh);return e.box.apply(e,[e.types.moov,e.mvhd(t[0].mvhdDurtion||t[0].duration,t[0].mvhdTimecale||t[0].timescale),e.mvex(t)].concat(qa(t.map((function(t){return e.trak(t)}))),[i]))}return e.box.apply(e,[e.types.moov,e.mvhd(t[0].mvhdDurtion||t[0].duration,t[0].mvhdTimecale||t[0].timescale)].concat(qa(t.map((function(t){return e.trak(t)}))),[e.mvex(t)]))}},{key:"mvhd",value:function(t){var i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:9e4,n=e.box(e.types.mvhd,new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0,i>>24&255,i>>16&255,i>>8&255,255&i,t>>24&255,t>>16&255,t>>8&255,255&t,0,1,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,255,255,255,255]));return n}},{key:"trak",value:function(t){var i=e.box(e.types.trak,e.tkhd(t.id,t.tkhdDuration||0,t.width,t.height),e.mdia(t));return i}},{key:"tkhd",value:function(t,i){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,s=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,r=e.box(e.types.tkhd,new Uint8Array([0,0,0,7,0,0,0,0,0,0,0,0,t>>24&255,t>>16&255,t>>8&255,255&t,0,0,0,0,i>>24&255,i>>16&255,i>>8&255,255&i,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,n>>8&255,255&n,0,0,s>>8&255,255&s,0,0]));return r}},{key:"mdia",value:function(t){var i=e.box(e.types.mdia,e.mdhd(t.duration,t.timescale),e.hdlr(t.type),e.minf(t));return i}},{key:"mdhd",value:function(t){var i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:9e4,n=e.box(e.types.mdhd,new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0,i>>24&255,i>>16&255,i>>8&255,255&i,t>>24&255,t>>16&255,t>>8&255,255&t,85,196,0,0]));return n}},{key:"hdlr",value:function(t){var i=e.box(e.types.hdlr,e.HDLR_TYPES[t]);return i}},{key:"minf",value:function(t){var i=e.box(e.types.minf,t.type===ll.VIDEO?e.VMHD:e.SMHD,e.DINF,e.stbl(t));return i}},{key:"stbl",value:function(t){var i=[];t&&t.ext&&t.ext.stss&&i.push(e.stss(t.ext.stss.entries));var n=e.box(e.types.stbl,e.stsd(t),e.STTS,i[0],e.STSC,e.STSZ,e.STCO);return n}},{key:"stsd",value:function(t){var i;i="audio"===t.type?t.useEME&&t.enca?e.enca(t):t.codecType===ul.OPUS?e.opus(t):e.mp4a(t):t.useEME&&t.encv?e.encv(t):t.av1C?e.av01(t):e.avc1hev1(t);var n=e.box(e.types.stsd,new Uint8Array([0,0,0,0,0,0,0,1]),i);return n}},{key:"enca",value:function(t){var i=t.enca.channelCount,n=t.enca.sampleRate,s=new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,i,0,16,0,0,0,0,n>>8&255,255&n,0,0]),r=e.esds(t.config),o=e.sinf(t.enca);return e.box(e.types.enca,s,r,o)}},{key:"encv",value:function(t){var i,n,s=t.sps.length>0?t.sps[0]:[],r=t.pps.length>0?t.pps[0]:[],o=t.width,a=t.height,l=t.sarRatio[0],c=t.sarRatio[1],u=new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,o>>8&255,255&o,a>>8&255,255&a,0,72,0,0,0,72,0,0,0,0,0,0,0,1,18,100,97,105,108,121,109,111,116,105,111,110,47,104,108,115,46,106,115,0,0,0,0,0,0,0,0,0,0,0,0,0,0,24,17,17]),h=new Uint8Array((i=(n=[1,s[1],s[2],s[3],255,225,s.length>>>8&255,255&s.length]).concat.apply(n,qa(s)).concat([1,r.length>>>8&255,255&r.length])).concat.apply(i,qa(r))),d=new Uint8Array([0,0,88,57,0,15,200,192,0,4,86,72]),p=e.sinf(t.encv),f=new Uint8Array([l>>24,l>>16&255,l>>8&255,255&l,c>>24,c>>16&255,c>>8&255,255&c]);return e.box(e.types.encv,u,e.box(e.types.avcC,h),e.box(e.types.btrt,d),p,e.box(e.types.pasp,f))}},{key:"schi",value:function(t){var i=new Uint8Array([]),n=e.tenc(t);return e.box(e.types.schi,i,n)}},{key:"tenc",value:function(t){var i=new Uint8Array([0,0,0,0,0,0,255&t.default_IsEncrypted,255&t.default_IV_size].concat(Rl(t.default_KID)));return e.box(e.types.tenc,i)}},{key:"sinf",value:function(t){var i=new Uint8Array([]),n=new Uint8Array([t.data_format.charCodeAt(0),t.data_format.charCodeAt(1),t.data_format.charCodeAt(2),t.data_format.charCodeAt(3)]),s=new Uint8Array([0,0,0,0,99,101,110,99,0,1,0,0]),r=e.schi(t);return e.box(e.types.sinf,i,e.box(e.types.frma,n),e.box(e.types.schm,s),r)}},{key:"av01",value:function(t){return e.box(e.types.av01,new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,t.width>>8&255,255&t.width,t.height>>8&255,255&t.height,0,72,0,0,0,72,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,24,17,17]),t.av1C,t.colr)}},{key:"avc1hev1",value:function(t){var i=t.codecType===cl.HEVC,n=i?e.types.hvc1:e.types.avc1,s=i?e.hvcC(t):e.avcC(t),r=[new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,t.width>>8&255,255&t.width,t.height>>8&255,255&t.height,0,72,0,0,0,72,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,24,17,17]),s];return i?r.push(e.box(e.types.fiel,new Uint8Array([1,0]))):t.sarRatio&&t.sarRatio.length>1&&r.push(e.pasp(t.sarRatio)),e.box.apply(e,[n].concat(r))}},{key:"avcC",value:function(t){var i,n,s,r=[],o=[];return t.sps.forEach((function(e){s=e.byteLength,r.push(s>>>8&255),r.push(255&s),r.push.apply(r,qa(e))})),t.pps.forEach((function(e){s=e.byteLength,o.push(s>>>8&255),o.push(255&s),o.push.apply(o,qa(e))})),e.box(e.types.avcC,new Uint8Array((i=(n=[1,r[3],r[4],r[5],255,224|t.sps.length]).concat.apply(n,r).concat([t.pps.length])).concat.apply(i,o)))}},{key:"hvcC",value:function(t){var i=t.hvcC;if(i instanceof ArrayBuffer||i instanceof Uint8Array)return i;var n,s=t.vps,r=t.sps,o=t.pps;if(i){var a=i.generalProfileCompatibilityFlags,l=i.generalConstraintIndicatorFlags,c=(s.length&&1)+(r.length&&1)+(o.length&&1);n=[1,i.generalProfileSpace<<6|i.generalTierFlag<<5|i.generalProfileIdc,a>>>24,a>>>16,a>>>8,a,l[0],l[1],l[2],l[3],l[4],l[5],i.generalLevelIdc,240,0,252,252|i.chromaFormatIdc,248|i.bitDepthLumaMinus8,248|i.bitDepthChromaMinus8,0,0,i.numTemporalLayers<<3|i.temporalIdNested<<2|3,c];var u=function(e){var t;n.push(e.length>>8,e.length),(t=n).push.apply(t,qa(e))};s.length&&(n.push(160,0,s.length),s.forEach(u)),r.length&&(n.push(161,0,r.length),r.forEach(u)),o.length&&(n.push(162,0,o.length),o.forEach(u))}else n=[1,1,96,0,0,0,144,0,0,0,0,0,93,240,0,252,253,248,248,0,0,15,3,160,0,1,0,24,64,1,12,1,255,255,1,96,0,0,3,0,144,0,0,3,0,0,3,0,93,153,152,9,161,0,1,0,45,66,1,1,1,96,0,0,3,0,144,0,0,3,0,0,3,0,93,160,2,128,128,45,22,89,153,164,147,43,154,128,128,128,130,0,0,3,0,2,0,0,3,0,50,16,162,0,1,0,7,68,1,193,114,180,98,64];return e.box(e.types.hvcC,new Uint8Array(n))}},{key:"pasp",value:function(t){var i=Xa(t,2),n=i[0],s=i[1];return e.box(e.types.pasp,new Uint8Array([n>>24,n>>16&255,n>>8&255,255&n,s>>24,s>>16&255,s>>8&255,255&s]))}},{key:"mp4a",value:function(t){return e.box(e.types.mp4a,new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,t.channelCount,0,16,0,0,0,0,t.sampleRate>>8&255,255&t.sampleRate,0,0]),t.config.length?e.esds(t.config):void 0)}},{key:"esds",value:function(t){var i=t.length,n=e.box(e.types.esds,new Uint8Array([0,0,0,0,3,23+i,0,0,0,4,15+i,64,21,0,6,0,0,0,218,192,0,0,218,192,5].concat([i]).concat(t).concat([6,1,2])));return n}},{key:"opus",value:function(t){var i=new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,t.channelCount,0,16,0,0,0,0,t.sampleRate>>8&255,255&t.sampleRate,0,0]),n=t.config.length?e.dOps(t):[];return e.box(e.types.Opus,i,n)}},{key:"dOps",value:function(t){if(t.config)return t.config[4]=t.sampleRate>>>24&255,t.config[5]=t.sampleRate>>>16&255,t.config[6]=t.sampleRate>>>8&255,t.config[7]=255&t.sampleRate,e.box(e.types.dOps,t.config)}},{key:"mvex",value:function(t){var i=e.box.apply(e,[e.types.mvex].concat(qa(t.map((function(t){return e.trex(t.id)})))));return i}},{key:"trex",value:function(t){var i=e.box(e.types.trex,new Uint8Array([0,0,0,0,t>>24,t>>16&255,t>>8&255,255&t,0,0,0,1,0,0,0,0,0,0,0,0,0,1,0,1]));return i}},{key:"trex1",value:function(t){var i=e.box(e.types.trex,new Uint8Array([0,0,0,0,t>>24,t>>16&255,t>>8&255,255&t,0,0,0,1,0,0,2,0,0,0,0,0,0,1,0,0]));return i}},{key:"trex2",value:function(t){var i=e.box(e.types.trex,new Uint8Array([0,0,0,0,t>>24,t>>16&255,t>>8&255,255&t,0,0,0,1,0,0,4,0,0,0,0,0,2,0,0,0]));return i}},{key:"moof",value:function(t){var i=e.box.apply(e,[e.types.moof,e.mfhd(t[0].samples?t[0].samples[0].gopId:0)].concat(qa(t.map((function(t){return e.traf(t)})))));return i}},{key:"mfhd",value:function(t){var i=e.box(e.types.mfhd,new Uint8Array([0,0,0,0,t>>24,t>>16&255,t>>8&255,255&t]));return i}},{key:"traf",value:function(t){var i,n=e.tfhd(t.id),s=e.tfdt(t,t.baseMediaDecodeTime),r=0;if(t.isVideo&&t.videoSenc&&(i=t.videoSenc,i.forEach((function(e){r+=8,e.subsamples&&e.subsamples.length&&(r+=2,r+=6*e.subsamples.length)}))),t.videoSencLength=r,t.useEME&&(t.isVideoEncryption||t.isAudioEncryption)){if(t.isVideoEncryption){if(t.isVideo){var o=e.saiz(t),a=e.saio(t),l=e.trun1(t),c=e.senc(t),u=e.box(e.types.traf,n,s,o,a,l,c);return u}if(t.isAudioEncryption){var h=e.sbgp(),d=e.saiz(t),p=e.saio(t),f=e.senc(t),g=e.trun1(t),m=e.box(e.types.traf,n,s,h,d,p,f,g);return m}var v=e.sbgp(),y=e.trun1(t);return e.box(e.types.traf,n,s,v,y)}if(t.isVideo){var _=e.trun1(t);return e.box(e.types.traf,n,s,_)}var b=e.sbgp(),S=e.saiz(t),E=e.saio(t),T=e.senc(t),k=e.trun1(t),w=e.box(e.types.traf,n,s,b,S,E,T,k);return w}var x=e.sdtp(t),C=76;return e.box(e.types.traf,n,s,x,e.trun(t.samples,x.byteLength+C))}},{key:"sdtp",value:function(t){var i=new ac;return t.samples.forEach((function(e){i.write(new Uint8Array(t.isVideo?[e.keyframe?32:16]:[16]))})),e.box(e.types.sdtp,this.extension(0,0),i.buffer)}},{key:"trun1",value:function(t){var i=new ac,n=ac.writeUint32(t.samples.length),s=null;if(t.isVideo){var r=t.videoSencLength;s=ac.writeUint32(16*t.samples.length+r+149),!t.isVideoEncryption&&t.isAudioEncryption&&(s=ac.writeUint32(16*t.samples.length+92))}else{var o=12*t.samples.length+124;t.isAudioEncryption&&(o=12*t.samples.length+8*t.audioSenc.length+177),s=ac.writeUint32(o)}return t.samples.forEach((function(e){i.write(ac.writeUint32(e.duration)),i.write(ac.writeUint32(e.size)),i.write(ac.writeUint32(e.keyframe?33554432:65536)),t.isVideo&&i.write(ac.writeUint32(e.cts?e.cts:0))})),e.box(e.types.trun,this.extension(0,t.flags),n,s,i.buffer)}},{key:"senc",value:function(t){var i=new ac,n=t.samples.length,s=t.isVideo?16:8,r=t.isVideo?2:0,o=[],a=0;return t.isVideo?(o=t.videoSenc,a=t.videoSencLength):o=t.audioSenc,a=a||s*n,i.write(ac.writeUint32(16+a),e.types.senc,this.extension(0,r)),i.write(ac.writeUint32(n)),o.forEach((function(e){for(var t=0;t<e.InitializationVector.length;t++)i.write(new Uint8Array([e.InitializationVector[t]]));e.subsamples&&e.subsamples.length&&(i.write(ac.writeUint16(e.subsamples.length)),e.subsamples.forEach((function(e){i.write(ac.writeUint16(e.BytesOfClearData)),i.write(ac.writeUint32(e.BytesOfProtectedData))})))})),i.buffer}},{key:"saio",value:function(t){var i=12*t.samples.length+141;!t.isVideo&&t.isAudioEncryption&&(i=149);var n=new Uint8Array([1,0,0,0,0,0,0,1,0,0,0,0,i>>24&255,i>>16&255,i>>8&255,255&i]);return e.box(e.types.saio,n)}},{key:"saiz",value:function(t){var i=t.samples.length,n=new Uint8Array([0,0,0,0,16,i>>24&255,i>>16&255,i>>8&255,255&i]);return e.box(e.types.saiz,n)}},{key:"sbgp",value:function(){var t=new Uint8Array([114,111,108,108,0,0,0,1,0,0,1,25,0,0,0,1]);return e.box(e.types.sbgp,this.extension(0,0),t)}},{key:"extension",value:function(e,t){return new Uint8Array([e,t>>16&255,t>>8&255,255&t])}},{key:"tfhd",value:function(t){return e.box(e.types.tfhd,new Uint8Array([0,0,0,0,t>>24,t>>16&255,t>>8&255,255&t]))}},{key:"tfdt",value:function(t,i){var n=Math.floor(i/(lc+1)),s=Math.floor(i%(lc+1));return t.useEME&&(t.isVideoEncryption||t.isAudioEncryption)?e.box(e.types.tfdt,new Uint8Array([0,0,0,0,s>>24,s>>16&255,s>>8&255,255&s])):e.box(e.types.tfdt,new Uint8Array([1,0,0,0,n>>24,n>>16&255,n>>8&255,255&n,s>>24,s>>16&255,s>>8&255,255&s]))}},{key:"trun",value:function(t,i){var n=t.length,s=12+16*n;i+=8+s;var r=new Uint8Array(s);r.set([0,0,15,1,n>>>24&255,n>>>16&255,n>>>8&255,255&n,i>>>24&255,i>>>16&255,i>>>8&255,255&i],0);for(var o=0;o<n;o++){var a=t[o],l=a.duration,c=a.size,u=a.flag,h=void 0===u?{}:u,d=a.cts,p=void 0===d?0:d;r.set([l>>>24&255,l>>>16&255,l>>>8&255,255&l,c>>>24&255,c>>>16&255,c>>>8&255,255&c,h.isLeading<<2|(null===h.dependsOn||void 0===h.dependsOn?1:h.dependsOn),h.isDependedOn<<6|h.hasRedundancy<<4|h.paddingValue<<1|(null===h.isNonSyncSample||void 0===h.isNonSyncSample?1:h.isNonSyncSample),61440&h.degradationPriority,15&h.degradationPriority,p>>>24&255,p>>>16&255,p>>>8&255,255&p],12+16*o)}return e.box(e.types.trun,r)}},{key:"moovMP4",value:function(t){return e.box.apply(e,[e.types.moov,e.mvhd(t[0].duration,t[0].timescale)].concat(qa(t.map((function(t){return e.trackMP4(t)})))))}},{key:"trackMP4",value:function(t){return e.box(e.types.trak,e.tkhd(t.id,t.duration,t.width,t.height),e.mdiaMP4(t))}},{key:"mdiaMP4",value:function(t){return e.box(e.types.mdia,e.mdhd(t.duration,t.timescale),e.hdlr(t.type),e.minfMP4(t))}},{key:"minfMP4",value:function(t){return e.box(e.types.minf,t.type===ll.VIDEO?e.VMHD:e.SMHD,e.DINF,e.stblMP4(t))}},{key:"stblMP4",value:function(t){var i=t.ext,n=[e.stsd(t),e.stts(i.stts),e.stsc(i.stsc),e.stsz(i.stsz),e.stco(i.stco)];return i.stss.length&&n.push(e.stss(i.stss)),i.ctts.length&&n.push(e.ctts(i.ctts)),e.box.apply(e,[e.types.stbl].concat(n))}},{key:"stts",value:function(t){var i=t.length,n=new Uint8Array(8*i),s=0;return t.forEach((function(e){var t=e.value,i=e.count;n.set([i>>24,i>>16&255,i>>8&255,255&i,t>>24,t>>16&255,t>>8&255,255&t],s),s+=8})),e.box(e.types.stts,Cl(new Uint8Array([0,0,0,0,i>>24,i>>16&255,i>>8&255,255&i]),n))}},{key:"stsc",value:function(t){var i=t.length,n=new Uint8Array(12*i),s=0;return t.forEach((function(e){var t=e.firstChunk,i=e.samplesPerChunk,r=e.sampleDescIndex;n.set([t>>24,t>>16&255,t>>8&255,255&t,i>>24,i>>16&255,i>>8&255,255&i,r>>24,r>>16&255,r>>8&255,255&r],s),s+=12})),e.box(e.types.stsc,Cl(new Uint8Array([0,0,0,0,i>>24,i>>16&255,i>>8&255,255&i]),n))}},{key:"stsz",value:function(t){var i=t.length,n=new Uint8Array(4*i),s=0;return t.forEach((function(e){n.set([e>>24,e>>16&255,e>>8&255,255&e],s),s+=4})),e.box(e.types.stsz,Cl(new Uint8Array([0,0,0,0,0,0,0,0,i>>24,i>>16&255,i>>8&255,255&i]),n))}},{key:"stco",value:function(t){var i=t.length,n=new Uint8Array(4*i),s=0;return t.forEach((function(e){n.set([e>>24,e>>16&255,e>>8&255,255&e],s),s+=4})),e.box(e.types.stco,Cl(new Uint8Array([0,0,0,0,i>>24,i>>16&255,i>>8&255,255&i]),n))}},{key:"stss",value:function(t){var i=t.length,n=new Uint8Array(4*i),s=0;return t.forEach((function(e){n.set([e>>24,e>>16&255,e>>8&255,255&e],s),s+=4})),e.box(e.types.stss,Cl(new Uint8Array([0,0,0,0,i>>24,i>>16&255,i>>8&255,255&i]),n))}},{key:"ctts",value:function(t){var i=t.length,n=new Uint8Array(8*i),s=0;return t.forEach((function(e){var t=e.value,i=e.count;n.set([i>>24,i>>16&255,i>>8&255,255&i,t>>24,t>>16&255,t>>8&255,255&t],s),s+=8})),e.box(e.types.ctts,Cl(new Uint8Array([0,0,0,0,i>>24,i>>16&255,i>>8&255,255&i]),n))}},{key:"styp",value:function(){return e.box(e.types.styp,new Uint8Array([109,115,100,104,0,0,0,0,109,115,100,104,109,115,105,120]))}},{key:"sidx",value:function(t){var i=t.timescale,n=t.samples[0].duration,s=n*t.samples.length,r=t.samples[0].sampleOffset*n,o=8;t.samples.forEach((function(e){o+=e.size}));var a=0;if(t.isVideo){var l,c=0;t.videoSenc&&(l=t.videoSenc),t.isVideo&&l.forEach((function(e){c+=8,e.subsamples&&e.subsamples.length&&(c+=2,c+=6*e.subsamples.length)})),t.videoSencLength=c,a=o+141+16*t.samples.length+c,t.useEME&&t.isAudioEncryption&&!t.isVideoEncryption&&(a=o+16*t.samples.length+84)}else a=o+116+12*t.samples.length,t.useEME&&t.isAudioEncryption&&(a=o+169+12*t.samples.length+8*t.audioSenc.length);var u=new Uint8Array([0,0,0,0,0,0,0,255&t.id,i>>24&255,i>>16&255,i>>8&255,255&i,r>>24&255,r>>16&255,r>>8&255,255&r,0,0,0,0,0,0,0,1,0,a>>16&255,a>>8&255,255&a,s>>24&255,s>>16&255,s>>8&255,255&s,144,0,0,0]);return e.box(e.types.sidx,u)}},{key:"mdat",value:function(t){var i=e.box(e.types.mdat,t);return i}}]),e}();ja(cc,"types",["Opus","dOps","av01","av1C","avc1","avcC","hvc1","hvcC","dinf","dref","esds","ftyp","hdlr","mdat","mdhd","mdia","mfhd","minf","moof","moov","mp4a","mvex","mvhd","pasp","stbl","stco","stsc","stsd","stsz","stts","tfdt","tfhd","traf","trak","trex","tkhd","vmhd","smhd","ctts","stss","styp","pssh","sidx","sbgp","saiz","saio","senc","trun","encv","enca","sinf","btrt","frma","tenc","schm","schi","mehd","fiel","sdtp"].reduce((function(e,t){return e[t]=[t.charCodeAt(0),t.charCodeAt(1),t.charCodeAt(2),t.charCodeAt(3)],e}),Object.create(null))),ja(cc,"HDLR_TYPES",{video:new Uint8Array([0,0,0,0,0,0,0,0,118,105,100,101,0,0,0,0,0,0,0,0,0,0,0,0,86,105,100,101,111,72,97,110,100,108,101,114,0]),audio:new Uint8Array([0,0,0,0,0,0,0,0,115,111,117,110,0,0,0,0,0,0,0,0,0,0,0,0,83,111,117,110,100,72,97,110,100,108,101,114,0])}),ja(cc,"FTYPAVC1",cc.box(cc.types.ftyp,new Uint8Array([105,115,111,109,0,0,0,1,105,115,111,109,97,118,99,49]))),ja(cc,"FTYPHEV1",cc.box(cc.types.ftyp,new Uint8Array([105,115,111,109,0,0,0,1,105,115,111,109,104,101,118,49]))),ja(cc,"DINF",cc.box(cc.types.dinf,cc.box(cc.types.dref,new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,12,117,114,108,32,0,0,0,1])))),ja(cc,"VMHD",cc.box(cc.types.vmhd,new Uint8Array([0,0,0,1,0,0,0,0,0,0,0,0]))),ja(cc,"SMHD",cc.box(cc.types.smhd,new Uint8Array([0,0,0,0,0,0,0,0]))),ja(cc,"StblTable",new Uint8Array([0,0,0,0,0,0,0,0])),ja(cc,"STTS",cc.box(cc.types.stts,cc.StblTable)),ja(cc,"STSC",cc.box(cc.types.stsc,cc.StblTable)),ja(cc,"STSZ",cc.box(cc.types.stsz,new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0]))),ja(cc,"STCO",cc.box(cc.types.stco,cc.StblTable));var uc=function(){function e(t,i){Fa(this,e),this.name=t||"",this._prefix="[".concat(this.name,"]"),e.disabled=i}return Ha(e,[{key:"debug",value:function(){var t;if(!e.disabled){for(var i=arguments.length,n=new Array(i),s=0;s<i;s++)n[s]=arguments[s];(t=console).debug.apply(t,[this._prefix].concat(n))}}},{key:"log",value:function(){var t;if(!e.disabled){for(var i=arguments.length,n=new Array(i),s=0;s<i;s++)n[s]=arguments[s];(t=console).log.apply(t,[this._prefix].concat(n))}}},{key:"warn",value:function(){var t;if(!e.disabled){for(var i=arguments.length,n=new Array(i),s=0;s<i;s++)n[s]=arguments[s];(t=console).warn.apply(t,[this._prefix].concat(n))}}},{key:"error",value:function(){var t;if(!e.disabled){for(var i=arguments.length,n=new Array(i),s=0;s<i;s++)n[s]=arguments[s];(t=console).error.apply(t,[this._prefix].concat(n))}}},{key:"table",value:function(){var t;e.disabled||(console.group(this._prefix),(t=console).table.apply(t,arguments),console.groupEnd())}}],[{key:"enable",value:function(){e.disabled=!1}},{key:"disable",value:function(){e.disabled=!0}}]),e}();ja(uc,"disabled",!0);var hc=function(){function e(t,i,n){Fa(this,e),this.videoTrack=t,this.audioTrack=i;var s=/Chrome\/([^.]+)/.exec(navigator.userAgent);this.forceFirstIDR=s&&Number(s[1])<50,this.log=new uc("FMP4Remuxer",!n||!n.openLog||!n.openLog)}return Ha(e,[{key:"remux",value:function(){var e,t,i,n,s,r=arguments.length>0&&void 0!==arguments[0]&&arguments[0],o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},a=this.videoTrack,l=this.audioTrack,c=a.exist(),u=l.exist(),h=[];return r&&(o&&o.initMerge?(c&&h.push(this.videoTrack),u&&h.push(this.audioTrack),i=cc.initSegment(h)):(c&&(e=cc.initSegment([this.videoTrack])),u&&(t=cc.initSegment([this.audioTrack])))),c&&a.hasSample()&&(n=this._remuxVideo()),u&&l.hasSample()&&(s=this._remuxAudio()),a.samples=[],l.samples=[],{initSegment:i,videoInitSegment:e,audioInitSegment:t,videoSegment:n,audioSegment:s}}},{key:"_remuxVideo",value:function(){var e=this.videoTrack;this.forceFirstIDR&&(e.samples[0].flag={dependsOn:2,isNonSyncSample:0});var t=e.samples,i=/av01/.test(e.codec),n=0;i?t.forEach((function(e){n+=e.data.byteLength})):t.forEach((function(e){n+=e.units.reduce((function(e,t){return e+t.byteLength}),0),n+=4*e.units.length}));var s=new Uint8Array(n);if(i)for(var r,o=0,a=t.length,l=0;o<a;o++)r=t[o],s.set(r.data,l),r.size=r.data.byteLength,l+=r.size;else for(var c,u=new DataView(s.buffer),h=function(e,i){i=t[d];var n=0;i.units.forEach((function(t){u.setUint32(e,t.byteLength),e+=4,s.set(t,e),e+=t.byteLength,n+=4+t.byteLength})),i.size=n,f=e,c=i},d=0,p=t.length,f=0;d<p;d++)h(f,c);var g=cc.mdat(s),m=cc.moof([e]);return Cl(m,g)}},{key:"_remuxAudio",value:function(){var e=this.audioTrack,t=new Uint8Array(e.samples.reduce((function(e,t){return e+t.size}),0));e.samples.reduce((function(e,i){return t.set(i.data,e),e+i.size}),0);var i=cc.mdat(t),n=cc.moof([e]);return Cl(n,i)}},{key:"reset",value:function(){this.videoTrack.reset(),this.audioTrack.reset()}}]),e}(),dc=io(io({},Aa),{},{STREAM_PARSED:"core.streamparsed",NO_AUDIO_TRACK:"core.noaudiotrack",SUBTITLE_SEGMENTS:"core.subtitlesegments",SUBTITLE_PLAYLIST:"core.subtitleplaylist",SEI_PAYLOAD_TIME:"core.seipayloadtime",APPEND_COST:"core.appendcost"}),pc=new ma("Transmuxer"),fc=function(){function e(t,i,n,s){ao(this,e),uo(this,"_initSegmentId",""),this.hls=t,this._demuxer=i?new rc:new $l(null,null,null,s),this._isMP4=i,n&&(this._remuxer=new hc(this._demuxer.videoTrack,this._demuxer.audioTrack))}return co(e,[{key:"transmux",value:function(e,t,i,n,s,r){var o=this._demuxer;try{this._isMP4?o.demux(e,t):o.demuxAndFix(Da(e,t),i,n,s)}catch(b){throw new da(ua.DEMUX,ua.SUB_TYPES.HLS,b)}var a=o.videoTrack,l=o.audioTrack,c=o.metadataTrack,u={codec:a.codec,timescale:a.timescale,firstDts:a.firstDts/a.timescale,firstPts:a.firstPts/a.timescale,duration:a.samplesDuration/a.timescale},h={codec:l.codec,timescale:l.timescale,firstDts:l.firstDts/a.timescale,firstPts:l.firstPts/a.timescale,duration:l.samplesDuration/a.timescale},d="".concat(a.codec,"/").concat(a.width,"/").concat(a.height,"/").concat(l.codec,"/").concat(l.config);if(d!==this._initSegmentId&&(this._initSegmentId=d,r=!0),this._fireEvents(a,l,c,i||r),this.hls.emit(dc.DEMUXED_TRACK,{videoTrack:a,audioTrack:l}),!this._remuxer)return[a,l];r&&this.hls.isLive&&!this.hls.config.mseLowLatency&&(a.duration=this.hls.totalDuration*a.timescale,l.duration=this.hls.totalDuration*l.timescale);try{var p=this._remuxer.remux(r),f=p.videoInitSegment,g=p.videoSegment,m=p.audioInitSegment,v=p.audioSegment,y=Da(f,g),_=Da(m,v);return[y?io(io({},u),{},{data:y}):void 0,_?io(io({},h),{},{data:_}):void 0]}catch(b){throw new da(ua.REMUX,ua.SUB_TYPES.FMP4,b)}}},{key:"_fireEvents",value:function(e,t,i,n){var s=this,r=[e,t],o="discontinuity: ".concat(n);r.forEach((function(e){var t;null!==(t=e.samples)&&void 0!==t&&t.length&&(o+="; ".concat(e.samples.length," ").concat(e.type===ll.VIDEO?"video":"audio"," samples, firstDts/firstPts/duration: ").concat((e.firstDts/e.timescale).toFixed(3),"/").concat((e.firstPts/e.timescale).toFixed(3),"/").concat((e.samplesDuration/e.timescale).toFixed(3))),n&&e.exist()&&s.hls.emit(dc.METADATA_PARSED,{type:e.type,track:e,meta:io({codec:e.codec,timescale:e.timescale,baseDts:e.baseDts},e.type===ll.VIDEO?{width:e.width,height:e.height,sarRatio:e.sarRatio}:{codec:e.codec,channelCount:e.channelCount,sampleRate:e.sampleRate})})})),pc.debug(o),e.warnings.forEach((function(e){var t;switch(e.type){case hl.LARGE_AV_SHIFT:t=dc.LARGE_AV_FIRST_FRAME_GAP_DETECT;break;case hl.LARGE_VIDEO_GAP:t=dc.LARGE_VIDEO_DTS_GAP_DETECT;break;case hl.LARGE_VIDEO_GAP_BETWEEN_CHUNK:t=dc.MAX_DTS_DELTA_WITH_NEXT_SEGMENT_DETECT;break}t&&s.hls.emit(dc.STREAM_EXCEPTION,io(io({},e),{},{type:t})),pc.warn("video exception",e)})),t.warnings.forEach((function(e){var t;switch(e.type){case hl.LARGE_AUDIO_GAP:t=dc.LARGE_AUDIO_DTS_GAP_DETECT;break;case hl.AUDIO_FILLED:t=dc.AUDIO_GAP_DETECT;break;case hl.AUDIO_DROPPED:t=dc.AUDIO_OVERLAP_DETECT;break}t&&s.hls.emit(dc.STREAM_EXCEPTION,io(io({},e),{},{type:t})),pc.warn("audio exception",e)})),e.samples.forEach((function(e){e.keyframe&&s.hls.emit(dc.KEYFRAME,{pts:e.pts})})),i.seiSamples.forEach((function(e){s.hls.emit(dc.SEI,io(io({},e),{},{originPts:e.originPts/90,sei:{code:e.data.type,content:e.data.payload,dts:e.pts}}))}))}}]),e}(),gc=["data"],mc=["data"],vc=new ma("BufferService"),yc=function(){function e(t){var i=this;ao(this,e),uo(this,"_decryptor",new sc),uo(this,"_transmuxer",null),uo(this,"_mse",null),uo(this,"_softVideo",null),uo(this,"_sourceCreated",!1),uo(this,"_needInitSegment",!0),uo(this,"_directAppend",!1),this.hls=t,t.config.softDecode?this._softVideo=t.media:(this._mse=new Ca(null,{preferMMS:t.config.preferMMS}),t.config.url&&this._mse.bindMedia(t.media).then((function(e){i.hls.emit(Aa.MEDIASOURCE_OPENED,e)}))),t.config.decryptor&&(this._decryptor.externalDecryptor=t.config.decryptor)}return co(e,[{key:"baseDts",get:function(){var e,t,i;return null===(e=this._transmuxer)||void 0===e||null===(t=e._demuxer)||void 0===t||null===(i=t._fixer)||void 0===i?void 0:i._baseDts}},{key:"nbSb",get:function(){var e;return null!==(e=this._mse)&&void 0!==e&&e._sourceBuffer?Object.keys(this._mse._sourceBuffer).length:0}},{key:"msIsOpened",get:function(){var e;return null===(e=this._mse)||void 0===e?void 0:e.isOpened}},{key:"msHasOpTasks",get:function(){var e;return null===(e=this._mse)||void 0===e?void 0:e.hasOpTasks}},{key:"msStreaming",get:function(){var e;return null===(e=this._mse)||void 0===e?void 0:e.streaming}},{key:"updateDuration",value:function(){var e=oo(no().mark((function e(t){return no().wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(vc.debug("update duration",t),!this._mse){e.next=9;break}if(this._mse.isOpened){e.next=5;break}return e.next=5,this._mse.open();case 5:return e.next=7,this._mse.updateDuration(t);case 7:e.next=10;break;case 9:this._softVideo&&(this._softVideo.duration=t);case 10:case"end":return e.stop()}}),e,this)})));function t(t){return e.apply(this,arguments)}return t}()},{key:"createSource",value:function(e,t,i,n){if(!this._sourceCreated){var s=e||t;if(s){if($l.probe(s))this._transmuxer||(this._transmuxer=new fc(this.hls,!1,!this._softVideo,this.hls.config.fixerConfig));else{if(!Ql.probe(s))throw new da(ua.OTHER,null,null,null,"unsupported stream");if(this._softVideo)this._transmuxer||(this._transmuxer=new fc(this.hls,!0,null,this.hls.config.fixerConfig));else{this._directAppend=!0;var r=!1;e&&!i&&Ql.findBox(e,["moov","trak"]).forEach((function(e){var t=Ql.findBox(e.data,["trak","mdia","minf","stbl","stsd"])[0];if(t){var s=Ql.stsd(t).entries[0];if(s)if(s.hvcC)i=s.hvcC.codec||"hev1.1.6.L93.B0";else if(s.avcC)i=s.avcC.codec;else if(s.sampleRate||s.esds){var o;n=(null===(o=s.esds)||void 0===o?void 0:o.codec)||"mp4a.40.2",r=!0}}})),t&&!n&&Ql.findBox(t,["moov","trak","mdia","minf","stbl","stsd"]).forEach((function(e){var t=Ql.stsd(e).entries[0];t&&t.esds&&(n=t.esds.codec)})),e&&!i&&(i="avc1.42e01e"),t&&!n&&(n="mp4a.40.2"),r&&(i+=", ".concat(n),n=""),this._createMseSource(i,n)}}this._softVideo&&(this._sourceCreated=!0)}}}},{key:"appendBuffer",value:function(){var e=oo(no().mark((function e(t,i,n,s,r,o,a){var l,c,u,h,d,p,f,g,m,v,y,_,b,S,E=this;return no().wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(null!==n&&void 0!==n&&n.length||null!==s&&void 0!==s&&s.length){e.next=2;break}return e.abrupt("return");case 2:if(l=function(){var e,i;null!==(e=E.hls)&&void 0!==e&&e.emit&&(null===(i=E.hls)||void 0===i||i.emit(Aa.APPEND_BUFFER,{start:t.start,end:t.end}))},!this._directAppend){e.next=8;break}return c=[],n&&c.push(this._mse.append(Ca.VIDEO,n)),s&&c.push(this._mse.append(Ca.AUDIO,s)),e.abrupt("return",Promise.all(c).then(l));case 8:if(u=this._needInitSegment||r,h=this._transmuxer.transmux(n,s,u,o,a,this._needInitSegment||r),d=So(h,2),p=d[0],f=d[1],s&&i&&(null===i||void 0===i||i.setTrackExist(!1,!0)),s&&t&&(null===t||void 0===t||t.setTrackExist(!0,!1)),i||null===t||void 0===t||t.setTrackExist(!!p,!!f),p&&!f&&this.hls.emit(dc.NO_AUDIO_TRACK),!this._softVideo){e.next=20;break}this._softVideo.appendBuffer(p,f),this._needInitSegment=!1,l(),e.next=30;break;case 20:if(!this._mse){e.next=30;break}return g=!this._sourceCreated,g&&this._createMseSource(null===p||void 0===p?void 0:p.codec,null===f||void 0===f?void 0:f.codec),this._needInitSegment=!1,m=this._mse,v=[],u&&!g&&this._handleCodecChange(p,f).forEach((function(e){return v.push(e)})),p&&(y=p.data,_=vo(p,gc),v.push(m.append(Ca.VIDEO,y,_))),f&&(b=f.data,S=vo(f,mc),v.push(m.append(Ca.AUDIO,b,S))),e.abrupt("return",Promise.all(v).then(l));case 30:case"end":return e.stop()}}),e,this)})));function t(t,i,n,s,r,o,a){return e.apply(this,arguments)}return t}()},{key:"removeBuffer",value:function(){var e=oo(no().mark((function e(){var t,i,n,s=this,r=arguments;return no().wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(t=r.length>0&&void 0!==r[0]?r[0]:0,i=r.length>1&&void 0!==r[1]?r[1]:1/0,n=this.hls.media,!(!this._mse||!n||t<0||i<t||t>=this._mse.duration)){e.next=5;break}return e.abrupt("return");case 5:return e.abrupt("return",this._mse.clearBuffer(t,i).then((function(){return s.hls.emit(Aa.REMOVE_BUFFER,{start:t,end:i,removeEnd:i})})));case 6:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}()},{key:"evictBuffer",value:function(){var e=oo(no().mark((function e(t){var i,n,s,r;return no().wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(i=this.hls.media,this._mse&&i&&t&&!(t<0)){e.next=3;break}return e.abrupt("return");case 3:if(n=i.currentTime,s=n-t,!(s<=0)){e.next=7;break}return e.abrupt("return");case 7:if(r=la.start(la.get(i)),!(r+1>=s)){e.next=10;break}return e.abrupt("return");case 10:return e.abrupt("return",this.removeBuffer(0,s));case 11:case"end":return e.stop()}}),e,this)})));function t(t){return e.apply(this,arguments)}return t}()},{key:"clearAllBuffer",value:function(){var e=oo(no().mark((function e(){return no().wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(!this._mse){e.next=2;break}return e.abrupt("return",this._mse.clearAllBuffer());case 2:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}()},{key:"decryptBuffer",value:function(e,t){return this._decryptor.decrypt(e,t)}},{key:"reset",value:function(){var e=oo(no().mark((function e(){var t,i=arguments;return no().wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(t=i.length>0&&void 0!==i[0]&&i[0],!this._mse||t){e.next=8;break}return this._transmuxer=null,this._sourceCreated=!1,e.next=6,this._mse.unbindMedia();case 6:return e.next=8,this._mse.bindMedia(this.hls.media);case 8:this._needInitSegment=!0,this._directAppend=!1;case 10:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}()},{key:"endOfStream",value:function(){var e=oo(no().mark((function e(){return no().wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(!this._mse){e.next=5;break}if(!this._sourceCreated){e.next=5;break}return e.next=4,this._mse.endOfStream();case 4:this.hls.emit(Aa.BUFFEREOS);case 5:this._softVideo&&this._softVideo.endOfStream();case 6:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}()},{key:"setLiveSeekableRange",value:function(){var e=oo(no().mark((function e(t,i){return no().wrap((function(e){while(1)switch(e.prev=e.next){case 0:this._mse&&this._mse.setLiveSeekableRange(t,i);case 1:case"end":return e.stop()}}),e,this)})));function t(t,i){return e.apply(this,arguments)}return t}()},{key:"detachMedia",value:function(){var e=oo(no().mark((function e(){return no().wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(!this._mse){e.next=3;break}return e.next=3,this._mse.unbindMedia();case 3:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}()},{key:"destroy",value:function(){var e=oo(no().mark((function e(){var t;return no().wrap((function(e){while(1)switch(e.prev=e.next){case 0:return null===(t=this._decryptor)||void 0===t||t.destroy(),e.next=3,this.detachMedia();case 3:this._decryptor=null,this._mse=null,this._softVideo=null;case 6:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}()},{key:"_createMseSource",value:function(e,t){vc.debug("create mse source, videoCodec=".concat(e,", audioCodec=").concat(t));var i=this._mse;i&&(e&&(i.createSource(Ca.VIDEO,"video/mp4;codecs=".concat(e)),this._sourceCreated=!0),t&&(i.createSource(Ca.AUDIO,"audio/mp4;codecs=".concat(t)),this._sourceCreated=!0),this.hls.emit(Aa.SOURCEBUFFER_CREATED))}},{key:"_handleCodecChange",value:function(e,t){var i=[],n=this._mse,s=[{type:Ca.VIDEO,codecs:null===e||void 0===e?void 0:e.codec},{type:Ca.AUDIO,codecs:null===t||void 0===t?void 0:t.codec}];return s.filter((function(e){return!!e.codecs})).forEach((function(e){var t=e.type,s=e.codecs,r=n.getSourceBuffer(t);if(r){var o=s.split(",")[0];new RegExp(o,"ig").test(r.mimeType)||i.push(n.changeType(t,"".concat(t,"/mp4;codecs=").concat(s)))}})),i}},{key:"seamlessSwitch",value:function(){this._needInitSegment=!0}},{key:"isFull",value:function(){var e,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Ca.VIDEO;return null===(e=this._mse)||void 0===e?void 0:e.isFull(t)}}]),e}();function _c(e){var t=(null===e||void 0===e?void 0:e.media)||document.createElement("video");return io(io({maxPlaylistSize:50,retryCount:3,retryDelay:1e3,pollRetryCount:2,loadTimeout:1e4,manifestLoadTimeout:1e4,preloadTime:30,softDecode:!1,bufferBehind:10,maxJumpDistance:3,startTime:0,useLowLatency:!0,targetLatency:10,maxLatency:20,allowedStreamTrackChange:!0,seiInTime:!1,manifestList:[],minSegmentsStartPlay:3,preferMMS:!1,preferMMSStreaming:!1,mseLowLatency:!0,fixerConfig:{forceFixLargeGap:!1,largeGapThreshold:5}},e),{},{media:t})}var bc={FETCH:"fetch",XHR:"xhr"},Sc={ARRAY_BUFFER:"arraybuffer",TEXT:"text",JSON:"json"},Ec=function(e){Vo(i,e);var t=Jo(i);function i(e,n,s,r){var o;return Fo(this,i),o=t.call(this,r),jo(Qo(o),"retryCount",0),jo(Qo(o),"isTimeout",!1),jo(Qo(o),"loaderType",bc.FETCH),jo(Qo(o),"startTime",0),jo(Qo(o),"endTime",0),jo(Qo(o),"options",{}),o.url=e,o.request=n,o.response=s,o}return Ho(i)}($o(Error)),Tc=Object.prototype.toString;function kc(e){return null!==e&&"object"===Mo(e)}function wc(e){if("[object Object]"!==Tc.call(e))return!1;var t=Object.getPrototypeOf(e);return null===t||t===Object.prototype}function xc(e){return"[object Date]"===Tc.call(e)}function Cc(e){if(e&&null!==e[0]&&void 0!==e[0]&&(0!==e[0]||null!==e[1]&&void 0!==e[1])){var t="bytes="+e[0]+"-";return e[1]&&(t+=e[1]),t}}function Ac(e){return encodeURIComponent(e).replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%20/g,"+").replace(/%5B/gi,"[").replace(/%5D/gi,"]")}function Pc(e,t){if(e){if(!t)return e;var i,n=Object.keys(t).map((function(e){if(i=t[e],null!==i&&void 0!==i)return Array.isArray(i)?e+="[]":i=[i],i.map((function(t){return xc(t)?t=t.toISOString():kc(t)&&(t=JSON.stringify(t)),"".concat(Ac(e),"=").concat(Ac(t))})).join("&")})).filter(Boolean).join("&");if(n){var s=e.indexOf("#");-1!==s&&(e=e.slice(0,s)),e+=(-1===e.indexOf("?")?"?":"&")+n}return e}}function Ic(e,t,i,n,s,r,o,a,l,c,u){s=null!==s&&void 0!==s?parseFloat(s):null,n=parseInt(n||"0",10),Number.isNaN(n)&&(n=0);var h={range:l,vid:c,index:a,contentLength:n,age:s,startTime:r,firstByteTime:o,endTime:Date.now(),priOptions:u};return{data:e,done:t,options:h,response:i}}function Dc(e,t){return Math.round(8*e*1e3/t/1024)}var Lc=2097152,Oc=function(e){Vo(i,e);var t=Jo(i);function i(){var e;return Fo(this,i),e=t.call(this),jo(Qo(e),"_abortController",null),jo(Qo(e),"_timeoutTimer",null),jo(Qo(e),"_reader",null),jo(Qo(e),"_response",null),jo(Qo(e),"_aborted",!1),jo(Qo(e),"_index",-1),jo(Qo(e),"_range",null),jo(Qo(e),"_receivedLength",0),jo(Qo(e),"_running",!1),jo(Qo(e),"_logger",null),jo(Qo(e),"_vid",""),jo(Qo(e),"_onProcessMinLen",0),jo(Qo(e),"_onCancel",null),jo(Qo(e),"_priOptions",null),e}return Ho(i,[{key:"load",value:function(e){var t,i=this,n=e.url,s=e.vid,r=e.timeout,o=e.responseType,a=e.onProgress,l=e.index,c=e.onTimeout,u=e.onCancel,h=e.range,d=e.transformResponse,p=e.request,f=e.params,g=e.logger,m=e.method,v=e.headers,y=e.body,_=e.mode,b=e.credentials,S=e.cache,E=e.redirect,T=e.referrer,k=e.referrerPolicy,w=e.onProcessMinLen,x=e.priOptions;this._logger=g,this._aborted=!1,this._onProcessMinLen=w,this._onCancel=u,this._abortController="undefined"!==typeof AbortController&&new AbortController,this._running=!0,this._index=l,this._range=h||[0,0],this._vid=s||n,this._priOptions=x||{};var C={method:m,headers:v,body:y,mode:_,credentials:b,cache:S,redirect:E,referrer:T,referrerPolicy:k,signal:null===(t=this._abortController)||void 0===t?void 0:t.signal},A=!1;clearTimeout(this._timeoutTimer),n=Pc(n,f);var P=Cc(h);P&&(v=p?p.headers:C.headers=C.headers||(Headers?new Headers:{}),Headers&&v instanceof Headers?v.append("Range",P):v.Range=P),r&&(this._timeoutTimer=setTimeout((function(){if(A=!0,i.cancel(),c){var e=new Ec(n,C,null,"timeout");e.isTimeout=!0,c(e,{index:i._index,range:i._range,vid:i._vid,priOptions:i._priOptions})}}),r));var I=Date.now();return this._logger.debug("[fetch load start], index,",l,",range,",h),new Promise((function(e,t){fetch(p||n,p?void 0:C).then(function(){var s=Uo(Ro().mark((function s(r){var c,u,p,f;return Ro().wrap((function(s){while(1)switch(s.prev=s.next){case 0:if(clearTimeout(i._timeoutTimer),i._response=r,!i._aborted&&i._running){s.next=4;break}return s.abrupt("return");case 4:if(d&&(r=d(r,n)||r),r.ok){s.next=7;break}throw new Ec(n,C,r,"bad network response");case 7:if(c=Date.now(),o!==Sc.TEXT){s.next=15;break}return s.next=11,r.text();case 11:u=s.sent,i._running=!1,s.next=37;break;case 15:if(o!==Sc.JSON){s.next=22;break}return s.next=18,r.json();case 18:u=s.sent,i._running=!1,s.next=37;break;case 22:if(!a){s.next=29;break}return i.resolve=e,i.reject=t,i._loadChunk(r,a,I,c),s.abrupt("return");case 29:return s.next=31,r.arrayBuffer();case 31:u=s.sent,u=new Uint8Array(u),i._running=!1,p=Date.now()-I,f=Dc(u.byteLength,p),i.emit(Aa.REAL_TIME_SPEED,{speed:f,len:u.byteLength,time:p,vid:i._vid,index:i._index,range:i._range,priOptions:i._priOptions});case 37:i._logger.debug("[fetch load end], index,",l,",range,",h),e(Ic(u,!0,r,r.headers.get("Content-Length"),r.headers.get("age"),I,c,l,h,i._vid,i._priOptions));case 39:case"end":return s.stop()}}),s)})));return function(e){return s.apply(this,arguments)}}()).catch((function(e){var s;clearTimeout(i._timeoutTimer),i._running=!1,i._aborted&&!A||(e=e instanceof Ec?e:new Ec(n,C,null,null===(s=e)||void 0===s?void 0:s.message),e.startTime=I,e.endTime=Date.now(),e.isTimeout=A,e.options={index:i._index,range:i._range,vid:i._vid,priOptions:i._priOptions},t(e))}))}))}},{key:"cancel",value:function(){var e=Uo(Ro().mark((function e(){return Ro().wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(!this._aborted){e.next=2;break}return e.abrupt("return");case 2:if(this._aborted=!0,this._running=!1,!this._response){e.next=14;break}if(e.prev=5,!this._reader){e.next=9;break}return e.next=9,this._reader.cancel();case 9:e.next=13;break;case 11:e.prev=11,e.t0=e["catch"](5);case 13:this._response=this._reader=null;case 14:if(this._abortController){try{this._abortController.abort()}catch(t){}this._abortController=null}this._onCancel&&this._onCancel({index:this._index,range:this._range,vid:this._vid,priOptions:this._priOptions});case 16:case"end":return e.stop()}}),e,this,[[5,11]])})));function t(){return e.apply(this,arguments)}return t}()},{key:"_loadChunk",value:function(e,t,i,n){var s=this;if(!e.body||!e.body.getReader){this._running=!1;var r=new Ec(e.url,"",e,"onProgress of bad response.body.getReader");return r.options={index:this._index,range:this._range,vid:this._vid,priOptions:this._priOptions},void this.reject(r)}this._onProcessMinLen>0&&(this._cache=new Uint8Array(Lc),this._writeIdx=0);var o,a,l,c=this._reader=e.body.getReader(),u=function(){var r=Uo(Ro().mark((function r(){var h,d,p,f,g,m,v,y;return Ro().wrap((function(r){while(1)switch(r.prev=r.next){case 0:return a=Date.now(),r.prev=1,r.next=4,c.read();case 4:o=r.sent,l=Date.now(),r.next=13;break;case 8:return r.prev=8,r.t0=r["catch"](1),l=Date.now(),s._aborted||(s._running=!1,r.t0.options={index:s._index,range:s._range,vid:s._vid,priOptions:s._priOptions},s.reject(r.t0)),r.abrupt("return");case 13:if(d=(null===(h=s._range)||void 0===h?void 0:h.length)>0?s._range[0]:0,p=d+s._receivedLength,!s._aborted){r.next=19;break}return s._running=!1,t(void 0,!1,{range:[p,p],vid:s._vid,index:s._index,startTime:a,endTime:l,st:i,firstByteTime:n,priOptions:s._priOptions},e),r.abrupt("return");case 19:f=o.value?o.value.byteLength:0,s._receivedLength+=f,s._logger.debug("【fetchLoader,onProgress call】,task,",s._range,", start,",p,", end,",d+s._receivedLength,", done,",o.done),s._onProcessMinLen>0?s._writeIdx+f>=s._onProcessMinLen||o.done?(g=new Uint8Array(s._writeIdx+f),g.set(s._cache.slice(0,s._writeIdx),0),f>0&&g.set(o.value,s._writeIdx),s._writeIdx=0,s._logger.debug("【fetchLoader,onProgress enough】,done,",o.done,",len,",g.byteLength,", writeIdx,",s._writeIdx)):f>0&&s._writeIdx+f<Lc?(s._cache.set(o.value,s._writeIdx),s._writeIdx+=f,s._logger.debug("【fetchLoader,onProgress cache】,len,",f,", writeIdx,",s._writeIdx)):f>0&&(m=new Uint8Array(s._writeIdx+f+2048),s._logger.debug("【fetchLoader,onProgress extra start】,size,",s._writeIdx+f+2048,", datalen,",f,", writeIdx,",s._writeIdx),m.set(s._cache.slice(0,s._writeIdx),0),f>0&&m.set(o.value,s._writeIdx),s._writeIdx+=f,delete s._cache,s._cache=m,s._logger.debug("【fetchLoader,onProgress extra end】,len,",f,", writeIdx,",s._writeIdx)):g=o.value,(g&&g.byteLength>0||o.done)&&t(g,o.done,{range:[s._range[0]+s._receivedLength-(g?g.byteLength:0),s._range[0]+s._receivedLength],vid:s._vid,index:s._index,startTime:a,endTime:l,st:i,firstByteTime:n,priOptions:s._priOptions},e),o.done?(v=Date.now()-i,y=Dc(s._receivedLength,v),s.emit(Aa.REAL_TIME_SPEED,{speed:y,len:s._receivedLength,time:v,vid:s._vid,index:s._index,range:s._range,priOptions:s._priOptions}),s._running=!1,s._logger.debug("[fetchLoader onProgress end],task,",s._range,",done,",o.done),s.resolve(Ic(o,!0,e,e.headers.get("Content-Length"),e.headers.get("age"),i,n,s._index,s._range,s._vid,s._priOptions))):u();case 25:case"end":return r.stop()}}),r,null,[[1,8]])})));return function(){return r.apply(this,arguments)}}();u()}},{key:"receiveLen",get:function(){return this._receivedLength}},{key:"running",get:function(){return this._running},set:function(e){this._running=e}}],[{key:"isSupported",value:function(){return!("undefined"===typeof fetch)}}]),i}(V());function Rc(e){return Oo({loaderType:bc.FETCH,retry:0,retryDelay:0,timeout:0,request:null,onTimeout:void 0,onProgress:void 0,onRetryError:void 0,transformRequest:void 0,transformResponse:void 0,transformError:void 0,responseType:Sc.TEXT,range:void 0,url:"",params:void 0,method:"GET",headers:{},body:void 0,mode:void 0,credentials:void 0,cache:void 0,redirect:void 0,referrer:void 0,referrerPolicy:void 0,integrity:void 0,onProcessMinLen:0},e)}var Mc=function(e){Vo(i,e);var t=Jo(i);function i(){var e;return Fo(this,i),e=t.call(this),jo(Qo(e),"_xhr",null),jo(Qo(e),"_aborted",!1),jo(Qo(e),"_timeoutTimer",null),jo(Qo(e),"_range",null),jo(Qo(e),"_receivedLength",0),jo(Qo(e),"_url",null),jo(Qo(e),"_onProgress",null),jo(Qo(e),"_index",-1),jo(Qo(e),"_headers",null),jo(Qo(e),"_currentChunkSizeKB",384),jo(Qo(e),"_timeout",null),jo(Qo(e),"_xhr",null),jo(Qo(e),"_withCredentials",null),jo(Qo(e),"_startTime",-1),jo(Qo(e),"_loadCompleteResolve",null),jo(Qo(e),"_loadCompleteReject",null),jo(Qo(e),"_runing",!1),jo(Qo(e),"_logger",!1),jo(Qo(e),"_vid",""),jo(Qo(e),"_responseType",void 0),jo(Qo(e),"_credentials",void 0),jo(Qo(e),"_method",void 0),jo(Qo(e),"_transformResponse",void 0),jo(Qo(e),"_firstRtt",void 0),jo(Qo(e),"_onCancel",null),jo(Qo(e),"_priOptions",null),e}return Ho(i,[{key:"load",value:function(e){var t=this;clearTimeout(this._timeoutTimer),this._logger=e.logger,this._range=e.range,this._onProgress=e.onProgress,this._index=e.index,this._headers=e.headers,this._withCredentials="include"===e.credentials||"same-origin"===e.credentials,this._body=e.body||null,e.method&&(this._method=e.method),this._timeout=e.timeout||null,this._runing=!0,this._vid=e.vid||e.url,this._responseType=e.responseType,this._firstRtt=-1,this._onTimeout=e.onTimeout,this._onCancel=e.onCancel,this._request=e.request,this._priOptions=e.priOptions||{},this._logger.debug("【xhrLoader task】, range",this._range),this._url=Pc(e.url,e.params);var i=Date.now();return new Promise((function(e,i){t._loadCompleteResolve=e,t._loadCompleteReject=i,t._startLoad()})).catch((function(e){if(clearTimeout(t._timeoutTimer),t._runing=!1,!t._aborted)throw e=e instanceof Ec?e:new Ec(t._url,t._request),e.startTime=i,e.endTime=Date.now(),e.options={index:t._index,vid:t._vid,priOptions:t._priOptions},e}))}},{key:"_startLoad",value:function(){var e=null;if(this._responseType===Sc.ARRAY_BUFFER&&this._range&&this._range.length>1)if(this._onProgress){this._firstRtt=-1;var t=1024*this._currentChunkSizeKB,i=this._range[0]+this._receivedLength,n=this._range[1];t<this._range[1]-i&&(n=i+t),e=[i,n],this._logger.debug("[xhr_loader->],tast :",this._range,", SubRange, ",e)}else e=this._range,this._logger.debug("[xhr_loader->],tast :",this._range,", allRange, ",e);this._internalOpen(e)}},{key:"_internalOpen",value:function(e){var t=this;try{this._startTime=Date.now();var i=this._xhr=new XMLHttpRequest;i.open(this._method||"GET",this._url,!0),i.responseType=this._responseType,this._timeout&&(i.timeout=this._timeout),i.withCredentials=this._withCredentials,i.onload=this._onLoad.bind(this),i.onreadystatechange=this._onReadyStatechange.bind(this),i.onerror=function(e){var i,n,s;t._running=!1;var r=new Ec(t._url,t._request,null===e||void 0===e||null===(i=e.currentTarget)||void 0===i?void 0:i.response,"xhr.onerror.status:"+(null===e||void 0===e||null===(n=e.currentTarget)||void 0===n?void 0:n.status)+",statusText,"+(null===e||void 0===e||null===(s=e.currentTarget)||void 0===s?void 0:s.statusText));r.options={index:t._index,range:t._range,vid:t._vid,priOptions:t._priOptions},t._loadCompleteReject(r)},i.ontimeout=function(e){t.cancel();var i=new Ec(t._url,t._request,{status:408},"timeout");t._onTimeout&&(i.isTimeout=!0,t._onTimeout(i,{index:t._index,range:t._range,vid:t._vid,priOptions:t._priOptions})),i.options={index:t._index,range:t._range,vid:t._vid,priOptions:t._priOptions},t._loadCompleteReject(i)};var n=this._headers||{},s=Cc(e);s&&(n.Range=s),n&&Object.keys(n).forEach((function(e){i.setRequestHeader(e,n[e])})),this._logger.debug("[xhr.send->] tast,",this._range,",load sub range, ",e),i.send(this._body)}catch(r){r.options={index:this._index,range:e,vid:this._vid,priOptions:this._priOptions},this._loadCompleteReject(r)}}},{key:"_onReadyStatechange",value:function(e){var t=e.target;2===t.readyState&&this._firstRtt<0&&(this._firstRtt=Date.now())}},{key:"_onLoad",value:function(e){var t,i=e.target.status;if(i<200||i>299){var n=new Ec(this._url,null,Oo(Oo({},e.target.response),{},{status:i}),"bad response,status:"+i);return n.options={index:this._index,range:this._range,vid:this._vid,priOptions:this._priOptions},this._loadCompleteReject(n)}var s,r=null,o=!1,a=(null===(t=this._range)||void 0===t?void 0:t.length)>0?this._range[0]:0;if(this._responseType===Sc.ARRAY_BUFFER){var l,c=new Uint8Array(e.target.response);if(s=a+this._receivedLength,c&&c.byteLength>0){this._receivedLength+=c.byteLength;var u=Date.now()-this._startTime,h=Dc(this._receivedLength,u);this.emit(Aa.REAL_TIME_SPEED,{speed:h,len:this._receivedLength,time:u,vid:this._vid,index:this._index,range:[s,a+this._receivedLength],priOptions:this._priOptions})}r=c,o=!((null===(l=this._range)||void 0===l?void 0:l.length)>1&&this._range[1]&&this._receivedLength<this._range[1]-this._range[0]),this._logger.debug("[xhr load done->], tast :",this._range,", start",s,"end ",a+this._receivedLength,",dataLen,",c?c.byteLength:0,",receivedLength",this._receivedLength,",index,",this._index,", done,",o)}else o=!0,r=e.target.response;var d={ok:i>=200&&i<300,status:i,statusText:this._xhr.statusText,url:this._xhr.responseURL,headers:this._getHeaders(this._xhr),body:this._xhr.response};this._transformResponse&&(d=this._transformResponse(d,this._url)||d),this._onProgress&&this._onProgress(r,o,{index:this._index,vid:this._vid,range:[s,a+this._receivedLength],startTime:this._startTime,endTime:Date.now(),priOptions:this._priOptions},d),o?(this._runing=!1,this._loadCompleteResolve&&this._loadCompleteResolve(Ic(this._onProgress?null:r,o,d,d.headers["content-length"],d.headers.age,this._startTime,this._firstRtt,this._index,this._range,this._vid,this._priOptions))):this._startLoad()}},{key:"cancel",value:function(){if(!this._aborted)return this._aborted=!0,this._runing=!1,ta(Go(i.prototype),"removeAllListeners",this).call(this),this._onCancel&&this._onCancel({index:this._index,range:this._range,vid:this._vid,priOptions:this._priOptions}),this._xhr?this._xhr.abort():void 0}},{key:"receiveLen",get:function(){return this._receivedLength}},{key:"running",get:function(){return this._running},set:function(e){this._running=e}},{key:"_getHeaders",value:function(e){var t,i=e.getAllResponseHeaders().trim().split("\r\n"),n={},s=sa(i);try{for(s.s();!(t=s.n()).done;){var r=t.value,o=r.split(": ");n[o[0].toLowerCase()]=o.slice(1).join(": ")}}catch(a){s.e(a)}finally{s.f()}return n}}],[{key:"isSupported",value:function(){return"undefined"!==typeof XMLHttpRequest}}]),i}(V()),Nc=["retry","retryDelay","onRetryError","transformError"],Uc=function(){function e(t,i){Fo(this,e),this.promise=ba(),this.alive=!!i.onProgress,!i.logger&&(i.logger=new ma("Loader")),this._loaderType=t,this._loader=t===bc.FETCH&&"undefined"!==typeof fetch?new Oc:new Mc,this._config=i,this._retryCount=0,this._retryTimer=null,this._canceled=!1,this._retryCheckFunc=i.retryCheckFunc,this._logger=i.logger}return Ho(e,[{key:"exec",value:function(){var e=this,t=this._config,i=t.retry,n=t.retryDelay,s=t.onRetryError,r=t.transformError,o=qo(t,Nc),a=function(){var t=Uo(Ro().mark((function t(){var l,c,u;return Ro().wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,e._loader.load(o);case 3:l=t.sent,e.promise.resolve(l),t.next=27;break;case 7:if(t.prev=7,t.t0=t["catch"](0),e._loader.running=!1,e._logger.debug("[task request catch err]",t.t0),!e._canceled){t.next=13;break}return t.abrupt("return");case 13:if(t.t0.loaderType=e._loaderType,t.t0.retryCount=e._retryCount,c=t.t0,r&&(c=r(c)||c),s&&e._retryCount>0&&s(c,e._retryCount,{index:o.index,vid:o.vid,range:o.range,priOptions:o.priOptions}),e._retryCount++,u=!0,e._retryCheckFunc&&(u=e._retryCheckFunc(t.t0)),!(u&&e._retryCount<=i)){t.next=26;break}return clearTimeout(e._retryTimer),e._logger.debug("[task request setTimeout],retry",e._retryCount,",retry range,",o.range),e._retryTimer=setTimeout(a,n),t.abrupt("return");case 26:e.promise.reject(c);case 27:case"end":return t.stop()}}),t,null,[[0,7]])})));return function(){return t.apply(this,arguments)}}();return a(),this.promise}},{key:"cancel",value:function(){var e=Uo(Ro().mark((function e(){return Ro().wrap((function(e){while(1)switch(e.prev=e.next){case 0:return clearTimeout(this._retryTimer),this._canceled=!0,this._loader.running=!1,e.abrupt("return",this._loader.cancel());case 4:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}()},{key:"running",get:function(){return this._loader&&this._loader.running}},{key:"loader",get:function(){return this._loader}}]),e}(),Fc=function(e){Vo(i,e);var t=Jo(i);function i(e){var n;return Fo(this,i),n=t.call(this,e),jo(Qo(n),"type",bc.FETCH),jo(Qo(n),"_queue",[]),jo(Qo(n),"_alive",[]),jo(Qo(n),"_currentTask",null),jo(Qo(n),"_finnalUrl",""),jo(Qo(n),"_config",void 0),n._config=Rc(e),n._config.loaderType!==bc.XHR&&Oc.isSupported()||(n.type=bc.XHR),n.log=e.logger,n}return Ho(i,[{key:"isFetch",value:function(){return this.type===bc.FETCH}},{key:"load",value:function(e){var t=this,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};"string"!==typeof e&&e?i=e:i.url=e||i.url||this._config.url,i=Object.assign({},this._config,i),i.params&&(i.params=Object.assign({},i.params)),i.headers&&wc(i.headers)&&(i.headers=Object.assign({},i.headers)),i.body&&wc(i.body)&&(i.body=Object.assign({},i.body)),i.transformRequest&&(i=i.transformRequest(i)||i),i.logger=this.log;var n=new Uc(this.type,i);return n.loader.on(Aa.REAL_TIME_SPEED,(function(e){t.emit(Aa.REAL_TIME_SPEED,e)})),this._queue.push(n),1!==this._queue.length||this._currentTask&&this._currentTask.running||this._processTask(),n.promise}},{key:"cancel",value:function(){var e=Uo(Ro().mark((function e(){var t;return Ro().wrap((function(e){while(1)switch(e.prev=e.next){case 0:return t=this._queue.map((function(e){return e.cancel()})).concat(this._alive.map((function(e){return e.cancel()}))),this._currentTask&&t.push(this._currentTask.cancel()),this._queue=[],this._alive=[],e.next=6,Promise.all(t);case 6:return e.next=8,La();case 8:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}()},{key:"_processTask",value:function(){var e=this;if(this._currentTask=this._queue.shift(),this._currentTask){this._currentTask.alive&&this._alive.push(this._currentTask);var t=this._currentTask.exec().catch((function(e){}));t&&"function"===typeof t.finally&&t.finally((function(){var t,i;null!==(t=e._currentTask)&&void 0!==t&&t.alive&&(null===(i=e._alive)||void 0===i?void 0:i.length)>0&&(e._alive=e._alive.filter((function(t){return t&&t!==e._currentTask}))),e._processTask()}))}}}],[{key:"isFetchSupport",value:function(){return Oc.isSupported()}}]),i}(V()),Bc=co((function e(){ao(this,e),uo(this,"version",0),uo(this,"streams",[]),uo(this,"isMaster",!0)})),Hc={Audio:"AUDIO",Video:"VIDEO",SubTitle:"SUBTITLE",ClosedCaptions:"CLOSED-CAPTIONS"},jc={CLEAR_KEY:"org.w3.clearkey",FAIRPLAY:["urn:uuid:94ce86fb-07ff-4f43-adb8-93d2fa968ca2","com.apple.streamingkeydelivery"],WIDEVINE:["urn:uuid:edef8ba9-79d6-4ace-a3c8-27dcd51d21ed","com.widevine.alpha","com.widevine"],PLAYREADY:["urn:uuid:9a04f079-9840-4286-ab92-e65be0885f95","com.microsoft.playready"]};function Vc(e){for(var t=[],i=0;i<e.length;i++)Array.isArray(e[i])?t=t.concat(Vc(e[i])):t.push(e[i]);return t}var Gc=co((function e(){ao(this,e),uo(this,"id",0),uo(this,"url",""),uo(this,"default",!1),uo(this,"autoSelect",!1),uo(this,"forced",!1),uo(this,"group",""),uo(this,"name",""),uo(this,"lang",""),uo(this,"segments",[]),uo(this,"endSN",0)})),zc=function(e){ho(i,e);var t=bo(i);function i(){var e;ao(this,i);for(var n=arguments.length,s=new Array(n),r=0;r<n;r++)s[r]=arguments[r];return e=t.call.apply(t,[this].concat(s)),uo(yo(e),"mediaType",Hc.Audio),uo(yo(e),"channels",0),e}return co(i)}(Gc),Kc=function(e){ho(i,e);var t=bo(i);function i(){var e;ao(this,i);for(var n=arguments.length,s=new Array(n),r=0;r<n;r++)s[r]=arguments[r];return e=t.call.apply(t,[this].concat(s)),uo(yo(e),"mediaType",Hc.SubTitle),e}return co(i)}(Gc),Wc=co((function e(){ao(this,e),uo(this,"id",0),uo(this,"bitrate",0),uo(this,"width",0),uo(this,"height",0),uo(this,"name",""),uo(this,"url",""),uo(this,"audioCodec",""),uo(this,"videoCodec",""),uo(this,"textCodec",""),uo(this,"audioGroup",""),uo(this,"audioStreams",[]),uo(this,"subtitleStreams",[]),uo(this,"closedCaptionsStream",[])})),Yc=co((function e(){ao(this,e),uo(this,"version",0),uo(this,"url",""),uo(this,"type",""),uo(this,"startCC",0),uo(this,"endCC",0),uo(this,"startSN",0),uo(this,"endSN",0),uo(this,"totalDuration",0),uo(this,"targetDuration",0),uo(this,"partTargetDuration",0),uo(this,"canSkipUntil",0),uo(this,"canSkipDateRanges",!1),uo(this,"skippedSegments",0),uo(this,"canBlockReload",!1),uo(this,"partHoldBack",0),uo(this,"live",!0),uo(this,"lowLatency",!1),uo(this,"endPartIndex",0),uo(this,"segments",[]),uo(this,"dateRanges",{}),uo(this,"skippedSegments",0)})),$c=function(){function e(t){ao(this,e),uo(this,"sn",0),uo(this,"cc",0),uo(this,"url",""),uo(this,"parentUrl",""),uo(this,"title",""),uo(this,"start",0),uo(this,"duration",0),uo(this,"dataTime",""),uo(this,"key",null),uo(this,"byteRange",null),uo(this,"isInitSegment",!1),uo(this,"initSegment",null),uo(this,"isLast",!1),uo(this,"hasAudio",!1),uo(this,"hasVideo",!1),uo(this,"independent",!1),uo(this,"partIndex",0),this.parentUrl=t}return co(e,[{key:"end",get:function(){return this.start+this.duration}},{key:"setTrackExist",value:function(e,t){this.hasVideo=e,this.hasAudio=t}},{key:"setByteRange",value:function(e,t){this.byteRange=[0];var i=e.split("@");1===i.length&&t&&t.byteRange?(this.byteRange[0]=t.byteRange[1]||0,this.byteRange[0]&&(this.byteRange[0]+=1)):this.byteRange[0]=parseInt(i[1]),this.byteRange[1]=this.byteRange[0]+parseInt(i[0])-1}}]),e}(),Xc=function(){function e(t){ao(this,e),uo(this,"method",""),uo(this,"url",""),uo(this,"iv",null),uo(this,"keyFormat",""),uo(this,"keyFormatVersions",""),t instanceof e&&(this.method=t.method,this.url=t.url,this.keyFormat=t.keyFormat,this.keyFormatVersions=t.keyFormatVersions,t.iv&&(this.iv=new Uint8Array(t.iv)))}return co(e,[{key:"clone",value:function(t){var i=new e(this);return null!==t&&void 0!==t&&i.setIVFromSN(t),i}},{key:"setIVFromSN",value:function(e){if(!this.iv&&"AES-128"===this.method&&"number"===typeof e&&this.url){this.iv=new Uint8Array(16);for(var t=12;t<16;t++)this.iv[t]=e>>8*(15-t)&255}}},{key:"isSegmentEncrypted",value:function(){var e=this.method;return"AES-128"===e}},{key:"isValidKeySystem",value:function(){var e=Vc([jc.CLEAR_KEY,jc.FAIRPLAY,jc.WIDEVINE,jc.PLAYREADY]).indexOf(this.keyFormat)>-1;if(!e)return!1;var t=["SAMPLE-AES","SAMPLE-AES-CENC","SAMPLE-AES-CTR"].indexOf(this.method)>-1;return!!t}},{key:"isSupported",value:function(){return!!this.method&&(!!this.isSegmentEncrypted()||!!this.isValidKeySystem())}}]),e}(),qc=/^#(EXT[^:]*)(?::(.*))?$/,Qc=/([^=]+)=(?:"([^"]*)"|([^",]*))(?:,|$)/g,Zc=/^(?:[a-zA-Z0-9+\-.]+:)?\/\//,Jc=/^((?:[a-zA-Z0-9+\-.]+:)?\/\/[^/?#]*)?([^?#]*\/)?/;function eu(e){return e.split(/[\r\n]/).map((function(e){return e.trim()})).filter(Boolean)}function tu(e){var t=e.match(qc);if(t&&t[1])return[t[1].replace("EXT-X-",""),t[2]]}function iu(e){var t={},i=Qc.exec(e);while(i)t[i[1]]=i[2]||i[3],i=Qc.exec(e);return t}function nu(e,t){if(!t||!e||Zc.test(e))return e;var i=Jc.exec(t);return i?"/"===e[0]?i[1]+e:i[1]+i[2]+e:e}var su={audio:[/^mp4a/,/^vorbis$/,/^opus$/,/^flac$/,/^[ae]c-3$/],video:[/^avc/,/^hev/,/^hvc/,/^vp0?[89]/,/^av1$/],text:[/^vtt$/,/^wvtt/,/^stpp/]};function ru(e,t){var i=su[e];if(i&&t&&t.length)for(var n=0;n<i.length;n++)for(var s=0;s<t.length;s++)if(i[n].test(t[s]))return t[s]}function ou(e,t){var i;if(t)for(var n in t)if(Object.prototype.hasOwnProperty.call(t,n)&&e[n]!==t[n]){i=n;break}var s=null;e.DURATION&&(s=parseFloat(e.DURATION),Number.isFinite(s)?e._endDate&&(s=(e._endDate.getTime()-e._startDate.getTime())/1e3):s=null);var r=au(e.CUE||e["X-CUE"],{pre:!1,post:!1,once:!1});return!!e.ID&&!i&&Number.isFinite(e._startDate.getTime())&&(null===s||s>=0)&&(!("YES"===e.END_ON_NEXT)||!!e.CLASS)&&(!e.CUE||!r.pre&&!r.post||r.pre!==r.post)&&(!("com.apple.hls.interstitial"===e.CLASS)||"X-ASSET-URI"in e||"X-ASSET-LIST"in e)}function au(e,t){return(e?e.split(/[ ,]+/):[]).reduce((function(e,t){return e[t.toLowerCase()]=!0,e}),t)}function lu(e,t){var i,n=new Bc,s=0,r=[],o=[];while(i=e[s++]){var a=tu(i);if(a){var l=So(a,2),c=l[0],u=l[1];if("VERSION"===c)n.version=parseInt(u);else if("MEDIA"===c&&u){var h=iu(u),d=void 0;switch(h.TYPE){case"AUDIO":d=new zc;break;case"SUBTITLES":d=new Kc;break;default:d=new Gc}d.url=nu(h.URI,t),d.default="YES"===h.DEFAULT,d.autoSelect="YES"===h.AUTOSELECT,d.group=h["GROUP-ID"],d.name=h.NAME,d.lang=h.LANGUAGE,h.CHANNELS&&(d.channels=Number(h.CHANNELS.split("/")[0]),Number.isNaN(d.channels)&&(d.channels=0)),"AUDIO"===h.TYPE&&h.URI&&r.push(d),"SUBTITLES"===h.TYPE&&o.push(d)}else if("STREAM-INF"===c&&u){var p=new Wc,f=iu(u);if(p.bitrate=parseInt(f["AVERAGE-BANDWIDTH"]||f.BANDWIDTH),p.name=f.NAME,p.url=nu(e[s++],t),f.RESOLUTION){var g=f.RESOLUTION.split("x"),m=So(g,2),v=m[0],y=m[1];p.width=parseInt(v),p.height=parseInt(y)}if(f.CODECS){var _=f.CODECS.split(/[ ,]+/).filter(Boolean);p.videoCodec=ru("video",_),p.audioCodec=ru("audio",_),p.textCodec=ru("text",_)}p.audioGroup=f.AUDIO,p.subtitleGroup=f.SUBTITLES,n.streams.push(p)}}}return n.streams.forEach((function(e,t){e.id=t})),r.length&&(r.forEach((function(e,t){e.id=t})),n.streams.forEach((function(e){e.audioGroup&&(e.audioStreams=r.filter((function(t){return t.group===e.audioGroup})))}))),o.length&&(o.forEach((function(e,t){e.id=t})),n.streams.forEach((function(e){e.subtitleGroup&&(e.subtitleStreams=o.filter((function(t){return t.group===e.subtitleGroup})))}))),n}function cu(e,t,i){var n=new Yc;n.url=t;var s,r=new $c(t),o=null,a=null,l=0,c=0,u=0,h=0,d=!1,p=0;while(s=e[h++])if("#"===s[0]){var f=tu(s);if(f){var g=So(f,2),m=g[0],v=g[1];switch(m){case"VERSION":n.version=parseInt(v);break;case"PLAYLIST-TYPE":n.type=null===v||void 0===v?void 0:v.toUpperCase();break;case"TARGETDURATION":n.targetDuration=parseFloat(v);break;case"PART-INF":i&&(n.lowLatency=!0);var y=iu(v);y["PART-TARGET"]&&(n.partTargetDuration=parseFloat(y["PART-TARGET"]));break;case"SERVER-CONTROL":var _=iu(v);n.canBlockReload="YES"===_["CAN-BLOCK-RELOAD"],n.partHoldBack=parseFloat(_["PART-HOLD-BACK"]||0),n.canSkipUntil=parseFloat(_["CAN-SKIP-UNTIL"]||0),n.canSkipDateRanges="YES"===_["CAN-SKIP-DATERANGES"];break;case"ENDLIST":d=!0;break;case"MEDIA-SEQUENCE":c=n.startSN=parseInt(v);break;case"DISCONTINUITY-SEQUENCE":u=n.startCC=parseInt(v);break;case"DISCONTINUITY":u++;break;case"BYTERANGE":r.setByteRange(v,n.segments[n.segments.length-1]);break;case"PART":if(!n.lowLatency)break;var b=iu(v);r.duration=parseFloat(b["DURATION"]),r.independent="YES"===b["INDEPENDENT"],r.sn=c,r.cc=u,r.partIndex=p,r.start=l,r.duration=parseFloat(b["DURATION"]),l+=r.duration,r.url=nu(b["URI"],t),a&&(r.key=a.clone(c)),o&&(r.initSegment=o),n.segments.push(r),r=new $c(t),p++;break;case"PRELOAD-HINT":break;case"PROGRAM-DATE-TIME":r.dataTime=v;break;case"EXTINF":if(n.lowLatency){p=0;break}var S=v.split(","),E=So(S,2),T=E[0],k=E[1];r.start=l,r.duration=parseFloat(T),l+=r.duration,r.title=k;break;case"KEY":var w=iu(v);if("NONE"===w.METHOD){a=null;break}if(a=new Xc,a.method=w.METHOD,a.url=/^blob:/.test(w.URI)?w.URI:nu(w.URI,t),a.keyFormat=w.KEYFORMAT||"identity",a.keyFormatVersions=w.KEYFORMATVERSIONS,!a.isSupported())throw new Error("encrypt ".concat(w.METHOD,"/").concat(w.KEYFORMAT," is not supported"));if(w.IV){var x=w.IV.slice(2);x=(1&x.length?"0":"")+x,a.iv=new Uint8Array(x.length/2);for(var C=0,A=x.length/2;C<A;C++)a.iv[C]=parseInt(x.slice(2*C,2*C+2),16)}break;case"MAP":var P=iu(v);r.url=nu(P.URI,t),P.BYTERANGE&&r.setByteRange(P.BYTERANGE),r.isInitSegment=!0,r.sn=0,a&&(r.key=a.clone(0)),o=r,r=new $c(t);break;case"SKIP":var I=iu(v),D=parseInt(I["SKIPPED-SEGMENTS"],10);D<=Number.MAX_SAFE_INTEGER&&(n.skippedSegments+=D);break;case"DATERANGE":var L=iu(v),O=n.dateRanges[L.ID];L._startDate=O?O._startDate:new Date(L["START-DATE"]);var R=(null===O||void 0===O?void 0:O._endDate)||new Date(L.END_DATE);Number.isFinite(R)&&(L._endDate=R),(ou(L,O)||n.skippedSegments)&&(n.dateRanges[L.ID]=L);break}}}else{if(n.lowLatency){c++;continue}r.sn=c,r.cc=u,r.url=nu(s,t),a&&(r.key=a.clone(c)),o&&(r.initSegment=o),n.segments.push(r),r=new $c(t),c++}n.segments=n.segments.filter((function(e){return 0!==e.duration}));var M=n.segments[n.segments.length-1];return M&&(d&&(M.isLast=!0),n.endSN=M.sn,n.endPartIndex=M.partIndex),d&&(n.live=!1),n.totalDuration=l,n.endCC=u,n}var uu=function(){function e(){ao(this,e)}return co(e,null,[{key:"parse",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",i=arguments.length>1?arguments[1]:void 0,n=arguments.length>2?arguments[2]:void 0;if(!t.includes("#EXTM3U"))throw new Error("Invalid m3u8 file");var s=eu(t);return e.isMediaPlaylist(t)?cu(s,i,n):lu(s,i)}},{key:"isMediaPlaylist",value:function(e){return e.includes("#EXTINF:")||e.includes("#EXT-X-TARGETDURATION:")}}]),e}(),hu=function(){function e(t){var i=this;ao(this,e),uo(this,"_emitOnLoaded",(function(e,t){var n=e.response,s=e.options,r=s||{},o=r.firstByteTime,a=r.startTime,l=r.endTime,c=r.contentLength,u=l-a;i.hls.emit(Aa.SPEED,{time:u,byteLength:c,url:t}),i.hls.emit(Aa.LOAD_COMPLETE,{url:t,elapsed:u||0}),i.hls.emit(Aa.TTFB,{url:t,responseUrl:n.url,elapsed:o-a}),i.hls.emit(Aa.LOAD_RESPONSE_HEADERS,{headers:n.headers,url:t})})),uo(this,"_onLoaderRetry",(function(e,t){i.hls.emit(dc.LOAD_RETRY,{error:da.network(e),retryTime:t})})),this.hls=t,this._timer=null,this._useLowLatency=t.config.useLowLatency;var n=this.hls.config,s=n.retryCount,r=n.retryDelay,o=n.manifestLoadTimeout,a=n.fetchOptions;this._loader=new Fc(io(io({},a),{},{responseType:"text",retry:s,retryDelay:r,timeout:o,onRetryError:this._onLoaderRetry})),this._audioLoader=new Fc(io(io({},a),{},{responseType:"text",retry:s,retryDelay:r,timeout:o,onRetryError:this._onLoaderRetry})),this._subtitleLoader=new Fc(io(io({},a),{},{responseType:"text",retry:s,retryDelay:r,timeout:o,onRetryError:this._onLoaderRetry}))}return co(e,[{key:"load",value:function(){var e=oo(no().mark((function e(t,i,n){var s,r,o,a,l,c,u,h,d,p,f,g,m,v,y,_,b,S,E,T;return no().wrap((function(e){while(1)switch(e.prev=e.next){case 0:return s=[this._loader.load(t)],i&&s.push(this._audioLoader.load(i)),n&&s.push(this._subtitleLoader.load(n)),e.prev=3,e.next=6,Promise.all(s);case 6:if(h=e.sent,d=So(h,3),p=d[0],f=d[1],g=d[2],p){e.next=13;break}return e.abrupt("return",[]);case 13:this._emitOnLoaded(p,t),r=p.data,l=p.response.url||t,i?(o=null===f||void 0===f?void 0:f.data,a=null===g||void 0===g?void 0:g.data,c=(null===f||void 0===f||null===(m=f.response)||void 0===m?void 0:m.url)||i,u=(null===g||void 0===g||null===(v=g.response)||void 0===v?void 0:v.url)||n,o&&this._emitOnLoaded(f,i),a&&this._emitOnLoaded(g,n)):(a=null===f||void 0===f?void 0:f.data,u=(null===f||void 0===f||null===(y=f.response)||void 0===y?void 0:y.url)||n,a&&this._emitOnLoaded(f,n)),e.next=22;break;case 19:throw e.prev=19,e.t0=e["catch"](3),da.network(e.t0);case 22:if(_=this.hls.config.onPreM3U8Parse,e.prev=23,_&&(r=_(r)||r,o&&(o=_(o,!0)||o),a&&(a=_(a,!0)||a)),b=uu.parse(r,l,this._useLowLatency),!1!==(null===(T=b)||void 0===T?void 0:T.live)||!b.segments||b.segments.length){e.next=28;break}throw new Error("empty segments list");case 28:o&&(S=uu.parse(o,c,this._useLowLatency)),a&&(E=uu.parse(a,u,this._useLowLatency)),e.next=35;break;case 32:throw e.prev=32,e.t1=e["catch"](23),new da(ua.MANIFEST,ua.SUB_TYPES.HLS,e.t1);case 35:return b&&(b.isMaster?this.hls.emit(dc.HLS_MANIFEST_LOADED,{playlist:b}):this.hls.emit(dc.HLS_LEVEL_LOADED,{playlist:b})),e.abrupt("return",[b,S,E]);case 37:case"end":return e.stop()}}),e,this,[[3,19],[23,32]])})));function t(t,i,n){return e.apply(this,arguments)}return t}()},{key:"parseText",value:function(e,t){var i,n=this.hls.config.onPreM3U8Parse;try{var s;if(n&&(e=n(e)||e),i=uu.parse(e,t,this._useLowLatency),!1===(null===(s=i)||void 0===s?void 0:s.live)&&i.segments&&!i.segments.length)throw new Error("empty segments list")}catch(r){throw new da(ua.MANIFEST,ua.SUB_TYPES.HLS,r)}return i&&(i.isMaster?this.hls.emit(dc.HLS_MANIFEST_LOADED,{playlist:i}):this.hls.emit(dc.HLS_LEVEL_LOADED,{playlist:i})),[i]}},{key:"poll",value:function(e,t,i,n,s,r){var o=this;clearTimeout(this._timer),r=r||3e3;var a=this.hls.config.pollRetryCount,l=function(){var c=oo(no().mark((function c(){var u;return no().wrap((function(c){while(1)switch(c.prev=c.next){case 0:return clearTimeout(o._timer),c.prev=1,c.next=4,o.load(e,t,i);case 4:if(u=c.sent,u[0]){c.next=7;break}return c.abrupt("return");case 7:a=o.hls.config.pollRetryCount,n(u[0],u[1],u[2]),c.next=15;break;case 11:c.prev=11,c.t0=c["catch"](1),a--,a<=0&&s(c.t0);case 15:o._timer=setTimeout(l,r);case 16:case"end":return c.stop()}}),c,null,[[1,11]])})));return function(){return c.apply(this,arguments)}}();this._timer=setTimeout(l,r)}},{key:"stopPoll",value:function(){return clearTimeout(this._timer),this.cancel()}},{key:"cancel",value:function(){return Promise.all([this._loader.cancel(),this._audioLoader.cancel()])}}]),e}();function du(e,t,i){return t>i&&(i=t),Math.min(Math.max(e,t),i)}var pu=new ma("playlist"),fu=function(){function e(t,i,n){ao(this,e),uo(this,"live",void 0),uo(this,"id",0),uo(this,"bitrate",0),uo(this,"width",0),uo(this,"height",0),uo(this,"name",""),uo(this,"url",""),uo(this,"audioCodec",""),uo(this,"videoCodec",""),uo(this,"textCodec",""),uo(this,"startCC",0),uo(this,"endCC",0),uo(this,"startSN",0),uo(this,"endSN",-1),uo(this,"totalDuration",0),uo(this,"targetDuration",0),uo(this,"partTargetDuration",0),uo(this,"canSkipUntil",0),uo(this,"canSkipDateRanges",!1),uo(this,"skippedSegments",0),uo(this,"canBlockReload",!1),uo(this,"partHoldBack",0),uo(this,"lowLatency",!1),uo(this,"endPartIndex",0),uo(this,"snDiff",null),uo(this,"segments",[]),uo(this,"audioStreams",[]),uo(this,"subtitleStreams",[]),uo(this,"closedCaptions",[]),uo(this,"currentAudioStream",null),uo(this,"currentSubtitleStream",null),this.update(this._setLLPlaybackPoint(t),i,n)}return co(e,[{key:"lastSegment",get:function(){return this.segments.length?this.segments[this.segments.length-1]:null}},{key:"segmentDuration",get:function(){var e;return this.targetDuration||(null===(e=this.segments[0])||void 0===e?void 0:e.duration)||0}},{key:"liveEdge",get:function(){return this.endTime},set:function(e){this.endTime=e}},{key:"endTime",get:function(){var e;return(null===(e=this.lastSegment)||void 0===e?void 0:e.end)||0},set:function(e){var t=this.lastSegment;t&&(t.duration=e-t.start)}},{key:"currentSubtitleEndSn",get:function(){var e;return(null===(e=this.currentSubtitleStream)||void 0===e?void 0:e.endSN)||0}},{key:"clearOldSegment",value:function(e,t){return this.currentAudioStream&&this._clearSegments(e,t),this._clearSegments(e,t)}},{key:"getAudioSegment",value:function(e){if(e&&this.currentAudioStream){var t=e.sn-this.snDiff;return this.currentAudioStream.segments.find((function(e){return e.sn===t}))}}},{key:"update",value:function(e,t){this.url=e.url,Array.isArray(e.segments)?(null!==this.live&&void 0!==this.live||(this.live=e.live),this._updateSegments(e,this),this.startCC=e.startCC,this.endCC=e.endCC,this.startSN=e.startSN,this.endSN=e.endSN||-1,this.totalDuration=e.totalDuration,this.targetDuration=e.targetDuration,this.live=e.live,this.lowLatency=e.lowLatency,this.canBlockReload=e.canBlockReload,this.canSkipDateRanges=e.canSkipDateRanges,this.canSkipUntil=e.canSkipUntil,this.partHoldBack=e.partHoldBack,this.partTargetDuration=e.partTargetDuration,this.skippedSegments=e.skippedSegments,this.endPartIndex=e.endPartIndex,t&&this.currentAudioStream&&Array.isArray(t.segments)&&(this._updateSegments(t,this.currentAudioStream),(null===this.snDiff||void 0===this.snDiff)&&e.segments.length&&t.segments.length&&(this.snDiff=e.segments[0].sn-t.segments[0].sn))):(this.id=e.id,this.bitrate=e.bitrate,this.width=e.width,this.height=e.height,this.name=e.name,this.audioCodec=e.audioCodec,this.videoCodec=e.videoCodec,this.textCodec=e.textCodec,this.audioStreams=e.audioStreams,this.subtitleStreams=e.subtitleStreams,!this.currentAudioStream&&this.audioStreams.length&&(this.currentAudioStream=this.audioStreams.find((function(e){return e.default}))||this.audioStreams[0]),!this.currentSubtitleStream&&this.subtitleStreams.length&&(this.currentSubtitleStream=this.subtitleStreams.find((function(e){return e.default}))||this.subtitleStreams[0]))}},{key:"updateSubtitle",value:function(e){var t=this;if(e&&this.currentSubtitleStream&&Array.isArray(e.segments)){var i=this._updateSegments(e,this.currentSubtitleStream),n=this.currentSubtitleStream.segments;if(n.length>100&&(this.currentSubtitleStream.segments=n.slice(100)),i)return i.map((function(e){return{sn:e.sn,url:e.url,duration:e.duration,start:e.start,end:e.end,lang:t.currentSubtitleStream.lang}}))}}},{key:"switchSubtitle",value:function(e){var t=this.subtitleStreams.find((function(t){return t.lang===e})),i=this.currentSubtitleStream;t&&(this.currentSubtitleStream=t,i.segments=[])}},{key:"_setLLPlaybackPoint",value:function(e){if(!e.lowLatency||!e.segments.length)return e;for(var t=e.totalDuration-e.partHoldBack,i=e.segments,n=0,s=0,r=i.length;s<r;s++)i[s].start<=t&&i[s].independent&&(n=s);var o=i.slice(n),a=0;return o.forEach((function(e){e.start=a,a=e.end})),e.segments=o,e.totalDuration=a,e.startSN=o[0].sn,e.startCC=o[0].cc,pu.log("set ll-hls playback point: SN=".concat(e.startSN," partIndex=").concat(o[0].partIndex,", duration=").concat(a)),e}},{key:"_clearSegments",value:function(e,t){for(var i=0,n=this.segments,s=0,r=n.length;s<r;s++)if(n[s].end>=e){i=s;break}return i>t&&(i=t),i&&(this.segments=this.segments.slice(i),this.currentAudioStream&&(this.currentAudioStream.segments=this.currentAudioStream.segments.slice(i))),t-i}},{key:"_updateSegments",value:function(e,t){var i=t.segments;if(this.live){var n,s=e.lowLatency,r=i[i.length-1],o=null!==(n=null===r||void 0===r?void 0:r.sn)&&void 0!==n?n:-1,a=(null===r||void 0===r?void 0:r.partIndex)||0,l=o<e.endSN&&e.segments.length;if(s&&(l=l||a<e.endPartIndex),l){pu.log("update segments: endSN:".concat(o,", partIndex:").concat(a," --\x3e endSN:").concat(e.endSN,", partIndex:").concat(e.endPartIndex));var c=e.segments.findIndex((function(e){return e.sn===o&&e.partIndex===a})),u=c<0?e.segments:e.segments.slice(c+1);if(i.length&&u.length){var h=r.end,d=h;u.forEach((function(e){e.start=h,h=e.end})),pu.log("liveEdge: ".concat(d," -> ").concat(h));var p=(null===r||void 0===r?void 0:r.cc)||-1;p>u[0].cc&&u.forEach((function(e){return e.cc+=p}))}return t.endSN=e.endSN,t.segments=i.concat(u),u}}else t.segments=e.segments}}]),e}(),gu=function(){function e(t){ao(this,e),uo(this,"streams",[]),uo(this,"currentStream",null),uo(this,"dvrWindow",0),uo(this,"_segmentPointer",-1),this.hls=t}return co(e,[{key:"lowLatency",get:function(){var e;return null===(e=this.currentStream)||void 0===e?void 0:e.lowLatency}},{key:"lastSegment",get:function(){var e;return null===(e=this.currentStream)||void 0===e?void 0:e.lastSegment}},{key:"currentSegment",get:function(){var e;return null===(e=this.currentSegments)||void 0===e?void 0:e[this._segmentPointer]}},{key:"nextSegment",get:function(){var e;return null===(e=this.currentSegments)||void 0===e?void 0:e[this._segmentPointer+1]}},{key:"currentSegments",get:function(){var e;return null===(e=this.currentStream)||void 0===e?void 0:e.segments}},{key:"currentSubtitleEndSn",get:function(){var e;return null===(e=this.currentStream)||void 0===e?void 0:e.currentSubtitleEndSn}},{key:"liveEdge",get:function(){var e;return null===(e=this.currentStream)||void 0===e?void 0:e.liveEdge},set:function(e){this.currentStream&&(this.currentStream.liveEdge=e)}},{key:"totalDuration",get:function(){var e;return(null===(e=this.currentStream)||void 0===e?void 0:e.totalDuration)||0}},{key:"seekRange",get:function(){var e=this.currentSegments;if(e&&e.length)return[e[0].start,e[e.length-1].end]}},{key:"nbSegments",get:function(){var e;return(null===(e=this.currentSegments)||void 0===e?void 0:e.length)||0}},{key:"isEmpty",get:function(){var e;return!(null!==(e=this.currentSegments)&&void 0!==e&&e.length)}},{key:"isLive",get:function(){var e;return null===(e=this.currentStream)||void 0===e?void 0:e.live}},{key:"hadSegmentLoaded",get:function(){return-1!==this._segmentPointer}},{key:"hasSubtitle",get:function(){var e;return!(null===(e=this.currentStream)||void 0===e||!e.currentSubtitleStream)}},{key:"getAudioSegment",value:function(e){var t;return null===(t=this.currentStream)||void 0===t?void 0:t.getAudioSegment(e)}},{key:"moveSegmentPointer",value:function(e){var t;null!==e&&void 0!==e||(e=this._segmentPointer+1),this._segmentPointer=du(e,-1,null===(t=this.currentSegments)||void 0===t?void 0:t.length)}},{key:"reset",value:function(){this.streams=[],this.currentStream=null,this.dvrWindow=0,this._segmentPointer=-1}},{key:"getSegmentByIndex",value:function(e){var t;return null===(t=this.currentSegments)||void 0===t?void 0:t[e]}},{key:"setNextSegmentByIndex",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;this._segmentPointer=e-1}},{key:"setNextSegmentBySN",value:function(){var e,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,i=null===(e=this.currentSegments)||void 0===e?void 0:e.findIndex((function(e){return e.sn===t}));return-1!==i&&this.setNextSegmentByIndex(i+1),i}},{key:"findSegmentIndexByTime",value:function(e){var t=this.currentSegments;if(t){for(var i,n=0,s=t.length;n<s;n++)if(i=t[n],e>=i.start&&e<i.end)return n;var r=t[t.length-1];if(Math.abs(e-(null===r||void 0===r?void 0:r.end))<.2)return t.length-1}}},{key:"upsertPlaylist",value:function(e,t,i){var n=this;if(e){if(e.isMaster)this.streams.length=e.streams.length,e.streams.filter((function(e){return e.url})).forEach((function(e,t){n.streams[t]?n.streams[t].update(e):n.streams[t]=new fu(e)})),this.currentStream=this.streams[0];else if(Array.isArray(e.segments)){var s=this.currentStream;if(s){s.update(e,t,i);var r=s.updateSubtitle(i);r&&this.hls.emit(dc.SUBTITLE_SEGMENTS,{list:r})}else this.reset(),this.currentStream=this.streams[0]=new fu(e,t,i)}var o=this.currentStream;o&&this.hls.isLive&&!this.dvrWindow&&(this.dvrWindow=this.currentSegments.reduce((function(e,t){return e+=t.duration,e}),0))}}},{key:"updateSegmentsRanges",value:function(e,t){var i,n=null===(i=this.currentSegments)||void 0===i?void 0:i.filter((function(t){return t.sn>=e}));n.forEach((function(e){e.start=t,t=e.end}))}},{key:"switchSubtitle",value:function(e){var t;null===(t=this.currentStream)||void 0===t||t.switchSubtitle(e)}},{key:"clearOldSegment",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:50,t=this.currentStream;if(this.dvrWindow&&t){var i=t.endTime-this.dvrWindow;if(!(i<=0)){var n=t.segments;n.length<=e||(this._segmentPointer=t.clearOldSegment(i,this._segmentPointer))}}}},{key:"checkSegmentTrackChange",value:function(e,t){var i=this.findSegmentIndexByTime(e),n=this.getSegmentByIndex(i);if(n&&(n.hasAudio||n.hasVideo)){if(2!==t&&n.hasAudio&&n.hasVideo)return n;if(!(n.end-e>.3)){var s=this.getSegmentByIndex(i+1);if(s&&(s.hasAudio||s.hasVideo))return s.hasAudio!==n.hasAudio||s.hasVideo!==n.hasVideo?s:void 0}}}},{key:"feedbackLiveEdge",value:function(e,t){var i,n=this.currentSegments;if(n){var s=(null===(i=this.lastSegment)||void 0===i?void 0:i.sn)===e.sn;s?this.liveEdge=t:this.updateSegmentsRanges(e.sn+1,t)}}}]),e}(),mu=1e3,vu=50,yu=3,_u=3e3,bu=function(){function e(t){Fo(this,e),jo(this,"_chunkSpeed",0),jo(this,"_chunkCache",[]),jo(this,"_speeds",[]),jo(this,"_totalSize",0),jo(this,"_totalCost",0),this._opts=t||{}}return Ho(e,[{key:"addRecord",value:function(e,t){e&&t&&(this._speeds.push(8e3*e/t),this._speeds=this._speeds.slice(-yu))}},{key:"addChunkRecord",value:function(e,t){var i,n;if(e&&t&&!(e<((null===(i=this._opts)||void 0===i?void 0:i.skipChunkSize)||mu))){this._totalSize+=e,this._totalCost+=t,this._chunkSpeed=8e3*e/t,this._chunkCache.push({size:e,duration:t,timestamp:performance.now()});var s=(null===(n=this._opts)||void 0===n?void 0:n.chunkCountForSpeed)||vu;this._chunkCache.length>s&&(this._chunkCache=this._chunkCache.slice(-s))}}},{key:"getAvgSpeed",value:function(){var e;if(!this._chunkCache.length&&!this._speeds.length)return 0;if(this._speeds.length)return this._speeds.reduce((function(e,t){return e+t}))/this._speeds.length;var t=this._chunkCache[this._chunkCache.length-1],i=performance.now()-t.timestamp;i>((null===(e=this._opts)||void 0===e?void 0:e.longtimeNoReceived)||_u)&&this._chunkCache.push({size:0,duration:i,timestamp:performance.now()});var n=this._chunkCache.reduce((function(e,t){return e+t.size}),0),s=this._chunkCache.reduce((function(e,t){return e+t.duration}),0);return 8e3*n/s}},{key:"getLatestSpeed",value:function(){return this._chunkCache.length||this._speeds.length?this._speeds.length?this._speeds[this._speeds.length-1]:this._chunkSpeed:0}},{key:"getTotalSize",value:function(){return this._totalSize}},{key:"getTotalCost",value:function(){return this._totalCost}},{key:"reset",value:function(){this._chunkCache=[],this._speeds=[],this._totalSize=0,this._totalCost=0}}]),e}(),Su=function(){function e(t){var i=this;ao(this,e),uo(this,"error",null),uo(this,"_emitOnLoaded",(function(e,t){var n=e.data,s=e.response,r=e.options,o=r||{},a=o.firstByteTime,l=o.startTime,c=o.endTime,u=o.contentLength,h=c-l;i._bandwidthService.addRecord(u||n.byteLength,h),i.hls.emit(Aa.SPEED,{time:h,byteLength:u,url:t}),i.hls.emit(Aa.LOAD_COMPLETE,{url:t,elapsed:h||0}),i.hls.emit(Aa.TTFB,{url:t,responseUrl:s.url,elapsed:a-l}),i.hls.emit(Aa.LOAD_RESPONSE_HEADERS,{headers:s.headers,url:t})})),uo(this,"_onLoaderRetry",(function(e,t){i.hls.emit(Aa.LOAD_RETRY,{error:da.network(e),retryTime:t})})),this.hls=t,this._bandwidthService=new bu,this._mapCache={},this._keyCache={};var n=this.hls.config,s=n.retryCount,r=n.retryDelay,o=n.loadTimeout,a=n.fetchOptions;this._segmentLoader=new Fc(io(io({},a),{},{responseType:"arraybuffer",retry:s,retryDelay:r,timeout:o,onRetryError:this._onLoaderRetry})),this._audioSegmentLoader=new Fc(io(io({},a),{},{responseType:"arraybuffer",retry:s,retryDelay:r,timeout:o,onRetryError:this._onLoaderRetry})),this._keyLoader=new Fc(io(io({},a),{},{responseType:"arraybuffer",retry:s,retryDelay:r,timeout:o,onRetryError:this._onLoaderRetry}))}return co(e,[{key:"speedInfo",value:function(){return{speed:this._bandwidthService.getLatestSpeed(),avgSpeed:this._bandwidthService.getAvgSpeed()}}},{key:"load",value:function(e,t,i){var n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:i,s=[];return e&&(s[0]=this.loadVideoSegment(e,i)),t&&(s[1]=this.loadAudioSegment(t,n)),Promise.all(s)}},{key:"loadVideoSegment",value:function(e,t){return this._loadSegment(this._segmentLoader,e,t)}},{key:"loadAudioSegment",value:function(e,t){return this._loadSegment(this._audioSegmentLoader,e,t)}},{key:"_loadSegment",value:function(){var e=oo(no().mark((function e(t,i,n){var s,r,o,a,l,c,u,h,d,p,f,g,m,v,y,_=this;return no().wrap((function(e){while(1)switch(e.prev=e.next){case 0:return u=[],this.hls.emit(Aa.LOAD_START,{url:i.url}),u[0]=t.load(i.url),n&&i.initSegment&&(d=i.initSegment.url,r=this._mapCache[d],r||(this.hls.emit(Aa.LOAD_START,{url:d}),u[1]=t.load(d).then((function(e){if(e){var t=Object.keys(_._mapCache);t>30&&(_._mapCache={}),r=_._mapCache[d]=e.data,_._emitOnLoaded(e,d)}}))),p=null===(h=i.initSegment.key)||void 0===h?void 0:h.url,p&&(c=i.initSegment.key.iv,l=this._keyCache[p],l||(this.hls.emit(Aa.LOAD_START,{url:p}),u[2]=this._keyLoader.load(p).then((function(e){e&&(l=_._keyCache[p]=e.data,_._emitOnLoaded(e,p))}))))),f=null===(s=i.key)||void 0===s?void 0:s.url,f&&i.key.isSegmentEncrypted()&&(a=i.key.iv,o=this._keyCache[f],o||(this.hls.emit(Aa.LOAD_START,{url:f}),u[3]=this._keyLoader.load(f).then((function(e){e&&(o=_._keyCache[f]=e.data,_._emitOnLoaded(e,f))})))),e.next=8,Promise.all(u);case 8:if(g=e.sent,m=So(g,1),v=m[0],v){e.next=13;break}return e.abrupt("return");case 13:return y=v.data,this._emitOnLoaded(v,i.url),e.abrupt("return",{data:y,map:r,key:o,mapKey:l,keyIv:a,mapKeyIv:c});case 16:case"end":return e.stop()}}),e,this)})));function t(t,i,n){return e.apply(this,arguments)}return t}()},{key:"reset",value:function(){this.error=null,this._mapCache={},this._keyCache={},this._bandwidthService.reset()}},{key:"cancel",value:function(){var e=oo(no().mark((function e(){return no().wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,Promise.all([this._keyLoader.cancel(),this._segmentLoader.cancel(),this._audioSegmentLoader.cancel()]);case 2:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}()}]),e}(),Eu=new ma("hls"),Tu=function(e){ho(i,e);var t=bo(i);function i(e){var n;return ao(this,i),n=t.call(this),uo(yo(n),"version",i.version),uo(yo(n),"media",null),uo(yo(n),"config",null),uo(yo(n),"_manifestLoader",null),uo(yo(n),"_segmentLoader",null),uo(yo(n),"_playlist",null),uo(yo(n),"_bufferService",null),uo(yo(n),"_gapService",null),uo(yo(n),"_seiService",null),uo(yo(n),"_stats",null),uo(yo(n),"_prevSegSn",null),uo(yo(n),"_prevSegCc",null),uo(yo(n),"_tickTimer",null),uo(yo(n),"_tickInterval",500),uo(yo(n),"_segmentProcessing",!1),uo(yo(n),"_reloadOnPlay",!1),uo(yo(n),"_switchUrlOpts",null),uo(yo(n),"_isProcessQuotaExceeded",!1),uo(yo(n),"_loadSegment",oo(no().mark((function e(){var t,i,s,r,o,a,l,c,u;return no().wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(!n._segmentProcessing&&n.media){e.next=2;break}return e.abrupt("return");case 2:if(t=n._playlist,i=t.nextSegment,s=t.lastSegment,r=yo(n),o=r.config,a=.016,l=Math.min(Math.max((null===s||void 0===s?void 0:s.duration)-a/2||0,a),.1),i){e.next=8;break}return e.abrupt("return");case 8:if(n.isLive){e.next=18;break}if(c=n.bufferInfo(),n.media.paused&&!n.media.currentTime&&(c=n.bufferInfo(c.nextStart||.5)),u=Math.abs(c.end-n.media.duration)<l,!(c.remaining>=o.preloadTime||u)){e.next=15;break}return n._tryEos(),e.abrupt("return");case 15:if(!o.preferMMSStreaming||n._bufferService.msStreaming){e.next=17;break}return e.abrupt("return");case 17:!n._urlSwitching&&n._prevSegSn!==i.sn-1&&c.end&&Math.abs(i.start-c.end)>1&&n._playlist.setNextSegmentByIndex(n._playlist.findSegmentIndexByTime(c.end+.1));case 18:return e.abrupt("return",n._loadSegmentDirect());case 19:case"end":return e.stop()}}),e)})))),uo(yo(n),"_onLoadeddata",(function(){n.isLive&&!n.config.mseLowLatency&&n.media.duration!==1/0&&n._bufferService.updateDuration(1/0).catch((function(e){}))})),uo(yo(n),"_onPlay",oo(no().mark((function e(){return no().wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(!n.media.seeking||0!==n.media.currentTime){e.next=3;break}return Eu.debug("replay currentTime 0, return"),e.abrupt("return");case 3:if(clearTimeout(n._disconnectTimer),!n._reloadOnPlay){e.next=9;break}n._reloadOnPlay=!1,n.replay(!0),e.next=12;break;case 9:return e.next=11,n._loadSegment();case 11:n._startTick();case 12:case"end":return e.stop()}}),e)})))),uo(yo(n),"_onPause",(function(){if(n.isLive){if(!n._reloadOnPlay){var e=n.config.disconnectTime;if(null!==e&&void 0!==e||(e=n._playlist.dvrWindow),!Number.isFinite(e))return;clearTimeout(n._disconnectTimer),n._disconnectTimer=setTimeout((function(){n._reloadOnPlay=!0,n._clear()}),e||0)}}else n._stopTick()})),uo(yo(n),"_onSeeking",oo(no().mark((function e(){var t,i,s,r,o,a,l;return no().wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(n.media){e.next=2;break}return e.abrupt("return");case 2:if(n._onCheckQuotaExceeded(),t=n.media.currentTime,i=n._playlist.seekRange,!i){e.next=10;break}if(s=du(t,i[0],n.isLive?i[1]:n.media.duration),!(s>=0&&Math.abs(t-s)>=.1)){e.next=10;break}return n.media.currentTime=s,e.abrupt("return");case 10:if(r=n._playlist.currentSegment,o=la.info(la.get(n.media),t,.1),!r){e.next=17;break}if(!(o.end&&Math.abs(o.end-r.end)<.2)){e.next=15;break}return e.abrupt("return");case 15:if(!n.isLive||!o.end){e.next=17;break}return e.abrupt("return");case 17:if(a=n._playlist.findSegmentIndexByTime(t),l=n._playlist.getSegmentByIndex(a),null!==a&&void 0!==a&&l&&(!n._segmentProcessing||l!==n._playlist.nextSegment)){e.next=21;break}return e.abrupt("return");case 21:return Eu.debug("seek to",t,l),n._playlist.setNextSegmentByIndex(a),n._stopTick(),e.next=26,n._segmentLoader.cancel();case 26:if(n._segmentProcessing=!1,o.end&&!n.isLive){e.next=30;break}return e.next=30,n._loadSegmentDirect(!0);case 30:n._startTick();case 31:case"end":return e.stop()}}),e)})))),uo(yo(n),"_onTimeupdate",(function(){if(n.media){var e,t=n.config;if(t.isLive&&t.maxLatency&&t.targetLatency&&n.media){var i=n._playlist.liveEdge;if(!i)return;var s=i-n.media.currentTime;s>=t.maxLatency&&(Eu.debug("latency jump, currentTime:".concat(n.media.currentTime,", liveEdge:").concat(i,",  latency=").concat(s)),n.media.currentTime=i-t.targetLatency)}if(t.seiInTime)null===(e=n._seiService)||void 0===e||e.throw(n.media.currentTime);n.config.allowedStreamTrackChange&&!n.config.softDecode&&n._checkStreamTrackChange(n.media.currentTime)}})),uo(yo(n),"_tick",(function(){if(n.media){n._startTick();var e=n.media,t=la.get(e),i=n._segmentLoader.error;if(n._onCheckQuotaExceeded(),n._isProcessQuotaExceeded&&(n._bufferService.isFull()||(n._isProcessQuotaExceeded=!1,n._segmentProcessing=!1)),i){var s=.5;(!e.readyState||n.bufferInfo(s).remaining<1)&&(i.fatal=!0,n._emitError(da.network(i)))}else la.end(t)>=.1&&e.readyState&&(Pa(e)?(n._loadSegment(),n._gapService&&n._gapService.do(e,n.config.maxJumpDistance,n.isLive)):e.readyState<2&&n._gapService&&n._gapService.do(e,n.config.maxJumpDistance,!e.currentTime||n.isLive)),n.isLive||n._tryEos()}})),n.config=e=_c(e),n.media=n.config.media,n._manifestLoader=new hu(yo(n)),n._segmentLoader=new Su(yo(n)),n._playlist=new gu(yo(n)),n._bufferService=new yc(yo(n)),e.seiInTime&&(n._seiService=new Oa(yo(n))),e.softDecode||(n._gapService=new Ra),n._stats=new Na(yo(n),9e4),n.media.addEventListener("loadeddata",n._onLoadeddata),n.media.addEventListener("play",n._onPlay),n.media.addEventListener("pause",n._onPause),n.media.addEventListener("seeking",n._onSeeking),n.media.addEventListener("timeupdate",n._onTimeupdate),n}return co(i,[{key:"isLive",get:function(){return this._playlist.isLive}},{key:"streams",get:function(){return this._playlist.streams}},{key:"currentStream",get:function(){return this._playlist.currentStream}},{key:"hasSubtitle",get:function(){return this._playlist.hasSubtitle}},{key:"totalDuration",get:function(){return this._playlist.totalDuration}},{key:"baseDts",get:function(){var e;return null===(e=this._bufferService)||void 0===e?void 0:e.baseDts}},{key:"abrSwitchPoint",get:function(){var e=this._urlSwitching?this._playlist.currentSegment:this._playlist.nextSegment;return e?e.start+e.duration/2:null}},{key:"speedInfo",value:function(){return this._segmentLoader.speedInfo()}},{key:"bufferInfo",value:function(){var e,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:.1;return la.info(la.get(this.media),null===(e=this.media)||void 0===e?void 0:e.currentTime,t)}},{key:"getStats",value:function(){return this._stats.getStats()}},{key:"playbackQuality",value:function(){return Ia(this.media)}},{key:"load",value:function(){var e=oo(no().mark((function e(){var t,i,n,s=arguments;return no().wrap((function(e){while(1)switch(e.prev=e.next){case 0:return t=s.length>0&&void 0!==s[0]?s[0]:"",i=s.length>1&&void 0!==s[1]?s[1]:{},n="boolean"===typeof i?i:!(null===i||void 0===i||!i.reuseMse),"object"===so(i)&&null!==i&&void 0!==i&&i.clearSwitchStatus&&(this._urlSwitching=!1,this._switchUrlOpts=null,this.config.startTime=void 0),t&&(this.config.url=t),t=this.config.url,e.next=8,this._reset(n);case 8:return e.next=10,this._loadData(t);case 10:this._startTick();case 11:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}()},{key:"_loadData",value:function(){var e=oo(no().mark((function e(t){var i,n,s,r,o,a,l,c,u,h,d,p,f;return no().wrap((function(e){while(1)switch(e.prev=e.next){case 0:try{t&&(t=t.trim())}catch(g){}if(t){e.next=3;break}throw this._emitError(new da(ua.OTHER,ua.SUB_TYPES.OPTION,null,null,"m3u8 url is missing"));case 3:return e.next=5,this._loadM3U8(t);case 5:if(i=e.sent,n=this._playlist.currentStream,!this._urlSwitching){e.next=23;break}if(!this.isLive){e.next=14;break}s=this._playlist.setNextSegmentBySN(this._prevSegSn),Eu.log("segment nb=".concat(this._prevSegSn," index of ").concat(s," in the new playlist")),-1===s&&(this._prevSegCc=null,this._prevSegSn=null),e.next=23;break;case 14:if(0===n.bitrate&&null!==(r=this._switchUrlOpts)&&void 0!==r&&r.bitrate&&(n.bitrate=null===(l=this._switchUrlOpts)||void 0===l?void 0:l.bitrate),c="number"===typeof(null===(o=this._switchUrlOpts)||void 0===o?void 0:o.startTime)?null===(a=this._switchUrlOpts)||void 0===a?void 0:a.startTime:this._getSeamlessSwitchPoint(),this.config.startTime=c,u=this._playlist.findSegmentIndexByTime(c),h=this._playlist.getSegmentByIndex(u+1),!h){e.next=23;break}return d=h.start,e.next=23,this._bufferService.removeBuffer(d);case 23:if(i){e.next=25;break}return e.abrupt("return");case 25:if(!this.isLive){e.next=36;break}if(this._bufferService.setLiveSeekableRange(0,4294967295),Eu.log("totalDuration first time got:",this._playlist.totalDuration),Eu.log("nb segments got:",this._playlist.nbSegments),this.config.targetLatency<this._playlist.totalDuration&&(this.config.targetLatency=this._playlist.totalDuration,this.config.maxLatency=1.5*this.config.targetLatency),i.isMaster||this._pollM3U8(t),!(this._playlist.nbSegments<this.config.minSegmentsStartPlay)){e.next=33;break}return e.abrupt("return");case 33:return e.next=35,this._loadSegment();case 35:return e.abrupt("return");case 36:return e.next=38,this._bufferService.updateDuration(n.totalDuration);case 38:return p=this.config.startTime,p&&(null!==(f=this._switchUrlOpts)&&void 0!==f&&f.seamless||(this.media.currentTime=p),this._playlist.setNextSegmentByIndex(this._playlist.findSegmentIndexByTime(p)||0)),e.next=42,this._loadSegment();case 42:case"end":return e.stop()}}),e,this)})));function t(t){return e.apply(this,arguments)}return t}()},{key:"replay",value:function(){var e=oo(no().mark((function e(t){return no().wrap((function(e){while(1)switch(e.prev=e.next){case 0:return this.config.startTime=0,this._urlSwitching=!1,this._switchUrlOpts=null,e.next=5,this.load();case 5:return this._reloadOnPlay=!1,e.abrupt("return",this.media.play(!t));case 7:case"end":return e.stop()}}),e,this)})));function t(t){return e.apply(this,arguments)}return t}()},{key:"switchURL",value:function(){var e=oo(no().mark((function e(t){var i,n,s,r,o,a,l,c=arguments;return no().wrap((function(e){while(1)switch(e.prev=e.next){case 0:i=c.length>1&&void 0!==c[1]?c[1]:{},n={seamless:!1,startTime:0,bitrate:0},e.t0=so(i),e.next="number"===e.t0?5:"boolean"===e.t0?7:"object"===e.t0?9:11;break;case 5:return i={startTime:i},e.abrupt("break",12);case 7:return i={seamless:i},e.abrupt("break",12);case 9:for(s in i)void 0!==i[s]&&null!==i[s]||delete i[s];return e.abrupt("break",12);case 11:throw"unsupported switchURL args: ".concat(i);case 12:if(i=Object.assign({},n,i),r=i,o=r.seamless,a=r.startTime,this.config.url=t,this.config.startTime=a,this._switchUrlOpts=i,o){e.next=38;break}if(e.prev=18,!this.config.softDecode){e.next=23;break}e.t1=this.load(t),e.next=26;break;case 23:return e.next=25,this.load(t);case 25:e.t1=e.sent;case 26:l=e.t1,e.next=33;break;case 29:throw e.prev=29,e.t2=e["catch"](18),this.emit(dc.SWITCH_URL_FAILED,e.t2),e.t2;case 33:return this._reloadOnPlay=!1,l&&this.emit(dc.SWITCH_URL_SUCCESS,{url:t}),e.abrupt("return",this.media.play(!0));case 38:return this._urlSwitching=!0,this.isLive||(this._prevSegSn=null,this._prevSegCc=null),this._playlist.reset(),this._bufferService.seamlessSwitch(),e.next=44,this._clear();case 44:return e.next=46,this._loadData(t);case 46:this._startTick();case 47:this._switchUrlOpts=null;case 48:case"end":return e.stop()}}),e,this,[[18,29]])})));function t(t){return e.apply(this,arguments)}return t}()},{key:"switchStream",value:function(){var e=oo(no().mark((function e(t){var i,n,s,r,o,a=arguments;return no().wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(i=!(a.length>1&&void 0!==a[1])||a[1],n=this.currentStream,s=this.streams,n&&n.id!==t&&s&&!(s.length<2)){e.next=5;break}return e.abrupt("return");case 5:if(r=s.find((function(e){return e.id===t})),r){e.next=8;break}return e.abrupt("return");case 8:return e.prev=8,e.next=11,this._clear();case 11:if(!i){e.next=14;break}return e.next=14,this._bufferService.clearAllBuffer();case 14:e.next=19;break;case 16:throw e.prev=16,e.t0=e["catch"](8),this._emitError(da.create(e.t0));case 19:if(n.currentAudioStream&&r.audioStreams.length>2&&(o=n.currentAudioStream.id,r.currentAudioStream=r.audioStreams.find((function(e){return e.id===o}))||r.currentAudioStream),this._playlist.currentStream=r,e.prev=21,!this.isLive&&r.segments.length){e.next=25;break}return e.next=25,this._refreshM3U8();case 25:return this._playlist.setNextSegmentByIndex(this._playlist.findSegmentIndexByTime(this.media.currentTime)||0),this._prevSegCc=null,e.next=29,this._loadSegmentDirect();case 29:e.next=35;break;case 31:throw e.prev=31,e.t1=e["catch"](21),this._playlist.currentStream=n,e.t1;case 35:return this._startTick(),e.abrupt("return",r);case 37:case"end":return e.stop()}}),e,this,[[8,16],[21,31]])})));function t(t){return e.apply(this,arguments)}return t}()},{key:"switchAudioStream",value:function(){var e=oo(no().mark((function e(t){var i,n,s,r,o=arguments;return no().wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(i=!(o.length>1&&void 0!==o[1])||o[1],n=this.currentStream,n){e.next=4;break}return e.abrupt("return");case 4:if(s=n.currentAudioStream,s&&s.id!==t&&!(n.audioStreams.length<2)){e.next=7;break}return e.abrupt("return");case 7:if(r=n.audioStreams.find((function(e){return e.id===t})),r){e.next=10;break}return e.abrupt("return");case 10:return e.prev=10,e.next=13,this._clear();case 13:if(!i){e.next=16;break}return e.next=16,this._bufferService.clearAllBuffer();case 16:e.next=21;break;case 18:throw e.prev=18,e.t0=e["catch"](10),this._emitError(da.create(e.t0));case 21:if(n.currentAudioStream=r,e.prev=22,!this.isLive&&r.segments.length){e.next=26;break}return e.next=26,this._refreshM3U8();case 26:return this._playlist.setNextSegmentByIndex(this._playlist.findSegmentIndexByTime(this.media.currentTime)||0),this._prevSegCc=null,e.next=30,this._loadSegmentDirect();case 30:e.next=36;break;case 32:throw e.prev=32,e.t1=e["catch"](22),n.currentAudioStream=s,e.t1;case 36:return this._startTick(),e.abrupt("return",r);case 38:case"end":return e.stop()}}),e,this,[[10,18],[22,32]])})));function t(t){return e.apply(this,arguments)}return t}()},{key:"switchSubtitleStream",value:function(){var e=oo(no().mark((function e(t){return no().wrap((function(e){while(1)switch(e.prev=e.next){case 0:return this._playlist.switchSubtitle(t),e.next=3,this._manifestLoader.stopPoll();case 3:return e.next=5,this._refreshM3U8();case 5:case"end":return e.stop()}}),e,this)})));function t(t){return e.apply(this,arguments)}return t}()},{key:"detachMedia",value:function(){var e=oo(no().mark((function e(){return no().wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(!this._bufferService){e.next=3;break}return e.next=3,this._bufferService.detachMedia();case 3:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}()},{key:"destroy",value:function(){var e=oo(no().mark((function e(){var t;return no().wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(this.media){e.next=2;break}return e.abrupt("return");case 2:return this.removeAllListeners(),this._playlist.reset(),this._segmentLoader.reset(),null===(t=this._seiService)||void 0===t||t.reset(),this.media.removeEventListener("loadeddata",this._onLoadeddata),this.media.removeEventListener("play",this._onPlay),this.media.removeEventListener("pause",this._onPause),this.media.removeEventListener("seeking",this._onSeeking),this.media.removeEventListener("timeupdate",this._onTimeupdate),e.next=13,Promise.all([this._clear(),this._bufferService.destroy()]);case 13:this.media=null;case 14:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}()},{key:"_loadM3U8",value:function(){var e=oo(no().mark((function e(t){var i,n,s,r,o,a,l;return no().wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(e.prev=0,r=null===(n=this.config.manifestList)||void 0===n||null===(s=n.filter((function(e){return e.url===t}))[0])||void 0===s?void 0:s.manifest,!r){e.next=6;break}e.t0=this._manifestLoader.parseText(r,t),e.next=9;break;case 6:return e.next=8,this._manifestLoader.load(t);case 8:e.t0=e.sent;case 9:o=e.t0,a=So(o,1),i=a[0],e.next=17;break;case 14:throw e.prev=14,e.t1=e["catch"](0),this._emitError(da.create(e.t1));case 17:if(i){e.next=19;break}return e.abrupt("return");case 19:if(this._playlist.upsertPlaylist(i),!i.isMaster){e.next=24;break}return null!==(l=this._playlist.currentStream.subtitleStreams)&&void 0!==l&&l.length&&this.emit(dc.SUBTITLE_PLAYLIST,{list:this._playlist.currentStream.subtitleStreams}),e.next=24,this._refreshM3U8();case 24:return this.emit(dc.STREAM_PARSED),e.abrupt("return",i);case 26:case"end":return e.stop()}}),e,this,[[0,14]])})));function t(t){return e.apply(this,arguments)}return t}()},{key:"_refreshM3U8",value:function(){var e,t,i=this,n=this._playlist.currentStream;if(!n||!n.url)throw this._emitError(da.create(null,null,new Error("m3u8 url is not defined")));var s=n.url,r=null===(e=n.currentAudioStream)||void 0===e?void 0:e.url,o=null===(t=n.currentSubtitleStream)||void 0===t?void 0:t.url;return this._manifestLoader.load(s,r,o).then((function(e){var t=So(e,3),n=t[0],a=t[1],l=t[2];n&&(i._playlist.upsertPlaylist(n,a,l),i.isLive&&i._pollM3U8(s,r,o))})).catch((function(e){throw i._emitError(da.create(e))}))}},{key:"_pollM3U8",value:function(e,t,i){var n,s,r=this,o=this._playlist.isEmpty;this._playlist.lowLatency?n=1e3*(this._playlist.currentStream.partTargetDuration||0):n=1e3*((null===(s=this._playlist.lastSegment)||void 0===s?void 0:s.duration)||0);this._manifestLoader.poll(e,t,i,(function(e,t,i){r._playlist.upsertPlaylist(e,t,i),r._playlist.clearOldSegment();var n=e&&o&&!r._playlist.isEmpty;(n||!r._playlist.hadSegmentLoaded&&r._playlist.nbSegments>=r.config.minSegmentsStartPlay)&&r._loadSegment(),o&&(o=r._playlist.isEmpty)}),(function(e){r._emitError(da.create(e))}),n)}},{key:"_loadSegmentDirect",value:function(){var e=oo(no().mark((function e(t){var i,n,s,r,o,a;return no().wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(i=this._playlist.nextSegment,i){e.next=3;break}return e.abrupt("return");case 3:return n=!1,s=null,e.prev=5,this._segmentProcessing=!0,Eu.log("load segment, sn:".concat(i.sn,", [").concat(i.start,", ").concat(i.end,"], partIndex:").concat(i.partIndex)),e.next=10,this._reqAndBufferSegment(i,this._playlist.getAudioSegment(i));case 10:n=e.sent,e.next=16;break;case 13:e.prev=13,e.t0=e["catch"](5),s=e.t0;case 16:return e.prev=16,this._segmentProcessing=!1,e.finish(16);case 19:if(!s){e.next=26;break}if(!this._bufferService.isFull()){e.next=25;break}return Eu.log("load segment, sn:".concat(i.sn,", partIndex:").concat(i.partIndex)),this._segmentProcessing=!0,this._isProcessQuotaExceeded=!0,e.abrupt("return",!1);case 25:return e.abrupt("return",this._emitError(da.create(s)));case 26:return n&&(o=this.bufferInfo().end,this.isLive&&!this.media.seeking&&o&&Math.abs(i.end-o)>1&&(Eu.warn("segment: ".concat(i.sn," expected end=").concat(i.end,", real end=").concat(o)),this._playlist.feedbackLiveEdge(i,o)),a=(null===(r=this._playlist.currentStream)||void 0===r?void 0:r.url)===i.parentUrl,this._urlSwitching&&!a&&(Eu.warn("pre playlist segment appended!"),this._bufferService.seamlessSwitch()),this.isLive&&this._urlSwitching&&a&&(this._urlSwitching=!1,this.emit(dc.SWITCH_URL_SUCCESS,{url:this.config.url})),this._playlist.moveSegmentPointer(),i.isLast?this._end():t||this._loadSegment()),e.abrupt("return",n);case 28:case"end":return e.stop()}}),e,this,[[5,13,16,19]])})));function t(t){return e.apply(this,arguments)}return t}()},{key:"_reqAndBufferSegment",value:function(){var e=oo(no().mark((function e(t,i){var n,s,r,o,a,l,c,u,h,d,p;return no().wrap((function(e){while(1)switch(e.prev=e.next){case 0:return s=t?t.cc:i.cc,r=this._prevSegCc!==s,o=[],e.prev=3,e.next=6,this._segmentLoader.load(t,i,r);case 6:o=e.sent,e.next=14;break;case 9:throw e.prev=9,e.t0=e["catch"](3),e.t0.fatal=!1,this._segmentLoader.error=e.t0,e.t0;case 14:if(o[0]){e.next=16;break}return e.abrupt("return");case 16:return e.next=18,(n=this._bufferService).decryptBuffer.apply(n,Eo(o));case 18:if(a=e.sent,a){e.next=21;break}return e.abrupt("return");case 21:return l=t?t.sn:i.sn,c=t?t.start:i.start,u=this._playlist.currentStream,this._bufferService.createSource(a[0],a[1],null===u||void 0===u?void 0:u.videoCodec,null===u||void 0===u?void 0:u.audioCodec),h=Date.now(),d=this._prevSegSn===l-1,this.isLive&&this._urlSwitching&&(p=this.bufferInfo().end,this._playlist.updateSegmentsRanges(l,p),Eu.warn("update the new playlist liveEdge, segment id=".concat(l,", buffer start=").concat(p,", liveEdge=").concat(this._playlist.liveEdge)),c=p),e.next=30,this._bufferService.appendBuffer(t,i,a[0],a[1],r,d,c);case 30:return this.emit(dc.APPEND_COST,{elapsed:Date.now()-h,url:t.url}),e.next=33,this._bufferService.evictBuffer(this.config.bufferBehind);case 33:return this._prevSegCc=s,this._prevSegSn=l,e.abrupt("return",!0);case 36:case"end":return e.stop()}}),e,this,[[3,9]])})));function t(t,i){return e.apply(this,arguments)}return t}()},{key:"_onCheckQuotaExceeded",value:function(){var e=oo(no().mark((function e(){var t,i,n,s,r,o;return no().wrap((function(e){while(1)switch(e.prev=e.next){case 0:t=this.media.currentTime,i=this.media.buffered,n=!1,s=0;case 4:if(!(s<i.length)){e.next=11;break}if(!(i.start(0)>=t&&t<i.end(s))){e.next=8;break}return n=!0,e.abrupt("break",11);case 8:s++,e.next=4;break;case 11:if(!this._bufferService.isFull()){e.next=17;break}if(r=n?this.config.bufferBehind:5,o=this.media.currentTime,!(o-r>0)){e.next=17;break}return e.next=17,this._bufferService.removeBuffer(0,o-r);case 17:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}()},{key:"_checkStreamTrackChange",value:function(e){var t=this._playlist.checkSegmentTrackChange(e,this._bufferService.nbSb);t&&this.switchURL(this.config.url,t.start+.2)}},{key:"_clear",value:function(){var e=oo(no().mark((function e(){return no().wrap((function(e){while(1)switch(e.prev=e.next){case 0:return clearTimeout(this._disconnectTimer),this._stopTick(),e.next=4,Promise.all([this._segmentLoader.cancel(),this._manifestLoader.stopPoll()]);case 4:this._segmentProcessing=!1;case 5:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}()},{key:"_reset",value:function(){var e=oo(no().mark((function e(){var t,i,n=arguments;return no().wrap((function(e){while(1)switch(e.prev=e.next){case 0:return i=n.length>0&&void 0!==n[0]&&n[0],this._reloadOnPlay=!1,this._prevSegSn=null,this._prevSegCc=null,this._switchUrlOpts=null,this._playlist.reset(),this._segmentLoader.reset(),null===(t=this._seiService)||void 0===t||t.reset(),this._stats.reset(),e.next=11,this._clear();case 11:return e.abrupt("return",this._bufferService.reset(i));case 12:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}()},{key:"_end",value:function(){this._clear(),this._bufferService.endOfStream(),(this.media.readyState<=2||this.media.buffered.length>1)&&this._startTick()}},{key:"_stopTick",value:function(){this._tickTimer&&clearTimeout(this._tickTimer),this._tickTimer=null}},{key:"_startTick",value:function(){this._stopTick(),this._tickTimer=setTimeout(this._tick,this._tickInterval)}},{key:"_emitError",value:function(e){var t,i,n,s,r=arguments.length>1&&void 0!==arguments[1]&&arguments[1];!1===(null===(t=e.originError)||void 0===t?void 0:t.fatal)?Eu.warn(e):(Eu.table(e),Eu.error(e),Eu.error(null===(i=this.media)||void 0===i?void 0:i.error),null!==(n=this.media)&&void 0!==n&&n.readyState&&this.media.pause(),this._stopTick(),this._urlSwitching&&(this._urlSwitching=!1,this.emit(dc.SWITCH_URL_FAILED,e)),this.emit(dc.ERROR,e),r&&this._end(),null===(s=this._seiService)||void 0===s||s.reset());return e}},{key:"_getSeamlessSwitchPoint",value:function(){var e=this.media,t=e.currentTime;if(!e.paused){var i,n=this._playlist.findSegmentIndexByTime(e.currentTime),s=this._playlist.getSegmentByIndex(n),r=null===(i=this._stats)||void 0===i?void 0:i.getStats().downloadSpeed;if(r&&s){var o=s.duration*this._playlist.currentStream.bitrate/r+1;t+=o}else t+=5}return t}},{key:"_tryEos",value:function(){var e,t,i=this.media,n=this._playlist,s=n.nextSegment,r=n.lastSegment,o=(!s||r&&la.isBuffered(i,r.start+r.duration/2))&&i.readyState&&i.duration>0&&(null===(e=this._bufferService)||void 0===e?void 0:e.msIsOpened)&&!(null!==(t=this._bufferService)&&void 0!==t&&t.msHasOpTasks);if(o){var a=this.bufferInfo();i.paused&&!i.currentTime&&(a=this.bufferInfo(a.nextStart||.5));var l=Math.abs(a.end-i.duration)<.1||!this.isLive&&r&&a.end>=r.start+r.duration;l&&this._bufferService.endOfStream()}}}],[{key:"isSupported",value:function(e){return e&&"video"!==e&&"audio"!==e?"undefined"!==typeof WebAssembly:Ca.isSupported()}},{key:"enableLogger",value:function(){ma.enable(),al.enable()}},{key:"disableLogger",value:function(){ma.disable(),al.disable()}}]),i}(V());uo(Tu,"version","3.0.20");try{localStorage.getItem("xgd")?Tu.enableLogger():Tu.disableLogger()}catch(Ou){}var ku=function(){function e(t,i){var n=this;ao(this,e),uo(this,"_opts",null),uo(this,"_plugin",null),uo(this,"_onLowDecode",(function(){var e,t,i,s,r=n._opts,o=r.media,a=r.innerDegrade;null===(e=n._plugin)||void 0===e||null===(t=e.player)||void 0===t||t.emit("lowdecode",o.degradeInfo),null===(i=n._plugin)||void 0===i||null===(s=i.player)||void 0===s||s.emit("core_event",io(io({},o.degradeInfo),{},{eventName:dc.LOWDECODE})),1===a&&n._degrade(o.src)})),uo(this,"_degrade",(function(e){var t=n._plugin.player,i=t.video;if(!i||"MVideo"===i.TAG){var s=t.video.degradeVideo;t.video=s,i.degrade(e),e&&(t.config.url=e);var r=t.root.firstChild;"MVideo"===r.TAG&&t.root.replaceChild(s,r);var o=n._plugin.constructor.pluginName.toLowerCase();t.unRegisterPlugin(o),t.once("canplay",(function(){t.play()}))}})),uo(this,"forceDegradeToVideo",(function(e){var t=n._opts.innerDegrade;1===t&&n._degrade(e)})),this._opts=t,this._plugin=i,this._init()}return co(e,[{key:"_init",value:function(){var e=this._opts,t=e.media,i=e.preloadTime,n=e.innerDegrade,s=e.isLive;t&&(s||!t.setPlayMode?(n&&t.setAttribute("innerdegrade",n),i&&t.setAttribute("preloadtime",i),this._bindEvents()):t.setPlayMode("VOD"))}},{key:"_bindEvents",value:function(){var e=this._opts.media;e.addEventListener("lowdecode",this._onLowDecode)}},{key:"destroy",value:function(){var e,t;null===(e=this._opts)||void 0===e||null===(t=e.media)||void 0===t||t.removeEventListener("lowdecode",this._onLowDecode),this._plugin=null}}]),e}(),wu=["currentTime"];function xu(e,t){var i=t.player,n=i.currentTime,s={startTime:n};switch(so(e)){case"boolean":s.seamless=e;break;case"object":var r=e.currentTime,o=vo(e,wu);Object.assign(s,o),"number"===typeof r&&(s.startTime=r);break}return s}var Cu=function(e){ho(i,e);var t=bo(i);function i(){var e;ao(this,i);for(var n=arguments.length,s=new Array(n),r=0;r<n;r++)s[r]=arguments[r];return e=t.call.apply(t,[this].concat(s)),uo(yo(e),"logger",Eu),uo(yo(e),"hls",null),uo(yo(e),"pluginExtension",null),uo(yo(e),"getStats",(function(){var t;return null===(t=e.hls)||void 0===t?void 0:t.getStats()})),uo(yo(e),"_onSwitchSubtitle",(function(t){var i,n=t.lang;null===(i=e.hls)||void 0===i||i.switchSubtitleStream(n)})),uo(yo(e),"_keepPauseStatus",(function(){var t=e.player.paused;t&&e.player.once("canplay",(function(){e.player.pause()}))})),e}return co(i,[{key:"core",get:function(){return this.hls}},{key:"version",get:function(){var e;return null===(e=this.hls)||void 0===e?void 0:e.version}},{key:"softDecode",get:function(){var e,t,i=null===(e=this.player)||void 0===e||null===(t=e.config)||void 0===t?void 0:t.mediaType;return!!i&&"video"!==i&&"audio"!==i}},{key:"beforePlayerInit",value:function(){var e=this,t=this.player.config,i=this.player.media||this.player.video,n=t.hls||{};if((t.url||t.__allowHlsEmptyUrl__)&&(n.preferMMS||!Ca.isMMSOnly())){this.hls&&this.hls.destroy();var s=Object.getOwnPropertyDescriptor(this.player,"switchURL");s&&!s.writable||(this.player.switchURL=function(t,i){return new Promise((function(n,s){var r=e.player,o=e.hls;if(o){var a,l,c=xu(i,e);r.config.url=t,o.switchURL(t,c).then((function(){return n(!0)})).catch(s),!c.seamless&&null!==(a=e.player.config)&&void 0!==a&&null!==(l=a.hls)&&void 0!==l&&l.keepStatusAfterSwitch&&e._keepPauseStatus()}else s()}))});var r,o=this.player.switchURL;if(this.player.handleSource=!1,n.innerDegrade=n.innerDegrade||t.innerDegrade,null!==n.disconnectTime&&void 0!==n.disconnectTime||(n.disconnectTime=0),this.hls=new Tu(io({softDecode:this.softDecode,isLive:t.isLive,media:i,startTime:t.startTime,url:t.url},n)),this.softDecode||Ot.defineGetterOrSetter(this.player,{url:{get:function(){var t,i;return null===(t=e.hls)||void 0===t||null===(i=t.media)||void 0===i?void 0:i.src},configurable:!0}}),this.softDecode&&(this.pluginExtension=new ku(io({isLive:t.isLive,media:i},n),this),this.player.forceDegradeToVideo=function(){for(var t,i=arguments.length,n=new Array(i),s=0;s<i;s++)n[s]=arguments[s];return null===(t=e.pluginExtension)||void 0===t?void 0:t.forceDegradeToVideo.apply(t,n)}),t.isLive)null===(r=this.player)||void 0===r||r.useHooks("replay",(function(){var t;return null===(t=e.hls)||void 0===t?void 0:t.replay()}));this.on(je,o),this.on(ht||"switch_subtitle",this._onSwitchSubtitle),this.on(He,this.destroy.bind(this)),this._transError(),this._transCoreEvent(Aa.TTFB),this._transCoreEvent(Aa.LOAD_START),this._transCoreEvent(Aa.LOAD_RESPONSE_HEADERS),this._transCoreEvent(Aa.LOAD_COMPLETE),this._transCoreEvent(Aa.LOAD_RETRY),this._transCoreEvent(Aa.SOURCEBUFFER_CREATED),this._transCoreEvent(Aa.MEDIASOURCE_OPENED),this._transCoreEvent(Aa.APPEND_BUFFER),this._transCoreEvent(Aa.REMOVE_BUFFER),this._transCoreEvent(Aa.BUFFEREOS),this._transCoreEvent(Aa.KEYFRAME),this._transCoreEvent(Aa.METADATA_PARSED),this._transCoreEvent(Aa.DEMUXED_TRACK),this._transCoreEvent(Aa.SEI),this._transCoreEvent(Aa.SEI_IN_TIME),this._transCoreEvent(Aa.SPEED),this._transCoreEvent(Aa.HLS_MANIFEST_LOADED),this._transCoreEvent(Aa.HLS_LEVEL_LOADED),this._transCoreEvent(Aa.STREAM_EXCEPTION),this._transCoreEvent(Aa.SWITCH_URL_SUCCESS),this._transCoreEvent(Aa.SWITCH_URL_FAILED),this._transCoreEvent(dc.NO_AUDIO_TRACK),this._transCoreEvent(dc.STREAM_PARSED),this._transCoreEvent(dc.SUBTITLE_SEGMENTS),this._transCoreEvent(dc.SUBTITLE_PLAYLIST),this._transCoreEvent(dc.APPEND_COST),t.url&&this.hls.load(t.url,{reuseMse:!0}).catch((function(e){}))}}},{key:"destroy",value:function(){var e;this.hls&&(this.hls.destroy(),this.hls=null),null===(e=this.pluginExtension)||void 0===e||e.destroy(),this.pluginExtension=null}},{key:"_transError",value:function(){var e=this;this.hls.on(dc.ERROR,(function(t){e.player&&e.player.emit(pe,new le(e.player,t))}))}},{key:"_transCoreEvent",value:function(e){var t=this;this.hls.on(e,(function(i){t.player&&(t.player.emit("core_event",io(io({},i),{},{eventName:e})),e===Aa.SEI_IN_TIME&&t.hls.hasSubtitle&&t._emitSeiPaylodTime(i))}))}},{key:"_emitSeiPaylodTime",value:function(e){try{var t=JSON.parse(Array.from(e.data.payload).map((function(e){return String.fromCharCode(e)})).join("").slice(0,-1));if(!t["rtmp_dts"])return;this.player.emit("core_event",{eventName:dc.SEI_PAYLOAD_TIME,time:t["rtmp_dts"]})}catch(i){}}}],[{key:"pluginName",get:function(){return"hls"}},{key:"isSupported",value:function(e,t){return Tu.isSupported(e,t)}}]),i}(Ot);uo(Cu,"Hls",Tu),uo(Cu,"EVENT",dc);var Au=i(2392),Pu={name:"Info",components:{Title:B.A,Card:F.A,Pagination:Au.A},data(){return{id:"",data:{},_ads:[],videos:[],player:null,relatedMap:{"ko-KR":"관련동영상","en-US":"Related videos","zh-CN":"相关视频"},moreRelatedMap:{"ko-KR":"관련 영상 더 보기","en-US":"More related videos","zh-CN":"更多相关视频"},classifyName:"",classifyId:"",specialId:"",pageNum:1,pageSize:20,total:10}},computed:{...(0,H.aH)({ads:e=>e.common.ads,menus:e=>e.common.menus,language:e=>e.common.language})},watch:{$route:{handler(e){"info"==e.name&&(this.id=this.$route.query.id,this.initData(),this.classifyName=this.$route.query.classifyName,this.classifyId=this.$route.query.classifyId,this.specialId=this.$route.query.specialId)},immediate:!0},ads(e){this._ads=JSON.parse(JSON.stringify(e))}},methods:{...(0,H.i0)({toggleLoading:"common/toggleLoading"}),handlePageChange(e){this.pageNum=e,this.getVideos()},goAd(e){window.open(e)},formatTime(e){return U()(e).format("YYYY-MM-DD")},async getVideoInfo(){this.toggleLoading(!0);try{let{data:e,code:t}=await M.G5({id:this.id});200==t&&(this.data=e,this.initPlayer(),this.getMenuInfo())}catch(e){}finally{this.toggleLoading(!1)}},async getMenuInfo(){try{let{data:e,code:t}=await M.Mz({id:this.data.classifyId});200==t&&(this.classifyInfo=e)}catch(e){}finally{this.toggleLoading(!1)}},async getVideos(){try{let{rows:e,code:t,total:i}=await M.fY({pageNum:this.pageNum,pageSize:this.pageSize,classifyId:this.data.classifyId,specialId:this.data.specialId});200==t&&(this.videos=e,this.total=i)}catch(e){}},goHome(){this.$router.push("index")},goCategory(){this.$router.push({name:"category",query:{classifyId:this.data.classifyId,specialId:this.data.specialId,classifyName:""}})},initPlayer(){const e={id:"video-info",fluid:!0,volume:.9,autoplay:!1,videoInit:!0,loop:!0,defaultPlaybackRate:1,url:this.data.video,playsinline:!0,poster:this.data.videoCover,plugins:[Cu],isLive:!1,playbackRate:[null],rotate:{clockwise:!0,innerRotate:!0},pip:!0,rotateFullscreen:!0};new Jr(e)},initData(){if(this.player&&this.player.dispose(),this.id=this.$route.query.id,this.getVideoInfo(),this.menus&&this.menus.length){let e=24*(this.menus.length+1)+1,t=Math.ceil(e/this.ads.length),i=[];for(let n=0;n<t;n++)i=i.concat(this.ads);i.shift(),this._ads=i}this.$nextTick((()=>{setTimeout((()=>{this.getVideos()}),1e3)}))}},beforeUnmount(){this.player&&this.player.dispose()}},Iu=i(1241);const Du=(0,Iu.A)(Pu,[["render",R],["__scopeId","data-v-d9ee5164"]]);var Lu=Du}}]);
//# sourceMappingURL=231.cbfed63f.js.map